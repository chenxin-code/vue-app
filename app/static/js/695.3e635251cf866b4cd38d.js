(window.webpackJsonp=window.webpackJsonp||[]).push([[695],{"1IMg":function(t,e,i){"use strict";i.r(e);var o=i("dqDD"),a=i("H7qB"),s=(i("iney"),{name:"select-city",components:{Toast:o.Toast},data:function(){return{cityList:[],listHeight:[],scrollY:0,touch:{},cityDomList:null,curCityListIndex:0,areaParentId:null,directCity:"",localtion:{},provinceName:""}},created:function(){var t=this;this.directCity=this.$route.query.directCity?this.$route.query.directCity:"",this.areaParentId=this.$route.query.areacode?this.$route.query.areacode:null,this.provinceName=this.$route.query.province?decodeURIComponent(this.$route.query.province):"",this.getCityList(),this.$bridgefunc.getLocation((function(e){t.localtion=e}))},mounted:function(){this.cityDomList=this.$refs.allcitybar.getElementsByClassName("city-item-list")},watch:{scrollY:function(t){var e=this.listHeight;if(t>0)this.curCityListIndex=0;else{for(var i=0;i<e.length-1;i++){var o=e[i],a=e[i+1];if(-t>=o&&-t<a)return this.curCityListIndex=i,void(this.diff=a+t)}this.currentIndex=e.length-2}}},methods:{backEvent:function(){this.$router.go(-1)},selectLocal:function(){var t=this;if("4"==this.$store.state.location.selectType){var e={province:this.localtion.province,city:this.localtion.city,district:this.localtion.area};return this.localtion.city==this.localtion.province&&(e.city=this.localtion.area,e.district=""),void this.$mallCommon.pureLocationAnalysis((function(e){sessionStorage.setItem("Address_City_Seleted",JSON.stringify(e)),t.$router.go(-1)}),e)}this.$mallCommon.addressAnalysis((function(e,i){console.log(i),t.$store.state.indexData.province=t.localtion.province,t.$store.state.indexData.city=t.localtion.city,e&&(t.$store.state.indexData.provinceId=i.provinceId,t.$store.state.indexData.cityId=i.cityId),t.$router.go(-1)}),this.localtion)},_updateArea:function(t,e,i,a){var s=this;this.$Loading.open("保存中");var r=this.$store.state.login.token,n=this.$store.state.userInfo,c={realName:n.realName?n.realName:"",gender:n.gender?n.gender:"",email:n.email?n.email:"",idType:n.idType?n.idType:"",idNumber:n.idNumber?n.idNumber:"",address:n.address?n.address:"",provinceName:t,cityName:e,provinceCode:i,cityCode:a,postCode:"",userType:"",token:r};console.log(c),this.$http.post("/app/json/user/modifyUserInfo",c).then((function(i){s.$Loading.close();var a=i.data;console.log("地区",a),0==a.status?(Object(o.Toast)({message:"修改地区成功",position:"bottom",duration:2e3}),s.$store.state.userInfo.provinceName=t,s.$store.state.userInfo.cityName=e,s.$store.state.location.selectType="0","1"==s.directCity?s.$router.go(-1):s.$router.go(-2)):Object(o.Toast)({message:a.info?a.info:"修改地区失败",position:"bottom",duration:2e3})}),(function(t){s.$Loading.close(),console.log("修改地区失败",t),Object(o.Toast)({message:"修改地区失败",position:"bottom",duration:2e3})}))},selectCity:function(t){var e=this;if(this.areaParentId){var i=this.provinceName;if("3"==this.$store.state.location.selectType)return void this._updateArea(i,t.areaName,this.areaParentId,t.areaCode);if("1"==this.$store.state.location.selectType)return this.$store.state.location.login.province=i,this.$store.state.location.login.city=t.areaName,this.$store.state.location.selectType="0",void("1"==this.directCity?this.$router.go(-1):"1"==this.$store.state.globalConfig.onlyProvince_area?this.$router.go(-1):this.$router.go(-2));if("2"==this.$store.state.location.selectType)return this.$store.state.indexData.province=i,this.$store.state.indexData.city=t.areaName,this.$store.state.indexData.cityId=t.areaCode,this.$store.state.location.selectType="0",void this.$bridgefunc.vuexStorage((function(){"1"==e.directCity?e.$router.go(-1):"1"==e.$store.state.globalConfig.onlyProvince_area?e.$router.go(-1):e.$router.go(-2)}));if("4"==this.$store.state.location.selectType){var o={cityName:t.areaName,cityId:t.areaCode,provinceId:this.areaParentId,provinceName:i};sessionStorage.setItem("Address_City_Seleted",JSON.stringify(o)),"1"==this.$store.state.globalConfig.onlyProvince_area?this.$router.go(-1):this.$router.go(-2)}}else this.$router.push({path:"/cityselector/"+t.areaCode,isnativetop:1,query:{areacode:t.areaCode,province:encodeURIComponent(t.areaName)}})},getShortName:function(t){var e=t;return-1==e.indexOf("省")&&-1==e.indexOf("市")||(e=e.substring(0,e.length-1)),e},getCityList:function(){var t=this;this.$Loading.open();var e={};this.areaParentId&&(e.areaParentId=this.areaParentId),this.$http.post("/app/json/home/getAreaList",e).then((function(e){t.$Loading.close();var i=e.data;if("1"!=t.$store.state.globalConfig.onlyProvince_area||t.areaParentId){var o=t.formCityData(i.data);t.cityList=o;var a=t;t.$nextTick((function(){a._initScroll(),a.calculateHeight()}))}else for(var s=i.data,r=0;r<s.length;r++){var n=s[r];if(t.getShortName(n.areaName)==t.getShortName(t.$store.state.globalConfig.province))return t.areaParentId=n.areaCode,t.directCity=n.areaName,t.provinceName=n.areaName,void t.getCityList()}}),(function(e){t.$Loading.close(),console.log("获取首页",e)}))},formCityData:function(t){for(var e=this,i=t.map((function(t){return{areaName:t.areaName,firstLetter:e.getFirstLetter(t.areaName),areaCode:t.areaCode}})).sort((function(t,e){return t.firstLetter.localeCompare(e.firstLetter)})).map((function(t){return{areaName:t.areaName,firstLetter:t.firstLetter.toLocaleUpperCase(),areaCode:t.areaCode}})),o={},a=0;a<i.length;a++){var s=i[a],r=s.firstLetter,n=o[r];n||(n=[]),n.push(s),o[r]=n}return o},getFirstLetter:function(t){return-1!=t.indexOf("重庆")?"C":-1!=t.indexOf("长春")?"C":pinyinUtil.getFirstLetter(t.substr(0,1),!1)[0]},_initScroll:function(){var t=this,e=this.$route.path;this.cityListScroll=new a.a(this.$refs[e],{click:!0,probeType:3}),this.cityListScroll.on("scroll",(function(e){t.scrollY=e.y}))},calculateHeight:function(){var t=this;this.$nextTick((function(){var e=t.$refs.allcitybar.getElementsByClassName("city-item-list"),i=0;t.listHeight.push(i);for(var o=0;o<e.length;o++)i+=e[o].clientHeight,t.listHeight.push(i)}))},onSelectFastTouchStart:function(t){var e=t.target.getAttribute("data-index"),i=t.touches[0];this.touch.y1=i.pageY,this.touch.anchorIndex=e;var o=this.cityDomList[e];this.scrollY=-this.listHeight[e],this.cityListScroll.scrollToElement(o)},onSelectFastTouchMove:function(t){var e=t.touches[0];this.touch.y2=e.pageY;var i=.4*parseInt(20),o=(this.touch.y2-this.touch.y1)/i|0,a=parseInt(this.touch.anchorIndex)+o,s=this.cityDomList[a];this.scrollY=-this.listHeight[a],this.cityListScroll.scrollToElement(s)}}}),r=(i("8QFf"),i("KHd+")),n=Object(r.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("nav-top",{on:{backEvent:t.backEvent}}),t._v(" "),i("nav-content",[i("div",{ref:t.$route.path,staticClass:"selectcitybottom"},[i("div",{ref:"allcitybar",staticClass:"allcity-bar"},["/cityselector/0"==t.$route.path?i("div",{staticClass:"city-item-list"},[i("div",{staticClass:"city-title-1"},[t._v("当前位置")]),t._v(" "),i("ul",[i("li",{staticClass:"city-item",on:{click:function(e){return e.stopPropagation(),t.selectLocal(e)}}},[t._v(t._s(t.localtion.city&&""!=t.localtion.city?t.localtion.city:"定位中..."))])])]):t._e(),t._v(" "),t._l(t.cityList,(function(e,o){return t.cityList?i("div",{staticClass:"city-item-list"},[i("div",{staticClass:"city-title"},[t._v(t._s(o))]),t._v(" "),i("ul",t._l(e,(function(e,o){return i("li",{staticClass:"city-item",on:{click:function(i){return i.stopPropagation(),t.selectCity(e)}}},[t._v(t._s(e.areaName)+"\n            ")])})),0)]):t._e()}))],2),t._v(" "),i("div",{staticClass:"fast-sel-bar"},t._l(t.cityList,(function(e,o,a){return i("p",{staticClass:"fast-sel-item",class:{fastSelActive:a===t.curCityListIndex},attrs:{"data-index":a},on:{touchstart:t.onSelectFastTouchStart,touchmove:function(e){return e.stopPropagation(),e.preventDefault(),t.onSelectFastTouchMove(e)}}},[t._v("\n          "+t._s(o)+"\n        ")])})),0)])])],1)}),[],!1,null,"e197fef2",null);e.default=n.exports},"8QFf":function(t,e,i){"use strict";var o=i("nDpY");i.n(o).a},nDpY:function(t,e,i){}}]);