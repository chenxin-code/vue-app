(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{"4ntK":function(t,e,i){"use strict";var a=i("YSmw");i.n(a).a},G7oN:function(t,e,i){"use strict";var a=i("QzrQ");i.n(a).a},Ht6i:function(t,e,i){"use strict";i.r(e),i("L2JU"),i("KJ3S");var a=i("A8ay"),s=i("W34l"),n=i("xN1T"),o={props:{percentage:{type:Number,default:0},color:{type:String,default:"#333"}}},r=(i("nFYi"),i("KHd+")),u=Object(r.a)(o,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"sbx-progress"},[e("div",{staticClass:"sbx-progress__portion",style:{backgroundColor:this.color,width:this.percentage+"%"}}),this._v(" "),e("div",{staticClass:"sbx-progress__pivot",style:{color:this.color}},[this._v(this._s(this.percentage)+"%")])])}),[],!1,null,"6738537a",null).exports,c={name:"get-coupon",mixins:[a.a],components:{CircleProgress:n.a,SbxProgress:u},data:function(){return{couponData:{},couActivity:{},nextCouActivity:null,receive:!1,beginTime:!1,hasCoupon:!0,dayType:"before",lastDay:!1}},props:["myIndex","usePorpData","propData"],computed:{configuration:function(){return-1==this.$store.state.webtype},btnSubmitImage:function(){var t=this.moduleData;return this.receive?"static/images/get-coupon/10.png":this.hasCoupon?t.btnImage||"static/images/get-coupon/7.png":t.btnFinishedImage||"static/images/get-coupon/11.png"},pageData:function(){return 1==this.usePorpData?this.propData:this.$store.state.pageData},moduleData:function(){return this.pageData.moduleList[this.myIndex].data},getWrapStyle:function(){var t=this.moduleData,e={};return e.backgroundImage="url("+t.bgImg+")",this.moduleData.isFloat&&(e.position=-1==this.$store.state.webtype?"absolute":"fixed",e.marginTop=t.floatUp+"px"),e},couList:function(){return this.couActivity.couList||[]}},methods:{regLastDay:function(t,e){var i=t+864e5;this.lastDay=new Date(i).getDate()==new Date(e).getDate()},getPercentage:function(){var t=0,e=0;return this.couList.map((function(i){t+=i.distRewardCnt,e+=i.limitRewardCnt})),t>=e&&(this.hasCoupon=!1),this.calCent(t,e)},testLength:function(t){return(t+"").length>1?t:"0"+t},getFilterTime:function(t){var e="xxxx年xx月xx日 xx:xx:xx";if(t){var i=new Date(t);e=i.getFullYear()+"年"+this.testLength(i.getMonth()+1)+"月"+this.testLength(i.getDate())+"日 "+this.testLength(i.getHours())+":"+this.testLength(i.getMinutes())+":"+this.testLength(i.getSeconds())}return e},hotEvent:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.actionBtnEvent(this.pageData.pgCode,this.moduleData.idCode+t)},testBegin:function(){var t=this.couActivity,e=new Date,i=new Date(t.mktStartTime),a=new Date(t.mktEndTime);if(e<i)this.dayType="before";else if(e>a)this.dayType="after";else{this.regLastDay(i,a),this.dayType="during";var s=e.getHours();this.testBeginTime(s)}},testBeginTime:function(t){var e=0;1==this.$store.state.globalConfig.yn_coupon_login_type&&(e=10),this.beginTime=t>=e&&t<24},getCouActivityAward:function(){var t=this,e=""!=this.$store.state.login.token,i=e?"/app/json/app_market/queryGetCouActivityAward":"/app/json/app_market/queryGetCouActivityAwardWithoutToken",a={provinceId:this.$store.state.indexData.provinceId||"",cityId:this.$store.state.indexData.cityId||"",countryId:this.$store.state.indexData.countryId||"",townId:this.$store.state.indexData.townId||""};this.$Loading.open(),this.$http.post(i,a).then((function(i){t.$Loading.close();var a=i.data;if(0==a.status&&a.data){t.couponData=a.data;for(var s=0;s<a.data.length;s++){var n=a.data[s].activityModelList;if(n.length){t.setCouActivity(n),t.testBegin(),e&&t.testReceive(t.couList);break}}}t.pageInit=!0}))},getTime:function(t){return new Date(t).getTime()},setCouActivity:function(t){var e=this,i={},a=t.sort((function(t,i){return e.getTime(t.mktStartTime)-e.getTime(i.mktStartTime)})),s=a.filter((function(t){return e.getTime(t.mktEndTime)>=Date.now()}));s.length?(i=s[0],s[1]&&(this.nextCouActivity=s[1])):i=a[a.length-1],this.couActivity=i},existCoupon:function(){var t=!0;if(this.couList.length){var e=this.couList[0];Number(e.distRewardCnt)>=Number(e.limitRewardCnt)&&(t=!1)}else t=!1;return t},showMessageBox:function(t){var e=this;this.$MessageBox.alert(t,"提示",{confirmButtonText:"确定"}).then((function(t){e.$router.replace({path:"/usercenter/downloadshare",query:{fromCoupon:"1"}})}))},getCoupons:function(){var t=""!=this.$store.state.login.token;this.testBegin(),t&&this.receive?this.$market.goCouponsTarget(this.moduleData):this.existCoupon()?this.$market.getCoupons(this.couActivity.mktActivityId,this.moduleData):this.showMessageBox("券已领完，下次请早点来，下载APP参加更多活动。")},testReceive:function(t){t.length&&-1==t[0].state&&this.existCoupon()&&(this.receive=!0)},calCent:function(t,e){if(t&&e){var i=Math.floor(parseInt(t/e*1e4))/100;return i>=100?100:i}return 0}},filters:{discount:function(t){var e=void 0;switch(t.couCategory){case 20:var i=Number(t.couFaceValue)>100?parseInt(t.couFaceValue):t.couFaceValue;e="满"+t.couThresholdAmount+"元减"+i+"元";break;case 40:var a=1e3*t.couDiscountValue/100;e="满"+t.couThresholdAmount+"元享"+a+"折";break;default:e="立减"+t.couFaceValue+"元"}return e}},created:function(){try{wx,s.a.hideMeItems(["menuItem:share:appMessage","menuItem:share:timeline","menuItem:copyUrl","menuItem:editTag","menuItem:delete","menuItem:originPage","menuItem:readMode","menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:share:email","menuItem:share:brand","menuItem:share:qq","menuItem:share:weiboApp","menuItem:favorite","menuItem:share:facebook","menuItem:share:QZone"])}catch(t){}this.getCouActivityAward()}},h=(i("G7oN"),Object(r.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"get-coupon",class:{isFloat:t.moduleData.isFloat},style:t.getWrapStyle},[t.configuration?i("div",{staticClass:"coupon-group coupon-show"},[i("img",{attrs:{src:"static/images/get-coupon/8.png"}})]):[t.couList.length?[i("ul",{staticClass:"coupon-group"},t._l(t.couList,(function(e,a){return i("li",{key:e.ruleId,staticClass:"coupon-list"},[t._m(0,!0),t._v(" "),i("div",{staticClass:"coupon-info"},[i("div",{staticClass:"conpon-info-col_1"},[i("div",{staticClass:"row-title"},[t._v(t._s(e.couTypeTitle))]),t._v(" "),i("div",{staticClass:"row-discount"},[t._v(t._s(t._f("discount")(e)))])]),t._v(" "),i("div",{staticClass:"conpon-info-col_2"},[t.receive?i("div",[t._v("待使用")]):"after"==t.dayType?i("div",[t._v("已结束")]):-1!=e.state?i("div",[t._v("待领取")]):i("div",[t._v("已领完")])])])])})),0),t._v(" "),t.receive?t._e():i("sbx-progress",{attrs:{color:"#F7C64D",percentage:t.getPercentage()}})]:i("div",{staticStyle:{"text-align":"center"}},[t._v("暂时没有可领的券")])],t._v(" "),i("div",{staticClass:"counpon-footer"},[t.receive?[i("div",{staticClass:"btn-submit",class:Object.assign({},t.hotareaClass(t.moduleData,!0),{"btn-disabled":!1}),on:{click:function(e){t.hotEvent(t.moduleData.idCode),t.getCoupons()}}},[i("img",{style:{height:t.moduleData.btnHeight+"px"},attrs:{src:t.btnSubmitImage}})])]:["before"!=t.dayType||t.configuration?t._e():[i("div",{staticClass:"counpon-footer-text"},[t._v("开始时间："+t._s(t.getFilterTime(t.couActivity.mktStartTime)))])],t._v(" "),"during"==t.dayType||t.configuration?[i("div",{staticClass:"btn-submit",class:Object.assign({},t.hotareaClass(t.moduleData,!0),{"btn-disabled":!1}),on:{click:function(e){t.hotEvent(t.moduleData.idCode),t.getCoupons()}}},[i("img",{style:{height:t.moduleData.btnHeight+"px"},attrs:{src:t.btnSubmitImage}})]),t._v(" "),t.hasCoupon?t._e():[null!=t.nextCouActivity?i("div",{staticClass:"counpon-footer-text"},[t._v("下一场预告："+t._s(t.getFilterTime(t.nextCouActivity.mktStartTime)))]):i("div",{staticClass:"counpon-footer-text"},[t._v("活动已结束")])]]:t._e(),t._v(" "),"after"!=t.dayType||t.configuration?t._e():[i("div",{staticClass:"counpon-footer-text"},[t._v("活动已结束")])]]],2)],2)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"coupon-image"},[e("img",{attrs:{src:"static/images/get-coupon/9.png"}})])}],!1,null,"31184478",null));e.default=h.exports},QzrQ:function(t,e,i){},YSmw:function(t,e,i){},Z07Q:function(t,e,i){},nFYi:function(t,e,i){"use strict";var a=i("Z07Q");i.n(a).a},xN1T:function(t,e,i){"use strict";var a={props:{value:Number,speed:Number,size:{type:String,default:"100px"},fill:{type:String,default:"none"},rate:{type:Number,default:100},color:{type:String,default:"#F80F16"},layerColor:{type:String,default:"rgb(235, 237, 240)"},strokeWidth:{type:Number,default:40},clockwise:{type:Boolean,default:!0}},beforeCreate:function(){this.perimeter=3140,this.path="M 530 530 m -500, 0 a 500, 500 0 1, 1 1000, 0 a 500, 500 0 1, 1 -1000, 0"},computed:{style:function(){return{width:this.size,height:this.size}},layerStyle:function(){var t=this.perimeter*(100-this.value)/100;return t=this.clockwise?t:2*this.perimeter-t,{stroke:""+this.color,strokeDashoffset:t+"px",strokeWidth:this.strokeWidth+1+"px"}},hoverStyle:function(){return{fill:""+this.fill,stroke:""+this.layerColor,strokeWidth:this.strokeWidth+"px"}}},watch:{rate:{handler:function(){this.startTime=Date.now(),this.startRate=this.value,this.endRate=this.format(this.rate),this.increase=this.endRate>this.startRate,this.duration=Math.abs(1e3*(this.startRate-this.endRate)/this.speed),this.speed?(this.cancel(this.rafId),this.rafId=this.raf(this.animate)):this.$emit("input",this.endRate)},immediate:!0}},methods:{animate:function(){var t=Date.now(),e=Math.min((t-this.startTime)/this.duration,1)*(this.endRate-this.startRate)+this.startRate;this.$emit("input",this.format(parseFloat(e.toFixed(1)))),(this.increase?e<this.endRate:e>this.endRate)&&(this.rafId=this.raf(this.animate))},format:function(t){return Math.min(Math.max(t,0),100)},raf:function(t){window.requestAnimationFrame(t)},cancel:function(t){window.cancelAnimationFrame(t)}}},s=(i("4ntK"),i("KHd+")),n=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"circle-wrapper",style:t.style},[i("svg",{attrs:{viewBox:"0 0 1060 1060"}},[i("path",{style:t.hoverStyle,attrs:{d:t.path}}),t._v(" "),i("path",{staticClass:"layer-circle",style:t.layerStyle,attrs:{d:t.path}})]),t._v(" "),i("div",{staticClass:"circle-content"},[t._t("default")],2)])}),[],!1,null,"724ed51e",null);e.a=n.exports}}]);