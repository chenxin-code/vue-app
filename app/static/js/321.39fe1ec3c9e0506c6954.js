(window.webpackJsonp=window.webpackJsonp||[]).push([[321,61],{"22sX":function(e,t,s){"use strict";var i=s("oYWQ");s.n(i).a},"7jY5":function(e,t,s){},XVgA:function(e,t,s){"use strict";s.r(t);var i=s("dqDD"),a=s("hDEW"),n={name:"addAddress",components:{Field:i.Field,RegionSelect:a.default},data:function(){return{eventType:1,receiverName:"",mobile:"",regionText:"",address:"",isDefault:!0,showSelect:!1,initData:{title:"请选择地区"},region:[],selectedItems:[],addressId:"",provinceId:"",provinceName:"",cityId:"",cityName:"",countryId:"",countryName:"",townId:"",townName:"",zipCode:"",areaCode:"",id:"",addressFull:"",addressType:"1",pageType:"0"}},methods:{receiverInputChange:function(e){var t=e.target.value;t.length>50&&(t=t.slice(0,50),this.$Toast("收货人最大输入50个字")),this.receiverName=t},addressInputChange:function(e){var t=e.target.value;t.length>100&&(t=t.slice(0,100),this.$Toast("详细地址最大输入100个字")),this.address=t},backEvent:function(){this.$router.go(-1)},switchClick:function(){this.isDefault=!this.isDefault},saveAddressEvent:function(){var e=this;if(""!=this.receiverName&&""!=this.mobile&&""!=this.regionText&&""!=this.address)if(this.$util.checkMobile(this.mobile))if(this.isEmojiCharacter(this.address))this.$Toast("详细地址里面不能输入表情符号！");else{var t;t=2==this.eventType?"/app/json/user_address/updateUserAddress":"/app/json/user_address/addNewUserAddress",this.$Loading.open();var s={addressFull:this.addressFull,zipCode:this.zipCode,townName:this.townName,address:this.address,addressType:this.addressType,receiverName:this.receiverName,mobile:this.mobile,townId:this.townId,cityId:this.cityId,provinceId:this.provinceId,countryId:this.countryId,isDefault:this.isDefault?"1":"0",cityName:this.cityName,provinceName:this.provinceName,countryName:this.countryName,id:this.id,token:this.$store.state.login.token};if(this.region.length>0)for(var i=0;i<4;i++){var a={id:"",name:""};this.region.length>i&&(a=this.region[i]),0==i?(s.provinceId=a.id,s.provinceName=a.name):1==i?(s.cityId=a.id,s.cityName=a.name):2==i?(s.countryId=a.id,s.countryName=a.name):3==i&&(s.townId=a.id,s.townName=a.name)}s.addressFull=s.provinceName+s.cityName+s.countryName+s.townName+s.address,console.log(s),this.$http.post(t,s).then((function(t){e.$Loading.close();var s=t.data;if(0==s.status){if(e.$store.state.mall2.selectAddress=s.data,e.$bridgefunc.vuexStorage(),e._setDefaultAddress(s.data.id),"direct"==e.$route.query.direct)return void e.$router.go(-1);"0"==e.pageType?e.$router.go(-2):e.$router.go(-1)}else e.$Toast(s.info)}),(function(t){e.$Loading.close(),console.log("添加地址失败",t),e.$Toast("保存失败")}))}else this.$Toast("请填写正确的手机号码！");else this.$Toast("所有填写项都为必填项，请将信息填写完整！")},_setDefaultAddress:function(e){var t={token:this.$store.state.login.token,deliveryId:e};this.$http.post("/app/json/user_address/addDefaultAddress",t).then((function(e){}),(function(e){}))},selectRegion:function(){console.log("selectRegion"),this.showSelect=!0,this._getRegionData(0)},selectedItemsEvent:function(e){var t=e.item;if(this.selectedItems=e.selecteds,4==this.selectedItems.length)return this.showSelect=!1,this.region=this.selectedItems,void this.getRegionText();this._getRegionData(t.id)},regionCloseEvent:function(){this.showSelect=!1},_getRegionData:function(e){var t=this;this.$Loading.open();var s={token:this.$store.state.login.token,parentId:e};this.$http.post("/app/json/area/loadAreaList",s).then((function(e){t.$Loading.close();var s=e.data;if(0==s.status){var i=s.data;console.log(i),i.length>0?t.$nextTick((function(){this.$refs.regionselect.pushCustomOptions(i)})):(t.showSelect=!1,t.region=t.selectedItems,t.getRegionText())}else t.$Toast(s.info)}),(function(e){t.$Loading.close(),console.log("获取失败",e),t.$Toast("获取数据失败")}))},getRegionText:function(){for(var e="",t=0;t<this.region.length;t++)e+=this.region[t].name;this.regionText=e,this.$refs.regionselect.reset(null)},isEmojiCharacter:function(e){for(var t=0;t<e.length;t++){var s=e.charCodeAt(t);if(55296<=s&&s<=56319){if(e.length>1){var i=1024*(s-55296)+(e.charCodeAt(t+1)-56320)+65536;if(118784<=i&&i<=128895)return!0}}else if(e.length>1){if(8419==e.charCodeAt(t+1))return!0}else{if(8448<=s&&s<=10239)return!0;if(11013<=s&&s<=11015)return!0;if(10548<=s&&s<=10549)return!0;if(12951<=s&&s<=12953)return!0;if(169==s||174==s||12349==s||12336==s||11093==s||11036==s||11035==s||11088==s)return!0}}}},created:function(){var e=this.$route.query.defaultProvince?this.$route.query.defaultProvince:"",t=this.$route.query.defaultCity?this.$route.query.defaultCity:"";e&&t&&(this.initData.initAreas=[e,t],this.initData.canNotReselect=!0),this.eventType=this.$route.query.type?this.$route.query.type:1,this.pageType=this.$route.query.pageType?this.$route.query.pageType:"0";var s=this.$route.query.addressItem?JSON.parse(decodeURIComponent(this.$route.query.addressItem)):"";""!=s&&(this.zipCode=s.zipCode,this.address=s.address,this.addressType=s.addressType,this.receiverName=s.receiverName,this.mobile=s.mobile,this.townId=s.townId,this.townName=s.townName,this.cityName=s.cityName,this.cityId=s.cityId,this.provinceId=s.provinceId,this.provinceName=s.provinceName,this.countryId=s.countryId,this.countryName=s.countryName,this.isDefault="1"==s.isDefault,this.id=s.id,this.addressFull=s.addressFull,this.regionText=s.provinceName+s.cityName+s.countryName+s.townName)}},o=(s("kXrW"),s("KHd+")),r=Object(o.a)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add-address mall2"},[s("nav-top",{attrs:{title:1==e.eventType?"新建收货人":"编辑收货地址"},on:{backEvent:e.backEvent}}),e._v(" "),s("nav-content",[s("div",{staticClass:"scrolcontent"},[s("div",{staticClass:"shadow-con shadow-cell"},[s("mt-field",{staticClass:"mt-title border",attrs:{label:"收货人姓名",placeholder:"请输入收货人姓名"},nativeOn:{"!input":function(t){return e.receiverInputChange(t)}},model:{value:e.receiverName,callback:function(t){e.receiverName=t},expression:"receiverName"}}),e._v(" "),s("mt-field",{staticClass:"mt-title border",attrs:{label:"手机号",placeholder:"请输入手机号码",type:"tel"},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}}),e._v(" "),s("div",{on:{click:function(t){return t.stopPropagation(),e.selectRegion(t)}}},[s("mt-field",{staticClass:"mt-title border",attrs:{label:"选择区域",placeholder:"请选择区域",readonly:"readonly"},model:{value:e.regionText,callback:function(t){e.regionText=t},expression:"regionText"}},[s("img",{attrs:{width:"20px",height:"20px",src:"static/image/mall2/area.png"}})])],1),e._v(" "),s("mt-field",{staticClass:"mt-title border",attrs:{label:"详细地址",placeholder:"请输入详细地址"},nativeOn:{"!input":function(t){return e.addressInputChange(t)}},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),e._v(" "),s("div",{staticClass:"default-div"},[s("div",{staticClass:"label"},[e._v("设置为默认地址")]),e._v(" "),s("img",{attrs:{width:"45px",height:"24px",src:e.isDefault?"static/image/mall2/switch-on.png":"static/image/mall2/switch-off.png"},on:{click:e.switchClick}})])],1)]),e._v(" "),s("div",{staticClass:"bottom-btn theme_bg_red",on:{click:e.saveAddressEvent}},[s("p",{},[e._v("保存并使用")])])]),e._v(" "),e.showSelect?s("RegionSelect",{ref:"regionselect",attrs:{initData:e.initData},on:{selectedItemsEvent:e.selectedItemsEvent,closeEvent:e.regionCloseEvent}}):e._e()],1)}),[],!1,null,"7683d808",null);t.default=r.exports},hDEW:function(e,t,s){"use strict";s.r(t);var i={name:"",props:{initData:{type:Object,default:{}}},data:function(){return{popShow:!1,selectedIndexs:[],selectedItems:[],dataCache:[],cusOptions:[],cusIndex:0,initAreas:[],myTimeout:null}},methods:{close:function(){var e=this;this.popShow=!1,this.myTimeout&&(clearTimeout(this.myTimeout),this.myTimeout=null),this.myTimeout=setTimeout((function(){e.$emit("closeEvent","")}),240)},reSelect:function(e){if(1!=this.initData.canNotReselect){var t=this.selectedItems.length-e;console.log(t),this.selectedItems.splice(e,t),this.selectedIndexs.splice(e,t);var s=this.dataCache[e];this.dataCache.splice(e+1,t),this.cusOptions=s}},selectOption:function(e,t){this.cusIndex=t,this.selectedItems.push(e),this.selectedIndexs.push(t),this.cusOptions=[];var s={item:e,selecteds:this.selectedItems};this.$emit("selectedItemsEvent",s)},pushCustomOptions:function(e){if(0==this.selectedIndexs.length&&(this.selectedIndexs=[],this.selectedItems=[],this.dataCache=[],this.cusIndex=0),this.dataCache.push(e),this.cusOptions=e,this.initAreas&&this.initAreas.length>0){for(var t=this.initAreas.shift(),s=!1,i=0;i<e.length;i++){var a=e[i];if(this.$util.areaEqual(t,a.name)){s=!0,this.selectOption(a,i);break}}0==s&&(this.initAreas=[])}},reset:function(e){this.selectedIndexs=[],this.selectedItems=[],this.cusIndex=0,e?(this.dataCache=[],this.dataCache.push(e),this.cusOptions=e):(this.cusOptions=this.dataCache[0],this.dataCache=[],this.dataCache.push(this.cusOptions))}},created:function(){try{this.initAreas=JSON.parse(JSON.stringify(this.initData.initAreas))}catch(e){this.initAreas=[]}},mounted:function(){this.popShow=!0}},a=(s("22sX"),s("KHd+")),n=Object(a.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"region-select"},[s("div",{staticClass:"other-div",on:{click:e.close}}),e._v(" "),s("transition",{attrs:{name:"pop_transiton"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.popShow,expression:"popShow"}],staticClass:"select-content"},[s("div",{staticClass:"close-btn",on:{click:e.close}},[s("img",{attrs:{src:"static/image/mall/close.png"}})]),e._v(" "),s("div",{staticClass:"font-medium-l-x title"},[e._v(e._s(e.initData.title?e.initData.title:"请选择区域"))]),e._v(" "),s("div",{staticClass:"selected-item font-medium"},[e._l(e.selectedItems,(function(t,i){return s("div",{staticClass:"item-div",on:{click:function(t){return e.reSelect(i)}}},[s("div",{staticClass:"item-text"},[e._v(e._s(t.name))])])})),e._v(" "),e.cusOptions.length>0?s("div",{staticClass:"item-div"},[s("div",{staticClass:"item-text item-selected theme_font_red"},[e._v("请选择")])]):e._e()],2),e._v(" "),s("div",{staticClass:"options-div"},e._l(e.cusOptions,(function(t,i){return s("div",{staticClass:"option",on:{click:function(s){return e.selectOption(t,i)}}},[e._v(e._s(t.name))])})),0)])])],1)}),[],!1,null,"60a4d13e",null);t.default=n.exports},kXrW:function(e,t,s){"use strict";var i=s("7jY5");s.n(i).a},oYWQ:function(e,t,s){}}]);