(window.webpackJsonp=window.webpackJsonp||[]).push([[703],{"6ygN":function(t,a,s){"use strict";var i=s("N0Hb");s.n(i).a},N0Hb:function(t,a,s){},RbXp:function(t,a,s){"use strict";s.r(a);var i=s("Ziuy"),e=s("7//l"),n=s("db0i"),o=(s("W34l"),s("ZGFV")),r=s("Gedb"),l={data:function(){return{settleInfo:{},usedCoupons:[],payDigitals:[],cardno:"",cardholder:"",reservedphone:"",payradio:1,dictByAlias:[],DigitalPwd:"",isshowcards:!1,ischangeCard:!1,cardinfo:{},mindex:0,cardListArr:[],zhilist:"",zhifufang:"",zhifudizhi:"",cardtype:"",ispricard:"",backReloadCoupon:!1}},created:function(){this.cardno=this.$route.query.usercard,this.mindex=this.$route.query.mindex||0,this.$store.state.globalConfig.oilCardVirtualPayEnabled&&1==this.$store.state.globalConfig.oilCardVirtualPayEnabled&&(this.settlement(),console.log("虚拟支付")),console.log("不需要虚拟支付")},mounted:function(){console.log(this.$store.state.globalConfig.oilCardVirtualPayEnabled),this.getCardList()},methods:{getCardList:function(){var t=this;this.$request.post("/app/json/card/getCardInfoList").then((function(a){0==a.status&&(t.cardListArr=a.data.cardAcctList||[],t.$request.post("/app/json/enterprise_card/getCardInfoList").then((function(a){if(0==a.status){var s=a.data.cardAcctList||[];t.cardListArr=t.cardListArr.concat(s),t.cardListArr.length>t.mindex?(t.cardno=t.cardListArr[t.mindex].cardno,t.cardholder=t.cardListArr[t.mindex].cardholder,t.reservedphone=t.cardListArr[t.mindex].reservedphone,t.cardtype=t.cardListArr[t.mindex].cardtype,t.ispricard=t.cardListArr[t.mindex].ispricard):(t.cardno="",t.cardholder="",t.reservedphone="",t.cardtype="",t.ispricard=""),t.queryPayModeLIst()}})))}))},changeCardbtn:function(){this.ischangeCard=!this.ischangeCard},changeCard:function(t){console.log(t),this.ischangeCard=!this.ischangeCard,this.cardno=t.cardno,this.cardholder=t.cardholder,this.reservedphone=t.reservedphone,this.cardtype=t.cardtype,this.ispricard=t.ispricard,this.payDigitals=[],this.usedCoupons=[],this.settlement()},queryPayModeLIst:function(){var t=this;this.$Loading.open();var a=this;this.$http.post("/app/json/card/getAppPayTextList",{cardno:this.cardno}).then((function(s){a.$Loading.close(),console.log(s),console.log(s.data.data),t.zhilist=s.data.data||[]}))},settlement:function(){var t=this,a={cardNo:this.cardno,rechargeAmount:"200"};this.payDigitals.length&&(a.payDigital=this.payDigitals),this.usedCoupons.length&&(a.couNo=this.usedCoupons),this.$request.post("/app/json/card/settle",a).then((function(a){if(0==a.status){t.settleInfo=a.data,t.usedCoupons=t.settleInfo.couNo;var s=a.data.digitalList||[],i=!0,e=!1,n=void 0;try{for(var o,r=s[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var l=o.value;if(l.payDigital>l.fixedDigital){t.payDigitals.push(l);break}}}catch(t){e=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(e)throw n}}t.reloadSelectedCoupon()}else t.$Toast(data.info),t.reloadSelectedCoupon()}))},setHour:function(t){return t?this.$util.formatDate(new Date(t),"yyyy-MM-dd hh:mm"):""},reloadSelectedCoupon:function(){if(0!=this.backReloadCoupon){this.backReloadCoupon=!1;for(var t=0;t<this.settleInfo.userCanUseCoupon.length;t++){var a=this.settleInfo.userCanUseCoupon[t].couNo;this.settleInfo.userCanUseCoupon[t].selected=!1;for(var s=0;s<this.usedCoupons.length;s++)if(console.log(this.usedCoupons[s],a,88888),this.usedCoupons[s]==a){console.log(this.settleInfo.userCanUseCoupon[t].selected,"9999"),this.settleInfo.userCanUseCoupon[t].selected=!0;break}}i.a.reloadSelectedCoupon(this.occurData.userCanUseCoupon)}},moreCoupon:function(){for(var t=this,a=0;a<this.settleInfo.userCanUseCoupon.length;a++){var s=this.settleInfo.userCanUseCoupon[a].couNo;this.settleInfo.userCanUseCoupon[a].selected=!1;for(var e=0;e<this.usedCoupons.length;e++)if(console.log(this.usedCoupons[e],s,88888),this.usedCoupons[e]==s){console.log(this.settleInfo.userCanUseCoupon[a].selected,"9999"),this.settleInfo.userCanUseCoupon[a].selected=!0;break}}i.a.open({initData:{listData:[],userCanNotUseCoupon:this.settleInfo.userCanNotUseCoupon,userCanUseCoupon:this.settleInfo.userCanUseCoupon,type:"use",skuId:"",categoryId:"",storeOuCode:"",token:this.$store.state.login.token,payAmount:this.$util.toDecimal2(parseFloat(this.settleInfo.payAmount))},selectedCoupon:function(a){for(var s=[],i=0;i<a.length;i++)s.push(a[i].couNo);0==s.length&&s.push("-1"),t.usedCoupons=s,t.backReloadCoupon=!0,t.settlement()}})},setPayWays:function(){var t=this;n.a.getPayWays("100005",this.$route.query.ouCode).then((function(a){t.payWay=a||[],t.selectedPayWay=t.payWay[0]}))},getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"150001")},getDigitalDisplayUnit:function(t){for(var a=this.$store.state.globalConfig.acctList,s=0;s<a.length;s++){var i=a[s];if(i.acctType==t)return i.displayUnit}},getCanNotUseStr:function(t){return 1==t||3==t?"余额不足":1==t?"订单金额不够":"未知原因"},useDigitalEvent:function(t){if(0==this.payradio)if(t.userCanUseDigital<=0){var a=this.getCanNotUseStr(t.deductionState);this.$Toast(a+"，不支持"+this.getDigitalDisplayName(t.acctType)+"支付！")}else{var s=t.acctType;if(t.payDigital<=t.fixedDigital){for(var i=[],e=0;e<this.payDigitals.length;e++)this.payDigitals[e].acctType!=s&&i.push(this.payDigitals[e]);this.payDigitals=i,this.payDigitals.push({acctType:s,payDigital:t.userCanUseDigital+t.fixedDigital}),console.log(this.payDigitals,"99991")}else{for(var n=[],o=0;o<this.payDigitals.length;o++)this.payDigitals[o].acctType!=s?n.push(this.payDigitals[o]):n.push({acctType:s,payDigital:t.fixedDigital});this.payDigitals=n,console.log(this.payDigitals,"99992")}this.settlement()}else this.$Toast("只有虚拟支付才可使用!!")},submitBill:function(){var t=this,a={};a.token=this.$store.state.login.token,a.cardNo=this.cardno,a.rechargeAmount=this.settleInfo.amount,a.couNo=this.usedCoupons||[],this.payDigitals.length&&(a.payDigital=this.payDigitals),""!=this.digitalPWD&&(a.payPwd=Object(r.a)(this.digitalPWD)),console.log(a),this.$http.post("/app/json/card/submit",a).then((function(a){t.$Loading.close(),console.log(a.data,"第一步res.data");var s=a.data;0==s.status?(t.$Toast("充值成功"),t.isshowcards=!t.isshowcards,t.$router.go(-1)):t.$Toast(s.info||"提交订单失败！")}),(function(a){t.$Loading.close(),t.$Toast("请求数据失败！")}))},payBill:function(t){var a=this;null!=this.selectedPayWay?n.a.refuelPayEvent(this.selectedPayWay,t.orderType,t.orderId).then((function(){a.resultHand("1",t)})).catch((function(){a.resultHand("0",t)})):this.$Toast("请选择支付方式！")},resultHand:function(t,a){var s=this;if(this.$Loading.close(),o.a.addLog("支付结果",t?"成功":"失败"),"1"==t)this.$router.replace({path:"/firmDetail",query:{orderType:a.orderType,orderId:a.orderId,fromPage:1}});else{var i={token:this.$store.state.login.token,orderType:a.orderType,orderId:a.orderId};this.$http.post("/app/json/refuel_center/cancelOrder",i).then((function(t){var a=t.data;0==a.status?s.$Toast("支付已取消"):s.$Toast(a.info)}))}},checkNeedPwd:function(){var t=this;if(this.digitalPWD="",this.settleInfo.needPayPwd){if("1"==this.settleInfo.payPwdState)return void this.$Toast("支付密码已锁定，请稍后再试！");e.a.open({initData:{payPwdState:this.settleInfo.payPwdState},toSettingPwd:function(){t.$router.push({path:"/usercenter/nosetpwd",query:{isSet:0}}),e.a.close()},inputFinished:function(a){t.digitalPWD=a,t.submitBill(),e.a.close()}})}else this.submitBill()},_submit:function(){if(0!=this.payradio)this.rendermode2();else{for(var t=0;t<this.payDigitals.length;t++){var a=this.payDigitals[t];if(a.payDigital>0&&a.payDigital>a.userBalanceDigital){var s=this.getDigitalDisplayName(a.acctType);return s+="余额不足！",this.$Toast(s),void this.settlement()}}this.checkNeedPwd()}},confirmpayment:function(){if(this.payradio)if(0==this.payradio){var t=this.$store.state.severTime.currentTime,a=new Date(1e3*t).getHours();if(23==a||a>23||a<2)return void this.$Toast("23:00~02:00不可进行虚拟支付!");this.isshowcards=!this.isshowcards}else this.zhifufang=this.zhilist[1*this.payradio-1].text,this.zhifudizhi=this.zhilist[1*this.payradio-1].href,this.isshowcards=!this.isshowcards;else this.$Toast("请选择支付方式!")},rendermode2:function(){var t=this;console.log(1*this.payradio-1),console.log(this.$store.state.login.wxOpenid),this.$Loading.open();var a=this;this.$http.post("/app/json/card/getAppPayTextList",{token:a.$store.state.login.token,cardno:this.cardno}).then((function(s){a.$Loading.close(),console.log(s),console.log(s.data.data),t.zhilist=s.data.data,t.zhifufang=s.data.data[1*t.payradio-1].text,t.zhifudizhi=s.data.data[1*t.payradio-1].href,"微信快充"==t.zhifufang&&"2"==t.$store.state.webtype&&(t.zhifudizhi=t.zhifudizhi.includes("?")?t.zhifudizhi+"&openId="+t.$store.state.login.wxOpenid:t.zhifudizhi+"?openId="+t.$store.state.login.wxOpenid),console.log(1*t.payradio-1,t.zhifufang,t.zhifudizhi),t.$bridgefunc.customPush({path:t.zhifudizhi,isnativetop:"1",superback:1})}))}}},c=(s("6ygN"),s("KHd+")),d=Object(c.a)(l,(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"recharge-index"},[s("nav-top",{attrs:{title:"加油卡充值"},on:{backEvent:function(a){return t.$router.go(-1)}}}),t._v(" "),s("nav-content",{staticClass:"recharge-content"},[s("div",{staticClass:"card-information"},[s("div",{staticClass:"item-bgcolor-red"}),t._v(" "),s("div",{staticClass:"card-content"},[s("div",{staticClass:"table-view"},[s("div",{staticClass:"table-view-cell"},[s("div",{staticClass:"table-view-cell-text"},["01"==t.cardtype||"02"==t.cardtype?s("div",{staticClass:"left"},[t._v("\n                单位卡("+t._s("1"==t.ispricard?"主卡":"副卡")+")\n              ")]):t._e(),t._v(" "),"01"!=t.cardtype&&"02"!=t.cardtype?s("div",{staticClass:"left"},[t._v("\n                个人卡("+t._s("1"==t.ispricard?"主卡":"副卡")+")\n              ")]):t._e(),t._v(" "),s("div",{staticClass:"right change-card-btn",on:{click:t.changeCardbtn}},[t._v("更换")])])]),t._v(" "),s("div",{staticClass:"table-view-cell"},[s("div",{staticClass:"table-view-cell-text"},[s("div",{staticClass:"left"},[t._v("加油卡卡号")]),t._v(" "),s("div",{staticClass:"right"},[t._v(t._s(t.cardno))])])]),t._v(" "),s("div",{staticClass:"table-view-cell"},[s("div",{staticClass:"table-view-cell-text"},[s("div",{staticClass:"left"},[t._v("预留手机号")]),t._v(" "),s("div",{staticClass:"right"},[t._v(t._s(t.reservedphone))])])])])]),t._v(" "),s("p",{staticClass:"title"},[t._v("充值方式")]),t._v(" "),s("van-radio-group",{model:{value:t.payradio,callback:function(a){t.payradio=a},expression:"payradio"}},[1==t.$store.state.globalConfig.oilCardVirtualPayEnabled?s("div",{staticClass:"virtual-payment boxshadow"},[t._l(t.settleInfo.digitalList||[],(function(a,i){return s("div",{key:i},[0!=a.deductionState?s("div",{staticClass:"flex-row"},[s("div",{staticClass:"label-middle theme_font_common inline_block payment-title"},[t._v("\n                "+t._s(t.getDigitalDisplayName(a.acctType))+"\n              ")]),t._v(" "),"元"==t.getDigitalDisplayUnit(a.acctType)?[a.userCanUseDigital>0?s("div",{staticClass:"right-margin inline_block"},[t._v("\n                  余额："+t._s(a.userBalanceDigital)+"元，可用"+t._s(a.userCanUseDigital)+"元\n                ")]):s("div",{staticClass:"right-margin inline_block"},[t._v("\n                  余额："+t._s(a.userBalanceDigital)+"元，"+t._s(t.getCanNotUseStr(a.deductionState))+"，不能使用\n                ")])]:[a.userCanUseDigital>0?s("div",{staticClass:"right-margin inline_block"},[a.userBalanceDigital<1e4?s("span",[t._v("共"+t._s(a.userBalanceDigital)+"个，")]):t._e(),t._v("\n                  可用"+t._s(a.userCanUseDigital)+"个，抵￥"+t._s(t.$util.toDecimal2(a.userCanUseDigitalAmount))+"元\n                ")]):s("div",{staticClass:"right-margin inline_block"},[a.userBalanceDigital<1e4?s("span",[t._v("共"+t._s(a.userBalanceDigital)+"个，")]):t._e(),t._v("\n                  "+t._s(t.getCanNotUseStr(a.deductionState))+"，不能使用\n                ")])],t._v(" "),s("div",{staticClass:"swith inline_block",on:{click:function(s){return t.useDigitalEvent(a)}}},[a.payDigital>a.fixedDigital?s("img",{staticStyle:{width:"25px"},attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),t._v(" "),a.payDigital<=a.fixedDigital?s("img",{staticStyle:{width:"25px"},attrs:{src:"static/image/mall2/switch-off.png"}}):t._e()])],2):t._e()])})),t._v(" "),s("div",{staticClass:"coupon"},[s("p",{staticClass:"payment-title"},[t._v("优惠券充值")]),t._v(" "),s("div",[s("p",[t._v("\n                共选择优惠券\n                "),s("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.couNo.length))]),t._v("张,充值金额\n                "),s("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.couponAmount.toFixed(2)||0))]),t._v("元\n              ")])]),t._v(" "),s("van-icon",{attrs:{name:"ellipsis",size:"16"},on:{click:t.moreCoupon}})],1),t._v(" "),s("div",{staticClass:"payamount"},[s("p",[t._v("\n              合计可充值金额:\n              "),s("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.amount&&t.settleInfo.amount.toFixed(2)))]),t._v("元\n            ")]),t._v(" "),s("van-radio",{attrs:{name:"0","checked-color":"red"}})],1)],2):t._e(),t._v(" "),s("div",{staticClass:"pay-mode"},t._l(t.zhilist,(function(a,i){return s("div",{key:i,staticClass:"pay-mode-item boxshadow"},[s("p",[t._v(t._s(a.text))]),t._v(" "),s("van-radio",{attrs:{name:i+1,"checked-color":"red"}})],1)})),0)]),t._v(" "),0==t.payradio?s("div",{staticClass:"submit-btn",on:{click:t.confirmpayment}},[t._v("\n        立即充值\n        "),s("span",[t._v("("+t._s(t.settleInfo.amount.toFixed(2))+"元)")])]):s("div",{staticClass:"submit-btn",on:{click:t.confirmpayment}},[t._v("立即充值")])],1),t._v(" "),t.ischangeCard?s("div",{staticClass:"change-card"},[s("div",{staticClass:"change-card-content"},[s("div",{staticClass:"modal-title"},[t._v("更换充值卡")]),t._v(" "),s("van-icon",{staticClass:"changeCard-close",attrs:{name:"cross",size:"14"},on:{click:function(a){t.ischangeCard=!1}}}),t._v(" "),s("div",{staticClass:"table-view"},t._l(t.cardListArr,(function(a,i){return s("div",{key:i,staticClass:"table-view-cell"},[s("div",{staticClass:"table-view-cell-text"},[s("div",{staticClass:"left"},[t._v(t._s(a.cardno))]),t._v(" "),s("div",{staticClass:"right change-card-btn",on:{click:function(s){return t.changeCard(a)}}},[t._v("更换")])])])})),0)],1)]):t._e(),t._v(" "),t.isshowcards?s("div",{staticClass:"confirm-pay-modal"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-title"},[t._v("确认支付？")]),t._v(" "),s("div",{staticClass:"firm-two"},[s("p",[s("span",[t._v("加油卡卡号")]),t._v(" "),s("span",[t._v(t._s(t.cardno))])]),t._v(" "),s("p",[s("span",[t._v("持卡人姓名")]),t._v(" "),s("span",[t._v(t._s(t.cardholder))])]),t._v(" "),s("p",[s("span",[t._v("持卡人手机号")]),t._v(" "),s("span",[t._v(t._s(t.reservedphone))])]),t._v(" "),s("p",[s("span",[t._v("支付方式")]),t._v(" "),s("span",[t._v(t._s(0==t.payradio?"虚拟支付":t.zhifufang))])]),t._v(" "),0==t.payradio?s("p",[s("span",[t._v("金额")]),t._v(" "),s("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.settleInfo.amount&&t.settleInfo.amount.toFixed(2)))])]):t._e(),t._v(" "),0==t.payradio?s("div",t._l(t.settleInfo.digitalList||[],(function(a,i){return 0!=a.digitalAmount?s("p",{key:i},[s("span",[t._v(t._s(t.getDigitalDisplayName(a.acctType))+"支付抵扣")]),t._v(" "),s("span",[t._v("¥"+t._s(a.digitalAmount))])]):t._e()})),0):t._e(),t._v(" "),0==t.payradio?s("p",[s("span",[t._v("应付金额")]),t._v(" "),s("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.settleInfo.payAmount&&t.settleInfo.payAmount.toFixed(2)))])]):t._e()]),t._v(" "),s("div",{staticClass:"firm-three"},[s("p",{staticClass:"btn cancel-btn",on:{click:function(a){t.isshowcards=!1}}},[t._v("否")]),t._v(" "),s("p",{staticClass:"btn",on:{click:t._submit}},[t._v("是")])])])]):t._e()])],1)}),[],!1,null,"dcdd40a6",null);a.default=d.exports}}]);