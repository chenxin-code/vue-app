(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{"2qT4":function(t,e,s){},BRVv:function(t,e,s){},"EmR+":function(t,e,s){"use strict";e.a={methods:{dealWithPrice:function(t){if(!(t=Number(t)))return[0,0,"0.00"];var e=(t=String(t.toFixed(2))).split(".")[1],s=t.split(".")[0];return[s,e,s+"."+e]}}}},"Le/0":function(t,e,s){"use strict";s.r(e);var o=s("db0i"),a=s("EmR+"),i=s("oCYn"),n={name:"list",props:["coupons","listType","payAmount"],components:{},data:function(){return{selectedIndex:-1,selectedCouponType:"",selectedCouponThresholdAmount:"",canUseCouponNumber:""}},methods:{getCouponEvent:function(t){this.$emit("getCouponEvent",t)},couponProducts:function(t){this.$emit("couponProducts",t)},itemEvent:function(t,e){if(2==this.listType){if(1==t.disable)return void this.$Toast("不能与已选优惠券叠加使用！");if(console.log("can use other coupon",""!=this.selectedCouponType&&this.selectedCouponType!=t.couTypeCode),console.log(this.selectedCouponType),console.log(t.couTypeCode),""!=this.selectedCouponType&&this.selectedCouponType!=t.couTypeCode)return void this.$Toast("不能与已选优惠券叠加使用！");t.selected=!t.selected,this.coupons.splice(e,1,t);for(var s=[],o=0;o<this.coupons.length;o++){var a=this.coupons[o];1==a.selected&&s.push(a)}this.$emit("selectedItems",s)}}},mounted:function(){}},c=(s("v2HF"),s("KHd+")),u=Object(c.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list"},t._l(t.coupons,(function(e,o){return s("div",{staticClass:"eccell",class:{disable:1==e.disable},on:{click:function(s){return s.stopPropagation(),t.itemEvent(e,o)}}},[s("div",{staticClass:"ecinfo shadow-cell"},[s("div",{staticClass:"left-info theme_font_white",class:4==t.listType||5==t.listType||""!=t.selectedCouponType&&t.selectedCouponType!=e.couTypeCode&&2==t.listType?"theme_bg_dark_d":"theme_bg_light_blue"},[40==e.couCategory?s("div",{staticClass:"left-con"},[e.couDiscountValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-xx"},[t._v(t._s(1e3*e.couDiscountValue/100)+"折")])]):s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("折扣券")])]),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:e.couThresholdAmount>0,expression:"item.couThresholdAmount>0"}],staticClass:"limmony"},[t._v("满"+t._s(e.couThresholdAmount)+"元可用")])],1):s("div",{staticClass:"left-con"},[e.couFaceValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("￥")]),s("span",{staticClass:"span-xx"},[t._v(t._s(e.couFaceValue))])]):t._e(),t._v(" "),""==e.couFaceValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("￥")]),s("span",{staticClass:"span-xx-s"},[t._v(t._s(e.couMinFaceValue+"~"+e.couMaxFaceValue))])]):t._e(),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:e.couThresholdAmount>0,expression:"item.couThresholdAmount>0"}],staticClass:"limmony"},[t._v("满"+t._s(e.couThresholdAmount)+"元可用")])],1)]),t._v(" "),s("div",{staticClass:"right-info"},[s("div",{staticClass:"right-con"},[s("div",{staticClass:"top-type"},[s("div",{staticClass:"top-con"},["100"==e.couOriginCode?s("p",{staticClass:"ectype-con theme_bg_light_blue theme_font_white"},[t._v("平台券")]):t._e(),t._v(" "),s("p",{staticClass:"title-con"},[t._v(t._s(e.couTypeTitle))])])]),t._v(" "),s("div",{staticClass:"coupon-tip"},[""==e.couFaceValue?s("div",{staticClass:"single-line font-small theme_font_tint"},[t._v("注：领取金额"+t._s(e.couMinFaceValue)+"元至"+t._s(e.couMaxFaceValue)+"元随机")]):t._e()]),t._v(" "),s("div",{staticClass:"date-con"},[s("div",{staticStyle:{flex:"1"}},[t._v(t._s(e.validStartDate)+" 至 "+t._s(e.validEndDate))]),t._v(" "),0==e.isReceived&&0==t.listType?s("div",{staticClass:"btn get-coupon theme_bg_light_blue theme_font_white",on:{click:function(s){return s.stopPropagation(),t.getCouponEvent(e)}}},[t._v("点击领取")]):t._e(),t._v(" "),1==e.isReceived&&0==t.listType?s("div",{staticClass:"btn to-product theme_font_light_blue",on:{click:function(s){return s.stopPropagation(),t.couponProducts(e)}}},[t._v("可用商品")]):t._e(),t._v(" "),3==t.listType?s("div",{staticClass:"btn get-coupon theme_bg_light_blue theme_font_white",on:{click:function(s){return s.stopPropagation(),t.getCouponEvent(e)}}},[t._v("立即使用")]):t._e()])])]),t._v(" "),4==t.listType?s("img",{attrs:{src:"/static/image/mall2/used.png"}}):t._e(),t._v(" "),2==t.listType?s("div",{staticClass:"select-div"},[e.selected?t._e():s("i",{staticClass:"iconfont mall-weixuanzhong theme_font_tint"}),t._v(" "),e.selected?s("i",{staticClass:"iconfont mall-xuanzhong theme_font_red"}):t._e()]):t._e()])])})),0)}),[],!1,null,"455afb20",null).exports,r=s("ZToj"),l={name:"list",props:["coupons","listType","payAmount"],components:{},data:function(){return{selectedIndex:-1,selectedCouponType:"",selectedCouponThresholdAmount:"",canUseCouponNumber:""}},methods:{setItemReceived:function(t){for(var e=0;e<this.coupons.length;e++)if(this.coupons[e].id==t.id)return t.isReceived=1,void this.coupons.splice(e,1,t)},excTypeVal:function(t){return t.activityTags.indexOf("YouDouExCoupon")>=0?t.perDiscountEmpRewardsPrice:t.activityTags.indexOf("RewardExCoupon")>=0?t.perDiscountRewardsPrice:t.points},excTypeIcon:function(t){return t.activityTags.indexOf("YouDouExCoupon")>=0?100==t.soldNum?"static/image/coupon/emp-reward-dis.png":"static/image/coupon/emp-reward.png":100==t.soldNum?"static/image/coupon/point-de.png":"static/image/coupon/point-icon.png"},excTypeName:function(t){return t.activityTags.indexOf("YouDouExCoupon")>=0?r.a.state.globalConfig.Employees_wallet||"福豆":t.activityTags.indexOf("RewardExCoupon")>=0?r.a.state.globalConfig.Employees_wallet||"福豆":"积分"},getCouponEvent:function(t){t.distCntCurUser>=t.discountGoodsCntPerUser?this.$Toast("每人限购"+t.discountGoodsCntPerUser+"个，您已到达上限，去看看其它商品吧！"):0==t.remainNum?this.$Toast("已售完"):100==t.selfSoldNum?this.$Toast("今日可领取次数已用尽"):this.$emit("jfdhCouponEvent",t)},couponProducts:function(t){this.$emit("couponProducts",t)},itemEvent:function(t,e){if(2==this.listType){if(""!=this.selectedCouponType&&this.selectedCouponType!=t.couTypeCode)return void this.$Toast("不能与已选优惠券叠加使用！");t.selected=!t.selected,this.coupons.splice(e,1,t),t.selected&&(this.selectedCouponType=t.couTypeCode,this.canUseCouponNumber=t.couTypeUseConditionModel.limitUserUseCouPerOrder,this.selectedCouponThresholdAmount=t.couThresholdAmount);for(var s=[],o=0;o<this.coupons.length;o++){var a=this.coupons[o];1==a.selected&&s.push(a)}""==s.length&&(this.selectedCouponThresholdAmount=0,this.selectedCouponType="",this.canUseCouponNumber="");var i=s.length;if(""!=this.canUseCouponNumber&&i>this.canUseCouponNumber)return t.selected=!t.selected,this.coupons.splice(e,1,t),void this.$Toast("优惠券单笔订单使用数量已达上限！");if(this.selectedCouponThresholdAmount*i>this.payAmount)return t.selected=!t.selected,this.coupons.splice(e,1,t),void this.$Toast("订单金额不足，使用数量已达上限！");this.$emit("selectedItems",s)}}},mounted:function(){if(2==this.listType){for(var t=[],e=0;e<this.coupons.length;e++){var s=this.coupons[e];1==s.selected&&(this.selectedCouponType=s.couTypeCode,this.canUseCouponNumber=s.couTypeUseConditionModel.limitUserUseCouPerOrder,t.push(s))}this.$emit("selectedItems",t)}}},p=(s("hjAl"),{name:"coupon",components:{Coupon:u,JFHQCoupon:Object(c.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list"},t._l(t.coupons,(function(e,o){return s("div",{staticClass:"eccell",on:{click:function(s){return s.stopPropagation(),t.itemEvent(e,o)}}},[s("div",{staticClass:"ecinfo shadow-cell"},[s("div",{staticClass:"left-info theme_font_white theme_bg_light_blue"},[40==e.couCategory?s("div",{staticClass:"left-con"},[e.couDiscountValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-xx"},[t._v(t._s(1e3*e.couDiscountValue/100)+"折")])]):s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("折扣券")])]),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:e.couThresholdAmount>0,expression:"item.couThresholdAmount>0"}],staticClass:"limmony"},[t._v("满"+t._s(e.couThresholdAmount)+"元可用")])],1):s("div",{staticClass:"left-con"},[e.couFaceValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("￥")]),s("span",{staticClass:"span-xx"},[t._v(t._s(e.couFaceValue))])]):t._e(),t._v(" "),""==e.couFaceValue?s("P",{staticClass:"faceamt "},[s("span",{staticClass:"span-x"},[t._v("￥")]),s("span",{staticClass:"span-xx-s"},[t._v(t._s(e.couMinFaceValue+"~"+e.couMaxFaceValue))])]):t._e(),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:e.couThresholdAmount>0,expression:"item.couThresholdAmount>0"}],staticClass:"limmony"},[t._v("满"+t._s(e.couThresholdAmount)+"元可用")])],1)]),t._v(" "),s("div",{staticClass:"right-info"},[s("div",{staticClass:"right-con"},[s("div",{staticClass:"top-type"},[s("div",{staticClass:"top-con"},["100"==e.couOriginCode?s("p",{staticClass:"ectype-con theme_bg_light_blue theme_font_white"},[t._v("平台券")]):t._e(),t._v(" "),s("p",{staticClass:"title-con"},[t._v(t._s(e.couTypeTitle))])])]),t._v(" "),s("div",{staticClass:"coupon-tip"},[""==e.couFaceValue?s("div",{staticClass:"single-line font-small theme_font_tint"},[t._v("注：领取金额"+t._s(e.couMinFaceValue)+"元至"+t._s(e.couMaxFaceValue)+"元随机")]):t._e()]),t._v(" "),s("div",{staticClass:"date-con"},[s("div",{staticStyle:{flex:"1"}},[t._v(t._s(e.mktStartDate.split(" ")[0])+" 至 "+t._s(e.mktEndDate.split(" ")[0]))])])])]),t._v(" "),s("div",{staticClass:"buy-div"},[s("div",{staticClass:"points"},[s("p",{staticClass:"title single-line"},[t._v("消耗"+t._s(t.excTypeName(e)))]),t._v(" "),s("div",{staticClass:"point-wrapper"},[s("img",{staticClass:"img",attrs:{src:t.excTypeIcon(e),alt:""}}),t._v(" "),s("span",{staticClass:"point-num"},[t._v(t._s(t.excTypeVal(e)||0))])])]),t._v(" "),1==e.isReceived?s("div",{staticClass:"btn to-product theme_font_light_blue",on:{click:function(s){return s.stopPropagation(),t.couponProducts(e)}}},[t._v("可用商品")]):100==e.soldNum?s("div",{staticClass:"btn to-product theme_bg_dark_d theme_font_white",on:{click:function(t){t.stopPropagation()}}},[t._v("已抢完")]):s("div",{staticClass:"btn get-coupon theme_bg_light_blue theme_font_white",on:{click:function(s){return s.stopPropagation(),t.getCouponEvent(e)}}},[t._v("点击兑换")])])])])})),0)}),[],!1,null,"1b844448",null).exports},data:function(){return{initData:{listData:[],userCanNotUseCoupon:[],userCanUseCoupon:[],userCanUseWhenNotSelectCoupon:[],freightCoupon:[],type:"",skuId:"",categoryId:"",storeOuCode:"",token:"",jfhqData:""},visible:!1,selectedCoupon:function(){console.log("selectedCoupon")},getedCoupon:function(){console.log("getedCoupon")},couponProducts:function(){console.log("couponProducts")},receivedCoupon:[],canReceiveCoupon:[],canUseCoupon:!0,selectedItems:[]}},methods:{reloadCoupons:function(){},sureEvent:function(){this.visible=!1},selectedItemsEvent:function(t){var e=[];if(this.initData.userCanUseCoupon&&this.initData.userCanUseCoupon.length)for(var s=0;s<this.initData.userCanUseCoupon.length;s++)1==this.initData.userCanUseCoupon[s].selected&&e.push(this.initData.userCanUseCoupon[s]);if(this.initData.freightCoupon&&this.initData.freightCoupon.length)for(var o=0;o<this.initData.freightCoupon.length;o++)1==this.initData.freightCoupon[o].selected&&e.push(this.initData.freightCoupon[o]);this.selectedItems=e,this.selectedCoupon(this.selectedItems)},popClose:function(){this.visible=!1},jfdhCouponEvent:function(t){var e=this;this.$Loading.open();var s={token:r.a.state.login.token,deliveryType:2,virtualUserPhone:r.a.state.login.phone};t.perDiscountEmpRewardsPrice?(s.carts=[{number:1,skuId:t.skuId,storeOuCode:t.storeOuCode,empRewardsPrice:t.perDiscountEmpRewardsPrice,price:0,selfActivityId:t.activityId}],s.payDigital=[{payDigital:t.perDiscountEmpRewardsPrice,acctType:"EmpRewards"}]):(s.carts=[{number:1,skuId:t.skuId,storeOuCode:t.storeOuCode,pointsPrice:t.points,price:0,selfActivityId:t.activityId}],s.payDigital=[{payDigital:t.points,acctType:"Points"}]),this.$http.post("/app/json/app_shopping_order/submit",s).then((function(s){var o=s.data;0==o.status?e.$refs.JFHQCoupon.setItemReceived(t):e.$Toast(o.info),e.$Loading.close()}))},getCouponEvent:function(t){var e=this;this.$Loading.open();var s={token:this.initData.token,mktActivityId:t.mktActivityId,proCode:this.initData.skuId,categoryCode:this.initData.categoryId,storeOuCode:this.initData.storeOuCode};console.log(s),this.$http.post("/app/json/app_market/getCouScanUrl",s).then((function(s){e.$Loading.close();var o=s.data;0==o.status?(t.isReceived=1,e.getedCoupon(t)):e.$Toast(o.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))}},mounted:function(){if(this.canUseCoupon=!0,"receive"==this.initData.type){this.receivedCoupon=[],this.canReceiveCoupon=[];for(var t=0;t<this.initData.listData.length;t++){var e=this.initData.listData[t];0==e.isReceived?this.canReceiveCoupon.push(e):this.receivedCoupon.push(e)}}else"use"==this.initData.type||"show"==this.initData.type&&(this.receivedCoupon=this.initData.listData)}}),d=(s("PvDJ"),Object(c.a)(p,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.visible?s("div",{staticClass:"coupon mall2"},[t.visible?s("pop-view",{on:{closeEvent:function(e){t.visible=!1}}},["receive"==t.initData.type?s("div",{staticClass:"pop-body"},[s("div",{staticClass:"pop-title theme_font_common"},[t._v("优惠券")]),t._v(" "),s("div",{staticClass:"pop-scroll-div"},[t.canReceiveCoupon.length>0?s("div",[s("div",{staticClass:"title theme_font_gray"},[t._v("可领取优惠券")]),t._v(" "),s("Coupon",{attrs:{coupons:t.canReceiveCoupon,listType:0},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts}})],1):t._e(),t._v(" "),t.initData.jfhqData&&t.initData.jfhqData.length>0?s("div",[s("div",{staticClass:"title theme_font_gray"},[t._v("积分换券")]),t._v(" "),s("JFHQCoupon",{ref:"JFHQCoupon",attrs:{coupons:t.initData.jfhqData,listType:0},on:{jfdhCouponEvent:t.jfdhCouponEvent,couponProducts:t.couponProducts}})],1):t._e(),t._v(" "),t.receivedCoupon.length>0?s("div",[s("div",{staticClass:"title theme_font_gray"},[t._v("已领取优惠券")]),t._v(" "),s("Coupon",{attrs:{coupons:t.receivedCoupon,listType:0},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts}})],1):t._e()])]):t._e(),t._v(" "),"use"==t.initData.type?s("div",{staticClass:"pop-body"},[s("div",{staticClass:"pop-title theme_font_common"},[t._v("优惠券")]),t._v(" "),s("div",{staticClass:"pop-tabs"},[s("div",{staticClass:"tab-item",on:{click:function(e){t.canUseCoupon=!0}}},[s("div",{staticClass:"theme_font_gray",class:{theme_font_black_i:t.canUseCoupon}},[t._v("可用优惠券("+t._s(t.initData.freightCoupon?t.initData.userCanUseCoupon.length+t.initData.freightCoupon.length:t.initData.userCanUseCoupon.length)+")")]),t._v(" "),s("div",{staticClass:"selected-line",class:{active:t.canUseCoupon}})]),t._v(" "),s("div",{staticClass:"tab-item",on:{click:function(e){t.canUseCoupon=!1}}},[s("div",{staticClass:"theme_font_gray",class:{theme_font_black_i:!t.canUseCoupon}},[t._v("不可用优惠券("+t._s(t.initData.userCanNotUseCoupon.length)+")")]),t._v(" "),s("div",{staticClass:"selected-line",class:{active:!t.canUseCoupon}})])]),t._v(" "),s("div",{staticClass:"pop-scroll-div"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.canUseCoupon,expression:"canUseCoupon"}]},[t.initData.freightCoupon&&0!=t.initData.freightCoupon.length||0!=t.initData.userCanUseCoupon.length?t._e():s("div",{staticClass:"no-coupon"},[s("img",{attrs:{src:"static/image/mall2/no-coupon.png"}}),t._v(" "),s("p",{staticClass:"theme_font_gray"},[t._v("您暂时没有可以使用的优惠券")])]),t._v(" "),t.initData.freightCoupon&&t.initData.freightCoupon.length>0?s("div",{staticClass:"cate-title"},[t._v("商场券")]):t._e(),t._v(" "),s("Coupon",{attrs:{listType:2,payAmount:t.initData.payAmount,coupons:t.initData.userCanUseCoupon},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts,selectedItems:t.selectedItemsEvent}}),t._v(" "),t.initData.freightCoupon&&t.initData.freightCoupon.length>0?s("div",{staticClass:"cate-title"},[t._v("运费券")]):t._e(),t._v(" "),s("Coupon",{attrs:{listType:2,payAmount:t.initData.payAmount,coupons:t.initData.freightCoupon},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts,selectedItems:t.selectedItemsEvent}})],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.canUseCoupon,expression:"!canUseCoupon"}]},[0==t.initData.userCanNotUseCoupon.length?s("div",{staticClass:"no-coupon"},[s("img",{attrs:{src:"static/image/mall2/no-coupon.png"}}),t._v(" "),s("p",{staticClass:"theme_font_gray"},[t._v("您暂时没有不可以使用的优惠券")])]):t._e(),t._v(" "),s("Coupon",{attrs:{listType:1,coupons:t.initData.userCanNotUseCoupon},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts}})],1)]),t._v(" "),t.canUseCoupon?s("div",{staticClass:"bottom-btn",on:{click:t.sureEvent}},[t._v("确定")]):t._e()]):t._e(),t._v(" "),"show"==t.initData.type?s("div",{staticClass:"pop-body"},[s("div",{staticClass:"pop-title theme_font_common"},[t._v("优惠券")]),t._v(" "),s("div",{staticClass:"pop-scroll-div"},[t.receivedCoupon.length>0?s("div",[s("div",{staticClass:"title theme_font_gray"},[t._v("已领取优惠券")]),t._v(" "),s("Coupon",{attrs:{coupons:t.receivedCoupon,listType:0},on:{getCouponEvent:t.getCouponEvent,couponProducts:t.couponProducts}})],1):t._e()])]):t._e()]):t._e()],1):t._e()}),[],!1,null,"365763a6",null).exports),C=i.default.extend(d),h=void 0,v={open:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h||(h=new C),h.initData=t.initData,"use"==h.initData.type?(h.selectedCoupon=t.selectedCoupon,this.initCouponList(h.initData.userCanUseCoupon,h.initData.freightCoupon,h.initData.userCanUseWhenNotSelectCoupon)):(h.getedCoupon=t.getedCoupon,h.couponProducts=t.couponProducts),h.visible||(h.$mount(),document.getElementById("app").appendChild(h.$el),i.default.nextTick((function(){h.visible=!0})))},close:function(){h&&(h.visible=!1)},initCouponList:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(s)for(var o=0;o<s.length;o++)s[o].selected=!1,s[o].disable=!0,t.push(s[o]);h.initData.userCanUseCoupon=JSON.parse(JSON.stringify(t)),h.initData.freightCoupon=JSON.parse(JSON.stringify(e)),h.initData.userCanUseWhenNotSelectCoupon=s},reloadSelectedCoupon:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=[],a=0;a<h.initData.userCanUseCoupon.length;a++){for(var i=h.initData.userCanUseCoupon[a].couNo,n=0;n<t.length;n++)i==t[n].couNo&&(h.initData.userCanUseCoupon[a].selected=t[n].selected,h.initData.userCanUseCoupon[a].disable=!1,o.push(h.initData.userCanUseCoupon[a]));if(s)for(var c=0;c<s.length;c++)i==s[c].couNo&&(h.initData.userCanUseCoupon[a].selected=!1,h.initData.userCanUseCoupon[a].disable=!0,o.push(h.initData.userCanUseCoupon[a]))}h.initData.userCanUseCoupon=JSON.parse(JSON.stringify(o)),h.initData.freightCoupon=JSON.parse(JSON.stringify(e)),h.initData.userCanUseWhenNotSelectCoupon=s}},m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o])}return t},f={mixins:[a.a],data:function(){return{purchaseNum:this.$route.params.settleCartData.carts[0].number,isShowBuyModal:!1,selectedPayWay:{},payWayList:[],submitData:{},rfrCode:"",scanCode:"",entryType:0,occurData:{},usedCoupons:[],newPrice:void 0}},mounted:function(){this.occurData=this.$route.params.occurData||{},this.paramsData=this.$route.params.settleCartData||{},this.$route.params.entryType&&(this.entryType=this.$route.params.entryType),this.initData()},methods:{getParamsInStr:function(t,e){var s={};if(t.indexOf("?")>-1){var o=t.split("?")[1].split("&");o instanceof Array&&o.length>0&&o.forEach((function(t){s[t.split("=")[0]]=t.split("=")[1]}))}return s[e]},confirmBuyNow:function(){var t=this;o.a.payEvent(this.selectedPayWay,this.submitData.orderType,this.submitData.orderId,"/mall2/paysuccess?entryType="+this.entryType+"&orderType="+this.submitData.orderType+"&orderId="+this.submitData.orderId).then((function(){})).catch((function(){t.$Toast("cancel")}))},rfrCodeScanHandler:function(){var t=this;this.$bridgefunc.scanCode((function(e){-1!==String(e.code).indexOf("http")?(t.scanCode=t.getParamsInStr(e.code,"qrCode"),t.rfrCode=t.getParamsInStr(e.code,"qrCode")):(t.scanCode=e.code,t.rfrCode=e.code)}))},submitOrder:function(){var t=this;if(this.submitData.orderType&&this.submitData.orderId)this.confirmBuyNow();else{this.$STLoading.open();var e=m({},this.$route.params.settleCartData,{virtualUserPhone:this.$store.state.login.phone,deliveryType:2,payDigital:[],userInvoice:{},orderScene:this.$util.orderScene()});if(e.couNo=[],this.usedCoupons.length>0)for(var s=0;s<this.usedCoupons.length;s++)e.couNo.push(this.usedCoupons[s].couNo);else e.couNo=[];this.rfrCode&&this.rfrCode.length&&(e.rfrCode=this.rfrCode,this.rfrCode==this.scanCode?e.rfrCodeType=2:e.rfrCodeType=1),this.$http.post("/app/json/app_shopping_order/submit",e).then((function(e){var s=e.data;0==s.status?(t.submitData=s.data,0===t.submitData.payAmount?t.$router.push({path:"/mall2/paysuccess",query:{entryType:t.entryType,orderType:t.submitData.orderType,orderId:t.submitData.orderId}}):t.getPayModal(s.data.orderType)):t.$Toast(s.info),t.$STLoading.close()})).catch((function(e){t.$Toast("submit err "+e),t.$STLoading.close()}))}},getPayModal:function(t){var e=this;o.a.getPayWays(200001,this.$route.params.occurData.ouCode).then((function(t){t&&t instanceof Array&&t.length>0?(e.payWayList=t,e.selectedPayWay=e.payWayList[0],e.isShowBuyModal=!0):e.$Toast("暂无支付方式")}))},chosePayType:function(t){this.selectedPayWay=t},couponEvent:function(){for(var t=this,e=[],s=0;s<this.occurData.userCanUseCoupon.length;s++){var o=this.occurData.userCanUseCoupon[s].couNo;this.occurData.userCanUseCoupon[s].selected=!1;for(var a=0;a<this.usedCoupons.length;a++)if(this.usedCoupons[a].couNo==o){this.occurData.userCanUseCoupon[s].selected=!0;break}e.push(this.occurData.userCanUseCoupon[s])}v.open({initData:{listData:[],userCanNotUseCoupon:this.occurData.userCanNotUseCoupon,userCanUseCoupon:e,userCanUseWhenNotSelectCoupon:this.occurData.userCanUseWhenNotSelectCoupon,type:"use",skuId:"",categoryId:"",storeOuCode:"",token:this.$store.state.login.token,payAmount:this.$util.toDecimal2(parseFloat(this.occurData.payAmount)+parseFloat(this.occurData.couponAmount))},selectedCoupon:function(e){t.usedCoupons=e,t._reSettleCart(null)}})},reloadSelectedCoupon:function(){var t=this.occurData.couNo;if(this.usedCoupons=[],t.length>0)for(var e=0;e<t.length;e++)this.usedCoupons.push({couNo:t[e]});for(var s=[],o=0;o<this.occurData.userCanUseCoupon.length;o++){var a=this.occurData.userCanUseCoupon[o].couNo;this.occurData.userCanUseCoupon[o].selected=!1;for(var i=0;i<this.usedCoupons.length;i++)if(this.usedCoupons[i].couNo==a){this.occurData.userCanUseCoupon[o].selected=!0;break}s.push(this.occurData.userCanUseCoupon[o])}v.reloadSelectedCoupon(s,[],this.occurData.userCanUseWhenNotSelectCoupon)},_reSettleCart:function(t,e){var s=this;this.$Loading.open();var o=this.paramsData;if(o.couNo=[],this.usedCoupons.length>0)for(var a=0;a<this.usedCoupons.length;a++)o.couNo.push(this.usedCoupons[a].couNo);else o.couNo.push("-1");o.limitWalletCardNo=e,2==this.paramsData.deliveryType?""!=this.$store.state.mall2.selectAddress.id&&(o.userAddressId=this.$store.state.mall2.selectAddress.id):o.pickupId=this.$store.state.mall2.zitiAddress.id,this.$http.post("/app/json/app_cart/SettleCart",o).then((function(t){s.$Loading.close();var e=t.data;0==e.status?(s.occurData=e.data.occur[0],s.paramsData=o,s.newPrice=s.occurData.payAmount,s.initData()):s.$Toast(e.info)}),(function(t){s.$Loading.close(),s.$Toast("SettleCart err "+err)}))},initData:function(){var t=this.occurData.couNo;if(this.usedCoupons=[],t&&t.length>0)for(var e=0;e<t.length;e++)this.usedCoupons.push({couNo:t[e]});this.reloadSelectedCoupon()}}},g=(s("Lfop"),Object(c.a)(f,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("nav-top",{on:{backEvent:function(e){return t.$router.go(-1)}}}),t._v(" "),o("nav-content",{staticClass:"container"},[o("div",{staticClass:"block-content prod-info"},[o("img",{staticClass:"prod-img",attrs:{src:t.$route.params.phMainUrl,alt:""}}),t._v(" "),o("div",{staticClass:"right"},[o("p",{staticClass:"name"},[t._v(t._s(t.$route.params.skuName))]),t._v(" "),o("div",{staticClass:"price"},[o("span",{staticClass:"current-price"},[t._v("¥"+t._s(t.dealWithPrice(t.$route.params.salePrice)[2]))]),t._v(" "),o("span",{staticClass:"buy-num"},[t._v("x"+t._s(t.$route.params.settleCartData.carts[0].number))])])])]),t._v(" "),o("div",{staticClass:"block-content chose-coupon",on:{click:t.couponEvent}},[o("div",{staticClass:"label"},[t._v("优惠券")]),t._v(" "),o("div",{staticClass:"right-info"},[o("p",{staticClass:"amount"},[t._v("优惠"+t._s(t.$util.toDecimal2(t.occurData.couponAmount))+"元")]),t._v(" "),o("i",{staticClass:"iconfont mall-gengduo more-icon"})])]),t._v(" "),o("div",{staticClass:"block-content referrer-container"},[o("van-field",{attrs:{clearable:"",label:"推荐人",placeholder:"请输入推荐人编码"},model:{value:t.rfrCode,callback:function(e){t.rfrCode=e},expression:"rfrCode"}},[o("van-icon",{staticClass:"rfr-scan-btn",attrs:{slot:"right-icon",name:"scan"},on:{click:t.rfrCodeScanHandler},slot:"right-icon"})],1)],1),t._v(" "),o("div",{staticClass:"bottom-btn"},[o("div",{staticClass:"left-price"},[t._v("\n        应付金额："),o("span",{staticClass:"num"},[t._v("￥"+t._s(void 0!==t.newPrice?t.newPrice:t.dealWithPrice(t.$route.params.occurData.payAmount)[2]))])]),t._v(" "),o("div",{staticClass:"chum-public-btn submit-btn"},[o("van-button",{attrs:{round:"",block:"",type:"info",color:"linear-gradient(270deg,rgba(49,49,49,1) 0%,rgba(84,84,84,1) 51%,rgba(49,49,49,1) 100%)"},on:{click:t.submitOrder}},[t._v("提交订单\n        ")])],1)])]),t._v(" "),o("van-popup",{staticClass:"buy-modal",attrs:{position:"bottom",closeable:""},model:{value:t.isShowBuyModal,callback:function(e){t.isShowBuyModal=e},expression:"isShowBuyModal"}},[o("p",{staticClass:"title"},[t._v("确认付款")]),t._v(" "),o("p",{staticClass:"price-c"},[t._v("￥"),o("span",{staticClass:"num"},[t._v(t._s(void 0!==t.newPrice?t.newPrice:t.dealWithPrice(t.$route.params.occurData.payAmount)[2]))])]),t._v(" "),o("p",{staticClass:"pay-type-title"},[t._v("支付方式")]),t._v(" "),o("div",{staticClass:"pay-type-container"},[o("ul",{staticClass:"pay-type-c"},t._l(t.payWayList,(function(e,a){return o("li",{key:a,staticClass:"item",on:{click:function(s){return t.chosePayType(e)}}},[o("div",{staticClass:"left-c"},[o("img",{staticClass:"icon",attrs:{src:e.icon,alt:""}}),t._v(" "),o("span",{staticClass:"pay-name"},[t._v(t._s(e.text))])]),t._v(" "),o("div",{staticClass:"right-c"},[e.payModeSub==t.selectedPayWay.payModeSub?o("img",{staticClass:"icon-select",attrs:{src:s("N+be"),alt:""}}):o("img",{staticClass:"icon-select",attrs:{src:s("qnwC"),alt:""}})])])})),0)]),t._v(" "),o("div",{staticClass:"chum-public-btn"},[o("van-button",{attrs:{round:"",block:"",type:"info",color:"linear-gradient(270deg,rgba(49,49,49,1) 0%,rgba(84,84,84,1) 51%,rgba(49,49,49,1) 100%)"},on:{click:t.confirmBuyNow}},[t._v("立即支付\n      ")])],1)])],1)}),[],!1,null,"65b132eb",null));e.default=g.exports},Lfop:function(t,e,s){"use strict";var o=s("WRFH");s.n(o).a},"N+be":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAAH7+Yj7AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAKAAAAAB65masAAAEmElEQVRYCdVYa2wVRRT+Zu9tgd7WVBAVkhpalF5eGltbMNEEQSupwfj4gRDa/ugj8YGIEkl8YDBqQkIQhcTa1mhFCSSaIMT4IFQIYCwtBKUvpKQBraSIYKWlte3d9czE2e7j3t29t5trnR87M+d855szs7tzzgwDlcaPyjVey8KsAq5QpNZYexeyxvryH6BhgTRnilKlGAVcoalqjYnzzuVvC4Mgf85dtgGhybfgWH3FqLB13+uiIx+2gaTCWtsGtwJkX3doTvFLUibqgtIaU9+2brOWPIufD7xrAvGOwidvlEYDcT3TNI3RdFUj2NRmrG9BWV2GbWgTyNDRJ2OQRW06AmcvXa8bxQTOvLcS7V9vsgPnLXtNF96YuwhnD9fqfd7QGVv2bcT8R95A6IZsXDx90ATiHfFVSOmpPa9ACaTKrqnWGaVUjQzJpqm2AU1aQ8f9zRjArk3GGgLF2b+a/kJXI2dAtuepOPOMahMmDBetw+2PvjXK9G/L9Pps2iiCrPzHcVN4CZo/fSqK1vI9SMS8hzeCMYZTX2yQImRm3YFZi1eLneSX45/rcmvD8bea89DLCE5Ix8SMqTj2cSXtXu7vz3HKbV++aXXAta/Q3PpcUXEAFL6dEGlDHDYxoYFAYDrjWlqfStrLttAapcdEOykYGgtL6+6mF6nRDl9xgIgWO+G96grL6hTHt+yVSMeRpwn/KTqJsUFB019CIh8/hIHUEHictJaEPGRKEPkr3kHX9/VWvkSmzFBQUo2f9ryK4YHesRMWltWi7atNGOy9YCPjAtuU6eMUO0w0NNd1HqxG38Uz0dRCZiM8sXst8p7YiuDE60xGBSXv41zTblw+12ySWzs2wpHBqzixaw3ylm9BSlqmwOev3I6eju/Q07bfam/rR90PR/7ux/Gdq5G/chuGaOF7f2vF+aZdNuNoApuHEhQZHkDzzmfQf6mL1u09KXatYxJyS3V4EGcatruSGAGOhEag17a/hBROfCWkHft5hccBr9NxxFFcKiytrRUxpXlH1bSIqn7iVyhwHNiLkmdxirLqrpKaC0wEPDrNeLFLNkYcvUQ0TvbIHsfjvtHxLMFUweMgY4KRb77+JWNyJobxuHcw6uYfYzK+iJXgBISLXkD61BxcpbjZTsHYqSTPQabgtvuexvV0Lhnqv4KTn62n+g8n34QuKQ7OWLgK/JgeGRpAC922XLt83tUxCXB18NZFTyKQmoazh6rB4348Zdr8YmTlPQZVHcHp/VspT2iJx1xgXXP/FEqVwg+uw6TM6bh2pRsd324Gz3qcypSchci5p1xAeCp6qfOIE9xR5+qgtOZHUf5xp03OwgBlmB3fbLalrRk3h5F7/xq6J0lB94970X1yrzRPuPbsoByBZ/zhorUITZmBwb960E6OBukTmL30Rcp2Q/i98yi6jn4o4WOu43ZQjhhImYTcB56j7WKmEP3Z3ULZ3ja6pYxIiC91wg76MroHknEfSf4HDtK1gIeV/m8g/MqC3674de3j6yxEyk83P5KUX4k37aiq0DSVdlg2N+l5orhw01oZUz4oKKmp41dS3Ld/AFmuY9fC7uBoAAAAAElFTkSuQmCC"},PvDJ:function(t,e,s){"use strict";var o=s("xYbt");s.n(o).a},WRFH:function(t,e,s){},hjAl:function(t,e,s){"use strict";var o=s("BRVv");s.n(o).a},qnwC:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAADC0lEQVR4Xu3dP2/TUBQF8HvrRPFAhbrSiQUGpCyAmBjCwAhUfAGYouaPbBYQfAAQLNhqkqpDBV8ARFckmoEJAUsHJFiYylpBGBIl6UXPaqFpQ2v3dEpORtvHkX8+0pOX+1TG/OI4vmhmz0Tk2rjzU3hsXVXvB0Hwef+z694D7XY7t7GxEYlIxcxUVbfMbM3zvDVV/aKqP6rV6u9JBmw2m6fM7MxwOLxgZjdU9aaZzamqiUirWCyGpVJpsGvwF7DVas31+/1XZlZS1a6IPPd9/2m5XP45yWBHPdvKysrpbrf7QETumZmvqu18Pn+7UqlsuWwCuNO8tw5PRDY9z7tVr9c/HXXzaTq/tLR0aTgcvhGReYdYLBavuyYmgHEcN8ys6vAKhcKVxcXFzWnCSfusy8vL871e78MOYjMIgpq6BUNEPopIb2Zm5iqbdzina+L29vZ7ESmIyGWNouidW21V9UkQBI/Svo1pvi6O48dm9lBE1h2gW263fN8/O+0LRtpS7Cws35PV2QGKyMswDO+mvQGvE4mi6IWI3EkAPc9bqNfrboXhL6VAHMcLZvY6Aczlcudrtdq3lFleJiKNRuPcYDD4mgDm8/nZSf/COOm37r5Y+v1+JwEMw3Dkk+6k/2xS75cswAQ8/usl4PHtkiQBCQgKgHE2kICgABhnAwkICoBxNpCAoAAYZwMJCAqAcTaQgKAAGGcDCQgKgHE2kICgABhnAwkICoBxNpCAoAAYZwMJCAqAcTaQgKAAGGcDCQgKgHE2kICgABhnAwkICoBxNpCAoAAYZwMJCAqAcTaQgKAAGGcDCQgKgHE2kICgABhnAwkICoBxNpCAoAAYZwMJCAqAcTaQgKAAGGcDCQgKgHE2kICgABhnA08KkIN3skuurq7OdjqdXxz9lN0uSYyMfuLwseyKI8PHOP4uO+DI+DsOYMwGuH8AI0eAZvNzQ3v/jQDlENpsegeG0Lo4xyCnQxw7BtlFOYj7aMBDB3G7OEfBj0dMNQp+N8rNCESOvRnBXn9uh3Ggjf/dDuMPY+LsM8OGfmQAAAAASUVORK5CYII="},v2HF:function(t,e,s){"use strict";var o=s("2qT4");s.n(o).a},xYbt:function(t,e,s){}}]);