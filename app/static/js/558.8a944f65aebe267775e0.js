(window.webpackJsonp=window.webpackJsonp||[]).push([[558],{BAUl:function(t,e,n){"use strict";var s=n("WpmB");n.n(s).a},WpmB:function(t,e,n){},mTnm:function(t,e,n){"use strict";n("5+UC");var s=n("05lO"),i=n("oCYn"),a=(n("ygAv"),n("oYx3"),n("dRp0")),o=n("ZToj"),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();i.default.use(s.a);var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsApiList=e}return c(t,[{key:"hideAllBaseMenu",value:function(){this._init(["hideAllNonBaseMenuItem"]).then((function(){wx.hideAllNonBaseMenuItem()}))}},{key:"getEtpLocation",value:function(t){this._init(["getLocation"]).then((function(){wx.getLocation({type:"gcj02",success:function(e){t&&t(e)}})}))}},{key:"createEnterpriseChat",value:function(t,e,n){t&&e?this._init(["openEnterpriseChat"]).then((function(){wx.openEnterpriseChat({userIds:t.join(";"),externalUserIds:e.join(";"),groupName:"群聊",success:function(t){n&&n(t)},fail:function(t){t.errMsg.indexOf("function not exist")>-1&&alert("版本过低请升级")}})})):console.log("传参有误")}},{key:"getExternalContact",value:function(t){var e=this;this._init(["getCurExternalContact"]).then((function(){e._initAgent(["getCurExternalContact"]).then((function(e){wx.invoke("getCurExternalContact",{},(function(e){"getCurExternalContact:ok"==e.err_msg?(console.log("wxfunc-etp getCurExternalContact res",e),t&&t(e.userId)):console.log("wxfunc-etp getCurExternalContact err")}))}))}))}},{key:"_init",value:function(t){var e=this;return new Promise((function(n,s){e._getConfig().then((function(e){wx.config({beta:!0,debug:!1,appId:e.corpId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t}),wx.ready((function(){n(e)})),wx.error((function(t){s(t),console.log("we error",t)}))})).catch((function(t){console.log("发生错误！",t)}))}))}},{key:"_getConfig",value:function(){return new Promise((function(t,e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);var n={url:window.location.href.split("#")[0],agentId:o.a.state.etpAgentId,appId:o.a.state.etpAppId,hbsy_web_tag_type:1};a.a.post("/app/json/wechat_qy/signature",n).then((function(n){var s=n.data;0===s.status?t(s.data):e("获取签名信息失败!")})).catch((function(t){e(t)}))}))}},{key:"_initAgent",value:function(t){var e=this;return new Promise((function(n,s){e._getAgentConfig().then((function(e){wx.agentConfig({corpid:e.corpId,agentid:e.agentId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t,success:function(t){n(t)},fail:function(t){t.errMsg.indexOf("function not exist")>-1&&alert("版本过低请升级")},complete:function(t){console.log("agentConfig complete",t)}})})).catch((function(t){console.log("发生错误！",t)}))}))}},{key:"_getAgentConfig",value:function(){return new Promise((function(t,e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);var n={url:window.location.href.split("#")[0],agentId:o.a.state.etpAgentId,appId:o.a.state.etpAppId,hbsy_web_tag_type:1};a.a.post("/app/json/wechat_qy/agentSignature",n).then((function(n){var s=n.data;0===s.status?t(s.data):e("获取签名信息失败!")})).catch((function(t){e(t)}))}))}}]),t}();e.a=new r},yc5u:function(t,e,n){"use strict";n.r(e);var s=n("mTnm"),i={data:function(){return{activeTab:0,tabList:[{title:"全部用户",customerType:0},{title:"未注册会员",customerType:-1},{title:"油滴会员",customerType:2},{title:"活跃用户",customerType:4},{title:"非活跃用户",customerType:5}],userList:[],isSelecting:!1,choseList:[]}},mounted:function(){this.activeTab=this.$route.query.customerType,this.getCustomerList()},methods:{changeListStatus:function(){this.isSelecting?(this.isSelecting=!1,this.choseList=[],this.userList.forEach((function(t){t.isChose=!1}))):this.isSelecting=!0},changeSel:function(t){if(t.isChose)this.choseList.push(t);else{var e=void 0;this.choseList.forEach((function(n,s){n.id==t.id&&(e=s)})),this.choseList.splice(e,1)}},cancelSel:function(t){var e=void 0;this.choseList.forEach((function(n,s){n.id==t.id&&(e=s)})),this.choseList.splice(e,1),this.userList.forEach((function(e,n){e.id==t.id&&(e.isChose=!1)}))},getCustomerList:function(t){var e=this;this.$Loading.open(),this.userList=[],this.$http.post("/app/json/wechat_qy/queryCustomerList",{customerType:this.activeTab}).then((function(t){e.$Loading.close();var n,s=t.data;0==s.status?s.data instanceof Array&&s.data.length>0&&(e.choseList instanceof Array&&e.choseList.length>0?s.data.forEach((function(t){for(var n=0;n<e.choseList.length;n++){if(e.choseList[n].qyUserId==t.qyUserId){t.isChose=!0;break}t.isChose=!1}})):s.data.forEach((function(t){t.isChose=!1})),(n=e.userList).push.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(s.data))):e.$Toast(s.info)})).catch((function(t){e.$Loading.close(),e.$Toast("queryCustomerList err "+t)}))},changeTabs:function(){this.getCustomerList()},startGroupChat:function(){var t=[this.choseList[0].empQyUserId],e=[];this.choseList.forEach((function(t){e.push(t.qyUserId)})),s.a.createEnterpriseChat(t,e,(function(t){console.log("拉起成功！")}))},toUserDetail:function(t){this.$router.push({path:"/performance-per-info",query:{qyUserId:t.qyUserId}})}}},a=(n("BAUl"),n("KHd+")),o=Object(a.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("van-tabs",{staticClass:"reset-tabs",attrs:{ellipsis:!1,swipeable:"",color:"#517BB5","title-active-color":"#517BB5"},on:{change:t.changeTabs},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.tabList,(function(e,s){return n("van-tab",{key:s,attrs:{title:e.title,name:e.customerType}},[t.userList.length>0?n("ul",{staticClass:"user-list"},t._l(t.userList,(function(e,s){return n("li",{key:s,staticClass:"item"},[t.isSelecting?n("div",{staticClass:"check-c"},[n("van-checkbox",{attrs:{shape:"square","checked-color":"#73D659"},on:{click:function(n){return t.changeSel(e)}},model:{value:e.isChose,callback:function(n){t.$set(e,"isChose",n)},expression:"item.isChose"}})],1):t._e(),t._v(" "),n("div",{staticClass:"avatar-c"},[n("img",{staticClass:"avatar",attrs:{src:e.avtUrl,alt:""}})]),t._v(" "),n("div",{staticClass:"user-c",on:{click:function(n){return t.toUserDetail(e)}}},[n("p",{staticClass:"name"},[t._v(t._s(e.nickName)+t._s(e.remark?"/"+e.remark:""))]),t._v(" "),n("p",{staticClass:"phone"},[t._v(t._s(e.userPhone))])]),t._v(" "),n("van-icon",{staticClass:"icon-c",attrs:{name:"arrow"}})],1)})),0):n("p",{staticClass:"no-result"},[t._v("暂无数据~")])])})),1),t._v(" "),n("van-button",{staticClass:"group-chat-btn",attrs:{type:"primary",color:"#517BB5",icon:t.isSelecting?"":"plus"},on:{click:t.changeListStatus}},[t._v(t._s(t.isSelecting?"取消":""))]),t._v(" "),t.choseList.length>0?n("div",{staticClass:"statistics-area"},[n("div",{staticClass:"chose-c"},[n("ul",{staticClass:"chose-list"},t._l(t.choseList,(function(e,s){return n("li",{key:s,staticClass:"item",on:{click:function(n){return t.cancelSel(e)}}},[n("img",{staticClass:"avatar",attrs:{src:e.avtUrl,alt:""}})])})),0)]),t._v(" "),n("div",{staticClass:"confirm-btn",on:{click:t.startGroupChat}},[t._v("确定("+t._s(t.choseList.length)+")")])]):t._e()],1)}),[],!1,null,"087df415",null);e.default=o.exports}}]);