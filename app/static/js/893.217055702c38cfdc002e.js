(window.webpackJsonp=window.webpackJsonp||[]).push([[893],{"6Usw":function(t,e,o){"use strict";o.r(e),o("4X9F");var a=o("IkEG"),n=o("YsXA"),i=o.n(n),s=o("0FX9"),c=o.n(s),r={name:"ad-page",components:{},data:function(){return{code:"",item:"",number:"",flag:!0,timeer:"",timeer2:"",timeVouc:"",detailInfo:{}}},methods:{getStatus:function(){var t=this,e=this;this.$http.post("/platform/json/coupon/getHjyusedcoustate",{}).then((function(o){0==o.data.status&&("0"==o.data.data?(t.getDetail(),t.timeer2=setInterval((function(){t.getDetail()}),6e4)):(clearInterval(t.timeer2),e.$Bridgefunc.customGo(-2)))}))},getDetail:function(){var t=this;this.$Loading.open();var e=this;this.$http.post("/platform/json/coupon/getHjyCoupons",this.item).then((function(o){if(t.$Loading.close(),0===o.data.status){var n=o.data.data;n&&(t.code=n.couNo,t.getCode(n.voucher))}else 1001==o.data.errorCode?a.a.alert({title:"",message:o.data.info}).then((function(){e.$Bridgefunc.customGo(-1)})):e.$Toast({message:o.data.info,position:"bottom",duration:1e3})})).catch((function(e){t.$Loading.close(),t.$Toast({message:"请求失败",position:"bottom",duration:2e3})}))},getCode:function(t){var e=this,o={"hjyCouponReqModel.voucher":t,isJsonData:!0};this.checkVouchers(t),this.timeVouc=setInterval((function(){e.checkVouchers(t)}),1e3),this.$http.post("/platform/json/coupon/getHjycheckcode",o).then((function(t){0===t.data.status&&e.$nextTick((function(){e.createBar(t.data.data)}))}))},createBar:function(t){this.number=t;var e=document.getElementById("barcode");i()(e,t,{displayValue:!1,fontSize:16});var o=document.getElementById("qrcode");c.a.toCanvas(o,t,(function(t){t&&console.error(t)}))},checkVouchers:function(t){var e=this,o={token:this.$store.state.login.token||"",voucher:t,isJsonData:!0};this.$http.post("/platform/json/coupon/gethjyCouponState",o).then((function(o){var a=o.data;0===a.status?0===Number(a.data)||(e.detailInfo.currentTime=a.currentTime,clearInterval(e.timeer2),clearInterval(e.timeVouc),e.$bridgefunc.customPush({path:"/hkpayDetail",query:{getGame:1===Number(a.data),voucher:encodeURIComponent(JSON.stringify(t)),detailInfo:encodeURIComponent(JSON.stringify(e.detailInfo))}})):e.$Toast(o.data.info)})).catch((function(t){e.$Toast("请求失败")}))}},created:function(){this.getStatus(),this.item=JSON.parse(decodeURIComponent(this.$route.query.item)),this.detailInfo=JSON.parse(decodeURIComponent(this.$route.query.detailInfo)),console.log("detailInfo",this.detailInfo)},destroyed:function(){clearInterval(this.timeer2),clearInterval(this.timeVouc)}},u=(o("aS9w"),o("KHd+")),d=Object(u.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"ad-page"},[o("nav-top",{attrs:{title:"优惠码"},on:{backEvent:function(e){return t.$router.go(-1)}}}),t._v(" "),o("nav-content",[o("div",{staticClass:"code"},[o("div",{staticClass:"top"},[o("span",[t._v(t._s(t.detailInfo.title)+"  "+t._s(t.detailInfo.oilNo))])]),t._v(" "),o("div",{staticClass:"top"},[o("span",[t._v("优惠码：")]),t._v(" "),o("span",[t._v(t._s(t.code))])]),t._v(" "),o("canvas",{attrs:{id:"barcode"}}),t._v(" "),o("div",{staticClass:"number"},[t._v(t._s(t.number))]),t._v(" "),o("canvas",{attrs:{id:"qrcode"}})])])],1)}),[],!1,null,"417cf3e8",null);e.default=d.exports},DGdM:function(t,e,o){},aS9w:function(t,e,o){"use strict";var a=o("DGdM");o.n(a).a}}]);