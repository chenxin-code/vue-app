(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2db64121"],{"45b5":function(t,a,i){"use strict";i.r(a);var e=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"recharge-index"},[i("nav-top",{attrs:{title:"加油卡充值"},on:{backEvent:function(a){return t.$router.go(-1)}}}),i("nav-content",{staticClass:"recharge-content"},[i("div",{staticClass:"card-information"},[i("div",{staticClass:"item-bgcolor-red"}),i("div",{staticClass:"card-content"},[i("div",{staticClass:"table-view"},[i("div",{staticClass:"table-view-cell"},[i("div",{staticClass:"table-view-cell-text"},["01"==t.cardtype||"02"==t.cardtype?i("div",{staticClass:"left"},[t._v(" 单位卡("+t._s("1"==t.ispricard?"主卡":"副卡")+") ")]):t._e(),"01"!=t.cardtype&&"02"!=t.cardtype?i("div",{staticClass:"left"},[t._v(" 个人卡("+t._s("1"==t.ispricard?"主卡":"副卡")+") ")]):t._e(),i("div",{staticClass:"right change-card-btn",on:{click:t.changeCardbtn}},[t._v("更换")])])]),i("div",{staticClass:"table-view-cell"},[i("div",{staticClass:"table-view-cell-text"},[i("div",{staticClass:"left"},[t._v("加油卡卡号")]),i("div",{staticClass:"right"},[t._v(t._s(t.cardno))])])]),i("div",{staticClass:"table-view-cell"},[i("div",{staticClass:"table-view-cell-text"},[i("div",{staticClass:"left"},[t._v("预留手机号")]),i("div",{staticClass:"right"},[t._v(t._s(t.reservedphone))])])])])]),i("p",{staticClass:"title"},[t._v("充值方式")]),i("van-radio-group",{model:{value:t.payradio,callback:function(a){t.payradio=a},expression:"payradio"}},[1==t.$store.state.globalConfig.oilCardVirtualPayEnabled?i("div",{staticClass:"virtual-payment boxshadow"},[t._l(t.settleInfo.digitalList||[],(function(a,e){return i("div",{key:e},[0!=a.deductionState?i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle theme_font_common inline_block payment-title"},[t._v(" "+t._s(t.getDigitalDisplayName(a.acctType))+" ")]),"元"==t.getDigitalDisplayUnit(a.acctType)?[a.userCanUseDigital>0?i("div",{staticClass:"right-margin inline_block"},[t._v(" 余额："+t._s(a.userBalanceDigital)+"元，可用"+t._s(a.userCanUseDigital)+"元 ")]):i("div",{staticClass:"right-margin inline_block"},[t._v(" 余额："+t._s(a.userBalanceDigital)+"元，"+t._s(t.getCanNotUseStr(a.deductionState))+"，不能使用 ")])]:[a.userCanUseDigital>0?i("div",{staticClass:"right-margin inline_block"},[a.userBalanceDigital<1e4?i("span",[t._v("共"+t._s(a.userBalanceDigital)+"个，")]):t._e(),t._v(" 可用"+t._s(a.userCanUseDigital)+"个，抵￥"+t._s(t.$util.toDecimal2(a.userCanUseDigitalAmount))+"元 ")]):i("div",{staticClass:"right-margin inline_block"},[a.userBalanceDigital<1e4?i("span",[t._v("共"+t._s(a.userBalanceDigital)+"个，")]):t._e(),t._v(" "+t._s(t.getCanNotUseStr(a.deductionState))+"，不能使用 ")])],i("div",{staticClass:"swith inline_block",on:{click:function(i){return t.useDigitalEvent(a)}}},[a.payDigital>a.fixedDigital?i("img",{staticStyle:{width:"25px"},attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),a.payDigital<=a.fixedDigital?i("img",{staticStyle:{width:"25px"},attrs:{src:"static/image/mall2/switch-off.png"}}):t._e()])],2):t._e()])})),i("div",{staticClass:"coupon"},[i("p",{staticClass:"payment-title"},[t._v("优惠券充值")]),i("div",[i("p",[t._v(" 共选择优惠券 "),i("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.couNo.length))]),t._v("张,充值金额 "),i("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.couponAmount.toFixed(2)||0))]),t._v("元 ")])]),i("van-icon",{attrs:{name:"ellipsis",size:"16"},on:{click:t.moreCoupon}})],1),i("div",{staticClass:"payamount"},[i("p",[t._v(" 合计可充值金额: "),i("span",{staticClass:"red"},[t._v(t._s(t.settleInfo.amount&&t.settleInfo.amount.toFixed(2)))]),t._v("元 ")]),i("van-radio",{attrs:{name:"0","checked-color":"red"}})],1)],2):t._e(),i("div",{staticClass:"pay-mode"},t._l(t.zhilist,(function(a,e){return i("div",{key:e,staticClass:"pay-mode-item boxshadow"},[i("p",[t._v(t._s(a.text))]),i("van-radio",{attrs:{name:e+1,"checked-color":"red"}})],1)})),0)]),0==t.payradio?i("div",{staticClass:"submit-btn",on:{click:t.confirmpayment}},[t._v(" 立即充值 "),i("span",[t._v("("+t._s(t.settleInfo.amount.toFixed(2))+"元)")])]):i("div",{staticClass:"submit-btn",on:{click:t.confirmpayment}},[t._v("立即充值")])],1),t.ischangeCard?i("div",{staticClass:"change-card"},[i("div",{staticClass:"change-card-content"},[i("div",{staticClass:"modal-title"},[t._v("更换充值卡")]),i("van-icon",{staticClass:"changeCard-close",attrs:{name:"cross",size:"14"},on:{click:function(a){t.ischangeCard=!1}}}),i("div",{staticClass:"table-view"},t._l(t.cardListArr,(function(a,e){return i("div",{key:e,staticClass:"table-view-cell"},[i("div",{staticClass:"table-view-cell-text"},[i("div",{staticClass:"left"},[t._v(t._s(a.cardno))]),i("div",{staticClass:"right change-card-btn",on:{click:function(i){return t.changeCard(a)}}},[t._v("更换")])])])})),0)],1)]):t._e(),t.isshowcards?i("div",{staticClass:"confirm-pay-modal"},[i("div",{staticClass:"modal-content"},[i("div",{staticClass:"modal-title"},[t._v("确认支付？")]),i("div",{staticClass:"firm-two"},[i("p",[i("span",[t._v("加油卡卡号")]),i("span",[t._v(t._s(t.cardno))])]),i("p",[i("span",[t._v("持卡人姓名")]),i("span",[t._v(t._s(t.cardholder))])]),i("p",[i("span",[t._v("持卡人手机号")]),i("span",[t._v(t._s(t.reservedphone))])]),i("p",[i("span",[t._v("支付方式")]),i("span",[t._v(t._s(0==t.payradio?"虚拟支付":t.zhifufang))])]),0==t.payradio?i("p",[i("span",[t._v("金额")]),i("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.settleInfo.amount&&t.settleInfo.amount.toFixed(2)))])]):t._e(),0==t.payradio?i("div",t._l(t.settleInfo.digitalList||[],(function(a,e){return 0!=a.digitalAmount?i("p",{key:e},[i("span",[t._v(t._s(t.getDigitalDisplayName(a.acctType))+"支付抵扣")]),i("span",[t._v("¥"+t._s(a.digitalAmount))])]):t._e()})),0):t._e(),0==t.payradio?i("p",[i("span",[t._v("应付金额")]),i("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.settleInfo.payAmount&&t.settleInfo.payAmount.toFixed(2)))])]):t._e()]),i("div",{staticClass:"firm-three"},[i("p",{staticClass:"btn cancel-btn",on:{click:function(a){t.isshowcards=!1}}},[t._v("否")]),i("p",{staticClass:"btn",on:{click:t._submit}},[t._v("是")])])])]):t._e()])],1)},s=[],n=i("b85c"),o=(i("99af"),i("0d03"),i("acd8"),i("ac1f"),i("5319"),i("caad"),i("2532"),i("662b")),r=i("efff"),c=i("75bd"),l=(i("5b7e"),i("6461")),d=i("19e7"),u={data:function(){return{settleInfo:{},usedCoupons:[],payDigitals:[],cardno:"",cardholder:"",reservedphone:"",payradio:1,dictByAlias:[],DigitalPwd:"",isshowcards:!1,ischangeCard:!1,cardinfo:{},mindex:0,cardListArr:[],zhilist:"",zhifufang:"",zhifudizhi:"",cardtype:"",ispricard:"",backReloadCoupon:!1}},created:function(){this.cardno=this.$route.query.usercard,this.mindex=this.$route.query.mindex||0,this.$store.state.globalConfig.oilCardVirtualPayEnabled&&1==this.$store.state.globalConfig.oilCardVirtualPayEnabled&&this.settlement()},mounted:function(){this.getCardList()},methods:{getCardList:function(){var t=this;this.$request.post("/app/json/card/getCardInfoList").then((function(a){0==a.status&&(t.cardListArr=a.data.cardAcctList||[],t.$request.post("/app/json/enterprise_card/getCardInfoList").then((function(a){if(0==a.status){var i=a.data.cardAcctList||[];t.cardListArr=t.cardListArr.concat(i),t.cardListArr.length>t.mindex?(t.cardno=t.cardListArr[t.mindex].cardno,t.cardholder=t.cardListArr[t.mindex].cardholder,t.reservedphone=t.cardListArr[t.mindex].reservedphone,t.cardtype=t.cardListArr[t.mindex].cardtype,t.ispricard=t.cardListArr[t.mindex].ispricard):(t.cardno="",t.cardholder="",t.reservedphone="",t.cardtype="",t.ispricard=""),t.queryPayModeLIst()}})))}))},changeCardbtn:function(){this.ischangeCard=!this.ischangeCard},changeCard:function(t){this.ischangeCard=!this.ischangeCard,this.cardno=t.cardno,this.cardholder=t.cardholder,this.reservedphone=t.reservedphone,this.cardtype=t.cardtype,this.ispricard=t.ispricard,this.payDigitals=[],this.usedCoupons=[],this.settlement()},queryPayModeLIst:function(){var t=this;this.$Loading.open();var a=this,i="/app/json/card/getAppPayTextList";this.$http.post(i,{cardno:this.cardno}).then((function(i){a.$Loading.close(),t.zhilist=i.data.data||[]}))},settlement:function(){var t=this,a={cardNo:this.cardno,rechargeAmount:"200"};this.payDigitals.length&&(a.payDigital=this.payDigitals),this.usedCoupons.length&&(a.couNo=this.usedCoupons),this.$request.post("/app/json/card/settle",a).then((function(a){if(0==a.status){t.settleInfo=a.data,t.usedCoupons=t.settleInfo.couNo;var i,e=a.data.digitalList||[],s=Object(n["a"])(e);try{for(s.s();!(i=s.n()).done;){var o=i.value;if(o.payDigital>o.fixedDigital){t.payDigitals.push(o);break}}}catch(r){s.e(r)}finally{s.f()}t.reloadSelectedCoupon()}else t.$Toast(data.info),t.reloadSelectedCoupon()}))},setHour:function(t){return t?this.$util.formatDate(new Date(t),"yyyy-MM-dd hh:mm"):""},reloadSelectedCoupon:function(){if(0!=this.backReloadCoupon){this.backReloadCoupon=!1;for(var t=0;t<this.settleInfo.userCanUseCoupon.length;t++){var a=this.settleInfo.userCanUseCoupon[t].couNo;this.settleInfo.userCanUseCoupon[t].selected=!1;for(var i=0;i<this.usedCoupons.length;i++)if(this.usedCoupons[i]==a){this.settleInfo.userCanUseCoupon[t].selected=!0;break}}o["a"].reloadSelectedCoupon(this.occurData.userCanUseCoupon)}},moreCoupon:function(){for(var t=this,a=0;a<this.settleInfo.userCanUseCoupon.length;a++){var i=this.settleInfo.userCanUseCoupon[a].couNo;this.settleInfo.userCanUseCoupon[a].selected=!1;for(var e=0;e<this.usedCoupons.length;e++)if(this.usedCoupons[e]==i){this.settleInfo.userCanUseCoupon[a].selected=!0;break}}o["a"].open({initData:{listData:[],userCanNotUseCoupon:this.settleInfo.userCanNotUseCoupon,userCanUseCoupon:this.settleInfo.userCanUseCoupon,type:"use",skuId:"",categoryId:"",storeOuCode:"",token:this.$store.state.login.token,payAmount:this.$util.toDecimal2(parseFloat(this.settleInfo.payAmount))},selectedCoupon:function(a){for(var i=[],e=0;e<a.length;e++)i.push(a[e].couNo);0==i.length&&i.push("-1"),t.usedCoupons=i,t.backReloadCoupon=!0,t.settlement()}})},setPayWays:function(){var t=this;c["a"].getPayWays("100005",this.$route.query.ouCode).then((function(a){t.payWay=a||[],t.selectedPayWay=t.payWay[0]}))},getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"150001")},getDigitalDisplayUnit:function(t){for(var a=this.$store.state.globalConfig.acctList,i=0;i<a.length;i++){var e=a[i];if(e.acctType==t)return e.displayUnit}},getCanNotUseStr:function(t){return 1==t||3==t?"余额不足":1==t?"订单金额不够":"未知原因"},useDigitalEvent:function(t){if(0==this.payradio)if(t.userCanUseDigital<=0){var a=this.getCanNotUseStr(t.deductionState);this.$Toast(a+"，不支持"+this.getDigitalDisplayName(t.acctType)+"支付！")}else{var i=t.acctType;if(t.payDigital<=t.fixedDigital){for(var e=[],s=0;s<this.payDigitals.length;s++)this.payDigitals[s].acctType!=i&&e.push(this.payDigitals[s]);this.payDigitals=e,this.payDigitals.push({acctType:i,payDigital:t.userCanUseDigital+t.fixedDigital})}else{for(var n=[],o=0;o<this.payDigitals.length;o++)this.payDigitals[o].acctType!=i?n.push(this.payDigitals[o]):n.push({acctType:i,payDigital:t.fixedDigital});this.payDigitals=n}this.settlement()}else this.$Toast("只有虚拟支付才可使用!!")},submitBill:function(){var t=this,a="/app/json/card/submit",i={};i.token=this.$store.state.login.token,i.cardNo=this.cardno,i.rechargeAmount=this.settleInfo.amount,i.couNo=this.usedCoupons||[],this.payDigitals.length&&(i.payDigital=this.payDigitals),""!=this.digitalPWD&&(i.payPwd=Object(d["a"])(this.digitalPWD)),this.$http.post(a,i).then((function(a){t.$Loading.close();var i=a.data;0==i.status?(t.$Toast("充值成功"),t.isshowcards=!t.isshowcards,t.$router.go(-1)):t.$Toast(i.info||"提交订单失败！")}),(function(a){t.$Loading.close(),t.$Toast("请求数据失败！")}))},payBill:function(t){var a=this;null!=this.selectedPayWay?c["a"].refuelPayEvent(this.selectedPayWay,t.orderType,t.orderId).then((function(){a.resultHand("1",t)}))["catch"]((function(){a.resultHand("0",t)})):this.$Toast("请选择支付方式！")},resultHand:function(t,a){var i=this;if(this.$Loading.close(),l["a"].addLog("支付结果",t?"成功":"失败"),"1"==t)this.$router.replace({path:"/firmDetail",query:{orderType:a.orderType,orderId:a.orderId,fromPage:1}});else{var e="/app/json/refuel_center/cancelOrder",s={token:this.$store.state.login.token,orderType:a.orderType,orderId:a.orderId};this.$http.post(e,s).then((function(t){var a=t.data;0==a.status?i.$Toast("支付已取消"):i.$Toast(a.info)}))}},checkNeedPwd:function(){var t=this;if(this.digitalPWD="",this.settleInfo.needPayPwd){var a=!0;if(a){if("1"==this.settleInfo.payPwdState)return void this.$Toast("支付密码已锁定，请稍后再试！");r["a"].open({initData:{payPwdState:this.settleInfo.payPwdState},toSettingPwd:function(){t.$router.push({path:"/usercenter/nosetpwd",query:{isSet:0}}),r["a"].close()},inputFinished:function(a){t.digitalPWD=a,t.submitBill(),r["a"].close()}})}else this.submitBill()}else this.submitBill()},_submit:function(){if(0!=this.payradio)this.rendermode2();else{for(var t=0;t<this.payDigitals.length;t++){var a=this.payDigitals[t];if(a.payDigital>0&&a.payDigital>a.userBalanceDigital){var i=this.getDigitalDisplayName(a.acctType);return i+="余额不足！",this.$Toast(i),void this.settlement()}}this.checkNeedPwd()}},confirmpayment:function(){if(this.payradio)if(0==this.payradio){var t=this.$store.state.severTime.currentTime,a=new Date(1e3*t),i=a.getHours();if(23==i||i>23||i<2)return void this.$Toast("23:00~02:00不可进行虚拟支付!");this.isshowcards=!this.isshowcards}else this.zhifufang=this.zhilist[1*this.payradio-1].text,this.zhifudizhi=this.zhilist[1*this.payradio-1].href,this.isshowcards=!this.isshowcards;else this.$Toast("请选择支付方式!")},rendermode2:function(){var t=this;this.$Loading.open();var a=this,i="/app/json/card/getAppPayTextList";this.$http.post(i,{token:a.$store.state.login.token,cardno:this.cardno}).then((function(i){a.$Loading.close(),t.zhilist=i.data.data,t.zhifufang=i.data.data[1*t.payradio-1].text,t.zhifudizhi=i.data.data[1*t.payradio-1].href,"微信快充"==t.zhifufang&&"2"==t.$store.state.webtype&&(t.zhifudizhi=t.zhifudizhi.includes("?")?"".concat(t.zhifudizhi,"&openId=").concat(t.$store.state.login.wxOpenid):"".concat(t.zhifudizhi,"?openId=").concat(t.$store.state.login.wxOpenid)),t.$bridgefunc.customPush({path:t.zhifudizhi,isnativetop:"1",superback:1})}))}}},h=u,p=(i("5d06"),i("0c7c")),f=Object(p["a"])(h,e,s,!1,null,"0178c92c",null);a["default"]=f.exports},"5d06":function(t,a,i){"use strict";i("8cb1")},"8cb1":function(t,a,i){},b85c:function(t,a,i){"use strict";i.d(a,"a",(function(){return s}));i("a4d3"),i("e01a"),i("d3b7"),i("d28b"),i("3ca3"),i("ddb0"),i("277d");var e=i("06c5");function s(t,a){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Object(e["a"])(t))||a&&t&&"number"===typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){c=!0,o=t},f:function(){try{r||null==i["return"]||i["return"]()}finally{if(c)throw o}}}}}}]);