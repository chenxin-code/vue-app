(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d460548","chunk-2d2176a6"],{"155a":function(t,s,i){"use strict";i("357a")},"357a":function(t,s,i){},6422:function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mapbot"},[e("nav-top",{attrs:{noBack:!t.hasBack},on:{backEvent:t.backEvent}}),e("nav-content",[1===t.isOpenLocation?[e("div",{ref:"mapBxo",staticClass:"map-box"},[e("div",{staticClass:"allmap",attrs:{id:t.randomId}}),e("div",{staticClass:"mapmore"},[e("div",{staticClass:"searchdiv"},[e("div",{staticClass:"getlocation"},[e("img",{staticClass:"locationimg",attrs:{src:i("9372"),alt:""},on:{click:t.pageInit}})]),e("div",{staticClass:"getmore",on:{click:t.searchMore}},[e("img",{staticClass:"search",attrs:{src:"static/image/station/search.png",alt:""}}),t.searchText?e("span",{staticClass:"black-text"},[t._v(t._s(t.searchText))]):e("span",[t._v("搜索地点")])])])])]),e("NearAddressList",{ref:"stationList",attrs:{searchText:t.searchText,mode:t.mode,tags:t.tags,stations:t.addressList,isBottomBounce:t.isBottomBounce},on:{requestStations:t.requestStations,gotoStation:t.gotoStation,locationStation:t.locationStation,searchMode:t.searchMode,pushToDetail:t.pushToDetail}})]:t._e(),0===t.isOpenLocation?[e("div",{staticClass:"no-gps-container"},[e("img",{staticClass:"img",attrs:{src:i("d0cc"),alt:""}}),e("p",{staticClass:"msg"},[t._v("【请您开启GPS定位附近位置】")]),e("div",{staticClass:"refresh",on:{click:t.settingLocation}},[e("span",{staticClass:"btn"},[t._v("去设置")])])])]:t._e()],2),t.isShowSearch?e("div",{staticClass:"search-container"},[e("div",{staticClass:"searchmorebot"},[e("div",{staticClass:"qrcode-top ",style:{height:this.$store.state.barHeight+this.$market.getNavHeight()+"px"},on:{backEvent:t.searchBackEvent}},[e("div",{staticClass:"navcontent",style:{top:this.$store.state.barHeight+"px",height:this.$market.getNavHeight()+"px"}},[e("div",{on:{click:t.searchBackEvent}},[e("i",{staticClass:"iconfont mall-fanhui theme_font_black"})]),e("div",{staticClass:"search-div"},[e("img",{staticClass:"searchimg",attrs:{src:"static/image/station/search.png",alt:""}}),e("div",{staticClass:"form-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"input-none",attrs:{type:"search",placeholder:"输入地点或商区名称"},domProps:{value:t.searchText},on:{input:function(s){s.target.composing||(t.searchText=s.target.value)}}})])]),e("div",{staticClass:"cancel",on:{click:t.cancelEvent}},[t._v("取消")])])]),e("nav-content",[!t.searchText&&t.searchHistoryArr[0]?e("div",{staticClass:"history-container"},[e("p",{staticClass:"his-title"},[t._v("搜索历史"),e("i",{staticClass:"clear-btn iconfont mall-shanchu theme_font_gray_i",on:{click:t.clearHistory}})]),e("ul",{staticClass:"his-item-container clearfix"},t._l(t.searchHistoryArr,(function(s,i){return e("li",{key:i,on:{click:function(i){return t.historyClick(s)}}},[t._v(t._s(s)+" ")])})),0)]):e("div",{staticClass:"listcontent"},t._l(t.dataList,(function(s){return e("div",{staticClass:"list-item",on:{click:function(i){return t.backMap(s)}}},[e("div",{staticClass:"list_name theme_font_black"},[t._v(t._s(s.name))]),e("div",{staticClass:"list_location theme_font_tint"},[t._v(t._s(s.province+s.city+s.district)+" ")])])})),0)])],1)]):t._e()],1)},a=[],n=i("53ca"),o=(i("0d03"),i("d3b7"),i("25f0"),i("4795"),i("b0c0"),i("498a"),i("4de4"),i("ac1f"),i("1276"),i("a15b"),i("b680"),i("a9e3"),i("4160"),i("159b"),i("99af"),i("d81d"),i("a434"),i("c740"),i("76a0")),c=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{ref:"oilListEl",staticClass:"oil-station-list",style:{top:t.nowTop+"px"}},[e("div",{staticClass:"drag-line",on:{touchstart:t._touchstart,touchmove:t._touchmove,touchend:t._touchend}},[e("div",{staticClass:"top"},[e("img",{staticClass:"icon-more",attrs:{src:i("88a9"),alt:""}}),e("div",{staticClass:"text"},[t._v(t._s(t.isUp?"下拉查看地图":"上拉查看更多"))])])]),e("PullRefresh",{ref:"PullRefresh",staticClass:"oil-station-list-content",attrs:{pullUpLoad:!1,hasMore:t.isBottomBounce,data:t.stations},on:{pullingUp:t.refresh}},[e("div",{ref:"cellsEl",staticClass:"cells"},[t._l(t.stations,(function(s,i){return e("div",[e("div",{staticClass:"cell cell_access",class:{"cell-line":i>0}},[e("div",{staticClass:"cell__bd",on:{click:function(i){return t.locationStation(s)}}},[e("p",{staticClass:"name"},[t._v(" "+t._s(s.name)+" ")]),e("p",{staticClass:"font-medium-l station-distance"},[e("span",{staticClass:"text"},[t._v(t._s(s.address))])])])])])})),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.stations.length,expression:"!stations.length"}],staticClass:"no-data"},[t._v("暂无位置信息~")])],2)])],1)},r=[],l=i("bba4"),h=(i("99fa"),{name:"oil-station-list",components:{PullRefresh:l["default"]},data:function(){return{nowTop:"",domHeight:"",isTouchMovingUp:!1,isTouchMovingDown:!1,startY:"",isUp:!1,tips:"距您",cellLogo:i("5c93")}},props:{stations:{type:Array},isBottomBounce:{type:Boolean,default:!1},searchText:{type:String,default:""},mode:Array,tags:Array},created:function(){this.$store.state.globalConfig.logo&&"*"!=this.$store.state.globalConfig.logo&&(this.cellLogo=this.$store.state.globalConfig.logo)},watch:{searchText:function(){null==this.searchText?this.tips="距您":this.tips="据搜索目的地"}},mounted:function(){var t=this;this.$nextTick((function(){t.domHeight=document.documentElement.clientHeight,t.nowTop=.6*t.domHeight}))},methods:{listenScroll:function(t){},refresh:function(t){this.$emit("requestStations",t)},_touchstart:function(t){var s=t.touches[0];this.startY=s.clientY},_touchmove:function(t){var s=t.touches[0],i=this.startY,e=s.clientY,a=0;i>e?(a=.2*this.domHeight,this.isUp=!0):(a=.6*this.domHeight,this.isUp=!1),this.nowTop=a},_touchend:function(){},pushToDetail:function(t){this.$emit("pushToDetail",t)},goStation:function(t){this.$emit("gotoStation",t)},goShopping:function(t){var s=t.storeModel;this.$market.pushToPickupProducts(s)},locationStation:function(t){this.$emit("locationStation",t)},addGas:function(t){this.$bridgefunc.customPush({path:"RefuelSelectOilGun",isnativetop:"1",query:{station:encodeURIComponent(JSON.stringify(t))}})},_findIndex:function(t,s){return t.findIndex((function(t){return t.dictValue===s.dictValue}))}}}),d=h,u=(i("155a"),i("0c7c")),p=Object(u["a"])(d,c,r,!1,null,"0f367cfb",null),g=p.exports,f=i("09cb"),m=(i("e2ba"),i("b5f2")),v=i("0cbd"),b=i("da71"),y=i("f2e8"),_=i.n(y),k={dictValue:"all",alias:"全部",_type:0},C={name:"home-stationto",components:{Toast:o["Toast"],NearAddressList:g,Navigation:m["a"]},props:{hasBack:{type:Boolean,default:!0}},data:function(){return{bdMap:null,stations:[],nowmk:null,openListener:null,pageOn:0,isBottomBounce:!0,isShowSearch:!1,searchText:null,isActive:!1,dataList:[],searchHistoryArr:[],isOpenLocation:-1,mode:[k],tags:[],loadedTimes:0,randomId:"",mapslogo:"static/image/station/mapslogo.png",mapslogo1:"static/image/station/mapslogo1.png",addressList:[]}},created:function(){this.randomId=this.randomString(),this.$store.state.globalConfig.mapslogo&&this.$store.state.globalConfig.mapslogo.length&&(this.mapslogo=this.$store.state.globalConfig.mapslogo),this.$store.state.globalConfig.mapslogo1&&this.$store.state.globalConfig.mapslogo1.length&&(this.mapslogo1=this.$store.state.globalConfig.mapslogo1)},mounted:function(){var t=this;this.initHistory(),this.$nextTick((function(){t.pageInit()})),this.queryMarks(),this.debounceQueryLocation=this.$util.debounce(this.queryLocation,500)},watch:{searchText:function(t,s){this.initHistory(),this.debounceQueryLocation(t)}},beforeRouteLeave:function(t,s,i){this.$keepaliveHelper.deleteCache(this),i()},methods:{randomString:function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var s=(new Date).getTime()+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();return s},pageInit:function(){var t=this;this.$bridgefunc.checkLocationAuth(t.pageInit).then((function(s){Object(f["a"])().then((function(e){t.loadBd(e),t.getLocation(e,s),i("1498"),t.loadedTimes++,1==t.loadedTimes&&setTimeout((function(){var s=window.document.getElementById(t.randomId);""==s.innerHTML&&t.pageInit()}),200)})),t.isOpenLocation=1}),(function(){t.isOpenLocation=0,t.$Toast("请您开启GPS定位附近中国石化加油站")}))},settingLocation:function(){this.$bridgefunc.requestPermissions()},cancelEvent:function(){this.searchText?this.searchText=null:this.isShowSearch=!1},searchBackEvent:function(){this.isShowSearch=!1},_moveFunc:function(t){this.searchText="",this.isActive=!0},focusFunc:function(){this.isActive=!1},backMap:function(t){this.stations=[],this.setHistoryItems(t.name),this.$store.state.selectp.lat=t.location.lat,this.$store.state.selectp.lng=t.location.lng;var s=this;this.$bridgefunc.vuexStorage((function(){s.searchBackEvent()})),this.newGet()},setHistoryItems:function(t){t=t.trim();var s=localStorage,i=s.searchHistory;if(i){var e=i.split("|").filter((function(s){return s!=t}));e.length>=6&&e.pop(),e.length>0&&(i=t+"|"+e.join("|")),localStorage.searchHistory=i}else localStorage.searchHistory=t},initHistory:function(){var t=window.localStorage.getItem("searchHistory");this.searchHistoryArr=t?t.split("|"):[]},historyClick:function(t){this.searchText=t},clearHistory:function(){this.searchHistoryArr=[],window.localStorage.searchHistory=""},backEvent:function(){this.$router.go(-1)},newGet:function(){if(this.$store.state.selectp.lng&&""!=this.$store.state.selectp.lng){var t=new BMap.Point(this.$store.state.selectp.lng,this.$store.state.selectp.lat);this.getNearStations(t)}},loadBd:function(t){var s=this;this.bdMap=new t.Map(this.randomId),this.bdMap.centerAndZoom(new t.Point(116.404,39.915),10),this.bdMap.addControl(new t.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]})),this.bdMap.addEventListener("click",(function(){})),this.bdMap.addEventListener("dragend",(function(){var i=s.bdMap.getCenter(),e=new t.Point(i.lng,i.lat);s.getNearStations(e)})),this.bdMap.enableScrollWheelZoom(!0)},getLocation:function(t,s){var i=this;s.city&&""!=s.city||(s.province=this.$store.state.globalConfig.province,s.city=this.$store.state.globalConfig.city,s.district=this.$store.state.globalConfig.district,s.longitude=this.$store.state.globalConfig.longitude,s.latitude=this.$store.state.globalConfig.latitude),this.locationinfo=s;var e=new t.Point(s.longitude,s.latitude);i.getNearStations(e)},addNewLocations:function(){for(var t=this.bdMap.getOverlays(),s=0;s<t.length;s++){var e=t[s];e!=this.nowmk&&this.bdMap.removeOverlay(e)}if(this.stations){for(var a=0;a<this.stations.length;a++){var n=this.stations[a];n.startlong=this.nowmk.point.lng,n.startlat=this.nowmk.point.lat;var o=new BMap.Point(n.lng,n.lat),c=null;c=n.stationStatus&&"02"!=n.stationStatus?new BMap.Icon(this.mapslogo1,new BMap.Size(23,30)):new BMap.Icon(this.mapslogo,new BMap.Size(23,30));var r=new BMap.Marker(o,{icon:c});this.bdMap.addOverlay(r),h(n,r)}var l=this}function h(t,s){s.addEventListener("click",(function(){d(t)}))}function d(t){var s=new BMap.Point(t.lng,t.lat),e=t.mktActivityList||[],a=i("4a72"),n="";n+="<div class='info-box'>",n+="<span class='info-box-btn' id='closeBtn'></span>",n+="<span class='arrow'></span>",n+="<div class='title'>",n+="<p class='name'>"+t.stationName+"</p>",n+='<div class="distance"><img class="img" src="'+a+'"> '+(Number(t.distance)/1e3).toFixed(2)+" km</div>",n+='<div class="service-icon">';for(var o=0;o<t.serviceUrls.length;o++)n+='<img class="img" src="'+t.serviceUrls[o]+'" alt="">';n+="</div>",t.closingTime&&t.opningTime&&(n+="<p class='time'>"+t.opningTime+"-"+t.closingTime+"</p>"),n+="</div>",n+="<ul class='discount-list'>";for(var c=0;c<e.length;c++)n+="<li class='discount-item'>",n+="<span class='icon theme_bg_red'>"+e[c].activityType+"</span>",n+="<span class='text'>"+e[c].activityTitle+"</span>",n+="</li>";0===e.length&&(n+="<li class='no-data'>暂无优惠活动~</li>"),n+="</ul>",n+="</div>",l.infoBox&&(l.infoBox.close(),l.infoBox=null),l.infoBox=new BMapLib.InfoBox(l.bdMap,n,{enableAutoPan:!0}),l.infoBox.open(s),l.openListener&&EventWrapper.removeListener(l.openListener),l.openListener=EventWrapper.addListener(l.infoBox,"open",(function(t){l.$nextTick((function(){EventWrapper.addDomListener(document.getElementById("closeBtn"),"touchstart",(function(){l.infoBox.close()}))}))}))}},searchMore:function(){this.searchText=null,this.isShowSearch=!0},getNearStations:function(t){this.resetCondition(),this.nowmk&&this.bdMap.removeOverlay(this.nowmk),this.nowmk=new BMap.Marker(t),this.bdMap.addOverlay(this.nowmk),this.bdMap.centerAndZoom(t,14),this.requestNearAddress()},requestNearAddress:function(t){var s=this,i="http://api.map.baidu.com/place/v2/search?query=号$楼$座$门$区$村$栋$店$馆$厅&location="+this.nowmk.point.lat+","+this.nowmk.point.lng+"&radius=500&output=json&page_size=20&ak="+b["a"].mapak;t&&t>0&&(i+="&page_num="+t),_()(i,null,(function(t,i){t||(s.addressList=i.results)}))},requestStations:function(t){var s=this;this.$Loading.open(),this.pageOn++;var i="/app/json/station/getStationList",e=this.$util.bd_decrypt(this.nowmk.point.lng,this.nowmk.point.lat),a={posx:e.gg_lon,posy:e.gg_lat,page:this.pageOn,index:this.pageOn,rows:12,token:this.$store.state.login.token,getType:"1"};this.mode.length&&this.mode.forEach((function(t){"all"!=t.dictValue&&(1===t._type?a["selfOil"]=t.dictValue:2===t._type&&(a[t.dictValue]=1))})),this.$http.post(i,a).then((function(i){s.$Loading.close();var e=i.data;if(0==e.status){for(var a=0;a<e.data.length;a++){var n=e.data[a];n.serviceUrls=v["a"].getServiceImgUrls(n),n.lng=n.posx,n.lat=n.posy}s.stations=s.stations.concat(e.data.map((function(t){return t.visible=!1,t}))||[]),s.stations.length>=e.totalRecords&&(s.isBottomBounce=!1),s.addNewLocations()}else s.$Toast(e.info);t&&t("done")}),(function(i){t&&t("done"),s.$Loading.close(),s.$Toast("请求错误")}))},gotoStation:function(t){this.$bridgefunc.baiduNav({startlong:this.locationinfo.longitude,startlat:this.locationinfo.latitude,endlong:t.posx,endlat:t.posy,txlong:t.txPosx,txlat:t.txPosy,type:"nav"})},locationStation:function(t){sessionStorage.setItem("Address_Map_Seleted",JSON.stringify(t)),this.$router.go(-1)},pushToDetail:function(t){this.$router.push({path:"/oilstationdetail",query:{detail:encodeURIComponent(JSON.stringify(t)),startlong:this.nowmk.point.lng,startlat:this.nowmk.point.lat}})},searchMode:function(t){var s=this._findIndex(this.mode,t);s>-1?"all"!==t.dictValue&&this.mode.length>1&&this.mode.splice(s,1):"all"===t.dictValue?this.mode=[k]:(this._findIndex(this.mode,k)>-1&&(this.mode=[]),this.mode.push(t)),this.resetCondition(),this.requestStations()},_findIndex:function(t,s){return t.findIndex((function(t){return t.dictValue===s.dictValue}))},resetCondition:function(){this.pageOn=0,this.isBottomBounce=!0,this.stations=[]},queryLocation:function(t){if(t){var s=this.$store.state.indexData.city||"",i="https://api.map.baidu.com/place/v2/suggestion?query="+t+"&region="+s+"&output=json&ak="+b["a"].mapak,e=this;_()(i,null,(function(t,s){t||(e.dataList=s.result)}))}else this.dataList=[]},queryMarks:function(){var t=this;this.$request.post("/app/json/station/queryOilMarks").then((function(s){0===s.status&&(s.data&&s.data.forEach((function(s){"object"===Object(n["a"])(s)&&(s._type=1,t.tags.push(s))})),t.$request.post("/app/json/station/queryServMarks").then((function(s){0===s.status&&s.data&&s.data.forEach((function(s){"object"===Object(n["a"])(s)&&(s._type=2,t.tags.push(s))})),t.tags.length&&t.tags.unshift(k)})))}))}}},x=C,$=(i("a76f"),Object(u["a"])(x,e,a,!1,null,"0ccad458",null));s["default"]=$.exports},a76f:function(t,s,i){"use strict";i("af1a")},af1a:function(t,s,i){},c740:function(t,s,i){"use strict";var e=i("23e7"),a=i("b727").findIndex,n=i("44d2"),o="findIndex",c=!0;o in[]&&Array(1)[o]((function(){c=!1})),e({target:"Array",proto:!0,forced:c},{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n(o)}}]);