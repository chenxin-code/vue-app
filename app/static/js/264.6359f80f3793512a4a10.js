(window.webpackJsonp=window.webpackJsonp||[]).push([[264],{F2nI:function(t,e,a){"use strict";var s=a("ewHY");a.n(s).a},GZl2:function(t,e,a){},HMz6:function(t,e,a){"use strict";var s=a("GZl2");a.n(s).a},Pee1:function(t,e,a){"use strict";e.a={data:function(){return{getResultTimes:0,clearTimer:null,payTime:0}},mounted:function(){},methods:{checkPayResult:function(){var t=this;this.queryState().then((function(e){if(1==e)t.resultHand(1);else if(2==e)t.resultHand(0);else if(0==e){if(t.getResultTimes++,t.getResultTimes>20)return;t.clearTimer=setTimeout((function(){t.checkPayResult()}),1e3)}}))},queryState:function(){var t=this;return new Promise((function(e,a){var s="/app/json/refuel_center/queryPayState";t.isScan&&(s="/app/json/refuel_scan_code/queryPayState");var n={token:t.$store.state.login.token,tradeNo:t.payData.tradeNo};t.$Loading.open(),t.$http.post(s,n).then((function(s){t.$Loading.close();var n=s.data;0==n.status?e(n.data.state):a(),n.data.msg})).catch((function(){t.$Loading.close()}))}))}},destroyed:function(){clearTimeout(this.clearTimer)}}},VGP3:function(t,e,a){"use strict";var s=a("db0i"),n={name:"pay-mode",props:{supportCompany:Boolean},data:function(){return{payWay:[],selectedPayWay:{}}},mounted:function(){},methods:{init:function(t,e){var a=this;s.a.getPayWays(t,e).then((function(t){a.payWay=t||[],a.supportCompany?a.selectedPayWay=[]:a.selectedPayWay=a.payWay[0],a.$emit("setPayWay",a.selectedPayWay,"init")}))},payWaySelected:function(t){t.payMode?(this.selectedPayWay=t,this.$emit("setPayWay",this.selectedPayWay)):this.$Toast("暂未开通！")}},components:{}},i=(a("HMz6"),a("KHd+")),o=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pay-mode"},[a("div",{staticClass:"title"},[t._v("支付方式")]),t._v(" "),t._l(t.payWay,(function(e){return a("div",{staticClass:"pay-mode-item",on:{click:function(a){return t.payWaySelected(e)}}},["210009"!=e.payModeSub||"210009"==e.payModeSub&&3==t.$store.state.webtype?[a("div",{staticClass:"icon"},[a("img",{attrs:{src:e.icon}})]),t._v(" "),a("div",{staticClass:"text"},[t._v(t._s(e.text))]),t._v(" "),a("div",{staticClass:"selected"},[t.selectedPayWay.payModeSub!=e.payModeSub?a("i",{staticClass:"iconfont mall-weixuanzhong theme_font_tint"}):t._e(),t._v(" "),t.selectedPayWay.payModeSub==e.payModeSub?a("i",{staticClass:"iconfont mall-xuanzhong theme_font_red"}):t._e()])]:t._e()],2)}))],2)}),[],!1,null,"0b904960",null);e.a=o.exports},ewHY:function(t,e,a){},kkux:function(t,e,a){"use strict";a.r(e),a("W34l");var s=a("ZGFV"),n=a("db0i"),i=a("L2JU"),o=a("VGP3"),r=a("Pee1"),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},l={mixins:[r.a],data:function(){return{showModal:!1,payData:{},selectedPayWay:null}},created:function(){this.queryOrder()},computed:c({isScan:function(){return"scan"==this.$route.query.enterPage}},Object(i.c)({orderList:"oilPayOrderList"})),methods:{setPayWays:function(t){this.selectedPayWay=Object.assign({},t)},settleMobelAmount:function(t,e){return(t||0)+(e||0)},payTypeStr:function(t){return n.a.getPayWayStr(t)},cancelOrderHandler:function(t){var e=this;this.$dialog.confirm({message:"确定取消当前订单吗？"}).then((function(){e.cancelOrder(t)}))},cancelOrder:function(t){var e=this,a={token:this.$store.state.login.token,orderType:t.orderType,orderId:t.id},s="/app/json/refuel_center/cancelOrder";this.isScan&&(s="/app/json/refuel_scan_code/cancelOrder"),this.$http.post(s,a).then((function(t){var a=t.data;0==a.status?(e.$Toast("支付已取消"),e.queryOrder()):e.$Toast(a.info)}))},payOrder:function(t){var e=this;this.payData=t,this.showModal=!0,this.payData.payMode||this.$nextTick((function(){e.$refs.payModeRef.init(t.orderType.slice(0,t.orderType.length-3),t.storeOuCode)}))},queryOrder:function(){var t=this,e="/app/json/refuel_center/queryOrder";this.isScan&&(e="/app/json/refuel_scan_code/queryOrder"),this.$request.post(e,{state:1}).then((function(e){0===e.status?(t.$store.state.oilPayOrderList=e.data.orderList,0===e.data.orderList.length&&t.$router.go(-1)):t.$Toast("订单请求失败！")}))},payBill:function(t){var e=this,a=this.isScan?"refuelScanPayEvent":"refuelPayEvent",s=Object.assign({},t);t.payMode||(s=Object.assign({},s,this.selectedPayWay)),this.hasToPay=!0,this.payTime=(new Date).getTime(),n.a[a](s,t.orderType,t.id).then((function(){e.resultHand("1",t)})).catch((function(){e.resultHand("0",t)}))},resultHand:function(t,e){console.log(999987),this.$Loading.close(),s.a.addLog("支付结果",t?"成功":"失败"),"1"==t?this.$router.replace({path:this.isScan?"/firmScanDetail":"/firmDetail",query:{orderType:this.payData.orderType,orderId:this.payData.id,fromPage:1}}):this.cancelOrder(e)},formatTime:function(t){return this.$util.formatDate(new Date(t),"yyyy-MM-dd hh:mm:ss")}},components:{PayMode:o.a}},u=(a("F2nI"),a("KHd+")),d=Object(u.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"order-list-container"},[a("nav-top",{on:{backEvent:function(e){return t.$router.go(-1)}}}),t._v(" "),a("nav-content",[a("div",{staticClass:"order-list"},t._l(t.orderList,(function(e,s){return a("div",{key:s,staticClass:"order-item"},[a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("油站")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.ouName))])]),t._v(" "),"scan"!=t.$route.query.enterPage?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("油枪")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.refuelGunNo)+"号")])]):t._e(),t._v(" "),a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("油品")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.refuelOilName))])]),t._v(" "),a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("加油时间")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.refuelTakeDate))])]),t._v(" "),"scan"!=t.$route.query.enterPage?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("加油升数")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.refuelLiter)+"L")])]):t._e(),t._v(" "),t.settleMobelAmount(e.thirdDiscountAmount,e.thirdDiscountAmount2)?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("移动优惠金额")]),t._v(" "),a("span",{staticClass:"content"},[t._v("￥"+t._s(t.settleMobelAmount(e.thirdDiscountAmount,e.thirdDiscountAmount2)))])]):t._e(),t._v(" "),a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("金额")]),t._v(" "),a("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(e.payAmount.toFixed(2)))])]),t._v(" "),a("div",{staticClass:"btn-group"},[a("div",{staticClass:"btns"},[a("div",{staticClass:"btn",on:{click:function(a){return t.cancelOrderHandler(e)}}},[t._v("取消订单")]),t._v(" "),a("div",{staticClass:"btn pay-btn",on:{click:function(a){return t.payOrder(e)}}},[t._v("继续支付")])])])])})),0),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.orderList.length,expression:"!orderList.length"}],staticClass:"no-data"},[t._v("暂无订单~")])]),t._v(" "),t.showModal?a("div",{staticClass:"confirm-pay-modal"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-title"},[t._v("确认支付？")]),t._v(" "),a("div",{staticClass:"content"},[t.payData.payMode?a("div",{staticClass:"item"},[a("span",[t._v("支付方式")]),t._v(" "),a("span",[t._v(t._s(t.payTypeStr(t.payData.payMode)))])]):a("div",{staticClass:"item"},[a("pay-mode",{ref:"payModeRef",staticStyle:{width:"100%","margin-top":"0"},on:{setPayWay:t.setPayWays}})],1),t._v(" "),a("div",{staticClass:"item"},[a("span",[t._v("加油时间")]),t._v(" "),a("span",[t._v(t._s(t.payData.createTime))])]),t._v(" "),a("div",{staticClass:"item"},[a("span",[t._v("加油升数")]),t._v(" "),a("span",[t._v(t._s(t.payData.refuelLiter)+"L")])]),t._v(" "),t.settleMobelAmount(t.payData.thirdDiscountAmount,t.payData.thirdDiscountAmount2)?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("移动优惠金额")]),t._v(" "),a("span",{staticClass:"content"},[t._v("￥"+t._s(t.settleMobelAmount(t.payData.thirdDiscountAmount,t.payData.thirdDiscountAmount2)))])]):t._e(),t._v(" "),a("div",{staticClass:"item"},[a("span",[t._v("金额")]),t._v(" "),a("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.payData.totalAmount.toFixed(2)))])])]),t._v(" "),a("div",{staticClass:"btns"},[a("p",{staticClass:"btn cancel-btn",on:{click:function(e){t.showModal=!1}}},[t._v("否")]),t._v(" "),a("p",{staticClass:"btn",on:{click:function(e){return t.payBill(t.payData)}}},[t._v("是")])])])]):t._e()],1)}),[],!1,null,"25c2c894",null);e.default=d.exports}}]);