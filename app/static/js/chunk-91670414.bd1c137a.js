(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-91670414"],{1618:function(t,s,i){"use strict";i("6b9d")},"33c3":function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mapbot"},[e("nav-top",{attrs:{noBack:!t.hasBack,title:"油站导航"},on:{backEvent:t.backEvent}}),e("nav-content",[1===t.isOpenLocation?[e("div",{ref:"mapBxo",staticClass:"map-box"},[e("div",{staticClass:"allmap",attrs:{id:t.randomId}}),e("div",{staticClass:"mapmore"},[e("div",{staticClass:"searchdiv"},[e("div",{staticClass:"getlocation"},[e("img",{staticClass:"locationimg",attrs:{src:i("9372"),alt:""},on:{click:t.pageInit}})]),e("div",{staticClass:"getmore",on:{click:t.searchMore}},[e("img",{staticClass:"search",attrs:{src:"static/image/station/search.png",alt:""}}),t.searchText?e("span",{staticClass:"black-text"},[t._v(t._s(t.searchText))]):e("span",[t._v("输入地点或商区名称")])])])])]),e("oil-station-list",{ref:"stationList",attrs:{searchText:t.searchText,mode:t.mode,tags:t.tags,stations:t.stations,stationType:t.$route.query.stationType,isBottomBounce:t.isBottomBounce},on:{requestStations:t.requestStations,gotoStation:t.gotoStation,locationStation:t.locationStation,searchMode:t.searchMode,downFilter:t.downFilter,pushToDetail:t.pushToDetail}})]:t._e(),0===t.isOpenLocation?[e("div",{staticClass:"no-gps-container"},[e("img",{staticClass:"img",attrs:{src:i("d0cc"),alt:""}}),e("p",{staticClass:"msg"},[t._v("【请您开启GPS定位附近中国石化加油站】")]),e("div",{staticClass:"refresh",on:{click:t.settingLocation}},[e("span",{staticClass:"btn"},[t._v("去设置")])])])]:t._e()],2),t.isShowSearch?e("div",{staticClass:"search-container"},[e("div",{staticClass:"searchmorebot"},[e("div",{staticClass:"qrcode-top ",style:{height:this.$store.state.barHeight+44+"px"},on:{backEvent:t.searchBackEvent}},[e("div",{staticClass:"navcontent",style:{top:this.$store.state.barHeight+"px",height:"44px"}},[e("div",{on:{click:t.searchBackEvent}},[e("i",{staticClass:"iconfont mall-fanhui theme_font_black"})]),e("div",{staticClass:"search-div"},[e("img",{staticClass:"searchimg",attrs:{src:"static/image/station/search.png",alt:""}}),e("div",{staticClass:"form-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"input-none",attrs:{type:"search",placeholder:"输入地点或商区名称"},domProps:{value:t.searchText},on:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.searchEntery.apply(null,arguments)},input:function(s){s.target.composing||(t.searchText=s.target.value)}}})])]),e("div",{staticClass:"cancel",on:{click:t.cancelEvent}},[t._v("取消")])])]),e("div",{staticClass:"history-wrapper",style:{top:this.$store.state.barHeight+44+"px"}},[!t.searchText&&t.searchHistoryArr[0]?e("div",{staticClass:"history-container"},[e("p",{staticClass:"his-title"},[t._v("搜索历史"),e("i",{staticClass:"clear-btn iconfont mall-shanchu theme_font_gray_i",on:{click:t.clearHistory}})]),e("ul",{staticClass:"his-item-container clearfix"},t._l(t.searchHistoryArr,(function(s,i){return e("li",{key:i,on:{click:function(i){return t.historyClick(s)}}},[t._v(t._s(s)+" ")])})),0)]):e("div",{staticClass:"listcontent"},t._l(t.dataList,(function(s){return e("div",{staticClass:"list-item",on:{click:function(i){return t.backMap(s)}}},[e("div",{staticClass:"list_name theme_font_black"},[t._v(t._s(s.name))]),e("div",{staticClass:"list_location theme_font_tint"},[t._v(t._s(s.province+s.city+s.district)+" ")])])})),0)])])]):t._e()],1)},a=[],o=i("53ca"),n=(i("0d03"),i("d3b7"),i("25f0"),i("4795"),i("b0c0"),i("498a"),i("4de4"),i("ac1f"),i("1276"),i("a15b"),i("b680"),i("a9e3"),i("4160"),i("159b"),i("99af"),i("d81d"),i("a434"),i("c740"),i("76a0")),c=i("5b3f"),r=i("09cb"),l=(i("e2ba"),i("b5f2")),h=i("0cbd"),u=i("da71"),d=i("f2e8"),p=i.n(d),g={dictValue:"all",alias:"全部",_type:0},f={name:"home-stationto",components:{Toast:n["Toast"],oilStationList:c["default"],Navigation:l["a"]},props:{hasBack:{type:Boolean,default:!0}},data:function(){return{bdMap:null,stations:[],nowmk:null,openListener:null,pageOn:0,isBottomBounce:!0,isShowSearch:!1,searchText:null,isActive:!1,dataList:[],searchHistoryArr:[],isOpenLocation:-1,mode:[g],tags:[],loadedTimes:0,randomId:"",mapslogo:"static/image/station/mapslogo.png",mapslogo1:"static/image/station/mapslogo1.png",mapslogoTruck:"static/image/station/maplogo_truck.png"}},created:function(){this.randomId=this.randomString(),this.$store.state.globalConfig.mapslogo&&this.$store.state.globalConfig.mapslogo.length&&(this.mapslogo=this.$store.state.globalConfig.mapslogo),this.$store.state.globalConfig.mapslogo1&&this.$store.state.globalConfig.mapslogo1.length&&(this.mapslogo1=this.$store.state.globalConfig.mapslogo1)},mounted:function(){var t=this;this.initHistory(),this.$nextTick((function(){t.pageInit()})),this.queryMarks(),this.debounceQueryLocation=this.$util.debounce(this.queryLocation,500)},watch:{searchText:function(t,s){this.initHistory(),this.debounceQueryLocation(t)}},beforeRouteLeave:function(t,s,i){this.$keepaliveHelper.deleteCache(this),i()},methods:{searchEntery:function(){this.searchText&&this.debounceQueryLocation(curVal)},randomString:function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var s=(new Date).getTime()+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();return s},pageInit:function(){var t=this;this.$bridgefunc.checkLocationAuth(t.pageInit).then((function(s){Object(r["a"])().then((function(e){t.loadBd(e),t.getLocation(e,s),i("1498"),t.loadedTimes++,1==t.loadedTimes&&setTimeout((function(){var s=window.document.getElementById(t.randomId);""==s.innerHTML&&t.pageInit()}),200)})),t.isOpenLocation=1}),(function(){t.isOpenLocation=0,t.$Toast("请您开启GPS定位附近中国石化加油站")}))},settingLocation:function(){this.$bridgefunc.requestPermissions()},cancelEvent:function(){this.searchText?this.searchText=null:this.isShowSearch=!1},searchBackEvent:function(){this.isShowSearch=!1},_moveFunc:function(t){this.searchText="",this.isActive=!0},focusFunc:function(){this.isActive=!1},backMap:function(t){this.stations=[],this.setHistoryItems(t.name),this.$store.state.selectp.lat=t.location.lat,this.$store.state.selectp.lng=t.location.lng;var s=this;this.$bridgefunc.vuexStorage((function(){s.searchBackEvent()})),this.newGet()},setHistoryItems:function(t){t=t.trim();var s=localStorage,i=s.searchHistory;if(i){var e=i.split("|").filter((function(s){return s!=t}));e.length>=6&&e.pop(),e.length>0&&(i=t+"|"+e.join("|")),localStorage.searchHistory=i}else localStorage.searchHistory=t},initHistory:function(){var t=window.localStorage.getItem("searchHistory");this.searchHistoryArr=t?t.split("|"):[]},historyClick:function(t){this.searchText=t},clearHistory:function(){this.searchHistoryArr=[],window.localStorage.searchHistory=""},backEvent:function(){this.$router.go(-1)},newGet:function(){if(this.$store.state.selectp.lng&&""!=this.$store.state.selectp.lng){var t=new BMap.Point(this.$store.state.selectp.lng,this.$store.state.selectp.lat);this.getNearStations(t)}},loadBd:function(t){this.bdMap=new t.Map(this.randomId),this.bdMap.centerAndZoom(new t.Point(116.404,39.915),10),this.bdMap.addControl(new t.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]})),this.bdMap.addEventListener("click",(function(){})),this.bdMap.enableScrollWheelZoom(!0)},getLocation:function(t,s){var i=this;s.city&&""!=s.city||(s.province=this.$store.state.globalConfig.province,s.city=this.$store.state.globalConfig.city,s.district=this.$store.state.globalConfig.district,s.longitude=this.$store.state.globalConfig.longitude,s.latitude=this.$store.state.globalConfig.latitude),this.locationinfo=s;var e=new t.Point(s.longitude,s.latitude);i.getNearStations(e)},addNewLocations:function(){for(var t=this.bdMap.getOverlays(),s=0;s<t.length;s++){var e=t[s];e!=this.nowmk&&this.bdMap.removeOverlay(e)}if(this.stations){for(var a=0;a<this.stations.length;a++){var o=this.stations[a];o.startlong=this.nowmk.point.lng,o.startlat=this.nowmk.point.lat;var n=new BMap.Point(o.lng,o.lat),c=null;c=1==o.truck?new BMap.Icon(this.mapslogoTruck,new BMap.Size(23,30)):o.stationStatus&&"02"!=o.stationStatus?new BMap.Icon(this.mapslogo1,new BMap.Size(23,30)):new BMap.Icon(this.mapslogo,new BMap.Size(23,30));var r=new BMap.Marker(n,{icon:c});this.bdMap.addOverlay(r),h(o,r)}var l=this}function h(t,s){s.addEventListener("click",(function(){u(t)}))}function u(t){var s=new BMap.Point(t.lng,t.lat),e=t.mktActivityList||[],a=i("4a72"),o="";o+="<div class='info-box'>",o+="<span class='info-box-btn' id='closeBtn'></span>",o+="<span class='arrow'></span>",o+="<div class='title'>",o+="<p class='name'>"+t.stationName+"</p>",o+='<div class="distance"><img class="img" src="'+a+'"> '+(Number(t.distance)/1e3).toFixed(2)+" km</div>",o+='<div class="service-icon">';for(var n=0;n<t.serviceUrls.length;n++)o+='<img class="img" src="'+t.serviceUrls[n]+'" alt="">';o+="</div>",t.closingTime&&t.opningTime&&(o+="<p class='time'>"+t.opningTime+"-"+t.closingTime+"</p>"),o+="</div>",o+="<ul class='discount-list'>";for(var c=0;c<e.length;c++)o+="<li class='discount-item'>",o+="<span class='icon theme_bg_red'>"+e[c].activityType+"</span>",o+="<span class='text'>"+e[c].activityTitle+"</span>",o+="</li>";0===e.length&&(o+="<li class='no-data'>暂无优惠活动~</li>"),o+="</ul>",o+="</div>",l.infoBox&&(l.infoBox.close(),l.infoBox=null),l.infoBox=new BMapLib.InfoBox(l.bdMap,o,{enableAutoPan:!0}),l.infoBox.open(s),l.openListener&&EventWrapper.removeListener(l.openListener),l.openListener=EventWrapper.addListener(l.infoBox,"open",(function(t){l.$nextTick((function(){EventWrapper.addDomListener(document.getElementById("closeBtn"),"touchstart",(function(){l.infoBox.close()}))}))}))}},searchMore:function(){this.searchText=null,this.isShowSearch=!0},getNearStations:function(t){this.resetCondition(),this.nowmk&&this.bdMap.removeOverlay(this.nowmk),this.nowmk=new BMap.Marker(t),this.bdMap.addOverlay(this.nowmk),this.bdMap.centerAndZoom(t,14),this.requestStations()},requestStations:function(t){var s=this;this.$Loading.open(),this.pageOn++;var i="/app/json/station/getStationMoreInfoList",e=this.$util.bd_decrypt(this.nowmk.point.lng,this.nowmk.point.lat),a={posx:e.gg_lon,posy:e.gg_lat,tags:"youzhan",page:{index:this.pageOn,pageSize:12},token:this.$store.state.login.token,getType:"1"},o=this.$route.query,n=o.stationType,c=o.RefuelGsOuCode,r=o.RefuelGsOuCodeOp;"coupon"===n&&(i="/app/json/station/getStationList",a.RefuelGsOuCode=c,a.RefuelGsOuCodeOp=r),this.mode.length&&this.mode.forEach((function(t){"all"!=t.dictValue&&(1===t._type?a["selfOil"]=t.dictValue:2===t._type&&(a[t.dictValue]=1))})),a.distLess=this.$store.state.refuelStation.distLess,this.$http.post(i,a).then((function(i){s.$Loading.close();var e=i.data,a=e.data||[];if(0==e.status){for(var o=0;o<a.length;o++){var n=a[o];n.serviceUrls=h["a"].getServiceImgUrls(n),n.lng=n.posx,n.lat=n.posy}s.stations=s.stations.concat(a.map((function(t){return t.visible=!1,t}))||[]),s.stations.length>=e.totalRecords&&(s.isBottomBounce=!1),s.addNewLocations()}else s.$Toast(e.info);t&&t("done")}),(function(i){t&&t("done"),s.$Loading.close(),s.$Toast("请求错误")}))},gotoStation:function(t){this.$bridgefunc.baiduNav({startlong:this.locationinfo.longitude,startlat:this.locationinfo.latitude,endlong:t.posx,endlat:t.posy,txlong:t.txPosx,txlat:t.txPosy,type:"nav"})},locationStation:function(t){this.bdMap.centerAndZoom(new BMap.Point(t.posx,t.posy),15)},pushToDetail:function(t){this.$router.push({path:"/oilstationdetail",query:{startlong:this.nowmk.point.lng,startlat:this.nowmk.point.lat}})},searchMode:function(t){var s=this._findIndex(this.mode,t);s>-1?"all"!==t.dictValue&&this.mode.length>1&&this.mode.splice(s,1):"all"===t.dictValue?this.mode=[g]:(this._findIndex(this.mode,g)>-1&&(this.mode=[]),this.mode.push(t)),this.resetCondition(),this.requestStations()},downFilter:function(){this.resetCondition(),this.requestStations()},_findIndex:function(t,s){return t.findIndex((function(t){return t.dictValue===s.dictValue}))},resetCondition:function(){this.pageOn=0,this.isBottomBounce=!0,this.stations=[]},queryLocation:function(t){if(t){var s=this.$store.state.indexData.province||131,i="https://api.map.baidu.com/place/v2/suggestion?query="+t+"&region="+s+"&output=json&ak="+u["a"].mapak,e=this;p()(i,null,(function(t,s){t||(e.dataList=s.result)}))}else this.dataList=[]},queryMarks:function(){var t=this;this.$request.post("/app/json/station/queryOilMarks").then((function(s){0===s.status&&(s.data&&s.data.forEach((function(s){"object"===Object(o["a"])(s)&&(s._type=1,t.tags.push(s))})),t.$request.post("/app/json/station/queryServMarks").then((function(s){0===s.status&&s.data&&s.data.forEach((function(s){"object"===Object(o["a"])(s)&&(s._type=2,t.tags.push(s))})),t.tags.length&&t.tags.unshift(g)})))}))}}},m=f,v=(i("1618"),i("0c7c")),b=Object(v["a"])(m,e,a,!1,null,null,null);s["default"]=b.exports},"6b9d":function(t,s,i){}}]);