(window.webpackJsonp=window.webpackJsonp||[]).push([[462],{"CG+W":function(t,o,n){"use strict";var e,a=n("0FX9"),i=(e=n.n(a).a.toCanvas,function(){var t=Array.prototype.slice.call(arguments);return new Promise((function(o,n){t.push((function(t,e){t?n(t):o(e)})),e.apply(null,t)}))}),s=function(t,o){var n=document.createElement("canvas");return i(n,t,o).then((function(){return n.width}))},r=function(t){return t.length>36?"M":t.length>16?"Q":"H"},c=function(t){var o=t.canvas,n=(t.content,t.logo);if(n){var e=o.width,a=n.logoSize,i=void 0===a?.15:a,s=n.borderColor,r=n.bgColor,c=void 0===r?s||"#ffffff":r,u=n.borderSize,l=void 0===u?.05:u,v=n.crossOrigin,f=n.borderRadius,p=void 0===f?8:f,A=n.logoRadius,h=void 0===A?0:A,m="string"==typeof n?n:n.src,C=e*i,g=e*(1-i)/2,I=e*(i+l),w=e*(1-i-l)/2,T=o.getContext("2d");d(T)(w,w,I,I,p),T.fillStyle=c,T.fill();var y=new Image;return(v||h)&&y.setAttribute("crossOrigin",v||"anonymous"),y.src=m,new Promise((function(t,o){y.onload=function(){h?function(t){var o=document.createElement("canvas");o.width=g+C,o.height=g+C,o.getContext("2d").drawImage(t,g,g,C,C),d(T)(g,g,C,C,h),T.fillStyle=T.createPattern(o,"no-repeat"),T.fill()}(y):function(t){T.drawImage(t,g,g,C,C)}(y),t()}}))}},d=function(t){return function(o,n,e,a,i){var s=Math.min(e,a);return i>s/2&&(i=s/2),t.beginPath(),t.moveTo(o+i,n),t.arcTo(o+e,n,o+e,n+a,i),t.arcTo(o+e,n+a,o,n+a,i),t.arcTo(o,n+a,o,n,i),t.arcTo(o,n,o+e,n,i),t.closePath(),t}},u=function(t){return function(t){var o=t.canvas,n=t.content,e=t.width,a=void 0===e?0:e,c=t.nodeQrCodeOptions,d=void 0===c?{}:c;return d.errorCorrectionLevel=d.errorCorrectionLevel||r(n),s(n,d).then((function(t){return d.scale=0===a?void 0:a/t*4,i(o,n,d)}))}(t).then((function(){return t})).then(c)},l={toCanvas:u,toImage:function(t){var o=document.createElement("canvas");return t.canvas=o,t.logo&&("string"==typeof t.logo&&(t.logo={src:t.logo}),t.logo.crossOrigin="Anonymous"),u(t).then((function(){var n=t.image,e=void 0===n?new Image:n,a=t.downloadName,i=void 0===a?"qr-code":a,s=t.download;e.src=o.toDataURL(),(!0===s||"function"==typeof s)&&(s=!0===s?function(t){return t()}:s)((function(){!function(t,o){var n=t.src,e=document.createElement("a");e.download=o,e.href=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)}(e,i)}))}))}};o.a=l},"Kz/S":function(t,o,n){"use strict";n.r(o);var e=n("CG+W"),a={data:function(){return{couDetailInfo:{storeModelList:[{}]},countdownTime:30,tempCountdownTime:0,interId:null,storeInfoData:{}}},mounted:function(){this.getCouDetail(),this.tempCountdownTime=this.countdownTime},beforeRouteLeave:function(t,o,n){this.interId&&window.clearInterval(this.interId),this.roudRobinInterId&&window.clearInterval(this.roudRobinInterId),n()},methods:{initQrCode:function(t){e.a.toCanvas({canvas:document.getElementById("qrcodeCanvas"),content:t,width:160,nodeQrCodeOptions:{margin:0}}),this.startCountdown()},goToApplicableStores:function(){this.$router.push({path:"/applicable_stores",query:{skuId:this.couDetailInfo.skuId,storeOuCode:this.couDetailInfo.storeOuCode}})},getCouDetail:function(){var t=this;this.$STLoading.open(),this.$http.post("/app/json/app_serve_cou/getMyCouInfo",{couNo:this.$route.query.couNo}).then((function(o){t.$STLoading.close();var n=o.data;0==n.status?(t.initQrCode(n.data.dynamicCode),t.couDetailInfo=n.data,t.getApplicableStores(t.couDetailInfo.skuId,t.couDetailInfo.storeOuCode),t.roundRobin(t.couDetailInfo.couNo)):t.$Toast(n.info)})).catch((function(o){t.$Toast("getMyCouInfo err "+o),t.$STLoading.close()}))},refreshQrCode:function(){var t=this;this.$STLoading.open(),this.$http.post("/app/json/app_serve_cou/refreshDynamicCode",{couNo:this.couDetailInfo.couNo}).then((function(o){var n=o.data;0==n.status&&t.initQrCode(n.data.dynamicCode),t.$STLoading.close()})).catch((function(o){t.$Toast("refreshDynamicCode err "+o),t.$STLoading.close()}))},startCountdown:function(){var t=this;this.interId?window.clearInterval(this.interId):this.interId=setInterval((function(){t.countdownTime--,t.countdownTime?console.log("计时进行中",t.countdownTime):(window.clearInterval(t.interId),t.interId=null,t.countdownTime=t.tempCountdownTime,t.refreshQrCode())}),1e3)},getApplicableStores:function(t,o){var n=this;this.$STLoading.open(),this.$http.post("/app/json/app_cou_service/queryCanUseStoreList",{skuId:t,storeOuCode:o,posx:this.$store.state.currentLocation.posx,posy:this.$store.state.currentLocation.posy,getType:1,page:1,rows:1}).then((function(t){var o=t.data;n.$STLoading.close(),0==o.status?o.data instanceof Array&&o.data[0]&&(n.storeInfoData=o.data[0],n.storeInfoData.allStoreNum=o.totalRecords||0):n.$Toast(o.info)})).catch((function(t){n.$Toast("queryCanUseStoreList err "+t),n.$STLoading.close()}))},dealwithTime:function(t){return t.openingTime&&t.closingTime?t.openingTime+" - "+t.closingTime:"暂无 - 暂无"},goToMap:function(){this.$bridgefunc.baiduNav({startlong:this.$store.state.currentLocation.posx,startlat:this.$store.state.currentLocation.posy,endlong:this.storeInfoData.posx,endlat:this.storeInfoData.posy,type:"nav"})},roundRobin:function(t){var o=this;this.roudRobinInterId?window.clearInterval(this.roudRobinInterId):this.roudRobinInterId=setInterval((function(){o.$http.post("/app/json/app_serve_cou/queryCouCheckState",{serveNo:t}).then((function(t){t.data.data.storeCode&&(window.clearInterval(o.roudRobinInterId),o.$router.push({path:"/mall2/paysuccess",query:{entryType:1,tradeTime:t.data.data.tradeTime,sumCheckAmount:t.data.data.sumCheckAmount,storeName:t.data.data.storeName}}))})).then((function(t){}))}),1e3)},initiativeRefresh:function(){this.interId&&(window.clearInterval(this.interId),this.interId=null,this.countdownTime=this.tempCountdownTime),this.refreshQrCode()}}},i=(n("jZvi"),n("KHd+")),s=Object(i.a)(a,(function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",[e("nav-top",{on:{backEvent:function(o){return t.$router.go(-1)}}}),t._v(" "),e("nav-content",{staticClass:"container"},[e("div",{staticClass:"qrcode-container"},[e("p",{staticClass:"top-title"},[t._v("使用时请出示给收银员")]),t._v(" "),e("div",{staticClass:"qrcode-c"},[e("canvas",{staticClass:"qr-canvas",attrs:{id:"qrcodeCanvas"},on:{click:t.initiativeRefresh}}),t._v(" "),e("span",{staticClass:"static-code"},[t._v("静态码："+t._s(t.couDetailInfo.staticCheckCode))])]),t._v(" "),e("p",{staticClass:"service-company"},[t._v("由"+t._s(t.couDetailInfo.merOuName)+"提供服务")]),t._v(" "),e("p",{staticClass:"countdown-c"},[t._v(t._s(t.countdownTime)+"秒自动刷新，点击二维码手动刷新")])]),t._v(" "),t.couDetailInfo.couThirdPic?e("div",{staticClass:"card-container"},[e("img",{staticClass:"card",attrs:{src:t.couDetailInfo.couThirdPic,alt:""}})]):t._e(),t._v(" "),e("div",{staticClass:"store-info"},[e("div",{staticClass:"top-info",on:{click:t.goToApplicableStores}},[e("p",{staticClass:"title"},[t._v("适用门店")]),t._v(" "),e("p",{staticClass:"match-num"},[t._v("共"+t._s(t.storeInfoData.allStoreNum)+"家"),e("i",{staticClass:"iconfont mall-gengduojiantou arrow-icon"})])]),t._v(" "),e("div",{staticClass:"bottom-info"},[e("div",{staticClass:"airport-info"},[e("p",{staticClass:"name"},[t._v(t._s(t.storeInfoData.storeName))]),t._v(" "),e("p",{staticClass:"address"},[t._v(t._s(t.storeInfoData.address))]),t._v(" "),e("p",{staticClass:"address"},[t._v("时间："+t._s(t.dealwithTime(t.storeInfoData)))])]),t._v(" "),e("div",{staticClass:"navigation-info",on:{click:t.goToMap}},[e("img",{staticClass:"icon-nav",attrs:{src:n("Zq3a"),alt:""}}),t._v(" "),e("span",{staticClass:"nav-text"},[t._v(t._s(t.$util.toDecimal2(t.storeInfoData.distance/1e3))+"km")])])])]),t._v(" "),e("div",{staticClass:"instructions-for-use",domProps:{innerHTML:t._s(t.couDetailInfo.couDesc)}})])],1)}),[],!1,null,"37871bc4",null);o.default=s.exports},Zq3a:function(t,o){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAAH7+Yj7AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAKAAAAAB65masAAAE40lEQVRYCcWYTWhcVRTHM180doLk06Qk6hAiEVETjBUsWgeq+IEoCLH4QY0LLbpIIwpVd65E3Oha0YXFheJGqd3ECIJFwaLEdCGCUppFJ9+0Tprv8XeGOS937rvvYzoTfTCce8/5n/8599zz7ntvmpocV8LUtba2lmSe6OzszG9tbX1vGr2xoBTpKWXgVIphZGQk4wUCtSzgRCLxTcJ2WVlZ8YBlPhsQHEQCmVd7e/vr4i2/XU4QPsqKl8ROyTiXyzUjNiv6KlGVoGmB9bCG6+3t7VBbmVEnItfW1i40Nzc3sf6Zubm5r0xb5JgIP1ctxvYwFjfuA/b09OQI/7fpJAtKqqKtre2UMNgg7EuC8e2XOqrU8iQrg6pQCjJlOTTgfnHgOmUalU10vsUYK20ygd5iDKaxyvhJQ+cemqyK8IVWQ1zZ1dU1vLm5+RP4feJTE2GpVErQy6eRj7oClgvnMqiuo6NjbHt7+1Odh0ktZFpB0sqrq6u/Eb1PdZDpMFQmk8mbFJCmBj0cKX8Ui8XrVVmjPLa0tHRRfZw1pH9/INP7FRQkabTPlpeXj5l2J6EJcLWG2CGbhexGE1vW2wrX3EWqm2DjIzNUB5M0iEyxsaVJGuQUO8MgAtWzkc9R17G6Ccn6E0hfFGL68ZFrIuSB0Eodf4UjJ0R6SW29O0WVYZL7+OGdnZ0zAZvygfjGypD6vE+jvxEWTIMEZjgwMLBvYWFBjqVhyMK4pMnPK8CXISfMQQ6FHwFkFBQlW1pa9s/Ozl4VnEfIst4kk3ejnB32LZbrBU+z7ZOAjkQty0FUVrHcvGlLojhnKmodc0BIebwrieKk7BDXq5425oBGfseGejVUA7V8jOWf1nmY1FYxMb7nKBl/K0Ci324C7TErOmvrZO4jVBDH+nmchnRuy6GhoQdsncx9S7ZBriOLQFdZyX4bK/PADA2w6xXiHsNeNYzMUNB2lq7NUNY4GQp2wnNIJl/TcV1SsrQzdREGnjY2mDb6kP68xdbb81g1tJ32Ys7bcxcvxsfljiXxAxKD8df/S4Kjo6OpqampJ3ianCAZ5/1Bfn/S6oP/SYJ8Mg7yDBgn6AsklJXqhF1U7nIqlerjAXQlds+EEZq27u7u7MbGhrzfjZPMrWLj5dOERI13MpnMXXyfXRFg3RXkzjkMzwl+coD4PgrR1XRRuQcXFxe/U6eaKshWHaBvXuF3HIIblKRRkjv7ZTM54Q1MMJ/Pp6enp59im6SRDwm4xq0Sl9gXffceD5yPbAdvi3luyuNNGvl5ErrOBu7lnOS+5I592hUjQWK/k1Dos9fl2EDdOZ5NdwfxySvNHfLw4pJ/d94GWAgC74G+wLdquX2CuL0ttgFymE5OTh5Ff5IK32nbGzDf4Di5eX5+/lIYV2CCLie+JQ6RrLwvP469Jl+bL51OH+Qg/sXW2/O6gtC/n5PsMzZp1Jzj5Ch37BdROLHHfT9yctG/z9K3Z5zGACX4t+ImJxR1VVBzoJJnqeS9Og+RH3NDvhRi95kakiDJyX9WM8jbfBF2FVMkd2R3Gm9U1xZrCLat1N/fP4z0/lFSW0X+NTEx8ZClizVtSAU1krzJrK+vX2Du/aVM0v/w66XvLiuuFtmQCmrAQqFQzGazgyRUrOhKvJ2MXGtyyttwST/2cePM8LuvXvJ/ATbQs32MVWgTAAAAAElFTkSuQmCC"},jZvi:function(t,o,n){"use strict";var e=n("sXGo");n.n(e).a},sXGo:function(t,o,n){}}]);