(window.webpackJsonp=window.webpackJsonp||[]).push([[751],{XAv6:function(t,s,e){"use strict";e.r(s);var i=e("8ujH"),a=e.n(i),o=e("2nGb"),n={name:"address-list",components:{},data:function(){return{searchKey:"",showSearchBtn:!1,listData:[],loaded:!0,location:{},storeOuCode:"",dataList:[],canUseList:[],canNotUseList:[],type:"",businessType:"0",storeList:[],imgStoreList:[],currentLocation:{},selectedStore:{},showStoreList:!1}},watch:{searchKey:function(t,s){this.queryLocation(t)}},methods:{selectStore:function(t){this.selectedStore=t,this.currentLocation.selectedStore=this.selectedStore,localStorage.setItem("Address_List_Seleted",JSON.stringify(this.currentLocation)),this.$router.go(-1)},selectSearchAddress:function(t){var s=this,e={province:t.province,city:t.city,district:t.district,longitude:t.location.lng,latitude:t.location.lat,address:t.address+t.name,name:t.name};t.city==t.province&&(e.city=t.district,e.district=""),this.$mallCommon.pureLocationAnalysis((function(t){var e=t;"1"==s.businessType?(s.showSearchBtn=!1,s.currentLocation=e,s.getStoreListData()):(localStorage.setItem("Address_List_Seleted",JSON.stringify(e)),s.$router.go(-1))}),e)},queryLocation:function(t){var s=this;if(t){var e="https://api.map.baidu.com/place/v2/suggestion?query="+t+"&region="+(this.$store.state.indexData.province||131)+"&output=json&ak="+o.a.mapak;a()(e,null,(function(t,e){t?console.error(t.message):s.dataList=e.result}))}else this.dataList=[]},selectAddress:function(t){"1"==this.businessType?(this.currentLocation=t,this.getStoreListData()):(localStorage.setItem("Address_List_Seleted",JSON.stringify(t)),this.$router.go(-1))},_deleteAddress:function(t,s){var e=this;this.$Loading.open();var i={id:t.id};this.$http.post("/app/json/user_address/deleteUserAddress",i).then((function(t){e.$Loading.close();var s=t.data;0==s.status?(e.$Toast("删除成功！"),e.getListData()):e.$Toast(s.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},editAddress:function(t){this.$router.push({path:"/mall2/store-delivery/address-edit",query:{pageType:"1",address:JSON.stringify(t)}})},addAddressEvent:function(){this.$router.push({path:"/mall2/store-delivery/address-edit"})},toSearchEvent:function(){},getListData:function(){var t=this;this.$Loading.open();var s={addresType:"3",storeOuCode:this.storeOuCode};this.$http.post("/app/json/user_address/getStoreDeliveryUserAddress",s).then((function(s){t.$Loading.close();var e=s.data;if(0==e.status){var i=e.data;if(2==t.type){for(var a=[],o=[],n=0;n<i.length;n++){var r=i[n];1==r.isWithinDelivery?a.push(r):o.push(r)}t.canUseList=a,t.canNotUseList=o}else t.listData=i}else t.$Toast(e.info)}),(function(s){t.$Loading.close(),t.$Toast("请求数据失败！")}))},getStoreListData:function(){var t=this;this.$Loading.open();var s={posx:this.currentLocation.posx,posy:this.currentLocation.posy,page:1,rows:20};this.$http.post("/app/json/store/getNearDistanceStoreList",s).then((function(s){t.$Loading.close();var e=s.data;if(0==e.status){var i=e.data;t.storeList=i,t.imgStoreList=[];for(var a=0;a<i.length&&a<3;a++)t.imgStoreList.push(i[a])}else t.$Toast(e.info)}),(function(s){t.$Loading.close(),t.$Toast("请求数据失败！")}))},getLoaction:function(){var t=this;this.$bridgefunc.getLocation((function(s){t.$mallCommon.nearAddress((function(s){console.log(s),t.location=s,"1"==t.businessType&&(t.currentLocation=s,t.getStoreListData())}),s)}))}},created:function(){this.type=this.$route.query.type||"1",this.businessType=this.$route.query.businessType||"0",this.storeOuCode=this.$route.query.storeOuCode||"",this.selectedStore={storeCode:this.$route.query.storeCode||"",storeName:this.$route.query.storeName||""},sessionStorage.removeItem("Address_Map_Seleted"),this.getLoaction(),this.getListData()}},r=(e("dH8r"),e("KHd+")),c=Object(r.a)(n,(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mall2"},[e("nav-top",{on:{backEvent:function(s){return t.$router.go(-1)}}}),t._v(" "),e("nav-content",["1"==t.type?e("div",{staticClass:"address-list"},[e("div",{staticClass:"search-div"},[e("div",{staticClass:"input-div"},[e("i",{staticClass:"iconfont mall-sousuo theme_font_tint"}),t._v(" "),e("form",{staticClass:"search-form",attrs:{action:""}},[e("input",{staticStyle:{display:"none"},attrs:{type:"text",name:"keyword"}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKey,expression:"searchKey"}],staticClass:"search-input",attrs:{type:"search",placeholder:"输入城市、小区、写字楼、学校"},domProps:{value:t.searchKey},on:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.toSearchEvent(s)},focus:function(s){t.showSearchBtn=!0},input:function(s){s.target.composing||(t.searchKey=s.target.value)}}})])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchBtn,expression:"showSearchBtn"}],staticClass:"btn-div",on:{click:function(s){t.showSearchBtn=!1}}},[t._v("取消")])]),t._v(" "),"1"==t.businessType&&t.storeList.length>0?e("div",{staticClass:"store-list"},[e("div",{staticClass:"title"},[t._v("配送至："+t._s(t.currentLocation.area))]),t._v(" "),e("div",{staticClass:"list-content"},[t._l(t.imgStoreList,(function(s,i){return e("div",{key:i,staticClass:"item",class:{selected:s.storeCode==t.selectedStore.storeCode},on:{click:function(e){return t.selectStore(s)}}},[s.storeCode==t.selectedStore.storeCode?e("div",{staticClass:"tag"},[t._v("当前")]):t._e(),t._v(" "),e("div",{staticClass:"store-img"},[e("img",{attrs:{src:s.storePictureUrl||t.$store.state.globalConfig.logoUrl}})]),t._v(" "),e("div",{staticClass:"store-title single-line"},[t._v(t._s(s.storeName))])])})),t._v(" "),e("div",{staticClass:"more",on:{click:function(s){t.showStoreList=!0}}},[e("span",[t._v("共"+t._s(t.storeList.length)+"个门店")]),t._v(" "),e("i",{staticClass:"iconfont mall-gengduojiantou"})])],2)]):t._e(),t._v(" "),e("div",{staticClass:"my-location line_bottom"},[e("div",{staticClass:"title"},[t._v("我当前的位置")]),t._v(" "),e("div",{staticClass:"location single-line"},[e("div",{staticClass:"loc-adr",on:{click:function(s){return t.selectAddress(t.location)}}},[e("i",{staticClass:"iconfont mall-dingwei"}),t._v(" "),e("span",{staticClass:"single-line"},[t._v(t._s(t.location.area))])]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.getLoaction}},[t._v("重新定位")])])]),t._v(" "),e("div",{staticClass:"list"},[e("div",{staticClass:"title"},[t._v("我的收货地址")]),t._v(" "),e("div",t._l(t.listData,(function(s,i){return e("div",{staticClass:"item line_bottom"},[e("mt-cell-swipe",{staticClass:"my-cell-swipe",attrs:{right:[{content:"删除",style:{padding:"20px 30px",background:"#F80F16",color:"white",display:"flex",alignItems:"center"},handler:function(){return t._deleteAddress(s,i)}}]}},[e("div",{staticStyle:{width:"100%",display:"flex","align-items":"center"},attrs:{slot:"title"},slot:"title"},[e("div",{staticStyle:{flex:"1"},on:{click:function(e){return t.selectAddress(s)}}},[e("div",{staticClass:"realName"},[t._v("\n                    "+t._s(s.area)+"\n                  ")]),t._v(" "),e("p",{staticClass:"address"},[e("span",[t._v(t._s(s.receiverName))]),t._v(" "),e("span",[t._v(t._s(s.mobile))])])]),t._v(" "),e("div",{staticClass:"address-edit"},[e("div",{staticClass:"edit",on:{click:function(e){return e.stopPropagation(),t.editAddress(s)}}},[e("i",{staticClass:"iconfont mall-bianji theme_font_gray"})])])])])],1)})),0),t._v(" "),t.loaded&&0==t.listData.length?e("div",{staticClass:"no-address"},[t._v("暂无收货地址！")]):t._e()]),t._v(" "),e("div",{staticClass:"bottom-btn theme_bg_red",on:{click:t.addAddressEvent}},[e("p",[t._v("新建收货地址")])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchBtn,expression:"showSearchBtn"}],staticClass:"search-list"},t._l(t.dataList,(function(s){return e("div",{staticClass:"item line_bottom",on:{click:function(e){return e.stopPropagation(),t.selectSearchAddress(s)}}},[e("div",{staticClass:"name"},[t._v(t._s(s.name))]),t._v(" "),e("div",{staticClass:"address"},[t._v(t._s(s.province+s.city+s.district))])])})),0)]):"2"==t.type?e("div",{staticClass:"address-list"},[e("div",{staticClass:"list"},[e("div",[t._l(t.canUseList,(function(s,i){return e("div",{staticClass:"item line_bottom"},[e("mt-cell-swipe",{staticClass:"my-cell-swipe",attrs:{right:[{content:"删除",style:{padding:"20px 30px",background:"#F80F16",color:"white",display:"flex",alignItems:"center"},handler:function(){return t._deleteAddress(s,i)}}]}},[e("div",{staticStyle:{width:"100%",display:"flex","align-items":"center"},attrs:{slot:"title"},slot:"title"},[e("div",{staticStyle:{flex:"1"},on:{click:function(e){return t.selectAddress(s)}}},[e("div",{staticClass:"realName"},[t._v("\n                    "+t._s(s.area)+"\n                  ")]),t._v(" "),e("p",{staticClass:"address"},[e("span",[t._v(t._s(s.receiverName))]),t._v(" "),e("span",[t._v(t._s(s.mobile))])])]),t._v(" "),e("div",{staticClass:"address-edit"},[e("div",{staticClass:"edit",on:{click:function(e){return e.stopPropagation(),t.editAddress(s)}}},[e("i",{staticClass:"iconfont mall-bianji theme_font_gray"})])])])])],1)})),t._v(" "),t.loaded&&0==t.canUseList.length?e("div",{staticClass:"no-address"},[t._v("暂无可用收货地址！")]):t._e()],2),t._v(" "),t.canNotUseList.length>0?e("div",{staticClass:"cannot-use"},[e("div",{staticClass:"title"},[t._v("*以下地址超出配送范围")]),t._v(" "),t._l(t.canNotUseList,(function(s,i){return e("div",{staticClass:"item line_bottom"},[e("mt-cell-swipe",{staticClass:"my-cell-swipe",attrs:{right:[{content:"删除",style:{padding:"20px 30px",background:"#F80F16",color:"white",display:"flex",alignItems:"center"},handler:function(){return t._deleteAddress(s,i)}}]}},[e("div",{staticStyle:{width:"100%",display:"flex","align-items":"center"},attrs:{slot:"title"},slot:"title"},[e("div",{staticStyle:{flex:"1"}},[e("div",{staticClass:"realName"},[t._v("\n                    "+t._s(s.area)+"\n                  ")]),t._v(" "),e("p",{staticClass:"address"},[e("span",[t._v(t._s(s.receiverName))]),t._v(" "),e("span",[t._v(t._s(s.mobile))])])]),t._v(" "),e("div",{staticClass:"address-edit"},[e("div",{staticClass:"edit",on:{click:function(e){return e.stopPropagation(),t.editAddress(s)}}},[e("i",{staticClass:"iconfont mall-bianji theme_font_gray"})])])])])],1)}))],2):t._e()]),t._v(" "),e("div",{staticClass:"bottom-btn theme_bg_red",on:{click:t.addAddressEvent}},[e("p",[t._v("新建收货地址")])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchBtn,expression:"showSearchBtn"}],staticClass:"search-list"},t._l(t.dataList,(function(s){return e("div",{staticClass:"item line_bottom",on:{click:function(e){return e.stopPropagation(),t.selectSearchAddress(s)}}},[e("div",{staticClass:"name"},[t._v(t._s(s.name))]),t._v(" "),e("div",{staticClass:"address"},[t._v(t._s(s.province+s.city+s.district))])])})),0)]):t._e()]),t._v(" "),t.showStoreList?e("pop-view",{on:{closeEvent:function(s){t.showStoreList=!1}}},[e("div",{staticClass:"pop-body"},[e("div",{staticClass:"pop-title theme_font_common"},[t._v("店铺列表")]),t._v(" "),e("div",{staticClass:"pop-scroll-div"},t._l(t.storeList,(function(s){return e("div",{staticClass:"store-row line_bottom",on:{click:function(e){return t.selectStore(s)}}},[e("div",{staticClass:"store-img"},[e("img",{attrs:{src:s.storePictureUrl||t.$store.state.globalConfig.logoUrl}})]),t._v(" "),e("div",{staticClass:"store-info"},[e("div",{staticClass:"store-title single-line"},[t._v(t._s(s.storeName))]),t._v(" "),e("div",{staticClass:"store-address single-line"},[t._v(t._s(s.addressFull))])]),t._v(" "),e("div",{staticClass:"select-div"},[s.storeCode==t.selectedStore.storeCode?e("i",{staticClass:"iconfont mall-xuanzhong theme_font_red"}):e("i",{staticClass:"iconfont mall-weixuanzhong theme_font_gray"})])])})),0)])]):t._e()],1)}),[],!1,null,"8ab80986",null);s.default=c.exports},dH8r:function(t,s,e){"use strict";var i=e("kL5+");e.n(i).a},"kL5+":function(t,s,e){}}]);