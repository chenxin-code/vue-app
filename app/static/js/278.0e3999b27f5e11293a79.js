(window.webpackJsonp=window.webpackJsonp||[]).push([[278],{"9kLS":function(t,e,s){"use strict";var a=s("uyam");s.n(a).a},IYJV:function(t,e,s){"use strict";var a=s("ZI3E");s.n(a).a},ZI3E:function(t,e,s){},ccmS:function(t,e,s){"use strict";s.r(e);var a=s("CuaN"),i=s("eqsK"),o=s("L2JU"),r=s("L5r+"),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t};function c(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}var l={name:"shop-preview",components:{list:a.a,Share:i.a},computed:n({},Object(o.c)(["getPutaggregate","getGlobalConfig"])),data:function(){return{actions:[{name:"全部商品",value:""},{name:"自主商品",value:"2"},{name:"推荐商品",value:"1"}],itemAddshare:{},isThreePoints:!1,threePointsArr:[],threePointsArrQB:[{name:"商品分享",value:"1"}],threePointsArrZD:[{name:"商品下架",value:"0"},{name:"商品置顶",value:"2"}],threePointsArrQZD:[{name:"商品下架",value:"0"},{name:"取消置顶",value:"2"}],deliveryTypes:[{text:"配送",fontclass:"mall-peisong",tag:"2"},{text:"自提",fontclass:"mall-ziti",tag:"1"}],screenArr:[{name:"出售中",number:"0",type:1},{name:"已下架",number:"0",type:2},{name:"无效商品",number:"0",type:0}],params:{page:"",rows:"",skuName:"",groupFlag:this.$route.query.groupFlag,queryTypeRecommend:"",deliverType:this.$store.state.mall2.staticDeliverType,queryType:"1"},styleObj:{listStyle:!1,rowStyle:3,isObject:1,isHeight:"88",url:"/app/json/app_distribution_order/getProList"},isType:"",selectedType:this.$store.state.mall2.staticDeliverType,screenType:"1",showView:!0,popupShow:!1,shareObj:{groupFlag:0,popupShow:!1,codeShow:!1,deliverType:this.$store.state.mall2.staticDeliverType},objData:{},isRecommend:!1,recommendText:"全部商品",codeStstus:!1,searchKey:""}},beforeRouteLeave:function(t,e,s){this.codeStstus?this.shareObj.codeShow=!1:this.popupShow?this.popupShow=!1:s()},created:function(){"1"==this.$store.state.globalConfig.delivertype_default?this.deliveryTypes=[{text:"自提",fontclass:"mall-ziti",tag:"1"}]:"2"==this.$store.state.globalConfig.delivertype_default&&(this.deliveryTypes=[{text:"配送",fontclass:"mall-peisong",tag:"2"}])},methods:{backEvent:function(){this.$router.go(-1)},qRcodeStstus:function(t){this.codeStstus=t},toSearchEvent:function(){var t=this;r.a.open({initData:{barHeight:this.$store.state.barHeight,searchHistory:this.$store.state.mall2.searchHistory},clearSearchHistory:function(){t.$store.state.mall2.searchHistory=[]},searchEvent:function(e){r.a.close(),t.$mallCommon.pushSearchHistory(e),t.searchKey=e,t.params.page=0,t.params.skuName=e}})},selectedTypeEvent:function(t){this.selectedType=t,this.shareObj.deliverType=t,this.$store.state.mall2.staticDeliverType=t,2==this.selectedType?this.showView=!0:this.showView=!1,this.params.deliverType=t,this.screenType=1,this.params.queryType="1"},screenBtn:function(t){this.screenType=t.type,this.params.queryType=t.type,this.$store.state.microSho.screenType=t.type},listData:function(t){var e=t.data||{};this.$set(this.screenArr[2],"number",e.numsForInvalid),this.$set(this.screenArr[0],"number",e.numsForSale),this.$set(this.screenArr[1],"number",e.numsForSoldOut)},setshareData:function(t){this.popupShow=!1,this.shareObj=Object.assign({},t)},upperShelf:function(t){var e=this;this.$messagebox.confirm("确定上架？","提示").then((function(s){e.$Loading.open();var a={token:e.$store.state.login.token,skuId:t.skuId,storeId:e.getPutaggregate.id,status:"1"};e.$http.post("/app/json/app_distribution_order/updateProFromMicroStore",a).then((function(t){e.$Loading.close();var s=t.data;0==s.status?(e.$Toast("上架成功！"),e.$refs.list._loadProList(!0)):e.$Toast(s.info)}))}))},deleteShare:function(t){var e=this;this.$messagebox.confirm("该商品已经停止分销，是否要删除？","提示").then((function(s){e.$Loading.open();var a={token:e.$store.state.login.token,storeId:e.getPutaggregate.id,skuId:t.skuId,proSkuDistributionId:t.proSkuDistributionId};e.$http.post("/app/json/app_distribution_order/removeProFromMicroStore",a).then((function(t){e.$Loading.close();var s=t.data;0==s.status?(e.$Toast("删除成功！"),e.$refs.list._loadProList(!0)):e.$Toast(s.info)}))})).catch((function(){}))},productEvent:function(t){if(0!=this.screenType){var e="/micro_sho/detail/"+this.$util.getDataString();t.groupFlag&&(e="/micro_sho/purchasedetail/"+this.$util.getDataString()),this.$router.push({path:e,query:{id:t.skuId,skuId:t.skuId,lastPath:this.$route.path,deliveryType:t.deliverType,deliverType:t.deliverType,productType:t.productType,isRecommend:t.isRecommend,proSkuDistributionId:t.proSkuDistributionId,groupFlag:this.$route.query.groupFlag,obj:{queryType:this.screenType}}})}},addshareBtn:function(t){this.isThreePoints=!0,this.itemAddshare=t,t.isRecommend?this.threePointsArr=[].concat(c(this.threePointsArrQB),[{name:"取消",value:"-1"}]):t.topFlag?this.threePointsArr=[].concat(c(this.threePointsArrQB),c(this.threePointsArrQZD),[{name:"取消",value:"-1"}]):this.threePointsArr=[].concat(c(this.threePointsArrQB),c(this.threePointsArrZD),[{name:"取消",value:"-1"}])},onSelectPoints:function(t){0==t.value?this.upDownMethod():1==t.value?(this.shareObj=Object.assign({},this.shareObj,this.itemAddshare,{phMainUrl:this.itemAddshare.mainMobilePicUrl,showTitle:this.itemAddshare.skuName,dpedData:{linePrice:this.itemAddshare.salePrice}}),this.popupShow=!0,this.shareObj.popupShow=!0,this.shareObj.groupFlag=this.$route.query.groupFlag):2==t.value&&this.microStoreProTop(),this.isThreePoints=!1},microStoreProTop:function(){var t=this;this.$messagebox.confirm("确定要操作该商品吗!","提示").then((function(e){t.$Loading.open(),t.$http.post("/app/json/app_distribution_order/microStoreProTop",{id:t.itemAddshare.microStoreProId}).then((function(e){t.$Loading.close(),0==e.data.status?(t.$Toast("操作成功!"),t.$refs.list._loadProList(t.params)):t.$Toast(e.data.info)}))}))},upDownMethod:function(){var t=this;this.$messagebox.confirm("确定要下架该商品吗!","提示").then((function(e){t.$Loading.open(),t.$http.post("/app/json/app_distribution_order/updateProFromMicroStore",{skuId:t.itemAddshare.skuId,storeId:t.getPutaggregate.id,status:0}).then((function(e){t.$Loading.close(),0==e.data.status?(t.$Toast("下架成功!"),t.$refs.list._loadProList(t.params)):t.$Toast(e.data.info)}))}))},isRecommendBtn:function(){this.isRecommend=!0},onSelect:function(t){this.recommendText=t.name,this.isRecommend=!1,this.params.queryTypeRecommend=t.value}}},d=(s("9kLS"),s("KHd+")),h=Object(d.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list"},[s("nav-top",{attrs:{noTitle:!0},on:{backEvent:t.backEvent}},[s("div",{staticClass:"search-div theme_bg_white_f5 microSearch",on:{click:t.toSearchEvent}},[s("i",{staticClass:"iconfont mall-sousuo theme_font_tint microSearchI"}),t._v(" "),s("span",{staticClass:"theme_font_tint microSearchSpan"},[t._v(t._s(t.searchKey?t.searchKey:"输入你想要的商品名称"))])])]),t._v(" "),s("nav-content",[s("div",{staticClass:"main"},[s("div",{staticClass:"row"},[s("div",t._l(t.deliveryTypes,(function(e,a){return s("div",{key:a,staticClass:"type-btn",class:{theme_light_bg:t.selectedType==e.tag,theme_standard_bdr_i:t.selectedType==e.tag},on:{click:function(s){return t.selectedTypeEvent(e.tag)}}},[s("i",{staticClass:"iconfont theme_font_common icon-size",class:[e.fontclass,{theme_standard_font_i:t.selectedType==e.tag}]}),t._v(" "),s("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.selectedType==e.tag}},[t._v(t._s(e.text))])])})),0),t._v(" "),1==t.getPutaggregate.empFlag?s("div",{staticClass:"type-btn",on:{click:t.isRecommendBtn}},[s("van-icon",{staticStyle:{"margin-right":"4px","margin-top":"-3px","vertical-align":"middle"},attrs:{name:t.isRecommend?"arrow-up":"arrow-down"}}),s("span",[t._v(t._s(t.recommendText))])],1):t._e()]),t._v(" "),s("div",{staticClass:"screen"},t._l(t.screenArr,(function(e,a){return s("div",{key:a,staticClass:"btn",class:{theme_standard_font_i:t.screenType==e.type},on:{click:function(s){return t.screenBtn(e)}}},[t._v(t._s(e.name+"（"+e.number+"）"))])})),0),t._v(" "),s("list",{ref:"list",attrs:{params:t.params,styleObj:t.styleObj},on:{productEvent:t.productEvent,addshare:t.addshareBtn,listData:t.listData,upperShelf:t.upperShelf,deleteShare:t.deleteShare}})],1)]),t._v(" "),t.popupShow?s("Share",{attrs:{shareObj:t.shareObj},on:{setshareData:t.setshareData,qRcodeStstus:t.qRcodeStstus}}):t._e(),t._v(" "),s("van-action-sheet",{attrs:{actions:t.actions},on:{select:t.onSelect},model:{value:t.isRecommend,callback:function(e){t.isRecommend=e},expression:"isRecommend"}}),t._v(" "),s("van-action-sheet",{attrs:{actions:t.threePointsArr},on:{select:t.onSelectPoints},model:{value:t.isThreePoints,callback:function(e){t.isThreePoints=e},expression:"isThreePoints"}})],1)}),[],!1,null,"4d90a509",null);e.default=h.exports},eqsK:function(t,e,s){"use strict";var a=s("lR8Q"),i=s.n(a),o=s("2nGb"),r=s("0FX9"),n=s.n(r),c=s("L2JU"),l=s("rlxw"),d={name:"share",props:["shareObj"],computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t})({},Object(c.c)(["getPutaggregate"])),data:function(){return{imgUrl:"",timeOutEvent:0,popupShow:!0,codeShow:this.shareObj.codeShow,detailData:this.$util.deepClone(this.shareObj)}},mounted:function(){this.setOssImg(this.detailData.phMainUrl||this.detailData.picMainUrl||this.detailData.picUrls[0])},methods:{getPrices:function(){return l.a.getPriceShow(this.detailData.purPriceRules)},setOssImg:function(t){var e=this;this.imgUrl="",this.$request.post("/app/json/home/getFileBase64",{filePath:t}).then((function(t){0==t.status?t.data?e.imgUrl="data:image/png;base64,"+(t.data||""):e.$Toast("getFileBase64 返回为空"):e.$Toast(t.info)}))},getInteger:function(t){return this.$util.toDecimal2(t).split(".")[0]},getDecimals:function(t){return this.$util.toDecimal2(t).split(".")[1]},clickOverlay:function(){this.detailData.popupShow=!1,this.$emit("setshareData",this.detailData.storeCode)},sharewx:function(){var t="/micro_sho/shareDetail/";this.detailData.groupFlag&&(t="/micro_sho/sharebuyingDetail/");var e={};(e={}).title=this.detailData.showTitle||this.detailData.skuName,e.sharetext=this.detailData.skuName,e.imageurl=this.detailData.phMainUrl,e.detailurl=this.$store.state.globalConfig.wxBaseUrl+o.a.shareUrl+""+t+this.$util.getDataString(),e.detailurl=e.detailurl+"?id="+(this.detailData.id||this.detailData.skuId)+"&skuId="+(this.detailData.skuId||this.detailData.id)+"&microStoreCode="+this.getPutaggregate.storeCode+"&storeName="+this.getPutaggregate.storeName+"&productType="+this.detailData.productType+"&deliveryType="+this.$store.state.mall2.staticDeliverType+"&storeOuCodeNew="+this.$store.state.mall2.zitiAddress.id+"&proSkuDistributionId="+this.detailData.proSkuDistributionId,this.$store.state.login.token&&""!=this.$store.state.login.token&&(e.detailurl=e.detailurl+"&recommend="+this.$store.state.userInfo.userId,e.detailurl=e.detailurl+"&recommendPhone="+this.$store.state.login.phone),console.log("shareData",e),this.$bridgefunc.wechatShare(e)},QRcode:function(){var t=this,e="/micro_sho/shareDetail";this.detailData.groupFlag&&(e="/micro_sho/sharebuyingDetail"),this.codeShow=!0,this.$emit("qRcodeStstus",this.codeShow),this.$nextTick((function(s){var a=""+t.$store.state.globalConfig.wxBaseUrl+o.a.shareUrl+e+"/"+t.$util.getDataString()+"?id="+(t.detailData.id||t.detailData.skuId)+"&skuId="+(t.detailData.skuId||t.detailData.id)+"&microStoreCode="+t.getPutaggregate.storeCode+"&storeName="+t.getPutaggregate.storeName+"&productType="+t.detailData.productType+"&deliveryType="+t.$store.state.mall2.staticDeliverType+"&storeOuCodeNew="+t.$store.state.mall2.zitiAddress.id+"&proSkuDistributionId="+t.detailData.proSkuDistributionId;n.a.toCanvas(document.getElementById("qrcode"),a,{width:140})}))},btnbox:function(){this.codeShow=!1,this.$emit("qRcodeStstus",this.codeShow)},preservation:function(){var t=this,e=document.querySelector(".code-content"),s=parseInt(window.getComputedStyle(e).width),a=parseInt(window.getComputedStyle(e).height),o=document.createElement("canvas");o.width=2*s,o.height=2*a,o.getContext("2d").scale(2,2);var r={useCORS:!0,scale:2,canvas:o,backgroundColor:"#000"};i()(this.$refs.imageWrapper,r).then((function(e){var s=e.toDataURL("image/png");t.codeShow=!1;var a=s.split("base64,");console.log(s),t.$bridgefunc.savePhoto(a[1],(function(e){"1"==e?(t.detailData.popupShow=!1,t.$emit("setshareData",t.detailData),t.$Toast("保存成功！")):t.$Toast("保存失败！")}))}))}}},h=(s("IYJV"),s("KHd+")),u=Object(h.a)(d,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box"},[s("van-popup",{attrs:{position:"bottom"},on:{"click-overlay":t.clickOverlay},model:{value:t.detailData.popupShow,callback:function(e){t.$set(t.detailData,"popupShow",e)},expression:"detailData.popupShow"}},[s("div",{staticClass:"popup"},[s("div",{staticClass:"popup-content",on:{click:t.sharewx}},[s("img",{attrs:{src:"static/image/mall2/weixin.png",alt:""}}),t._v(" "),s("span",[t._v("微信")])]),t._v(" "),s("div",{staticClass:"popup-content",on:{click:t.QRcode}},[s("img",{attrs:{src:"static/image/microShop/code@2x.png",alt:""}}),t._v(" "),s("span",[t._v("二维码")])])])]),t._v(" "),t.codeShow?s("div",{staticClass:"code-div",on:{click:function(e){return e.target!==e.currentTarget?null:t.btnbox(e)}}},[s("div",{ref:"imageWrapper",staticClass:"code-content"},[s("div",{staticClass:"code-content-img"},[s("div",{staticClass:"code-content-img-top"},[s("img",{attrs:{src:t.imgUrl,alt:"",crossOrigin:"anonymous"}})]),t._v(" "),t.detailData.groupFlag?s("div",{staticClass:"code-content-img-buttom"},[s("div",{staticClass:"price theme_font_red"},t._l(t.getPrices(),(function(e,a){return s("div",{staticClass:"price-item"},[0!=a?s("p",{staticClass:"xian"},[t._v(" ~ ")]):t._e(),t._v(" "),s("p",[t._v("¥")]),t._v(" "),s("p",{staticClass:"big"},[t._v(t._s(e.iNum)+".")]),t._v(" "),s("p",[t._v(t._s(e.dNum))])])})),0),t._v(" "),s("div",{staticClass:"text theme_font_black"},[t._v(t._s(t.detailData.showTitle))])]):s("div",{staticClass:"code-content-img-buttom"},[s("div",{staticClass:"text theme_font_red"},[s("span",{staticClass:"font-small price-z theme_font_red",staticStyle:{"font-weight":"700"}},[t._v("￥")]),t._v(" "),s("span",{staticClass:"price-z theme_font_red",staticStyle:{"margin-left":"-4px"}},[t._v(t._s(t.getInteger(t.detailData.salePrice)))]),t._v(" "),s("span",{staticClass:"font-small price-z theme_font_red",staticStyle:{"margin-left":"-4px","font-weight":"700"}},[t._v("."+t._s(t.getDecimals(t.detailData.salePrice)))])]),t._v(" "),s("div",{staticClass:"text theme_font_black"},[t._v(t._s(t.detailData.dpedData.featureName||t.detailData.skuName))])])]),t._v(" "),s("div",{staticClass:"code-content-line"}),t._v(" "),t._m(0),t._v(" "),s("div",{staticClass:"code-content-zanwei"})]),t._v(" "),s("div",{staticClass:"code-btn"},[s("div",{staticClass:"btn theme_bg_red",on:{click:function(e){return e.stopPropagation(),t.preservation(e)}}},[t._v("保存图片到本地")]),t._v(" "),s("div",{staticClass:"text"},[t._v("记得发送给朋友或发布到朋友圈呦！")])])]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"code-content-code"},[e("canvas",{staticClass:"qrcode",attrs:{id:"qrcode"}}),this._v(" "),e("p",[this._v("微信扫码或长按识别二维码")])])}],!1,null,"1e8a9c88",null);e.a=u.exports},rlxw:function(t,e,s){"use strict";var a=s("ygAv"),i={getPriceShow:function(t){if(0==t.length)return"";for(var e=t[0].price,s=t[0].price,a=1;a<t.length;a++){var i=t[a].price;e>i&&(e=i),s<i&&(s=i)}return e==s?[this.getINumDNum(e)]:[this.getINumDNum(e),this.getINumDNum(s)]},getINumDNum:function(t){var e=a.a.toDecimal2(t).split(".");return{iNum:e[0],dNum:e[1]}}};e.a=i},uyam:function(t,e,s){}}]);