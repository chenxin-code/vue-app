(window.webpackJsonp=window.webpackJsonp||[]).push([[849],{Oq3I:function(t,e,a){},UPm3:function(t,e,a){"use strict";a.r(e);var i=a("0ERz"),s=a.n(i),o=a("YsXA"),n=a.n(o),c=(a("2nGb"),a("7//l")),r=a("Gedb"),d=a("L2JU"),l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},u={name:"my-qrcode",components:{QRCode:s.a},data:function(){return{show:!1,myInfo:{},statusObj:{totalAddUnit:0,expireBalanceUnit:0,totalConsumeUnit:0},details:{details:{}},queryPayStateTimer:null,digitalPWD:"",payDetais:"",complete:!1}},mounted:function(){this.details=JSON.parse(this.$route.query.details),this.makePayQrcode()},activated:function(){1==this.isPwdSet.status&&(this.payQrcodePay(this.isPwdSet.pwd,this.myInfo.qrcode),c.a.close())},methods:{backEvent:function(){this.$keepaliveHelper.deleteCache(this),this.$router.go(-1)},barcodeBtn:function(){var t=this;this.show=!0,this.$nextTick((function(e){var a=document.getElementById("barcode"),i=document.getElementById("enlargeBarcode");n()(a,t.myInfo.qrcode,{displayValue:!1,width:2,height:130}),n()(i,t.myInfo.qrcode,{displayValue:!1,width:2,height:130})}))},makePayQrcode:function(){var t=this;this.$Loading.open();var e={token:this.$store.state.login.token,payMode:121,groupValue:this.details.dictKey,distOuCode:1,imgVerifyCode:this.$route.query.verifyCode||"",uuid:this.$route.query.uuid||""};this.$http.post("/app/json/app_pay/makePayQrcode",e).then((function(e){t.$Loading.close();var a=e.data;0==a.status?(t.complete=!0,t.myInfo=a.data,t.$nextTick((function(){t.toCanvas(),clearInterval(t.queryPayStateTimer),t.queryPayStateTimer=setInterval((function(){t.payQrcodeCheck(t.myInfo.qrcode)}),2e3)}))):("1"==t.$store.state.globalConfig.qrcodePayVerify&&t.$router.go(-1),t.$Toast(a.info))}),(function(e){t.$Loading.close()}))},payQrcodeCheck:function(t){var e=this;this.digitalPWD="";var a={token:this.$store.state.login.token,payMode:121,qrcode:t};this.$http.post("/app/json/app_pay/payQrcodeCheck",a).then((function(a){var i=a.data;if(0==i.status&&(e.payDetais=i.data,e.payDetais.payUnit))if(console.log(e.payDetais),clearInterval(e.queryPayStateTimer),e.payDetais.needPayPwd){if("1"==e.payDetais.payPwdState)return void e.$Toast("支付密码已锁定，请稍后再试！");c.a.open({initData:{payPwdState:e.payDetais.payPwdState},toSettingPwd:function(){e.$router.push({path:"/usercenter/nosetpwd",query:{isSet:e.payDetais.payPwdState,source:"rebate"}}),c.a.close()},inputFinished:function(a){e.digitalPWD=a,e.payQrcodePay(e.digitalPWD,t),c.a.close()}})}else console.log(e.payDetais),e.payQrcodePay(e.digitalPWD,t)}),(function(t){}))},payQrcodePay:function(t,e){var a=this,i="";t&&(i=Object(r.a)(t)),this.$request.post("/app/json/app_pay/payQrcodePay",{payMode:121,qrcode:e,PayPwd:i}).then((function(t){0===t.status?(console.log(a.payDetais),a.$router.push({path:"/usercenter/pay-results",query:{payInfo:JSON.stringify(a.payDetais)}})):a.$Toast(t.info)}))},toCanvas:function(){var t=document.getElementById("barcode");n()(t,this.myInfo.qrcode,{displayValue:!1}),document.getElementById("qrcode").innerHTML="",new s.a("qrcode",{width:200,height:200,text:this.myInfo.qrcode});var e=document.getElementById("qrcode").getElementsByTagName("img")[0];e.style.width="100%",e.style.height="100%"},pushHistory:function(){this.$keepaliveHelper.deleteCache(this),this.$router.push({path:"/usercenter/rebatebonuslist",query:l({title:this.details.dictValue,dictKey:this.details.dictKey},this.statusObj)}),console.log(this.details.dictValue),console.log(this.statusObj)}},destroyed:function(){clearInterval(this.queryPayStateTimer)},computed:l({},Object(d.c)(["isPwdSet"]))},p=(a("Y4AC"),a("KHd+")),y=Object(p.a)(u,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"my-qrcode"},[a("nav-top",{attrs:{title:t.details.dictValue},on:{backEvent:t.backEvent}}),t._v(" "),a("nav-content",{staticClass:"my-qrcode-container"},[t.complete?a("div",{staticClass:"code-content"},[a("div",{staticClass:"balance qr-div"},[a("p",[t._v("账户红包余额")]),t._v(" "),a("span",{staticClass:"number"},[t._v(t._s(t.details.details.balanceUnit||"0"))])]),t._v(" "),a("div",{staticClass:"qr-div"},[a("div",{staticClass:"barcode",on:{click:t.barcodeBtn}},[a("canvas",{attrs:{id:"barcode"}})]),t._v(" "),a("div",{staticClass:"codeimg-content"},[a("div",{ref:"qrcode",staticClass:"qrcode",attrs:{id:"qrcode"}})])]),t._v(" "),a("div",{staticClass:"choseOil",on:{click:t.pushHistory}},[t._v("查看历史记录")]),t._v(" "),a("van-popup",{model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("div",{staticClass:"popup-show",on:{click:function(e){t.show=!1}}},[a("div",{staticClass:"barcode"},[a("canvas",{attrs:{id:"enlargeBarcode"}})])])])],1):t._e()])],1)}),[],!1,null,"626fee08",null);e.default=y.exports},Y4AC:function(t,e,a){"use strict";var i=a("Oq3I");a.n(i).a}}]);