(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3acc5d38"],{"07c0":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bottom"},[t.isYunCardIndoor?s("div",{staticClass:"moudleUp-style"},[s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("订单号")]),s("span",{staticClass:"right-span"},[t._v(t._s(t.yunCardInfo.orderNo))])]),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("加油站")]),s("span",{staticClass:"right-span"},[t._v(t._s(t.yunCardInfo.stationName))])]),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("金额")]),s("span",{staticClass:"right-span"},[s("span",[s("span",{staticClass:"money"},[t._v("￥"+t._s(t.yunCardInfo.totalAmount))]),t._v("元 ")])])])]):s("div",{staticClass:"moudleUp-style"},[s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("枪号")]),s("span",{staticClass:"right-span"},[t._v(t._s(t.refuelInfo.gunNo)+"号")])]),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("油品")]),s("span",{staticClass:"right-span"},[t._v(t._s(t.refuelInfo.oilName))])]),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("金额")]),s("span",{staticClass:"right-span"},[s("span",[s("span",{staticClass:"money"},[t._v("￥"+t._s(t.refuelInfo.totalOilAmount))]),t._v("元 ")])])])]),s("div",{staticClass:"moudle2_style"},[s("div",{staticClass:"line_style text_style money_style"},[t._v("选择支付方式")]),t.cardInfo?s("div",{staticClass:"paytype_style moudle_style",on:{click:function(e){return t.paytypeselect()}}},["0"==t.selectedIndex?s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/checked.png"}}):s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/unchecked.png"}}),s("div",{staticClass:"hint_style"},[s("div",[t._v("加油卡支付（"+t._s(t.cardInfo.cityName)+"）")]),s("div",{staticClass:"hint_text"},[t._v(t._s(t.cardInfo.cardNo)+"  余额¥ "+t._s(t.cardInfo.totalBalance))])]),s("div",{staticClass:"btn_change_card",on:{click:t.pushSelectCard}},[t._v("更换")])]):t._e(),t._l(t.paytype_normal,(function(e){return s("div",{staticClass:"paytype_style moudle_style",on:{click:function(s){return t.paytypeselect(e)}}},[e.type==t.selectedIndex?s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/checked.png"}}):s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/unchecked.png"}}),s("img",{staticClass:"img_style",attrs:{src:e.img}}),s("div",{staticStyle:{flex:"1"}},[t._v(t._s(e.name))])])}))],2),"0"==t.selectedIndex?s("div",{staticClass:"moudle_style",on:{click:t.selectticket}},[s("div",{staticClass:"text_style hint_style "},[t._v("优惠券")]),s("div",{staticClass:"text_style hint_text",class:{mtop:t.elticket.limit}},[t._v(t._s(t.elticket.limit?t.elticket.limit:"不适用优惠券"))]),s("img",{staticClass:"moreimg_style",attrs:{src:"static/images/icon-more.png"}})]):t._e(),s("div",{staticClass:"moudle_style"},[s("div",{staticClass:"text_style hint_style"},[t._v("需付金额")]),s("div",{staticClass:"text_style orange"},[t._v("¥ ")]),s("div",{staticClass:"text_style orange money_style"},[t._v(t._s(t.money))]),s("div",{staticClass:"text_style"},[t._v("元")])]),s("div",{staticClass:"sure-div",on:{click:function(e){return t.payClick()}}},[t._v("付款")])])},i=[],o=s("76a0"),n={name:"refuel-order",components:{Toast:o["Toast"]},data:function(){return{orderNo:"",pageShow:0,selectedIndex:"0",cardInfo:null,elticket:{couNo:"",userId:"",couPic:"",couTypeTitle:"不适用优惠券",couTypeSubTitle:"",validDate:"",state:"",couCanGift:""},refuelInfo:{stationCode:"",stationName:"",gunNo:"",tradeNo:"",oilName:"",oilCode:"",oilType:"",oilPrice:"",totalOilQty:"",totalOilAmount:"",tradeTime:""},paytype_normal:[{type:"01",name:"微信",img:"static/image/refuel/pay_wechat.png"},{type:"02",name:"支付宝",img:"static/image/refuel/pay_zhifubao.png"}],pageType:"",yunCardInfo:null}},computed:{money:function(){var t=this.elticket.limit?this.elticket.limit:0,e=this.refuelInfo.totalOilAmount;return e-t<0?0:e-t},isYunCardIndoor:function(){return"yunPay-indoor"===this.pageType}},mounted:function(){var t=this,e=this;this.$bridgefunc.registePageShow((function(){e.$bridgefunc.vuexRead((function(){switch(e.pageShow){case 1:var s=e.$util.cloneDeep(e.$store.state.card);for(var a in""!=s.cardNo&&(e.cardInfo=s),t.$store.state.card)e.$store.state.card[a]="";break;case 2:var i=e.$util.cloneDeep(e.$store.state.elticket);for(var o in""!=i.coucode&&(e.elticket=i),t.$store.state.elticket)e.$store.state.elticket[o]="";break;case 3:e.orderNo&&e.orderNo.length>0&&e.queryOrder();break}e.$bridgefunc.vuexStorage(),e.pageShow=0}))}))},methods:{getUserCardList:function(){this.$Loading.open();var t="/app/json/card/getUserCardList",e=this.$store.state.login.token,s={token:e},a=this;this.$http.post(t,s).then((function(t){a.$Loading.close();var e=t.data;if(0==e.status){var s=e.data;s&&s.length?a.cardInfo=s[0]:a.$store.state.login.bindCardState="0"}else Object(o["Toast"])({message:e.info?e.info:"获取加油卡列表失败",position:"bottom",duration:2e3})}),(function(t){a.$Loading.close(),Object(o["Toast"])({message:"获取加油卡列表失败",position:"bottom",duration:2e3})}))},cancelOrder:function(){this.$Loading.open();var t=this,e="/app/json/refuel/cancelOrder",s=this.$store.state.login.token,a={token:s,orderNo:t.orderNo};this.$http.post(e,a).then((function(e){t.$Loading.close();var s=e.data;0==s.status&&(t.orderNo="")}),(function(e){t.$Loading.close()}))},payPage:function(){this.payWay=!this.payWay,this.selectedIndex="0"},selectticket:function(){this.pageShow=2,this.$bridgefunc.customPush({path:"/selectelticket",isnativetop:1,query:{}})},paytypeselect:function(t){this.selectedIndex=t?t.type:"0"},pushSelectCard:function(){this.pageShow=1,this.$bridgefunc.customPush({path:"/refuelcardselect",isnativetop:"1"})},repickOilGun:function(){this.$bridgefunc.customGo(-2)},payClick:function(){if(this.isYunCardIndoor){var t={orgId:this.yunCardInfo.stationCode,orderId:this.yunCardInfo.orderNo,amount:100*this.yunCardInfo.totalAmount},e={payStr:encodeURIComponent(JSON.stringify(t)),pan:this.yunCardInfo.cardNo};this.$bridgefunc.yunConfirmPayCode(e,(function(t){alert(t)}))}else if(0!=this.selectedIndex){this.$Loading.open();var s="/app/json/refuel/refuel",a=this;this.$http.post(s,{stationCode:a.refuelInfo.stationCode,gunNo:a.refuelInfo.gunNo,payMode:a.selectedIndex,token:a.$store.state.login.token,stationName:a.refuelInfo.stationName,oilCode:a.refuelInfo.oilCode,oilName:a.refuelInfo.oilName,oilPrice:a.refuelInfo.oilPrice,totalOilQty:a.refuelInfo.totalOilQty,totalOilAmount:a.refuelInfo.totalOilAmount,tradeNo:a.refuelInfo.tradeNo,respData:this.$route.query.respData?decodeURIComponent(this.$route.query.respData):""}).then((function(t){a.$Loading.close();var e=t.data;0==e.status?(a.orderNo=e.data.orderNo,a.pageShow=3,"01"==a.selectedIndex?a.payForWX(e.data):"02"==a.selectedIndex&&a.payForAli(e.data.aliPrepay)):a.$MessageBox.alert(e.info?e.info:"获取订单失败","提示")}),(function(t){a.$Loading.close(),Object(o["Toast"])({message:"获取订单失败",position:"bottom",duration:2e3})}))}else{var i=this.refuelInfo.yunCardInfo||{};this.refuelInfo.gunNo,this.refuelInfo.oilCode,i.workstationID,i.saleItem.transactionNumber,i.tender.authorization.timeStamp,i.saleItem.productCode,i.saleItem.additionalProductCode,this.refuelInfo.oilName,this.refuelInfo.totalOilAmount,i.unitPrice,i.quantity,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount,this.refuelInfo.totalOilAmount}},payForAli:function(t){var e=this;this.$bridgefunc.aliPay(t,(function(t){t?e.queryOrder():Object(o["Toast"])({message:"支付失败",position:"bottom",duration:2e3})}))},payForWX:function(t){var e=this;this.$bridgefunc.wxPay(t,(function(t){t?e.queryOrder():Object(o["Toast"])({message:"支付失败",position:"bottom",duration:2e3})}))},pushOrderDetail:function(){"01"==this.selectedIndex?this.refuelInfo.payMode="微信支付":"02"==this.selectedIndex&&(this.refuelInfo.payMode="支付宝支付"),this.refuelInfo.payTime=this.$util.getPayTime(),this.$bridgefunc.customPush({path:"/refuelorderdetail",isnativetop:1,query:{oilRecord:encodeURIComponent(JSON.stringify(this.refuelInfo))}})},queryOrder:function(){this.$Loading.open();var t="/app/json/refuel/queryOrderState",e=this.$store.state.login.token,s={token:e,orderNo:this.orderNo,stationCode:this.refuelInfo.stationCode},a=this;this.$http.post(t,s).then((function(t){a.$Loading.close();var e=t.data;"316"==e.data.bizCode||"318"==e.data.bizCode?a.pushOrderDetail():"313"==e.data.bizCode?a.$bridgefunc.customPush({path:"/oilrecord",isnativetop:"1",query:{selected:"00"}}):a.$MessageBox.alert(e.info?e.info:"查询失败","提示")}),(function(t){a.$Loading.close(),Object(o["Toast"])({message:"查询失败",position:"bottom",duration:2e3})}))}},created:function(){this.pageType=this.$route.query.pageType,"yunPay-indoor"!==this.pageType?(this.refuelInfo=JSON.parse(decodeURIComponent(this.$route.query.refuelInfo)),this.getUserCardList()):this.yunCardInfo=JSON.parse(decodeURIComponent(this.$route.query.payData))}},r=n,l=(s("29fc"),s("0c7c")),c=Object(l["a"])(r,a,i,!1,null,"12c6c067",null);e["default"]=c.exports},"29fc":function(t,e,s){"use strict";s("f85d")},f85d:function(t,e,s){}}]);