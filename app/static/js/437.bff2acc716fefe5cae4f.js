(window.webpackJsonp=window.webpackJsonp||[]).push([[437],{"17lL":function(t,e,a){"use strict";a("4X9F");var o=a("IkEG"),n=(a("5+UC"),a("05lO"));function i(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}var r=a("2nGb"),s=a("vDqi"),c=a.n(s),l=a("oCYn"),u=a("p46w"),p=a.n(u),f=a("Qyje"),g=a.n(f),d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t};l.default.use(n.a),l.default.use(o.a);var m=c.a.create({baseURL:r.a.baseURL,timeout:1e4,responseType:"json",withCredentials:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});m.interceptors.request.use((function(t){n.a.loading({mask:!0,duration:0});var e=p.a.get("usertoken");return"post"===t.method?t.data=g.a.stringify(d({},t.data,{token:e})):"get"===t.method&&(t.params=d({},t.params,{token:e})),t}),(function(t){return Promise.reject(t)})),m.interceptors.response.use((function(t){return n.a.clear(),-1==t.data.status&&t.data.info.indexOf("用户信息为空")>-1&&o.a.confirm({title:"提示",message:"用户信息失效, 请重新登录"}).then((function(){})),t}),(function(t){return n.a.clear(),console.log(t),Promise.reject(t)}));var h=m,v=a("N4/4"),y=a("ZToj"),w=function(){function t(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),e}}(),_=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsApiList=e}return w(t,[{key:"share",value:function(t,e,a,o){return i()?this._wxShare(t,e,a,o):this._appShare(t,e,a,o)}},{key:"chooseImage",value:function(t){return i()?this._wxChooseImage(t):this._appChooseImage()}},{key:"_wxChooseImage",value:function(t){var e=this;return new Promise((function(a,o){e._init(["chooseImage","uploadImage"]).then((function(){wx.chooseImage({count:t||1,sourceType:["camera"],sizeType:["original"],success:function(t){var e=t.localIds[0];wx.getLocalImgData({localId:e,success:function(t){console.log(t);var e=t.localData,o=e.substr(e.indexOf(",")+1);a({imagedata:[o]})}})}})}))}))}},{key:"_wxUploadImage",value:function(t){return new Promise((function(e,a){wx.uploadImage({localId:t,isShowProgressTips:1,success:function(t){e(t.serverId)}})}))}},{key:"_wxShare",value:function(t,e,a,o){var n=this;return console.log(t),console.log(e),console.log(a),console.log(o),new Promise((function(i,r){n._init(["onMenuShareTimeline","onMenuShareAppMessage","updateAppMessageShareData","updateTimelineShareData"]).then((function(){console.log("开始分享"),wx.onMenuShareTimeline({title:t,link:e,imgUrl:a,success:function(){console.log("onMenuShareTimeline 设置成功！"),i()}}),wx.onMenuShareAppMessage({title:t,desc:o,link:e,imgUrl:a,success:function(){console.log("onMenuShareAppMessage 设置成功！"),i()}}),wx.updateAppMessageShareData({title:t,desc:o,link:e,imgUrl:a,success:function(){console.log("updateAppMessageShareData 设置成功！")}}),wx.updateTimelineShareData({title:t,link:e,imgUrl:a,success:function(){console.log("updateTimelineShareData 设置成功！")}})}))}))}},{key:"_appShare",value:function(t,e,a,o){if(console.log(t),console.log(e),console.log(a),console.log(o),"new"==y.a.state.globalConfig.yht_protocol_type){var n={title:t,sharetext:o,imageurl:a,detailurl:e};v.a.share(n)}else{var i={type:"share",para:{title:t,sharetext:o,imageurl:a,detailurl:e}};location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify(i))}}},{key:"_appUploadImage",value:function(t){var e={type:"webuploadimage",para:{callback:"appCallbackUploadImage",num:t||1}};return location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify(e)),new Promise((function(t){window.appCallbackUploadImage=function(e){t(e)}}))}},{key:"_appChooseImage",value:function(){return"new"==y.a.state.globalConfig.yht_protocol_type?new Promise((function(t){v.a.getPhoto(3,(function(e){var a=[];a.push(e),t({imagedata:a})}))})):(location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify({type:"nativephoto",para:{type:"3"}})),new Promise((function(t){window.photoCallBack=function(e){t(e)}})))}},{key:"scanCode",value:function(){return"new"==y.a.state.globalConfig.yht_protocol_type?new Promise((function(t){v.a.scanCode((function(e){t(e)}))})):(location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify({type:"qrscan"})),new Promise((function(t){window.qrCallBack=function(e){t(e)}})))}},{key:"wxSign",value:function(t){if("new"==y.a.state.globalConfig.yht_protocol_type)v.a.wxFreePay(t);else{var e={type:"wxfreepay",para:{pre_entrustweb_id:t}};location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify(e))}}},{key:"getLocation",value:function(){return new Promise((function(t){wx.getLocation({type:"wgs84",success:function(t){}})}))}},{key:"_init",value:function(t){var e=this;return new Promise((function(a,o){e._getConfig().then((function(e){wx.config({appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonce,signature:e.signature,jsApiList:t}),wx.ready((function(){console.log("微信签名配置成功"),a()})),wx.error((function(t){o(t),console.log("请求信息："+JSON.stringify(e)+"-----错误信息："+JSON.stringify(t))}))})).catch((function(t){o(),console.log("发生错误！",t)}))}))}},{key:"_getConfig",value:function(){return new Promise((function(t,e){var a;a=navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.initUrl:window.location.href.split("#")[0],h.post("/app/json/wx/getAccessToken",{url:encodeURIComponent(a)}).then((function(e){0===e.data.status&&(console.log("请求",Object.assign({},e.data.data,e.data.data.signature)),t(Object.assign({},e.data.data,e.data.data.signature)))})).catch((function(t){e(t)}))}))}},{key:"openNewPage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("new"==y.a.state.globalConfig.yht_protocol_type)v.a.newPage({weburl:t,isnativetop:!0});else{var a={type:"newpage",para:{isnative:e,islogin:!0,isnativetop:!0,isopen:!0}};e?a.para.code=t:(a.para.weburl=t,console.log("打印的p",t)),location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify(a))}}},{key:"finishPage",value:function(){location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify({type:"finish"}))}},{key:"openLogin",value:function(){location.href=location.origin+"?appprotocol="+encodeURIComponent(JSON.stringify({type:"login"}))}},{key:"chooseImg",value:function(){var t=this;return new Promise((function(e,a){t.chooseImage().then((function(t){if(t.imagedata&&t.imagedata.length){var a=t.imagedata[0];h.get("/app/json/app_youdi/getSunboxToken").then((function(t){var i=t.data.data;n.a.loading({mask:!0,duration:0}),c.a.post("/uploadFile",g.a.stringify({base64File:a,fileType:"png",fileName:"1",token:i,bucketName:"default_file"})).then((function(t){var i=t.data.data,r={imgUrl:i,baseImgUrl:a};n.a.clear(),i?e(r):o.a.alert({title:"提示",message:"上传失败！"})}))}))}}))}))}}]),t}();e.a=new _},DJUa:function(t,e,a){"use strict";var o=a("Dl78");a.n(o).a},Dl78:function(t,e,a){},R20A:function(t,e,a){"use strict";e.a={methods:{applyData:function(t){return this.$http.post("/app/json/micro_store_front_end/applyMicroStore",t)},stateData:function(t){return this.$http.post("/app/json/micro_store_front_end/queryMicroStoreOpenState",t)},stateDatahn:function(t){return this.$http.post("/app/json/micro_store_front_end/queryMicroStoreOpenProcess",t)},profitData:function(t){return this.$http.post("/app/json/micro_store_front_end/queryMicroStoreForProfit",t)},profitDatahn:function(t){return this.$http.post("/app/json/micro_store_front_end/cashEarningsDetail",t)},monthData:function(t){return this.$http.post("/app/json/micro_store_front_end/getMonthProfitList",t)},detailData:function(t){return this.$http.post("/app/json/micro_store_front_end/getEmployeeInfoByUserId",t)},modifyData:function(t){return this.$http.post("/app/json/micro_store_front_end/queryMicroStoreForDecoration",t)},getRewardData:function(t){return this.$http.post("/app/json/micro_store_front_end/getRewardTypeList",t)},modifyafterData:function(t){return this.$http.post("/app/json/micro_store_front_end/updateMicroStoreInfoById",t)},modifyBankData:function(t){return this.$http.post("/app/json/micro_store_front_end/saveBankInfo",t)}}}},pCTv:function(t,e,a){"use strict";a.r(e),a("5+UC");var o=a("05lO"),n=(a("8LpY"),a("R20A")),i=a("ZToj"),r=a("L2JU"),s=a("17lL"),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t},l={name:"renovation",mixins:[n.a],data:function(){return{headUrl:"/static/image/microShop/head@2x.png",bacUrl:"/static/image/microShop/head@2x.png",disabled:!1,showFaceBackImg:!1,actions:[{name:"相册"},{name:"拍照"}],faceOrBack:"",frontOfId:"",backOfId:"",mall:{}}},computed:c({},Object(r.c)(["getPutaggregate"])),mounted:function(){1==this.$store.state.globalConfig.auto_create_store_info&&(this.disabled=!0),this.loadIndex()},methods:{loadIndex:function(){var t=this,e=this,a={token:this.$store.state.login.token};e.modifyData(a).then((function(a){var o=a.data.data||{};e.mall=o,e.mall.storeProfile||t.content()}))},content:function(){var t=this;this.$request.post("/app/json/news/getNewsList",{values:62}).then((function(e){if(console.log("协议内容1",e),"success"===e.result){var a=e.data||[];t.mall.storeProfile=a[0].content}else t.$Toast(e.info)}))},changeProfile:function(){0==this.disabled&&this.$router.push({path:"/micro_sho/modifyintroduction"})},changeName:function(){0==this.disabled&&this.$router.push({path:"/micro_sho/modifyname"})},openChangeImgPopup:function(t){var e=this;this.faceOrBack=1==t?1:2,6==this.$store.state.webtype?s.a.chooseImg().then((function(t){1==e.faceOrBack?(e.mall.pictureUrl=t.imgUrl,e.frontOfId=t.imgUrl):(e.mall.backgroundImgUrl=t.imgUrl,e.backOfId=t.imgUrl),e.commit()})):this.showFaceBackImg=!0},onSelect:function(t){this.showFaceBackImg=!1,"拍照"==t.name?this.getImg("2"):"相册"==t.name&&this.getImg("1")},getImg:function(t){var e=this;this.$bridgefunc.getPhoto(t,(function(t){e.updateImg(t);var a="data:image/jpg;base64,"+t;1==e.faceOrBack?e.mall.pictureUrl=a:e.mall.backgroundImgUrl=a}))},updateImg:function(t){var e=this,a={base64File:t,fileType:"jpg",fileName:"id-card-img",bucketName:"default_file"};this.$Loading.open("保存中..."),this.$http.post("/uploadFile",a).then((function(t){e.$Loading.close();var a=t.data;0==a.status?1==e.faceOrBack?(e.frontOfId=a.data,e.commit()):(e.backOfId=a.data,e.commit()):e.$Toast(a.info)}),(function(t){e.$Loading.close(),e.$Toast("上传图片失败")}))},commit:function(){var t=this,e=this;console.log(e.getPutaggregate.id);var a={token:this.$store.state.login.token,id:e.getPutaggregate.id,storeName:"",pictureUrl:e.frontOfId,backgroundImgUrl:e.backOfId,storeProfile:"",card:""};e.modifyafterData(a).then((function(a){"success"===a.data.result?(t.getPutaggregate.pictureUrl=e.frontOfId,t.getPutaggregate.backgroundImgUrl=e.backOfId,i.a.commit("putaggregate",t.getPutaggregate)):Object(o.a)(a.data.info)}))},previewData:function(){this.$router.push({name:"micro_sho/preview",params:{mall:this.mall}})}}},u=(a("DJUa"),a("KHd+")),p=Object(u.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"body"},[a("nav-top",{attrs:{title:"店铺装修"},on:{backEvent:function(e){return t.$router.go(-1)}}},[a("div",{staticClass:"shareBox",on:{click:t.previewData}},[t._v("预览")])]),t._v(" "),a("nav-content",[a("van-cell-group",[a("div",{staticClass:"selectDiv",on:{click:t.changeName}},[a("van-field",{attrs:{label:"店铺名称",readonly:!0,placeholder:"店铺名称"},model:{value:t.mall.storeName,callback:function(e){t.$set(t.mall,"storeName",e)},expression:"mall.storeName"}}),t._v(" "),t.disabled?t._e():a("span",{staticClass:"iconfont mall-gengduojiantou"})],1),t._v(" "),a("div",{staticClass:"selectDiv",on:{click:t.changeProfile}},[a("van-field",{attrs:{readonly:!0,label:"店铺简介",placeholder:"店铺简介"},model:{value:t.mall.storeProfile,callback:function(e){t.$set(t.mall,"storeProfile",e)},expression:"mall.storeProfile"}}),t._v(" "),t.disabled?t._e():a("span",{staticClass:"iconfont mall-gengduojiantou"})],1),t._v(" "),1==t.$store.state.globalConfig.microshop_open?a("router-link",{staticClass:"link",attrs:{to:{path:"/micro_sho/bank",query:{card:t.mall.card,bankName:t.mall.bankName}}}},[a("div",{staticClass:"selectDiv"},[a("van-field",{attrs:{readonly:!0,label:"我的银行卡"},model:{value:t.mall.card,callback:function(e){t.$set(t.mall,"card",e)},expression:"mall.card"}}),t._v(" "),a("span",{staticClass:"iconfont mall-gengduojiantou"})],1)]):t._e(),t._v(" "),a("div",{staticClass:"selectDiv",on:{click:function(e){return t.openChangeImgPopup(1)}}},[a("van-field",{attrs:{type:"tel",label:"店铺头像",disabled:""}}),t._v(" "),a("img",{staticClass:"img1",attrs:{src:t.mall.pictureUrl,alt:""}}),t._v(" "),a("span",{staticClass:"iconfont mall-gengduojiantou"})],1),t._v(" "),a("div",{staticClass:"selectDiv",on:{click:function(e){return t.openChangeImgPopup(2)}}},[a("van-field",{attrs:{label:"店铺背景",disabled:""}}),t._v(" "),a("img",{staticClass:"img1",attrs:{src:t.mall.backgroundImgUrl,alt:""}}),t._v(" "),a("span",{staticClass:"iconfont mall-gengduojiantou"})],1)],1),t._v(" "),a("van-action-sheet",{attrs:{actions:t.actions},on:{select:t.onSelect},model:{value:t.showFaceBackImg,callback:function(e){t.showFaceBackImg=e},expression:"showFaceBackImg"}})],1)],1)}),[],!1,null,"764dd481",null);e.default=p.exports}}]);