(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{"/sdw":function(t,e,i){"use strict";var s=i("RAH5");i.n(s).a},"21UD":function(t,e,i){"use strict";i.r(e);var s=i("oCYn"),a=i("ygAv"),r=(i("ZToj"),{getTopArr:function(){return[{name:"配送",type:2,hasShow:!1,class:"mall-peisong",occurArr:[]},{name:"自提",type:1,hasShow:!1,class:"mall-ziti",occurArr:[]}]},dealCartList:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.checked=!0;for(var s=0;s<i.store.length;s++){var a=i.store[s];a.checked=this.judgeStoreIsSel(a,!1),a.checked||(i.checked=!1);for(var r=a.activity,c=0;c<r.length;c++){var n=r[c];n.number=this.getActivityNum(n)}}}return t},getActivityNum:function(t){for(var e=0,i=0;i<t.cart.length;i++){var s=t.cart[i];0==s.isGift&&1==s.checked&&(e+=s.number)}return e},judgeStoreIsSel:function(t,e){for(var i=this.getCheckKey(e),s=0;s<t.activity.length;s++)for(var a=t.activity[s],r=0;r<a.cart.length;r++)if(!a.cart[r][i])return!1;for(var c=0;c<t.noActivityCart.length;c++)if(!t.noActivityCart[c][i])return!1;return!0},getItemAmount:function(t,e){var i=a.a.toDecimal2(t).split(".");return i.length>e?i[e]:"00"},getXZClass:function(t,e,i){return t?i?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray":e?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray"},getOccClass:function(t,e,i){return t?i?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray":e?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray"},setAllUnSel:function(t){for(var e=0;e<t.length;e++){var i=t[e];s.default.set(i,"dchecked",!1);for(var a=0;a<i.store.length;a++){var r=i.store[a];s.default.set(r,"dchecked",!1);for(var c=0;c<r.activity.length;c++)for(var n=r.activity[c],o=0;o<n.cart.length;o++){var l=n.cart[o];s.default.set(l,"dchecked",!1)}for(var u=0;u<r.noActivityCart.length;u++){var d=r.noActivityCart[u];s.default.set(d,"dchecked",!1)}}}return t},setOccSel:function(t,e){var i=this.getCheckKey(e);t[i]=!t[i];for(var s=0;s<t.store.length;s++){var a=t.store[s];this.setStoreSel(a,e,t[i])}},setStoreSel:function(t,e,i,s){var a=this.getCheckKey(e);null==i&&(i=!t[a]),t[a]=i;for(var r=0;r<t.activity.length;r++)for(var c=t.activity[r],n=0;n<c.cart.length;n++)c.cart[n][a]=i;for(var o=0;o<t.noActivityCart.length;o++)t.noActivityCart[o][a]=i;s&&this.resetOccurItem(s,e,i)},resetOccurItem:function(t,e,i){var s=this.getCheckKey(e),a=!0;if(i){for(var r=0;r<t.store.length;r++)if(!t.store[r][s]){a=!1;break}}else a=!1;t[s]=a},setCartSel:function(t,e,i,s){var a=this.getCheckKey(e);t[a]=!t[a];var r;r=!!t[a]&&this.judgeStoreIsSel(i,e),i[a]=r,this.resetOccurItem(s,e,r)},getPayNum:function(t,e){if(e)return 0;for(var i=this.getCheckKey(e),s=0,a=0;a<t.store.length;a++){for(var r=t.store[a],c=0;c<r.activity.length;c++)for(var n=r.activity[c],o=0;o<n.cart.length;o++){var l=n.cart[o];l[i]&&"0"==l.isGift&&(s+=l.number)}for(var u=0;u<r.noActivityCart.length;u++){var d=r.noActivityCart[u];d[i]&&(s+=d.number)}}return s},getCheckKey:function(t){return t?"dchecked":"checked"},getSelOccur:function(t,e,i){this.getCheckKey(e);for(var s=[],a=0;a<t.store.length;a++){var r=t.store[a],c=this.getSelStore(r,e,i);s=s.concat(c)}if("update"==i)for(var n=0;n<s.length;n++)s[n].checked=t.checked?0:1;return s},getSelStore:function(t,e,i){for(var s=this.getCheckKey(e),a=[],r=0;r<t.activity.length;r++)for(var c=t.activity[r],n=0;n<c.cart.length;n++){var o=c.cart[n];(o[s]||"update"==i)&&a.push(this.revertCartitemToDic(o,i,t))}for(var l=0;l<t.noActivityCart.length;l++){var u=t.noActivityCart[l];(u[s]||"update"==i)&&a.push(this.revertCartitemToDic(u,i,t))}return a},getInvalidArr:function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];e.push(this.revertCartitemToDic(s,"delete"))}return e},revertCartitemToDic:function(t,e,i){var s={};return"update"==e?(s={skuId:t.skuId,storeOuCode:t.storeOuCode,checked:i.checked?0:1,activityId:t.activityId,isGift:t.isGift},t.currentSelfActivity&&""!=t.currentSelfActivity&&t.currentSelfActivity.mktActivityId&&""!=t.currentSelfActivity.mktActivityId&&(s.selfActivityId=t.currentSelfActivity.mktActivityId)):"pay"==e?(s={id:t.id,skuId:t.skuId,storeOuCode:t.storeOuCode,number:t.number,activityId:t.activityId,checked:t.checked,isGift:t.isGift},t.currentSelfActivity&&""!=t.currentSelfActivity&&t.currentSelfActivity.mktActivityId&&""!=t.currentSelfActivity.mktActivityId&&(s.selfActivityId=t.currentSelfActivity.mktActivityId),null!=t.currentSelfActivity&&""==t.currentSelfActivity&&t.selfActivity&&""!=t.selfActivity&&t.selfActivity.length>0&&(s.selfActivityId="-2")):"delete"==e&&(s={skuId:t.skuId,storeOuCode:t.storeOuCode,isGift:t.isGift,activityId:t.activityId}),s},getActivityRightTitle:function(t){if(1==t.linkType||5==t.linkType||6==t.linkType)return"去凑单";if(2==t.linkType)return"再逛逛";if(3==t.linkType){for(var e=!1,i=0;i<t.cart.length;i++)if(1==t.cart[i].isGift){e=!0;break}return e?"重新领取":"领赠品"}if(4==t.linkType){for(var s=!1,a=0;a<t.cart.length;a++)if(2==t.cart[a].isGift){s=!0;break}return s?"重新领取":"去换购"}return"再逛逛"},getGiftIsOnlyScan:function(t){var e=!0;return 3!=t.linkType&&4!=t.linkType||(e=!1),e},getGiftType:function(t){var e=1;return 4!=t.linkType&&6!=t.linkType||(e=2),e}}),c=i("WQzh"),n=i("dqDD"),o={name:"cart-item",components:{CellSwipe:n.CellSwipe,PriceOrder:c.a},props:["cartitem","storeitem","occuritem","isEditing"],data:function(){return{cartJS:r,singleActivities_2:[],curSingleActivity:null}},methods:{getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},onClose:function(t,e){switch(t){case"left":case"cell":case"outside":e.close();break;case"right":this.$emit("deleteCart",[this.cartitem]),e.close()}},initSingleActivity:function(){if(this.singleActivities_2=[],this.cartitem.currentSelfActivity&&2==this.cartitem.currentSelfActivity.mktActivityPriceLevel?(this.curSingleActivity=this.cartitem,this.singleActivities_2.push(this.cartitem)):this.curSingleActivity=null,this.cartitem.selfActivity)for(var t=0;t<this.cartitem.selfActivity.length;t++){var e=this.cartitem.selfActivity[t];2==e.currentSelfActivity.mktActivityPriceLevel&&this.singleActivities_2.push(e)}},removeSingleActivity:function(){var t=this;this.$store.state.microSho.carts.forEach((function(e,i){t.cartitem.skuId!=e.skuId||(t.$store.state.microSho.carts[i].selfActivityId="-2")})),this.$emit("updateCart")},joinSingleActivity:function(t){var e=this;this.$store.state.microSho.carts.forEach((function(i,s){e.cartitem.skuId!=i.skuId||(e.$store.state.microSho.carts[s].selfActivityId=t.mktActivityId)})),this.$emit("updateCart")},reviseSingleActivity:function(){for(var t=this,e=[],i=0;i<this.singleActivities_2.length;i++){var s=this.singleActivities_2[i];e.push({mktActivityId:s.currentSelfActivity.mktActivityId,title:s.currentSelfActivity.mktActivityTitle+" "+s.digitalPrice+this.getDigitalDisplayName(s.acctType)+"+¥"+this.$util.toDecimal2(s.price),checked:s.currentSelfActivity.mktActivityId==this.curSingleActivity.currentSelfActivity.mktActivityId})}e.push({mktActivityId:"-2",title:"不参加兑换活动",checked:!1}),SalesPro.open({listData:e,sureFunc:function(e){var i=[{skuId:t.cartitem.skuId,storeOuCode:t.cartitem.storeOuCode,selfActivityId:e.mktActivityId}];t.$emit("updateCart",i)}})},deleteCartItem:function(){this.$emit("deleteCart",[this.cartitem])},enterGoodDetail:function(t){},setCartSel:function(t,e,i){this.$emit("setCartSel",t,e,i)},getActivityTitle:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityTitle}return""},getActivityTag:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityType}return""},getItemAmount:function(t,e){return r.getItemAmount(t,e)},reviseActivity:function(){for(var t=[],e=0;e<this.cartitem.activity.length;e++){var i=this.cartitem.activity[e],s=!1;this.cartitem.activityId==i.mktActivityId&&(s=!0),t.push({mktActivityId:i.mktActivityId,title:i.mktActivityTitle,checked:s})}SalesPro.open({listData:t,sureFunc:this.sureFunc})},sureFunc:function(t){var e=[{skuId:this.cartitem.skuId,storeOuCode:this.cartitem.storeOuCode,activityId:t.mktActivityId}];this.$emit("updateCart",e)},numChange:function(){this.$emit("numChange",this.cartitem)},getStateStr:function(){return 1==this.cartitem.state?"下架":4==this.cartitem.state?"无货":""},getFontColorClass:function(){return 1==this.cartitem.state||4==this.cartitem.state?"theme_font_gray_i":""}},created:function(){this.initSingleActivity()},watch:{cartitem:function(){this.initSingleActivity()}}},l=(i("/sdw"),i("KHd+")),u=Object(l.a)(o,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-swipe-cell",{staticClass:"cell-swipe",attrs:{"right-width":80,"on-close":t.onClose}},[i("div",{staticClass:"cart-item"},[i("div",{staticClass:"cart-item-sel"},[i("i",{directives:[{name:"show",rawName:"v-show",value:0==t.cartitem.isGift||t.isEditing,expression:"cartitem.isGift == 0 || isEditing "}],staticClass:"iconfont font-large",class:t.cartJS.getXZClass(t.isEditing,t.cartitem.checked,t.cartitem.dchecked),on:{click:function(e){return t.setCartSel(t.cartitem,t.storeitem,t.occuritem)}}})]),t._v(" "),i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img",class:{"img-samll":0!=t.cartitem.isGift}},[i("div",{staticClass:"click-div",on:{click:function(e){return e.stopPropagation(),t.enterGoodDetail(t.cartitem)}}}),t._v(" "),i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}}),t._v(" "),1==t.cartitem.state||4==t.cartitem.state?i("div",{staticClass:"cart-item-state theme_font_white"},[t._v("\n              "+t._s(t.getStateStr())+"\n            ")]):t._e()]),t._v(" "),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name line-two",class:t.getFontColorClass()},[1==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("赠品")]):t._e(),2==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("换购")]):t._e(),t._v("\n                "+t._s(t.cartitem.productName))]),t._v(" "),0==t.cartitem.isGift?i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))]):t._e(),t._v(" "),i("div",{staticClass:"good-paras"},[i("div",{staticClass:"paras-left"},[i("PriceOrder",{attrs:{productData:t.cartitem}})],1),t._v(" "),i("div",{staticClass:"paras-right"},[0==t.cartitem.isGift&&1!=t.cartitem.state&&4!=t.cartitem.state?i("van-stepper",{attrs:{min:t.cartitem.saleNumBegin,step:t.cartitem.saleNumStep,max:t.cartitem.saleNumMax,integer:""},on:{change:t.numChange},model:{value:t.cartitem.number,callback:function(e){t.$set(t.cartitem,"number",e)},expression:"cartitem.number"}}):t._e(),t._v(" "),0!=t.cartitem.isGift?i("span",{staticClass:"gift-num theme_font_gray"},[t._v("X"+t._s(t.cartitem.number))]):t._e()],1)])])])]),t._v(" "),t.singleActivities_2.length>0&&null!=t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityType))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(t.curSingleActivity.digitalPrice)+t._s(t.getDigitalDisplayName(t.curSingleActivity.acctType))+" + ¥"+t._s(t.$util.toDecimal2(t.curSingleActivity.price)))])]),t._v(" "),t.singleActivities_2.length>1?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseSingleActivity()}}},[t._v("修改")]):t._e(),t._v(" "),1==t.singleActivities_2.length?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.removeSingleActivity()}}},[t._v("不参加")]):t._e()]):t._e(),t._v(" "),t._l(t.singleActivities_2,(function(e){return t.singleActivities_2.length>0&&null==t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(e.currentSelfActivity.mktActivityType))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(e.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(e.digitalPrice)+t._s(t.getDigitalDisplayName(e.acctType))+" + ¥"+t._s(t.$util.toDecimal2(e.price)))])]),t._v(" "),i("p",{staticClass:"good-salespro-right",on:{click:function(i){return t.joinSingleActivity(e.currentSelfActivity)}}},[t._v("参加")])]):t._e()})),t._v(" "),t.cartitem.activity.length>1&&0==t.cartitem.isGift?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sl-tag theme_border_red_i theme_font_red"},[t._v(t._s(t.getActivityTag()))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.getActivityTitle()))]),t._v(" "),i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseActivity()}}},[t._v("修改")])]):t._e()],2)]),t._v(" "),i("div",{staticClass:"del-btn",attrs:{slot:"right"},slot:"right"},[t._v("删除")])])],1)}),[],!1,null,null,null).exports,d=(i("fqje"),Object(l.a)({name:"cart-item-invalid",components:{},props:["cartitem"],data:function(){return{}},methods:{},created:function(){}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-item-invalid"},[i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img"},[i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}})]),t._v(" "),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name double-line theme_font_gray"},[t._v(t._s(t.cartitem.productName))]),t._v(" "),i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))])])])])])])}),[],!1,null,"6604dac4",null).exports),h=i("H7qB"),v={name:"pay-div",props:["occuritem","isEditing"],components:{},data:function(){return{cartJS:r}},methods:{getTotalUnitStr:function(t){for(var e=this.$store.state.globalConfig.acctList,i=0;i<e.length;i++){var s=e[i];if(s.acctType==t)return s.displayName+"+"}return"积分+"},getTotalUsePoints:function(t){var e=0;return(t.fixedDigital>0||t.payDigital>0)&&(e=parseInt(t.fixedDigital)+parseInt(t.payDigital)),e},setOccSel:function(t){this.$emit("setOccSel",t)},toPay:function(t){this.$emit("toPay",t)},toDelete:function(t){this.$emit("toDelete",t)},getUnitStr:function(){var t=this.occuritem.fixedPoints,e=this.occuritem.amount;return t&&""!=t?0==e||""==e?"积分":"积分+￥":"￥"},getShowPrice:function(t,e){var i=this.occuritem.fixedPoints,s=this.occuritem.amount;return 0!=s&&""!=s||!i||""==i},getTotalStr:function(){var t="";return this.occuritem.fixedPoints&&""!=this.occuritem.fixedPoints&&(t+=this.occuritem.fixedPoints),t+=this.getUnitStr(),this.getShowPrice()&&(t+=this.occuritem.amount),t}},created:function(){}},m=(i("w81p"),Object(l.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pay-div"},[i("div",{staticClass:"pay-left"},[i("div",{staticClass:"selectAll",on:{click:function(e){return t.setOccSel(t.occuritem)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getXZClass(t.isEditing,t.occuritem.checked,t.occuritem.dchecked)}),t._v(" "),i("span",{staticClass:"font-medium marL theme_font_black"},[t._v("全选")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEditing,expression:"!isEditing"}],staticClass:"paymoney"},[i("div",[i("span",{staticClass:"theme_font_black font-large-x"},[t._v("合计:")]),t._v(" "),t._l(t.occuritem.digitalList,(function(e){return t.getTotalUsePoints(e)>0?i("div",{staticClass:"digital-div"},[i("span",{staticClass:"font-large-x theme_font_red"},[t._v(t._s(t.getTotalUsePoints(e)))]),t._v(" "),i("span",{staticClass:"font-small theme_font_red"},[t._v(t._s(t.getTotalUnitStr(e.acctType)))])]):t._e()})),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.getShowPrice(),expression:"getShowPrice()"}],staticClass:"font-large-x theme_font_red"},[t._v(t._s(t.cartJS.getItemAmount(t.occuritem.payAmount,0))+".")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.getShowPrice(),expression:"getShowPrice()"}],staticClass:"font-small theme_font_red"},[t._v(t._s(t.cartJS.getItemAmount(t.occuritem.payAmount,1)))])],2),t._v(" "),i("p",{staticClass:"point theme_font_black font-small"},[t._v("总额: ￥"+t._s(t.$util.toDecimal2(t.getTotalStr()))+"    优惠:\n        ￥"+t._s(t.$util.toDecimal2(t.occuritem.discountAmount)))])])]),t._v(" "),t.isEditing?t._e():i("div",{staticClass:"pay-right theme_font_white theme_standard_bg font-large-x",on:{click:function(e){return t.toPay(t.occuritem)}}},[t._v("\n    结算 "),i("span",{staticClass:"font-small"},[t._v("("+t._s(t.cartJS.getPayNum(t.occuritem,t.isEditing))+")")])]),t._v(" "),t.isEditing?i("div",{staticClass:"pay-right theme_font_white theme_standard_bg font-large-x",on:{click:function(e){return t.toDelete(t.occuritem)}}},[t._v("\n    删除\n  ")]):t._e()])}),[],!1,null,"3a870356",null).exports),f=i("L2JU"),g={name:"cart-list",components:{CartItem:u,PayDiv:m,InvalidCartItem:d},computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t})({},Object(f.c)(["getPutaggregate"])),props:["deliverType","isEditing"],data:function(){return{occurArr:[],invalidCart:[],cartJS:r,isHasRequest:!1,heightArr:[],fixedIndex:-1,showFirstBt:!0,microStoreCode:""}},methods:{clearInvalid:function(){var t=r.getInvalidArr(this.invalidCart);this.deleteCart(t)},toShop:function(t){},getCartRef:function(t){return"mall2cart"+t},goShopList:function(){var t="/mall2/list/"+this.$util.getDataString();this.$router.push({path:t,query:{lastPath:this.$route.path,delivertype:this.deliverType}})},coupon:function(t){var e=this;Coupon.open({initData:{listData:t.userCanGetCoupon,storeOuCode:t.storeOuCode,skuId:"",type:"receive",categoryId:"",token:this.$store.state.login.token},selectedCoupon:function(t){Coupon.close()},getedCoupon:function(t){},couponProducts:function(t){var i="/mall2/list/"+e.$util.getDataString();e.$router.push({path:i,query:{pageType:"coupon",coupon:t.couTypeCode,fromCart:"1",delivertype:e.deliverType,lastPath:e.$route.path,couFaceValue:t.couFaceValue,couThresholdAmount:t.couThresholdAmount,endTime:e.$util.getDateFromString(t.validEndDate)}}),Coupon.close()}})},rightActivityClick:function(t){var e="/mall2/list/"+this.$util.getDataString();this.$router.push({path:e,query:{pageType:"activity",activity:t.mktActivityId,fromCart:"1",delivertype:this.deliverType,skuId:t.cart[0].skuId,storeOuCode:t.cart[0].storeOuCode,lastPath:this.$route.path}})},sureFunc:function(t){var e=this;this.$Loading.open();var i={token:this.$store.state.login.token,carts:t,deliveryType:this.deliverType};this.$http.post("/app/json/app_cart/addCart",i).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.$store.state.mall2.cartNum=i.data,e.$Toast("添加购物车成功！")):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},setCartSel:function(t,e,i){var s=this;this.isEditing?r.setCartSel(t,this.isEditing,e,i):(this.$store.state.microSho.carts.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.carts[i].checked=s.$store.state.microSho.carts[i].checked?0:1)})),this.getDataList())},setStoreSel:function(t,e,i){var s=this;if(this.isEditing)r.setStoreSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.carts;(t.noActivityCart||[]).forEach((function(t,e){a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.carts[i].checked=s.$store.state.microSho.carts[i].checked?0:1)}))})),this.getDataList()}},setOccSel:function(t){var e=this;if(this.isEditing)r.setOccSel(t,this.isEditing);else{for(var i=[],s=0;s<t.store.length;s++){var a=t.store[s],c=this.getSelStore(a,!1);i=i.concat(c)}var n=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){n.forEach((function(s,a){s.skuId==i.skuId&&s.deliverType==e.deliverType&&(e.$store.state.microSho.groupbuyingCarts[a].checked=t.checked?0:1)}))})),this.getDataList()}},getSelStore:function(t,e){for(var i=[],s=0;s<t.noActivityCart.length;s++){var a=t.noActivityCart[s];i.push({checked:e?a.checked:a.checked?0:1,deliverType:a.deliverType,number:a.number,proSkuDistributionId:a.proSkuDistributionId,selfActivityId:a.selfActivityId,skuId:a.skuId,storeOuCode:a.storeOuCode})}return i},toPay:function(t){for(var e=this,i=this.$store.state.microSho.carts,s=[],a=0;a<t.store.length;a++){var c=t.store[a],n=this.getSelStore(c,!0);s=s.concat(n)}var o=[];if(s.forEach((function(t){t.checked&&(i.forEach((function(e){e.skuId==t.skuId&&(t.proSkuDistributionId=e.proSkuDistributionId,t.selfActivityId=e.selfActivityId)})),o.push(t))})),0!=o.length){var l={token:this.$store.state.login.token,deliveryType:this.deliverType,carts:o,microStoreCode:this.microStoreCode};if(2==this.deliverType){if(""==this.$store.state.mall2.selectAddress.id||"undefined"==this.$store.state.mall2.selectAddress.id)return void this.$Toast("请先选择配送区域！");"-1"!=this.$store.state.mall2.selectAddress.id?l.userAddressId=this.$store.state.mall2.selectAddress.id:(l.userAddress={},l.userAddress.provinceId=this.$store.state.mall2.selectAddress.provinceId,l.userAddress.provinceName=this.$store.state.mall2.selectAddress.provinceName,l.userAddress.cityId=this.$store.state.mall2.selectAddress.cityId,l.userAddress.cityName=this.$store.state.mall2.selectAddress.cityName,l.userAddress.countryId=this.$store.state.mall2.selectAddress.countryId,l.userAddress.countryName=this.$store.state.mall2.selectAddress.countryName,l.userAddress.townId=this.$store.state.mall2.selectAddress.townId,l.userAddress.townName=this.$store.state.mall2.selectAddress.townName)}this.setCommonPara(l),this.$Loading.open(),this.$http.post("/app/json/app_cart/SettleCart",l).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(console.log(222,i.data),e.occurArr=r.dealCartList(i.data.occur),e.isEditing&&r.setAllUnSel(e.occurArr),1==e.$mallCommon.isExistCanNotAttendActivity(i.data.occur)?e.$MessageBox.confirm("部分商品不能参加活动</br>将按原价购买，是否继续？","提示",{confirmButtonText:"确定"}).then((function(t){e.$router.push({name:"填写订单",params:{res:i.data,paramsData:l,deliveryType:e.deliverType}})})).catch((function(t){})):e.$router.push({name:"填写订单",params:{res:i.data,paramsData:l,deliveryType:e.deliverType}})):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))}else this.$Toast("请选择要结算的商品")},toDelete:function(t){var e=this,i=JSON.parse(JSON.stringify(this.$store.state.microSho.carts));(t.store||[]).forEach((function(t){t.noActivityCart.forEach((function(t){i.forEach((function(i,s){i.deliverType==e.deliverType&&t.skuId==i.skuId&&e.$store.state.microSho.carts.splice(s,1)}))}))})),this.getDataList()},setCommonPara:function(t){return 2==this.deliverType?(t.provinceId=this.$store.state.mall2.selectAddress.provinceId,t.cityId=this.$store.state.mall2.selectAddress.cityId,t.countryId=this.$store.state.mall2.selectAddress.countryId):1==this.deliverType&&(t.pickupId=this.$store.state.mall2.zitiAddress.id),!0},_initScroll:function(){var t=this;this.cityListScroll?(this.cityListScroll.refresh(),this.cityListScroll.off("scroll")):this.cityListScroll=new h.a(this.$refs.scrollwarp,{click:!0,probeType:3,bounce:!1});var e=this.$refs.scrollwarp.offsetHeight;if(1!=this.occurArr.length||""!=this.invalidCart){this.showFirstBt=!0;for(var i=0;i<this.occurArr.length;i++){var s=this.$refs[this.getCartRef(i)][0],a={top:s.offsetTop,height:s.offsetHeight,isFixed:!1};s.offsetHeight>e&&(a.isFixed=!0),this.heightArr.push(a)}this.cityListScroll.on("scroll",(function(i){if(i.y>5)t.fixedIndex=-1;else{var s=Math.abs(i.y);t.calculateFixedIndex(s,e)}})),this.calculateFixedIndex(0,e)}else{this.fixedIndex=0;var r=this.$refs[this.getCartRef(0)][0].offsetHeight;r<e&&(console.log(r,e),this.showFirstBt=!1)}},calculateFixedIndex:function(t,e){for(var i=!1,s=0;s<this.heightArr.length;s++){var a=this.heightArr[s],r=a.top,c=a.height,n=a.isFixed;if(t>=r&&t<=r+c){n&&t<=r+c-e&&(i=!0,this.fixedIndex=s);break}}i||(this.fixedIndex=-1)},_getCartCount:function(){var t=this,e={token:this.$store.state.login.token,deliveryType:this.deliverType};this.$http.post("/app/json/app_cart/getCartCount",e).then((function(e){var i=e.data;0==i.status?t.$store.state.mall2.cartNum=i.data:t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},numChange:function(t){var e=this;this.$store.state.microSho.carts.forEach((function(i,s){t.skuId!=i.skuId||(e.$store.state.microSho.carts[s].number=t.number)})),this.getDataList()},updateCart:function(){this.getDataList()},deleteCart:function(t){var e=this;t.length?(this.$store.state.microSho.carts.forEach((function(i,s){t[0].skuId!=i.skuId||e.$store.state.microSho.carts.splice(s,1)})),this.$Toast("删除成功"),this.getDataList()):this.$Toast("请选择要删除的商品")},getDataList:function(){var t=this,e=[];if(this.$store.state.microSho.carts.forEach((function(i){i.deliverType==t.deliverType&&e.push(i)})),e.length){this.$Loading.open();var i={token:this.$store.state.login.token,microStoreCode:this.microStoreCode,carts:e,deliveryType:this.deliverType};this.setCommonPara(i),this.$http.post("/app/json/app_cart/getCart",i).then((function(e){t.$Loading.close();var i=e.data;if(0==i.status){t.isHasRequest=!0,t.occurArr=r.dealCartList(i.data.occur),t.invalidCart=i.data.invalidCart?i.data.invalidCart:[];var s=t.$store.state.microSho.carts;t.invalidCart.forEach((function(e){s.forEach((function(i,s){e.skuId==i.skuId&&t.$store.state.microSho.carts.splice(s,1)}))})),t.isEditing&&r.setAllUnSel(t.occurArr),t.$nextTick((function(){}))}else t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}else this.isHasRequest=!0,this.occurArr=r.dealCartList([]),this.invalidCart=[]}},watch:{isEditing:function(t,e){t&&this.occurArr&&(this.occurArr=r.setAllUnSel(this.occurArr))}},mounted:function(){},created:function(){this.microStoreCode=this.$route.query.microStoreCode?this.$route.query.microStoreCode:"",console.log(1,this.$route.query.lastPath),this.getDataList()},beforeDestroy:function(){}},p=(i("Cqik"),Object(l.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-list"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.occurArr.length||t.invalidCart.length,expression:"occurArr.length || invalidCart.length"}],ref:"scrollwarp",staticClass:"cart-content"},[t._l(t.occurArr,(function(e,s){return i("div",{ref:t.getCartRef(s),refInFor:!0,staticClass:"occur-div theme_bg_white"},[i("div",{staticClass:"occur-title theme_font_white theme_bg_ml_red",on:{click:function(i){return t.setOccSel(e)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getOccClass(t.isEditing,e.checked,e.dchecked)}),t._v(" "),i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" "+t._s(e.ouName))])]),t._v(" "),t._l(e.store,(function(s,a){return i("div",{staticClass:"store-div"},[i("div",{staticClass:"store-title"},[i("div",{staticClass:"leftcontent"},[i("i",{staticClass:"iconfont font-large-x",class:t.cartJS.getXZClass(t.isEditing,s.checked,s.dchecked),on:{click:function(i){return t.setStoreSel(s,void 0,e)}}}),t._v(" "),i("span",{on:{click:function(e){return t.toShop(s)}}},[i("i",{staticClass:"iconfont mall-dianpu font-large-x"}),t._v(" "+t._s(s.storeName))])])]),t._v(" "),t._l(s.activity,(function(a,r){return i("div",{staticClass:"store-content"},[i("div",{staticClass:"activity-title"},[i("div",{staticClass:"leftcontent single-line"},[i("span",{staticClass:"ac-tag theme_font_white theme_bg_red"},[t._v(t._s(a.mktActivityType))]),t._v(" "),i("span",{staticClass:"ac-title theme_font_gray  marL single-line"},[t._v(t._s(a.activityDiscountDesc))])]),t._v(" "),t.cartJS.getActivityRightTitle(a)?i("div",{staticClass:"rightcontent",on:{click:function(e){return t.rightActivityClick(a)}}},[i("span",{staticClass:"theme_font_red"},[t._v(t._s(t.cartJS.getActivityRightTitle(a)))]),t._v(" "),i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_red font-large marL"})]):t._e()]),t._v(" "),i("div",{staticClass:"activity-content"},t._l(a.cart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])})),t._v(" "),i("div",{staticClass:"store-content marT10"},[i("div",{staticClass:"activity-content"},t._l(s.noActivityCart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])],2)})),t._v(" "),i("PayDiv",{directives:[{name:"show",rawName:"v-show",value:t.showFirstBt,expression:"showFirstBt"}],attrs:{occuritem:e,isEditing:t.isEditing},on:{setOccSel:t.setOccSel,toPay:t.toPay,toDelete:t.toDelete}})],2)})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.invalidCart&&t.invalidCart.length,expression:"invalidCart && invalidCart.length"}],staticClass:"occur-div  theme_bg_white"},[i("div",{staticClass:"occur-title title-between theme_font_white theme_bg_ml_red"},[t._m(0),t._v(" "),i("span",{staticClass:"theme_font_tint flotr",on:{click:function(e){return e.stopPropagation(),t.clearInvalid(e)}}},[t._v("清除所有")])]),t._v(" "),i("div",{staticClass:"invalid-content"},t._l(t.invalidCart,(function(t,e){return i("InvalidCartItem",{key:e,attrs:{cartitem:t}})})),1)])],2),t._v(" "),t.occurArr.length||t.invalidCart.length||!t.isHasRequest?t._e():i("div",{staticClass:"nodata-content"},[t._m(1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"theme_font_black"},[e("i",{staticClass:"iconfont mall-shoukuanfang"}),this._v(" 失效的宝贝")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"noCart"},[e("div",{staticClass:"noCartTag"},[e("i",{staticClass:"iconfont mall-gouwuche btn-icon theme_font_tint"}),this._v(" "),e("p",{staticClass:"text theme_font_tint"},[this._v("您的购物车是空的,去逛逛吧！")])])])}],!1,null,"73130ac0",null).exports),y={name:"cart-item",components:{CellSwipe:n.CellSwipe,PriceOrder:c.a},props:["cartitem","storeitem","occuritem","isEditing"],data:function(){return{cartJS:r,singleActivities_2:[],curSingleActivity:null}},methods:{getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},onClose:function(t,e){switch(t){case"left":case"cell":case"outside":e.close();break;case"right":this.$emit("deleteCart",[this.cartitem]),e.close()}},initSingleActivity:function(){if(this.singleActivities_2=[],this.cartitem.currentSelfActivity&&2==this.cartitem.currentSelfActivity.mktActivityPriceLevel?(this.curSingleActivity=this.cartitem,this.singleActivities_2.push(this.cartitem)):this.curSingleActivity=null,this.cartitem.selfActivity)for(var t=0;t<this.cartitem.selfActivity.length;t++){var e=this.cartitem.selfActivity[t];2==e.currentSelfActivity.mktActivityPriceLevel&&this.singleActivities_2.push(e)}},removeSingleActivity:function(){var t=this;this.$store.state.microSho.groupbuyingCarts.forEach((function(e,i){t.cartitem.skuId!=e.skuId||(t.$store.state.microSho.groupbuyingCarts[i].selfActivityId="-2")})),this.$emit("updateCart")},joinSingleActivity:function(t){var e=this;this.$store.state.microSho.groupbuyingCarts.forEach((function(i,s){e.cartitem.skuId!=i.skuId||(e.$store.state.microSho.groupbuyingCarts[s].selfActivityId=t.mktActivityId)})),this.$emit("updateCart")},reviseSingleActivity:function(){for(var t=this,e=[],i=0;i<this.singleActivities_2.length;i++){var s=this.singleActivities_2[i];e.push({mktActivityId:s.currentSelfActivity.mktActivityId,title:s.currentSelfActivity.mktActivityTitle+" "+s.digitalPrice+this.getDigitalDisplayName(s.acctType)+"+¥"+this.$util.toDecimal2(s.price),checked:s.currentSelfActivity.mktActivityId==this.curSingleActivity.currentSelfActivity.mktActivityId})}e.push({mktActivityId:"-2",title:"不参加兑换活动",checked:!1}),SalesPro.open({listData:e,sureFunc:function(e){var i=[{skuId:t.cartitem.skuId,storeOuCode:t.cartitem.storeOuCode,selfActivityId:e.mktActivityId}];t.$emit("updateCart",i)}})},deleteCartItem:function(){this.$emit("deleteCart",[this.cartitem])},enterGoodDetail:function(t){},setCartSel:function(t,e,i){this.$emit("setCartSel",t,e,i)},getActivityTitle:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityTitle}return""},getActivityTag:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityType}return""},getItemAmount:function(t,e){return r.getItemAmount(t,e)},reviseActivity:function(){for(var t=[],e=0;e<this.cartitem.activity.length;e++){var i=this.cartitem.activity[e],s=!1;this.cartitem.activityId==i.mktActivityId&&(s=!0),t.push({mktActivityId:i.mktActivityId,title:i.mktActivityTitle,checked:s})}SalesPro.open({listData:t,sureFunc:this.sureFunc})},sureFunc:function(t){var e=[{skuId:this.cartitem.skuId,storeOuCode:this.cartitem.storeOuCode,activityId:t.mktActivityId}];this.$emit("updateCart",e)},numChange:function(){this.$emit("numChange",this.cartitem)},getStateStr:function(){return 1==this.cartitem.state?"下架":4==this.cartitem.state?"无货":""},getFontColorClass:function(){return 1==this.cartitem.state||4==this.cartitem.state?"theme_font_gray_i":""}},created:function(){this.initSingleActivity()},watch:{cartitem:function(){this.initSingleActivity()}}},_=(i("Eakg"),{name:"cart-list",components:{CartItem:Object(l.a)(y,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-swipe-cell",{staticClass:"cell-swipe",attrs:{"right-width":80,"on-close":t.onClose}},[i("div",{staticClass:"cart-item"},[i("div",{staticClass:"cart-item-sel"},[i("i",{directives:[{name:"show",rawName:"v-show",value:0==t.cartitem.isGift||t.isEditing,expression:"cartitem.isGift == 0 || isEditing "}],staticClass:"iconfont font-large",class:t.cartJS.getXZClass(t.isEditing,t.cartitem.checked,t.cartitem.dchecked),on:{click:function(e){return t.setCartSel(t.cartitem,t.storeitem,t.occuritem)}}})]),t._v(" "),i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img",class:{"img-samll":0!=t.cartitem.isGift}},[i("div",{staticClass:"click-div",on:{click:function(e){return e.stopPropagation(),t.enterGoodDetail(t.cartitem)}}}),t._v(" "),i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}}),t._v(" "),1==t.cartitem.state||4==t.cartitem.state?i("div",{staticClass:"cart-item-state theme_font_white"},[t._v("\n              "+t._s(t.getStateStr())+"\n            ")]):t._e()]),t._v(" "),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name line-two",class:t.getFontColorClass()},[1==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("赠品")]):t._e(),2==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("换购")]):t._e(),t._v("\n                "+t._s(t.cartitem.productName))]),t._v(" "),0==t.cartitem.isGift?i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))]):t._e(),t._v(" "),i("div",{staticClass:"good-paras"},[i("div",{staticClass:"paras-left"},[i("PriceOrder",{attrs:{productData:t.cartitem}})],1),t._v(" "),i("div",{staticClass:"paras-right"},[0==t.cartitem.isGift&&1!=t.cartitem.state&&4!=t.cartitem.state?i("van-stepper",{attrs:{min:t.cartitem.saleNumBegin,step:t.cartitem.saleNumStep,max:t.cartitem.saleNumMax,integer:""},on:{change:t.numChange},model:{value:t.cartitem.number,callback:function(e){t.$set(t.cartitem,"number",e)},expression:"cartitem.number"}}):t._e(),t._v(" "),0!=t.cartitem.isGift?i("span",{staticClass:"gift-num theme_font_gray"},[t._v("X"+t._s(t.cartitem.number))]):t._e()],1)])])])]),t._v(" "),t.singleActivities_2.length>0&&null!=t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityType))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(t.curSingleActivity.digitalPrice)+t._s(t.getDigitalDisplayName(t.curSingleActivity.acctType))+" + ¥"+t._s(t.$util.toDecimal2(t.curSingleActivity.price)))])]),t._v(" "),t.singleActivities_2.length>1?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseSingleActivity()}}},[t._v("修改")]):t._e(),t._v(" "),1==t.singleActivities_2.length?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.removeSingleActivity()}}},[t._v("不参加")]):t._e()]):t._e(),t._v(" "),t._l(t.singleActivities_2,(function(e){return t.singleActivities_2.length>0&&null==t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(e.currentSelfActivity.mktActivityType))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(e.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(e.digitalPrice)+t._s(t.getDigitalDisplayName(e.acctType))+" + ¥"+t._s(t.$util.toDecimal2(e.price)))])]),t._v(" "),i("p",{staticClass:"good-salespro-right",on:{click:function(i){return t.joinSingleActivity(e.currentSelfActivity)}}},[t._v("参加")])]):t._e()})),t._v(" "),t.cartitem.activity.length>1&&0==t.cartitem.isGift?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sl-tag theme_border_red_i theme_font_red"},[t._v(t._s(t.getActivityTag()))]),t._v(" "),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.getActivityTitle()))]),t._v(" "),i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseActivity()}}},[t._v("修改")])]):t._e()],2)]),t._v(" "),i("div",{staticClass:"del-btn",attrs:{slot:"right"},slot:"right"},[t._v("删除")])])],1)}),[],!1,null,null,null).exports,PayDiv:m,InvalidCartItem:d},computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t})({},Object(f.c)(["getPutaggregate"])),props:["deliverType","isEditing"],data:function(){return{occurArr:[],invalidCart:[],cartJS:r,isHasRequest:!1,heightArr:[],fixedIndex:-1,showFirstBt:!0,microStoreCode:""}},methods:{clearInvalid:function(){var t=r.getInvalidArr(this.invalidCart);this.deleteCart(t)},toShop:function(t){},getCartRef:function(t){return"mall2cart"+t},goShopList:function(){var t="/mall2/list/"+this.$util.getDataString();this.$router.push({path:t,query:{lastPath:this.$route.path,delivertype:this.deliverType}})},coupon:function(t){var e=this;Coupon.open({initData:{listData:t.userCanGetCoupon,storeOuCode:t.storeOuCode,skuId:"",type:"receive",categoryId:"",token:this.$store.state.login.token},selectedCoupon:function(t){Coupon.close()},getedCoupon:function(t){},couponProducts:function(t){var i="/mall2/list/"+e.$util.getDataString();e.$router.push({path:i,query:{pageType:"coupon",coupon:t.couTypeCode,fromCart:"1",delivertype:e.deliverType,lastPath:e.$route.path,couFaceValue:t.couFaceValue,couThresholdAmount:t.couThresholdAmount,endTime:e.$util.getDateFromString(t.validEndDate)}}),Coupon.close()}})},rightActivityClick:function(t){var e="/mall2/list/"+this.$util.getDataString();this.$router.push({path:e,query:{pageType:"activity",activity:t.mktActivityId,fromCart:"1",delivertype:this.deliverType,skuId:t.cart[0].skuId,storeOuCode:t.cart[0].storeOuCode,lastPath:this.$route.path}})},sureFunc:function(t){var e=this;this.$Loading.open();var i={token:this.$store.state.login.token,carts:t,deliveryType:this.deliverType};this.$http.post("/app/json/app_cart/addCart",i).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.$store.state.mall2.cartNum=i.data,e.$Toast("添加购物车成功！")):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},setCartSel:function(t,e,i){var s=this;this.isEditing?r.setCartSel(t,this.isEditing,e,i):(this.$store.state.microSho.groupbuyingCarts.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.groupbuyingCarts[i].checked=s.$store.state.microSho.groupbuyingCarts[i].checked?0:1)})),this.getDataList())},setStoreSel:function(t,e,i){var s=this;if(this.isEditing)r.setStoreSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.groupbuyingCarts;(t.noActivityCart||[]).forEach((function(t,e){a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.groupbuyingCarts[i].checked=s.$store.state.microSho.groupbuyingCarts[i].checked?0:1)}))})),this.getDataList()}},setOccSel:function(t){var e=this;if(this.isEditing)r.setOccSel(t,this.isEditing);else{for(var i=[],s=0;s<t.store.length;s++){var a=t.store[s],c=this.getSelStore(a,!1);i=i.concat(c)}var n=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){n.forEach((function(s,a){s.skuId==i.skuId&&s.deliverType==e.deliverType&&(e.$store.state.microSho.groupbuyingCarts[a].checked=t.checked?0:1)}))})),this.getDataList()}},getSelStore:function(t,e){for(var i=[],s=0;s<t.noActivityCart.length;s++){var a=t.noActivityCart[s];i.push({checked:e?a.checked:a.checked?0:1,deliverType:a.deliverType,number:a.number,proSkuDistributionId:a.proSkuDistributionId,selfActivityId:a.selfActivityId,skuId:a.skuId,storeOuCode:a.storeOuCode})}return i},toPay:function(t){for(var e=this,i=this.$store.state.microSho.groupbuyingCarts,s=[],a=0;a<t.store.length;a++){var c=t.store[a],n=this.getSelStore(c,!0);s=s.concat(n)}var o=[];if(s.forEach((function(t){t.checked&&(i.forEach((function(e){e.skuId==t.skuId&&(t.proSkuDistributionId=e.proSkuDistributionId,t.selfActivityId=e.selfActivityId)})),o.push(t))})),0!=o.length){var l={token:this.$store.state.login.token,deliveryType:this.deliverType,carts:o,microStoreCode:this.microStoreCode};if(2==this.deliverType){if(""==this.$store.state.mall2.selectAddress.id||"undefined"==this.$store.state.mall2.selectAddress.id)return void this.$Toast("请先选择配送区域！");"-1"!=this.$store.state.mall2.selectAddress.id?l.userAddressId=this.$store.state.mall2.selectAddress.id:(l.userAddress={},l.userAddress.provinceId=this.$store.state.mall2.selectAddress.provinceId,l.userAddress.provinceName=this.$store.state.mall2.selectAddress.provinceName,l.userAddress.cityId=this.$store.state.mall2.selectAddress.cityId,l.userAddress.cityName=this.$store.state.mall2.selectAddress.cityName,l.userAddress.countryId=this.$store.state.mall2.selectAddress.countryId,l.userAddress.countryName=this.$store.state.mall2.selectAddress.countryName,l.userAddress.townId=this.$store.state.mall2.selectAddress.townId,l.userAddress.townName=this.$store.state.mall2.selectAddress.townName)}this.setCommonPara(l),this.$Loading.open(),this.$http.post("/app/json/app_purchase_order/settleCart",l).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(console.log(222,i.data),e.occurArr=r.dealCartList(i.data.occur),e.isEditing&&r.setAllUnSel(e.occurArr),1==e.$mallCommon.isExistCanNotAttendActivity(i.data.occur)?e.$MessageBox.confirm("部分商品不能参加活动</br>将按原价购买，是否继续？","提示",{confirmButtonText:"确定"}).then((function(t){e.$router.push({name:"企业团购下订单",params:{res:i.data,paramsData:l,deliveryType:e.deliverType}})})).catch((function(t){})):e.$router.push({name:"企业团购下订单",params:{res:i.data,paramsData:l,deliveryType:e.deliverType}})):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))}else this.$Toast("请选择要结算的商品")},toDelete:function(t){var e=this,i=JSON.parse(JSON.stringify(this.$store.state.microSho.groupbuyingCarts));(t.store||[]).forEach((function(t){t.noActivityCart.forEach((function(t){i.forEach((function(i,s){i.deliverType==e.deliverType&&t.skuId==i.skuId&&e.$store.state.microSho.groupbuyingCarts.splice(s,1)}))}))})),this.getDataList()},setCommonPara:function(t){return 2==this.deliverType?(t.provinceId=this.$store.state.mall2.selectAddress.provinceId,t.cityId=this.$store.state.mall2.selectAddress.cityId,t.countryId=this.$store.state.mall2.selectAddress.countryId):1==this.deliverType&&(t.pickupId=this.$store.state.mall2.zitiAddress.id),!0},_initScroll:function(){var t=this;this.cityListScroll?(this.cityListScroll.refresh(),this.cityListScroll.off("scroll")):this.cityListScroll=new h.a(this.$refs.scrollwarp,{click:!0,probeType:3,bounce:!1});var e=this.$refs.scrollwarp.offsetHeight;if(1!=this.occurArr.length||""!=this.invalidCart){this.showFirstBt=!0;for(var i=0;i<this.occurArr.length;i++){var s=this.$refs[this.getCartRef(i)][0],a={top:s.offsetTop,height:s.offsetHeight,isFixed:!1};s.offsetHeight>e&&(a.isFixed=!0),this.heightArr.push(a)}this.cityListScroll.on("scroll",(function(i){if(i.y>5)t.fixedIndex=-1;else{var s=Math.abs(i.y);t.calculateFixedIndex(s,e)}})),this.calculateFixedIndex(0,e)}else{this.fixedIndex=0;var r=this.$refs[this.getCartRef(0)][0].offsetHeight;r<e&&(console.log(r,e),this.showFirstBt=!1)}},calculateFixedIndex:function(t,e){for(var i=!1,s=0;s<this.heightArr.length;s++){var a=this.heightArr[s],r=a.top,c=a.height,n=a.isFixed;if(t>=r&&t<=r+c){n&&t<=r+c-e&&(i=!0,this.fixedIndex=s);break}}i||(this.fixedIndex=-1)},_getCartCount:function(){var t=this,e={token:this.$store.state.login.token,deliveryType:this.deliverType};this.$http.post("/app/json/app_cart/getCartCount",e).then((function(e){var i=e.data;0==i.status?t.$store.state.mall2.cartNum=i.data:t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},numChange:function(t){var e=this;this.$store.state.microSho.groupbuyingCarts.forEach((function(i,s){t.skuId!=i.skuId||(e.$store.state.microSho.groupbuyingCarts[s].number=t.number)})),this.getDataList()},updateCart:function(){this.getDataList()},deleteCart:function(t){var e=this;t.length?(this.$store.state.microSho.groupbuyingCarts.forEach((function(i,s){t[0].skuId!=i.skuId||e.$store.state.microSho.groupbuyingCarts.splice(s,1)})),this.$Toast("删除成功"),this.getDataList()):this.$Toast("请选择要删除的商品")},getDataList:function(){var t=this,e=[];if(this.$store.state.microSho.groupbuyingCarts.forEach((function(i){i.deliverType==t.deliverType&&e.push(i)})),e.length){this.$Loading.open();var i={token:this.$store.state.login.token,microStoreCode:this.microStoreCode,carts:e,deliveryType:this.deliverType};this.setCommonPara(i),this.$http.post("/app/json/app_purchase_order/getCart",i).then((function(e){t.$Loading.close();var i=e.data;if(0==i.status){t.isHasRequest=!0,t.occurArr=r.dealCartList(i.data.occur),t.invalidCart=i.data.invalidCart?i.data.invalidCart:[];var s=t.$store.state.microSho.groupbuyingCarts;t.invalidCart.forEach((function(e){s.forEach((function(i,s){e.skuId==i.skuId&&t.$store.state.microSho.groupbuyingCarts.splice(s,1)}))})),t.isEditing&&r.setAllUnSel(t.occurArr),t.$nextTick((function(){}))}else t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}else this.isHasRequest=!0,this.occurArr=r.dealCartList([]),this.invalidCart=[]}},watch:{isEditing:function(t,e){t&&this.occurArr&&(this.occurArr=r.setAllUnSel(this.occurArr))}},mounted:function(){},created:function(){this.microStoreCode=this.$route.query.microStoreCode?this.$route.query.microStoreCode:"",console.log(1,this.$route.query.lastPath),this.getDataList()},beforeDestroy:function(){}}),C=(i("hsxG"),Object(l.a)(_,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-list"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.occurArr.length||t.invalidCart.length,expression:"occurArr.length || invalidCart.length"}],ref:"scrollwarp",staticClass:"cart-content"},[i("div",[t._l(t.occurArr,(function(e,s){return i("div",{ref:t.getCartRef(s),refInFor:!0,staticClass:"occur-div theme_bg_white"},[i("div",{staticClass:"occur-title theme_font_white theme_bg_ml_red",on:{click:function(i){return t.setOccSel(e)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getOccClass(t.isEditing,e.checked,e.dchecked)}),t._v(" "),i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" "+t._s(e.ouName))])]),t._v(" "),t._l(e.store,(function(s,a){return i("div",{staticClass:"store-div"},[i("div",{staticClass:"store-title"},[i("div",{staticClass:"leftcontent"},[i("i",{staticClass:"iconfont font-large-x",class:t.cartJS.getXZClass(t.isEditing,s.checked,s.dchecked),on:{click:function(i){return t.setStoreSel(s,void 0,e)}}}),t._v(" "),i("span",{on:{click:function(e){return t.toShop(s)}}},[i("i",{staticClass:"iconfont mall-dianpu font-large-x"}),t._v(" "+t._s(s.storeName))])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:s.userCanGetCoupon&&s.userCanGetCoupon.length,expression:"storeitem.userCanGetCoupon && storeitem.userCanGetCoupon.length"}],staticClass:"rightcontent",on:{click:function(e){return t.coupon(s)}}},[i("span",[t._v("优惠券")]),t._v(" "),i("i",{staticClass:"iconfont mall-gengduo theme_font_gray font-large marL"})])]),t._v(" "),t._l(s.activity,(function(a,r){return i("div",{staticClass:"store-content"},[i("div",{staticClass:"activity-title"},[i("div",{staticClass:"leftcontent single-line"},[i("span",{staticClass:"ac-tag theme_font_white theme_bg_red"},[t._v(t._s(a.mktActivityType))]),t._v(" "),i("span",{staticClass:"ac-title theme_font_gray  marL single-line"},[t._v(t._s(a.activityDiscountDesc))])]),t._v(" "),t.cartJS.getActivityRightTitle(a)?i("div",{staticClass:"rightcontent",on:{click:function(e){return t.rightActivityClick(a)}}},[i("span",{staticClass:"theme_font_red"},[t._v(t._s(t.cartJS.getActivityRightTitle(a)))]),t._v(" "),i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_red font-large marL"})]):t._e()]),t._v(" "),i("div",{staticClass:"activity-content"},t._l(a.cart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])})),t._v(" "),i("div",{staticClass:"store-content marT10"},[i("div",{staticClass:"activity-content"},t._l(s.noActivityCart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])],2)})),t._v(" "),i("PayDiv",{directives:[{name:"show",rawName:"v-show",value:t.showFirstBt,expression:"showFirstBt"}],attrs:{occuritem:e,isEditing:t.isEditing},on:{setOccSel:t.setOccSel,toPay:t.toPay,toDelete:t.toDelete}})],2)})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.invalidCart&&t.invalidCart.length,expression:"invalidCart && invalidCart.length"}],staticClass:"occur-div  theme_bg_white"},[i("div",{staticClass:"occur-title title-between theme_font_white theme_bg_ml_red"},[t._m(0),t._v(" "),i("span",{staticClass:"theme_font_tint flotr",on:{click:function(e){return e.stopPropagation(),t.clearInvalid(e)}}},[t._v("清除所有")])]),t._v(" "),i("div",{staticClass:"invalid-content"},t._l(t.invalidCart,(function(t,e){return i("InvalidCartItem",{key:e,attrs:{cartitem:t}})})),1)])],2)]),t._v(" "),t.occurArr.length||t.invalidCart.length||!t.isHasRequest?t._e():i("div",{staticClass:"nodata-content"},[t._m(1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"theme_font_black"},[e("i",{staticClass:"iconfont mall-shoukuanfang"}),this._v(" 失效的宝贝")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"noCart"},[e("div",{staticClass:"noCartTag"},[e("i",{staticClass:"iconfont mall-gouwuche btn-icon theme_font_tint"}),this._v(" "),e("p",{staticClass:"text theme_font_tint"},[this._v("您的购物车是空的,去逛逛吧！")])])])}],!1,null,"44778954",null).exports),A=i("csf6"),k={name:"cart",components:{CartList:p,buyingCartList:C},props:{hasBack:{type:Boolean,default:!1},commonShow:{type:Boolean,default:!1}},data:function(){return{topArr:[],deliverType:null,isEditing:!1,peisongNum:0,zitiNum:0,dataIsLoad:!1,firstZiti:!0}},methods:{backEvent:function(){this.$router.go(-1),this.$keepaliveHelper.deleteCache(this)},setEdit:function(){this.isEditing=!this.isEditing},getAddressName:function(){var t=null;return 2==this.deliverType?t="":1==this.deliverType&&(t=""),t},chooseAddress:function(t){2==t?this.$router.push({path:"/mall2/addresslist"}):this.$router.push({path:"/mall2/mypickupaddress"})},deliverTypeEvent:function(t){console.log(t),2==t.type?(this.saveItemSel(t),this.getData()):1==t.type&&(1!=this.firstZiti||null!=this.$store.state.mall2.zitiAddress.id&&""!=this.$store.state.mall2.zitiAddress.id?(this.saveItemSel(t),this.getData()):this.chooseAddress(t.type),this.firstZiti=!1)},saveItemSel:function(t){t.hasShow=!0,this.deliverType=t.type,this.$store.state.mall2.staticDeliverType=this.deliverType,this.$bridgefunc.vuexStorage()},pageShow:function(){this.getData()},getData:function(){var t=this;if(1==this.deliverType)A.a.checkIsInitialLoad((function(e){if(e)t.getData();else{var i=t.getCartRef(t.deliverType);t.$nextTick((function(){t.$refs[i]&&t.$refs[i][0].getDataList()}))}}));else{var e=this.getCartRef(this.deliverType);this.$nextTick((function(){t.$refs[e]&&t.$refs[e][0].getDataList()}))}},getCartRef:function(t){return"cart"+t},getItemByType:function(t){for(var e=0;e<this.topArr.length;e++){var i=this.topArr[e];if(i.type==t)return i}return null},_getCartCount:function(t){var e=this,i={token:this.$store.state.login.token,deliveryType:t};this.$http.post("/app/json/app_cart/getCartCount",i).then((function(i){var s=i.data;0==s.status&&(1==t?e.zitiNum=s.data:e.peisongNum=s.data)}),(function(t){}))}},activated:function(){if(("/common"!=this.$route.path||this.commonShow)&&1==this.dataIsLoad){var t=this.getItemByType(this.deliverType);this.deliverTypeEvent(t)}},mounted:function(){var t=this;this.deliverType=this.$store.state.mall2.staticDeliverType;var e=this.getItemByType(this.deliverType);this.deliverTypeEvent(e),setTimeout((function(){t.dataIsLoad=!0}),500)},created:function(){this.topArr=r.getTopArr()}},S=(i("qaS1"),Object(l.a)(k,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart"},[i("nav-top",{attrs:{noTitle:!0},on:{backEvent:t.backEvent}},[i("div",{staticClass:"cart-top"},[i("div",{staticClass:"cart-title",on:{click:function(e){return t.chooseAddress(t.deliverType)}}},[i("span",{staticClass:"title theme_font_black"},[t._v("购物车")]),t._v(" "),i("span",{staticClass:"address theme_font_gray"},[t._v(t._s(t.getAddressName()))]),t._v(" "),i("i",{staticClass:"iconfont mall-dingwei theme_font_black"})])])]),t._v(" "),i("nav-content",[2==t.$store.state.webtype?i("div",{staticClass:"cart-top"},[i("div",{staticClass:"cart-title",on:{click:function(e){return t.chooseAddress(t.deliverType)}}},[i("span",{staticClass:"title theme_font_black"},[t._v("购物车")]),t._v(" "),i("span",{staticClass:"address theme_font_gray"},[t._v(t._s(t.getAddressName()))]),t._v(" "),i("i",{staticClass:"iconfont mall-dingwei theme_font_black"})])]):t._e(),t._v(" "),"1"!=t.$store.state.globalConfig.delivertype_default&&"2"!=t.$store.state.globalConfig.delivertype_default?i("div",{staticClass:"row"},t._l(t.topArr,(function(e,s){return i("div",{staticClass:"type-btn",class:{theme_light_bg:t.deliverType==e.type,theme_standard_bdr_i:t.deliverType==e.type},on:{click:function(i){return t.deliverTypeEvent(e)}}},[i("i",{staticClass:"iconfont  theme_font_common icon-size",class:[e.class,{theme_standard_font_i:t.deliverType==e.type}]}),t._v(" "),i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v(t._s(e.name))]),t._v(" "),t.peisongNum>0&&2==e.type?i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v("("+t._s(t.peisongNum)+")")]):t._e(),t._v(" "),t.zitiNum>0&&1==e.type?i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v("("+t._s(t.zitiNum)+")")]):t._e()])})),0):t._e(),t._v(" "),i("div",{class:{notop:"1"==t.$store.state.globalConfig.delivertype_default||"2"==t.$store.state.globalConfig.delivertype_default}},[i("p",{staticStyle:{margin:"10px","font-size":"15px"}},[t._v("普通商品")]),t._v(" "),t._l(t.topArr,(function(e,s){return e.hasShow?i("CartList",{directives:[{name:"show",rawName:"v-show",value:t.deliverType==e.type,expression:"deliverType == item.type"}],key:s,ref:t.getCartRef(e.type),refInFor:!0,attrs:{deliverType:e.type,isEditing:t.isEditing},on:{updateEdit:t.setEdit}}):t._e()})),t._v(" "),i("p",{staticStyle:{margin:"10px","font-size":"15px"}},[t._v("团购商品")]),t._v(" "),t._l(t.topArr,(function(e,s){return e.hasShow?i("buyingCartList",{directives:[{name:"show",rawName:"v-show",value:t.deliverType==e.type,expression:"deliverType == item.type"}],key:s+100,ref:t.getCartRef(e.type),refInFor:!0,attrs:{deliverType:e.type,isEditing:t.isEditing},on:{updateEdit:t.setEdit}}):t._e()}))],2)])],1)}),[],!1,null,"75a92b58",null));e.default=S.exports},"8q8K":function(t,e,i){},Cqik:function(t,e,i){"use strict";var s=i("HEyQ");i.n(s).a},Eakg:function(t,e,i){"use strict";var s=i("LR0P");i.n(s).a},GKC9:function(t,e,i){},HEyQ:function(t,e,i){},HaVa:function(t,e,i){},LR0P:function(t,e,i){},RAH5:function(t,e,i){},csf6:function(t,e,i){"use strict";var s=i("N4/4"),a=i("ZToj"),r=i("dRp0"),c=i("VQwz"),n=i("mfrH"),o=(i("ygAv"),{checkIsInitialLoad:function(t){"cnooc"!=a.a.state.globalConfig.app_home_special_flag?0==a.a.state.mall2.pickupAddressChecked?(a.a.state.mall2.pickupAddressChecked=!0,s.a.vuexStorage(),o.getLocation(t)):t(null):t()},getLocation:function(t){s.a.getLocation((function(e){e.city&&""!=e.city?(a.a.state.currentLocation.posx=e.longitude,a.a.state.currentLocation.posy=e.latitude,o.loadNeerPickupAddress(t)):t(null)}))},loadNeerPickupAddress:function(t){var e={posx:a.a.state.currentLocation.posx,posy:a.a.state.currentLocation.posy,page:{index:1,pageSize:1}};r.a.post("/app/json/user_address/searchSelfliftAddressList",e).then((function(e){var i=e.data;if(console.log("自提站点列表:",i),0==i.status)if(i.data&&i.data.length>0){var s=i.data[0];o.checkEqualAndDistance(s,t)}else t(null);else t(null)}),(function(e){t(null),console.log("自提站点",e)}))},checkEqualAndDistance:function(t,e){t.id!=a.a.state.mall2.zitiAddress.id&&t.distance<500?c.a.confirm("距离您最近的自提点是："+t.storeName+",是否切换到最近自提点","提示").then((function(i){console.log(i),o.reSelectPickupAddress(t,e)})).catch((function(t){e(null)})):e(null)},reSelectPickupAddress:function(t,e){a.a.state.mall2.zitiAddress=t,s.a.vuexStorage((function(){e(t)})),a.a.state.login.token&&""!=a.a.state.login.token&&(n.a._addToMyPickupAddress(t.id),n.a._setDefaultPickupAddress(t.id))}});e.a=o},fqje:function(t,e,i){"use strict";var s=i("8q8K");i.n(s).a},hsxG:function(t,e,i){"use strict";var s=i("GKC9");i.n(s).a},qaS1:function(t,e,i){"use strict";var s=i("vO2T");i.n(s).a},vO2T:function(t,e,i){},w81p:function(t,e,i){"use strict";var s=i("HaVa");i.n(s).a}}]);