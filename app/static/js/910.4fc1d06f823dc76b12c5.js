(window.webpackJsonp=window.webpackJsonp||[]).push([[910],{"7eU1":function(t,s,e){"use strict";function i(t){if(Array.isArray(t)){for(var s=0,e=Array(t.length);s<t.length;s++)e[s]=t[s];return e}return Array.from(t)}e.r(s);var a={name:"opened",mixins:[e("Osj4").a],props:{statusObj:{type:Object,default:function(){return{isEffect:!1}}},couponLayoutType:[String,Number]},data:function(){return{isToUse:!1,popupCancel:!1,activeNames:-1,isCanLoadMore:!1,equityArr:[],toUseObj:{},itemObj:{},cardPrompt:"",openAccess:[]}},beforeRouteLeave:function(t,s,e){this.$keepaliveHelper.deleteCache(this),e()},created:function(){this.getNewsList(),this.statusObj.isEffect?this.queryGetCouActivityAward():this.getVVGetCouMktList(),this.queryCanAttendActivity()},computed:{couponQrCodeEnabled:function(){return this.$store.state.globalConfig.couponQrCodeEnabled||1}},methods:{queryCanAttendActivity:function(){var t=this;this.$request.post(this.queryCanAttendActivityUrl,{orderType:999001}).then((function(s){0==s.status?(console.log(11,s),t.openAccess=s.data||[]):t.$Toast(s.info)}))},couListState:function(t){var s=!1;return t.forEach((function(t){-1==t.state||(s=!0)})),s},getNewsList:function(){var t=this;this.$request.post(this.getNewsListUrl,{values:25}).then((function(s){0==s.status?t.cardPrompt=s.data[0]?s.data[0].content:"":t.$Toast(s.info)}))},getVVGetCouMktList:function(){var t=this;this.$request.post(this.getVVGetCouMktListUrl,{activityTag:"VV"}).then((function(s){0==s.status?t.equityArr=s.data:t.$Toast(s.info)}))},queryGetCouActivityAward:function(){var t=this;this.$request.post(this.queryGetCouActivityAwardUrl,{alias:"VV"}).then((function(s){if(0==s.status){var e=s.data[0];t.equityArr=e?e.activityModelList:[]}else t.$Toast(s.info)}))},receive:function(t){var s=this;this.$request.post(this.getCouScanUrl,{mktActivityId:t.mktActivityId}).then((function(t){0==t.status?1!=t.data.state?(s.$Toast("领取成功"),s.queryGetCouActivityAward()):s.$Toast("领取失败"):s.$Toast(t.info)}))},changeCollapse:function(t){var s=this;this.activeNames=t;var e=this.equityArr[t];e&&(this.equityArr.forEach((function(t,e){s.$set(s.equityArr[e],"arr",[])})),(e.couList||[]).forEach((function(t){s.getData({mktActivityId:e.mktActivityId,couTypeCode:t.couTypeCode},s.activeNames)})))},getData:function(t,s){this.getUnusedCouponsWithCols(t,s),this.getUsedCoupons(t,s)},getUnusedCouponsWithCols:function(t,s){var e=this;this.$request.post(this.getUnusedCouponsWithColsUrl,t).then((function(t){0==t.status?((t.data||[]).forEach((function(t){1!=t.isActive&&""!=t.isActive||e.$set(t,"mayUse",!0)})),e.equityArr.forEach((function(a,o){var n;s==o&&(e.equityArr[o].arr=[],(n=e.equityArr[o].arr).push.apply(n,i(t.data||[])))}))):e.$Toast(t.info)}))},getUsedCoupons:function(t,s,e){var a=this;this.$request.post(this.getUsedCouponsUrl,t).then((function(t){(t.data||[]).forEach((function(t){1!=t.isActive&&""!=t.isActive||a.$set(t,"mayUse",!1)})),0==t.status?a.equityArr.forEach((function(e,o){var n;s==o&&(n=a.equityArr[o].arr).push.apply(n,i(t.data||[]))})):a.$Toast(t.info)}))},cancelConfirm:function(){var t=this;this.$request.post(this.cancelTwoVMemberUrl,{phone:this.userInfo.phone}).then((function(s){0==s.status?(t.popupCancel=!1,t.$Toast("取消成功"),t.checkTwoVMemmber()):t.$Toast(s.info)}))},toUse:function(t){if(this.toUseObj=t,"SC"===t.couTypeCategoryAlias){var s="/mall2/list/"+this.$util.getDataString();this.$router.push({path:s,query:{pageType:"coupon",coupon:t.couTypeCode,couThresholdAmount:t.couThresholdAmount,couFaceValue:t.couFaceValue,lastPath:this.$route.path,endTime:this.$util.getDateFromString(t.validEndDate)}})}else"DSFJK"===t.couTypeCategoryAlias?this.isToUse=!0:3==this.couponQrCodeEnabled?this.$router.push({path:"/addCard",query:{couNo:t.couNo}}):2==this.couponLayoutType?this.$router.push({path:"/coupon_detail2",query:{couTypeCode:t.couTypeCode,couFaceValue:t.couFaceValue}}):this.$router.push({path:"/coupon_detail",query:{couNo:t.couNo}})},toUseConfirm:function(){this.couNo()},couNo:function(){var t=this;this.$request.post(this.getMyCouInfoUrl,{couNo:this.toUseObj.couNo||""}).then((function(s){0==s.status?t.dynamicCode(s.data.dynamicCode||""):t.$Toast(s.info)}))},dynamicCode:function(t){var s=this;this.$request.post(this.useVVCouUrl,{dynamicCode:t}).then((function(t){0==t.status?(s.isToUse=!1,s.$Toast("充值成功"),s.activeNames=-1,s.queryGetCouActivityAward()):s.$Toast(t.info)}))}},components:{Scroll:function(){return Promise.all([e.e(0),e.e(55)]).then(e.bind(null,"u6Q6"))}}},o=(e("KpEb"),e("KHd+")),n=Object(o.a)(a,(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("nav-content",[e("div",{staticClass:"contentImg"},[e("div",{staticClass:"contentImgUserInfo"},[e("div",{staticClass:"userInfoImg"},[e("img",{attrs:{src:t.userInfo.headImg||"static/image/double-v-membership/头像@2x.png",alt:""}})]),t._v(" "),e("div",{staticClass:"userInfoText"},[e("span",[t._v(t._s(t.userInfo.userName))]),t._v(" "),2!=t.statusObj.state&&0==t.statusObj.isEffect?e("span",[t._v("待生效")]):t._e(),t._v(" "),2!=t.statusObj.state&&1==t.statusObj.isEffect?e("span",{on:{click:function(s){t.popupCancel=!0}}},[t._v("取消会员")]):t._e(),t._v(" "),2==t.statusObj.state?e("span",[t._v("会员")]):t._e()])]),t._v(" "),e("div",{staticClass:"contentImgBottom"},[e("span"),t._v(" "),e("span",[t._v(t._s((new Date).getFullYear()+"年"+((new Date).getMonth()+1)+"月会员特权"))])])]),t._v(" "),e("div",{staticClass:"list"},[e("scroll",{attrs:{pullUpLoad:!0,listenScroll:!0,data:t.equityArr,hasMore:t.isCanLoadMore}},[e("van-collapse",{attrs:{accordion:""},on:{change:t.changeCollapse},model:{value:t.activeNames,callback:function(s){t.activeNames=s},expression:"activeNames"}},[t._l(t.openAccess,(function(s,i){return e("div",{key:i,staticClass:"equity"},[e("div",{staticClass:"mark"},[e("span",{staticClass:"text"},[t._v(t._s("特权"+t.turnNumber[i+1]))])]),t._v(" "),e("div",{staticClass:"equity-details"},[e("div",{staticClass:"equity-details-left"},[e("span",[t._v(t._s(s.activityTitle))]),t._v(" "),e("div",{staticClass:"content",domProps:{innerHTML:t._s(s.activityDesc)}})]),t._v(" "),t.statusObj.isEffect?e("div",{staticClass:"equity-details-right"},[e("img",{attrs:{src:"static/image/double-v-membership/icon1@2x.png",alt:""}})]):t._e()])])})),t._v(" "),t._l(t.equityArr,(function(s,i){return e("div",{key:"equityArr"+i,staticClass:"equity"},[e("div",{staticClass:"mark"},[e("span",{staticClass:"text"},[t._v(t._s("特权"+t.turnNumber[i+1+t.openAccess.length]))])]),t._v(" "),e("div",{staticClass:"equity-details",class:{detailsBottom:0==i}},[e("div",{staticClass:"equity-details-left"},[e("span",[t._v(t._s(t.statusObj.isEffect?s.mktActivityTitle:s.activityTitle))]),t._v(" "),t.statusObj.isEffect?e("div",{staticClass:"content",domProps:{innerHTML:t._s(s.mktActivityDesc)}}):e("div",{staticClass:"content",domProps:{innerHTML:t._s(s.activityDesc)}})]),t._v(" "),t.statusObj.isEffect?e("div",{staticClass:"equity-details-right"},[t.couListState(s.couList)?e("span",{staticClass:"btn",on:{click:function(e){return t.receive(s)}}},[t._v("领取")]):e("img",{attrs:{src:"static/image/double-v-membership/icon1@2x.png",alt:""}})]):t._e()]),t._v(" "),t.statusObj.isEffect&&!t.couListState(s.couList)?e("van-collapse-item",{attrs:{name:i}},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.activeNames===i?"权益详情 （仅限当月使用）":"点击可查看权益详情"))]),t._v(" "),t._l(s.arr,(function(s,i){return e("div",{key:i,staticClass:"equity-details details-list"},[e("div",{staticClass:"equity-details-left"},[e("span",[t._v(t._s(s.couTypeTitle))])]),t._v(" "),e("div",{staticClass:"equity-details-right"},[1==s.isActive||""===s.isActive?[s.mayUse?e("span",{staticClass:"btn",on:{click:function(e){return t.toUse(s)}}},[t._v("去使用")]):e("img",{attrs:{src:"static/image/double-v-membership/icon3@2x.png",alt:""}})]:[e("img",{attrs:{src:"static/image/double-v-membership/icon2@2x.png",alt:""}})]],2)])}))],2):t._e()],1)}))],2),t._v(" "),e("div",{staticClass:"explain"},[e("p",[t._v("活动说明")]),t._v(" "),e("div",{staticClass:"content",domProps:{innerHTML:t._s(t.cardPrompt)}})])],1)],1),t._v(" "),e("van-popup",{staticClass:"popupCard",attrs:{"close-on-click-overlay":!1},model:{value:t.popupCancel,callback:function(s){t.popupCancel=s},expression:"popupCancel"}},[e("div",{staticClass:"popupCardText"},[e("span",[t._v("确认取消双V会员吗？")]),t._v(" "),e("span",[t._v("取消后次月起不再享有会员特权，")]),t._v(" "),e("span",[t._v("也不再扣费！")])]),t._v(" "),e("div",{staticClass:"popupCardBtn"},[e("span",{on:{click:function(s){t.popupCancel=!1}}},[t._v("取消")]),t._v(" "),e("span",{on:{click:t.cancelConfirm}},[t._v("确认")])])]),t._v(" "),e("van-popup",{staticClass:"popupCard",attrs:{"close-on-click-overlay":!1},model:{value:t.isToUse,callback:function(s){t.isToUse=s},expression:"isToUse"}},[e("div",{staticClass:"popupCardText"},[e("span",[t._v("确认使用该券，")]),t._v(" "),e("span",[t._v("充值到 "+t._s(t.replacePhone(t.userInfo.phone))+" 的手机号码吗？")])]),t._v(" "),e("div",{staticClass:"popupCardBtn"},[e("span",{on:{click:function(s){t.isToUse=!1}}},[t._v("取消")]),t._v(" "),e("span",{on:{click:t.toUseConfirm}},[t._v("确认")])])])],1)}),[],!1,null,"42288889",null);s.default=n.exports},KpEb:function(t,s,e){"use strict";var i=e("ei4f");e.n(i).a},ei4f:function(t,s,e){}}]);