(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{EdN2:function(t,e,s){"use strict";var o=s("Z0LT");s.n(o).a},Z0LT:function(t,e,s){},jgsS:function(t,e,s){"use strict";s.r(e);var o=s("ANbv"),n=s("2TyV"),i=s("u6Q6"),a=s("L2JU"),u={name:"",data:function(){return{appcouponTotal:0,couponMenuListIndex:0,couponMenuList:[{title:"APP优惠券",type:"app"},{title:this.$store.state.globalConfig.crmcoupons_title||"便利店优惠券",type:"crm"}],noGetCoupon:"",showActivateModel:!1,dynamicCode:"",hasGetData:!1,couponTypeList:[],couponList:[],menuList:[],page:0,rows:10,hasMore:!0,loading:!1,scrollY:0,_scrollY:0,isFirstEnter:!0,curType:"",curCateAlias:"quanbu",isGroupCoupon:!1,unusedValue:"",flags:!1,position:{x:0,y:0},nx:"",ny:"",dx:"",dy:"",xPum:"",yPum:"",couponsView:!1,crmUrl:"",hasBtmBtn:!0}},mounted:function(){this.loadIndex(),this.getCouTypeCateCnt()},created:function(){this.noGetCoupon=this.$store.state.globalConfig.coupon_list_no_get_coupon||"",1==this.$store.state.globalConfig.hideCouponListBtmBtn?this.hasBtmBtn=!1:this.hasBtmBtn=!0},activated:function(){this.isFirstEnter||this.backScroll()},beforeRouteLeave:function(t,e,s){this._scrollY=this.scrollY,s()},computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o])}return t})({disabled:function(){return"getUsedCoupons"===this.curType||"getExpiredCoupons"===this.curType}},Object(a.c)(["vipUnitUser"])),methods:{couponHandle:function(t,e){var s=this;this.couponMenuListIndex=e,"crm"==t.type&&this.$request.post("/app/json/home/getExoLoginUrl",{token:this.$store.state.login.token,sysTag:"crm",vipUnitUserCode:this.vipUnitUser.vipUnitUserId}).then((function(t){0===t.status?(s.crmUrl=t.data||"",s.$bridgefunc.customPush({path:s.crmUrl,isnativetop:"1"})):s.$Toast(t.info)}))},resetCoupon:function(){this.reset(),this.getMyCouponCnt(),this.getCouTypeCateCnt()},scanCodeFunc:function(){var t=this;this.$bridgefunc.scanCode((function(e){t.dynamicCode=e.code,t.activateHandler()}))},backEvent:function(){"subject"==this.$route.query.type?this.$router.push({path:"/questionlist"}):"serviceSubject"==this.$route.query.type?this.$router.push({path:"/service/questionlist"}):"equity_car"==this.$route.query.type?this.$router.push({path:"/equity_card/equityList"}):this.$router.go(-1)},tocoupons:function(){this.$router.push({path:"/user_center/shareList"})},closeBtn:function(){this.couponsView=!1},down:function(){var t;this.flags=!0,t=event.touches?event.touches[0]:event,this.position.x=t.clientX,this.position.y=t.clientY,this.dx=moveDiv.offsetLeft,this.dy=moveDiv.offsetTop},move:function(){if(this.flags){var t;t=event.touches?event.touches[0]:event,this.nx=t.clientX-this.position.x,this.ny=t.clientY-this.position.y,this.xPum=this.dx+this.nx,this.yPum=this.dy+this.ny;var e=document.body.clientWidth-this.$refs.moved.offsetWidth,s=document.body.clientHeight-this.$refs.moved.offsetHeight;this.xPum<0&&(this.xPum=0),this.yPum<0&&(this.yPum=0),this.xPum>e&&(this.xPum=e),this.yPum>s&&(this.yPum=s),moveDiv.style.left=this.xPum+"px",moveDiv.style.top=this.yPum+"px",document.addEventListener("touchmove",(function(t){t.stopPropagation()}),!1)}},end:function(){this.flags=!1},loadIndex:function(){var t=this,e=this;this.$http.post("/app/json/fission_activity/getShareUsedCoupons",{}).then((function(t){"success"===t.data.result&&(t.data.data||[]).length>0&&(e.couponsView=!0)}),(function(e){t.$Toast(res.data.info)}))},pageInit:function(){var t=this;this.getMyCouponCnt().then((function(e){t.getCouTypeCateCnt(),t.loadMore(),t.isFirstEnter=!1}))},backScroll:function(){var t,e=this;return(t=regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.page,e.rows=s*e.rows,e.page=0,e.couponList=[],t.next=6,e.getMyCouponCnt();case 6:return t.next=8,e.loadMore(!0);case 8:e.getCouTypeCateCnt(),e.$nextTick((function(){e.$refs.scroll.scrollTo(0,e._scrollY)})),e.rows=10,e.page=s;case 12:case"end":return t.stop()}}),t,e)})),function(){var e=t.apply(this,arguments);return new Promise((function(t,s){return function o(n,i){try{var a=e[n](i),u=a.value}catch(t){return void s(t)}if(!a.done)return Promise.resolve(u).then((function(t){o("next",t)}),(function(t){o("throw",t)}));t(u)}("next")}))})()},scroll:function(t){this.scrollY=t.y},chooseHandler:function(t){t!==this.curType&&(this.$refs.scroll&&this.$refs.scroll.scrollTo(0,0),this.curType=t,this.reset())},subMenuHandler:function(t){t!==this.curCateAlias&&(this.$refs.scroll&&this.$refs.scroll.scrollTo(0,0),this.curCateAlias=t,this.reset())},reset:function(){this.$refs.scroll.closePullUp(),this.hasMore=!0,this.hasGetData=!1,this.page=0,this.couponList=[],this.loadMore(!0)},loadMore:function(t){var e=this;if(!this.loading){this.$Loading.open(),this.page++,this.loading=!0;var s={page:this.page,rows:this.rows};return this.curType===this.unusedValue&&this.curCateAlias&&"quanbu"!=this.curCateAlias&&(s.couTypeCategoryAlias=this.curCateAlias),this.$http.post("/app/json/coupon/"+this.curType,s).then((function(s){var o=s.data;if(0==o.status){var n=o.data||[];n.map((function(t){return t.dpedData=e.$mallCommon.priceFromItem(t),t.linePrice=e.$util.toDecimal2(t.dpedData.linePrice),t})),e.couponList=e.couponList.concat(n),e.curType===e.unusedValue&&e.curCateAlias&&"quanbu"!=e.curCateAlias?e.couponTypeList.find((function(t){return t.cateAlias===e.curCateAlias})).cateCnt:e.menuList.find((function(t){return t.url===e.curType})).num,e.couponList.length>=o.totalRecords&&(e.hasMore=!1)}e.loading=!1,e.hasGetData=!0,t&&e.$refs.scroll.openPullUp(),e.$Loading.close()}))}},getMyCouponCnt:function(){var t=this;return new Promise((function(e,s){t.$Loading.open(),t.$http.post("/app/json/coupon/getMyCouponCnt",{}).then((function(s){var o=s.data;if(0==o.status){var n=o.data||{},i=[];for(var a in n){var u={};switch(a){case"unusednum":u={name:"未使用",num:n[a],url:t.unusedValue,sort:0},i.push(u);break;case"usednum":u={name:"已使用",num:n[a],url:"getUsedCoupons",sort:1},i.push(u);break;case"expnum":u={name:"已过期",num:n[a],url:"getExpiredCoupons",sort:2},i.push(u)}}i=i.sort((function(t,e){return t.sort-e.sort})),console.log("menuList",i),t.menuList=i,e()}t.$Loading.close()}))}))},getCouTypeCateCnt:function(){var t=this;this.$Loading.open(),this.$http.post("/app/json/coupon/getCouTypeCateCnt",{state:20}).then((function(e){var s=e.data;if(0==s.status){for(var o=s.data.cateCntModels||[],n=0,i=0;i<o.length;i++)n+=o[i].cateCnt||0;o.unshift({cateName:"全部",cateCnt:n,cateAlias:"quanbu"}),t.couponTypeList=o,t.appcouponTotal=n}t.$Loading.close()}))},deleteCoupon:function(t){var e=this;this.$Loading.open();var s={couNo:t.couNo};this.$http.post("/app/json/coupon/delCoupons",s).then((function(t){var s=t.data;0==s.status?(e.$toast("删除成功！"),e.getMyCouponCnt(),e.reset()):e.$toast(s.info||"删除失败！"),e.$Loading.close()})).catch((function(t){e.$toast(t||"删除异常！"),e.$Loading.close()}))},activateHandler:function(){var t=this;this.dynamicCode?this.$http.post("/app/json/coupon/corpUserActivateCou",{dynamicCode:this.dynamicCode}).then((function(e){var s=e.data;0==s.status?(t.$toast("激活成功！"),t.getMyCouponCnt(),t.reset()):t.$toast(s.info||"激活失败！"),t.dynamicCode="",t.showActivateModel=!1})):this.$toast("请输入激活码！")}},watch:{$route:{handler:function(t,e){!this.isFirstEnter||"/coupon_list2"!==t.path&&"/coupon_list"!==t.path||(this.isGroupCoupon="/coupon_list2"===t.path,this.unusedValue=this.isGroupCoupon?"getUnusedCouponsGroup":"getUnusedCouponsWithCols",this.curType=this.unusedValue,this.pageInit())},immediate:!0}},components:{Coupon:n.a,HorizontalScroll:o.a,Scroll:i.default}},c=(s("EdN2"),s("KHd+")),r=Object(c.a)(u,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"coupon-list"},[o("nav-top",{attrs:{title:"优惠券"},on:{backEvent:t.backEvent}},[1!=t.$store.state.globalConfig.appCouponListActBtnDisabled?o("span",{staticClass:"activate-btn",on:{click:function(e){t.showActivateModel=!0}}},[t._v("激活")]):t._e()]),t._v(" "),t.menuList.length?o("nav-content",{staticClass:"coupon-center"},[1==t.$store.state.globalConfig.app_crm_coupon_enable&&7!=t.$store.state.webtype?o("ul",{staticClass:"coupon-menu"},t._l(t.couponMenuList,(function(e,s){return o("li",{key:s,class:t.couponMenuListIndex==s?"active":"",on:{click:function(o){return t.couponHandle(e,s)}}},[t._v(t._s(e.title)),"app"==e.type?o("span",[t._v("("+t._s(t.appcouponTotal)+")")]):t._e()])})),0):t._e(),t._v(" "),0==t.couponMenuListIndex?o("div",{staticClass:"coupon-content"},[o("ul",{staticClass:"menu-list"},t._l(t.menuList,(function(e,s){return o("li",{key:s,staticClass:"menu-item",class:{active:t.curType===e.url},on:{click:function(s){return t.chooseHandler(e.url)}}},[o("span",{staticClass:"text theme_standard_bdr_i",class:{theme_standard_font_i:t.curType===e.url}},[t._v(t._s(e.name)+"（"+t._s(e.num)+"）")])])})),0),t._v(" "),o("ul",{directives:[{name:"show",rawName:"v-show",value:t.curType===t.unusedValue,expression:"curType === unusedValue"}],staticClass:"sub-menu-list"},[o("horizontal-scroll",{attrs:{dataList:t.couponTypeList}},t._l(t.couponTypeList,(function(e,s){return o("li",{staticClass:"sub-menu-item",class:{active:t.curCateAlias===e.cateAlias},on:{click:function(s){return t.subMenuHandler(e.cateAlias)}}},[o("span",{staticClass:"text",class:{"theme_standard_bdr_i theme_standard_font_i theme_light_bg_i":t.curCateAlias===e.cateAlias}},[t._v(t._s(e.cateName)+"("+t._s(e.cateCnt)+")")])])})),0)],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.hasGetData,expression:"hasGetData"}],staticClass:"coupon-list-wrapper",class:{"no-padding":!t.hasBtmBtn}},[o("scroll",{ref:"scroll",staticClass:"coupon-list-scroll",attrs:{listenScroll:!0,"probe-type":3,hasMore:t.hasMore,pullUpLoad:!0,data:t.couponList,pullDownRefresh:!0},on:{scroll:t.scroll,pullingUp:t.loadMore,pullingDown:t.reset}},["getExpiredCoupons"===t.curType?[t._l(t.couponList,(function(e,s){return[o("van-swipe-cell",{attrs:{"right-width":65}},[o("coupon",{staticClass:"coupon-item",attrs:{couponLayoutType:t.isGroupCoupon?2:1,disabled:t.disabled,used:"getUsedCoupons"===t.curType,item:e,index:s}}),t._v(" "),o("div",{staticClass:"delete theme_bg_red",attrs:{slot:"right"},on:{click:function(s){return t.deleteCoupon(e)}},slot:"right"},[o("span",{staticClass:"text"},[t._v("删除")])])],1)]}))]:t._l(t.couponList,(function(e,s){return o("coupon",{key:s,staticClass:"coupon-item",attrs:{couponLayoutType:t.isGroupCoupon?2:1,disabled:t.disabled,used:"getUsedCoupons"===t.curType,item:e,index:s},on:{load:t.resetCoupon}})}))],2),t._v(" "),t.couponList.length?t._e():o("div",{staticClass:"no-coupon-wrapper"},[o("img",{staticClass:"img",attrs:{src:s("IjqJ"),alt:""}}),t._v(" "),o("p",{staticClass:"title theme_font_tint"},[t._v("没有券？")]),t._v(" "),o("p",{staticClass:"sub-title theme_font_tint"},[t._v("去领券中心看看吧")])]),t._v(" "),t.disabled?o("div",{staticClass:"tip"},[t._v("以上是近期"+t._s("getExpiredCoupons"==t.curType?"已过期":"已使用")+"的优惠券")]):t._e()],1),t._v(" "),t.hasBtmBtn?o("div",{staticClass:"footer-btn"},[""==t.noGetCoupon?o("router-link",{staticClass:"btn",attrs:{to:"/get_coupon"}},[t._v("领更多好券")]):t._e(),t._v(" "),o("router-link",{staticClass:"btn",attrs:{to:"/coupon_market"}},[t._v("积分换券")])],1):t._e()]):o("div",{staticClass:"coupon-content"})]):t._e(),t._v(" "),o("van-popup",{model:{value:t.showActivateModel,callback:function(e){t.showActivateModel=e},expression:"showActivateModel"}},[o("div",{staticClass:"activate-model"},[o("div",{staticClass:"title"},[t._v("激活码")]),t._v(" "),o("div",{staticClass:"content"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.dynamicCode,expression:"dynamicCode"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入激活码"},domProps:{value:t.dynamicCode},on:{input:function(e){e.target.composing||(t.dynamicCode=e.target.value)}}}),t._v(" "),o("span",{staticStyle:{"margin-left":"10px"},on:{click:t.scanCodeFunc}},[o("img",{staticClass:"see-icon",attrs:{src:"static/image/setting/icon-scan.png"}})])]),t._v(" "),o("div",{staticClass:"btn theme_standard_bg theme_standard_font",staticStyle:{"margin-left":"0","margin-top":"15px"},on:{click:t.activateHandler}},[t._v("激活\n      ")])])]),t._v(" "),t.couponsView?o("div",{ref:"moved",staticClass:"xuanfu",attrs:{id:"moveDiv"},on:{mousedown:t.down,touchstart:t.down,mousemove:function(e){return e.preventDefault(),t.move(e)},touchmove:function(e){return e.preventDefault(),t.move(e)},mouseup:t.end,touchend:t.end}},[o("img",{staticClass:"imgt1",attrs:{src:s("4tAI"),alt:""},on:{click:t.tocoupons}}),t._v(" "),o("img",{staticClass:"imgt2",attrs:{src:s("dAF6"),alt:""},on:{click:t.closeBtn}})]):t._e()],1)}),[],!1,null,"c341ad32",null);e.default=r.exports}}]);