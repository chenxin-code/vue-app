(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bda385f6","chunk-90808508"],{1148:function(t,e,a){"use strict";var i=a("a691"),s=a("1d80");t.exports=function(t){var e=String(s(this)),a="",o=i(t);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(a+=e);return a}},1726:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"agreement-content"},[a("div",{staticClass:"content",domProps:{innerHTML:t._s(t.agreementContent)}})])},s=[],o={name:"agreement-content",components:{},props:["value","noloading"],data:function(){return{agreementContent:""}},methods:{getAgreement:function(){var t,e,a=this;"true"!=this.noloading&&this.$Loading.open(),18==this.value?(t="/app/json/news/getNewsList",e={values:52}):(t="/app/json/news/getList",e={token:this.$store.state.login.token,value:this.value}),this.$http.post(t,e).then((function(t){"true"!=a.noloading&&a.$Loading.close();var e=t.data,i=e.data;if(i&&""!=i){var s=i[0];a.agreementContent=s.content}}),(function(t){"true"!=a.noloading&&a.$Loading.close(),a.$Toast("请求数据失败！")}))}},mounted:function(){this.getAgreement()},created:function(){}},r=o,n=(a("ad60"),a("0c7c")),c=Object(n["a"])(r,i,s,!1,null,"9f41190a",null);e["a"]=c.exports},"17c5":function(t,e,a){},1868:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"agreement theme_bg_white"},[a("nav-top",{attrs:{title:t.topTitle},on:{backEvent:t.backEvent}}),a("nav-content",[a("div",{staticClass:"content"},[a("AgreementContent",{attrs:{value:t.value}})],1)])],1)},s=[],o=a("1726"),r={name:"agreement",components:{AgreementContent:o["a"]},props:["propsValue"],data:function(){return{value:"",topTitle:"协议"}},methods:{backEvent:function(){this.propsValue?this.$emit("backEvent"):this.$router.go(-1)}},created:function(){this.value=this.$route.query.value?this.$route.query.value:3,this.topTitle="协议",this.propsValue&&(this.value=this.propsValue),3!=this.$store.state.webtype&&(9==this.value?(this.topTitle="发票须知",document.title="发票须知"):10==this.value?(this.topTitle="积分规则",document.title="积分规则"):11==this.value?(this.topTitle="积分使用规则",document.title="积分使用规则"):17==this.value?(this.topTitle="用户协议",document.title="用户协议"):18==this.value?(this.topTitle="捐赠协议",document.title="捐赠协议"):63==this.value?(this.topTitle="隐私协议",document.title="隐私协议"):(65==this.value||80==this.value)&&(this.topTitle="使用规则",document.title="使用规则"))}},n=r,c=(a("be46"),a("0c7c")),l=Object(c["a"])(n,i,s,!1,null,"34da5652",null);e["default"]=l.exports},"20d1":function(t,e,a){"use strict";a("8e02")},"408a":function(t,e,a){var i=a("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=i(t))throw TypeError("Incorrect invocation");return+t}},"52b1":function(t,e,a){},"8e02":function(t,e,a){},ad60:function(t,e,a){"use strict";a("52b1")},b680:function(t,e,a){"use strict";var i=a("23e7"),s=a("a691"),o=a("408a"),r=a("1148"),n=a("d039"),c=1..toFixed,l=Math.floor,u=function(t,e,a){return 0===e?a:e%2===1?u(t,e-1,a*t):u(t*t,e/2,a)},p=function(t){var e=0,a=t;while(a>=4096)e+=12,a/=4096;while(a>=2)e+=1,a/=2;return e},h=function(t,e,a){var i=-1,s=a;while(++i<6)s+=e*t[i],t[i]=s%1e7,s=l(s/1e7)},d=function(t,e){var a=6,i=0;while(--a>=0)i+=t[a],t[a]=l(i/e),i=i%e*1e7},v=function(t){var e=6,a="";while(--e>=0)if(""!==a||0===e||0!==t[e]){var i=String(t[e]);a=""===a?i:a+r.call("0",7-i.length)+i}return a},m=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n((function(){c.call({})}));i({target:"Number",proto:!0,forced:m},{toFixed:function(t){var e,a,i,n,c=o(this),l=s(t),m=[0,0,0,0,0,0],f="",g="0";if(l<0||l>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(f="-",c=-c),c>1e-21)if(e=p(c*u(2,69,1))-69,a=e<0?c*u(2,-e,1):c/u(2,e,1),a*=4503599627370496,e=52-e,e>0){h(m,0,a),i=l;while(i>=7)h(m,1e7,0),i-=7;h(m,u(10,i,1),0),i=e-1;while(i>=23)d(m,1<<23),i-=23;d(m,1<<i),h(m,1,1),d(m,2),g=v(m)}else h(m,0,a),h(m,1<<-e,0),g=v(m)+r.call("0",l);return l>0?(n=g.length,g=f+(n<=l?"0."+r.call("0",l-n)+g:g.slice(0,n-l)+"."+g.slice(n-l))):g=f+g,g}})},be46:function(t,e,a){"use strict";a("17c5")},d0a0:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"placeorder mall2"},[t.noNavTop?t._e():a("nav-top",{on:{backEvent:function(e){return t.$router.go(-1)}}}),t.complete?a("nav-content",{style:t.getContentTop()},[a("div",{staticClass:"flex-div"},[a("div",{staticClass:"scroll-div"},[1==t.deliveryType&&1==t.occurData.needAddress?a("div",{staticClass:"block-div no-padding-bottom"},[a("div",{on:{click:t.toSelectZitiAddress}},[a("div",{staticClass:"pickup-shop"},[a("div",{staticStyle:{flex:"1"}},[a("div",{staticClass:"flex-row"},[a("div",{staticClass:"name theme_font_black"},[t._v(" 自提店铺："+t._s(t.$route.params.paramsData.storeName)+" ")])]),a("div",{staticClass:"flex-row"},[a("div",{staticClass:"full theme_font_tint font-small",staticStyle:{"line-height":"1.4"}},[t._v(" "+t._s(t.$route.params.paramsData.storeAddress)+" ")])])]),a("div",[a("i",{staticClass:"iconfont mall-gengduojiantou theme_font_tint icon-font"})])])]),a("div",{staticClass:"colorfulline"},[a("img",{attrs:{src:"static/image/mall2/colorfulline.png"}})])]):t._e(),a("div",{staticClass:"block-div"},[a("div",{staticClass:"flex-row",on:{click:t.payWayShow}},[a("div",{staticClass:"label-middle theme_font_common"},[t._v("支付方式")]),a("div",{staticClass:"full"}),a("div",{staticClass:"theme_font_common right-margin"},[t._v(t._s(t.payWayText))]),a("div",[a("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])])]),2==t.pageType?a("div",{staticClass:"block-div"},[a("div",{staticClass:"flex-row",on:{click:t.contratWayShow}},[a("div",{staticClass:"label-middle theme_font_common",staticStyle:{width:"100px"}},[t._v("预约单联系方式")]),a("div",{staticClass:"full"}),a("div",{staticClass:"theme_font_common right-margin"},[t._v(t._s(t.contratWayText))]),a("div",[a("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])]),"选择联系方式"!=t.contratWayText?a("div",{},[a("van-cell",{attrs:{title:"姓名：",value:t.selectItem.realName}}),a("van-cell",{attrs:{title:"联系电话：",value:t.selectItem.userName}})],1):t._e()]):t._e(),t._l(t.occurData.store,(function(e){return a("div",{staticClass:"block-div"},[a("div",{staticClass:"flex-row"},[a("div",{staticClass:"name"},[t._v(t._s(e.storeName))])]),1==e.storeProData.num?a("div",[t._l(e.storeProData.proArr,(function(e){return a("div",{staticClass:"pro-row"},[a("div",{staticClass:"img-div"},[a("img",{attrs:{src:e.phPictureUrl}})]),a("div",{staticClass:"info-div"},[a("div",{staticClass:"title theme_font_black"},[t._v(t._s(e.productName))]),a("div",{staticClass:"title theme_font_black"},[a("span",[t._v(t._s(e.specs))])]),a("div",{staticClass:"price"},[a("PriceOrder",{attrs:{productData:e}}),"wish"==t.$route.query.entryType?a("van-stepper",{staticClass:"wish-prod-stepper",attrs:{max:t.$route.params.wishProdInfo.saleNumMax,min:t.$route.params.wishProdInfo.saleNumBegin,step:t.$route.params.wishProdInfo.saleNumStep,integer:""},model:{value:e.number,callback:function(a){t.$set(e,"number",a)},expression:"prodata.number"}}):a("span",{staticStyle:{float:"right"}},[t._v("x "+t._s(e.number))])],1)])])})),a("div",{staticClass:"service"},[a("div",{staticClass:"title"},[t._v("保障服务")]),t._l(e.storeProData.serviceArr,(function(e){return a("div",{staticClass:"service-row line_top",on:{click:function(a){return t.toServiceEvent(e)}}},[a("div",{staticClass:"name single-line"},[t._v(t._s(e.productName))]),a("div",{staticClass:"price"},[t._v("¥"+t._s(t.$util.toDecimal2(e.price))+" x "+t._s(e.number)+" "),a("i",{staticClass:"iconfont mall-gengduojiantou"})])])}))],2)],2):t._e(),e.storeProData.num>1?a("div",{on:{click:function(a){return t.showProsDetailEvent(e)}}},[a("div",{staticClass:"pros-row"},[a("div",{staticClass:"pros-msg"},[a("span",[t._v("共"+t._s(e.storeProData.proNum)+"件")]),a("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})]),t._l(e.storeProData.proArr,(function(e,i){return i<3?a("div",{staticClass:"img-div"},[a("img",{attrs:{src:e.phPictureUrl}})]):t._e()}))],2)]):t._e(),a("div",{staticClass:"flex-row"},[a("div",{staticClass:"label-middle theme_font_common"},[t._v("备注")]),a("div",{staticClass:"full"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"store.remark"}],staticClass:"row-input theme_font_common",attrs:{placeholder:"请留下您想说的话"},domProps:{value:e.remark},on:{input:function(a){a.target.composing||t.$set(e,"remark",a.target.value)}}})])])])})),(!t.cardType||t.cardType&&551==t.cardType)&&"false"!=t.$store.state.globalConfig.invoice_shopping_enable&&1!=t.paramsData.orderCategory?a("div",{staticClass:"block-div"},[a("div",{staticClass:"flex-row"},[a("div",{staticClass:"title full theme_font_common"},[t._v("发票")]),a("div",{staticClass:"swith",on:{click:t.useInvoiceEvent}},[t.useInvoice?a("img",{attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),t.useInvoice?t._e():a("img",{attrs:{src:"static/image/mall2/switch-off.png"}})])]),t.useInvoice?a("div",{staticClass:"flex-row",on:{click:t.changeInvoice}},[a("div",{staticClass:"label-middle theme_font_common"},[t._v("发票信息")]),a("div",{staticClass:"full"}),a("div",{staticClass:"theme_font_black right-margin",class:{theme_font_tint:""==t.invoiceInfo}},[t._v(" "+t._s(""!=t.invoiceInfo?t.invoiceInfo:"请编辑发票信息")+" ")]),a("div",[a("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])]):t._e()]):t._e(),(!t.cardType||t.cardType&&551==t.cardType)&&1!=t.paramsData.orderCategory&&"wish"!==t.$route.query.entryType?a("div",{staticClass:"block-div"},[a("div",{staticClass:"flex-row",on:{click:t.couponEvent}},[a("div",{staticClass:"label-middle theme_font_common"},[t._v("优惠券")]),a("div",{staticClass:"full"}),t.lastRes.occur?a("div",{staticClass:"theme_font_black right-margin"},[t._v("优惠"+t._s(t.$util.toDecimal2(t.occurData.couponAmount))+"元 ")]):t._e(),a("div",[a("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])]),t._l(t.occurData.digitalList,(function(e){return"LimitWallet"!=e.acctType?a("div",[0!=e.deductionState?a("div",{staticClass:"flex-row"},[a("div",{staticClass:"label-middle theme_font_common"},[t._v(t._s(t.getDigitalDisplayName(e.acctType)))]),a("div",{staticClass:"full"}),e.userCanUseDigital>0?a("div",{staticClass:"right-margin"},[t._v(" 共"+t._s(e.userBalanceDigital)+"，可用"+t._s(e.userCanUseDigital)+"，抵￥"+t._s(t.$util.toDecimal2(e.userCanUseDigitalAmount))+"元 ")]):t._e(),e.userCanUseDigital<=0?a("div",{staticClass:"right-margin"},[t._v("共"+t._s(e.userBalanceDigital)+"，"+t._s(t.getCanNotUseStr(e.deductionState))+"，不能使用 ")]):t._e(),a("div",{staticClass:"swith",on:{click:function(a){return t.useDigitalEvent(e)}}},[e.payDigital>e.fixedDigital?a("img",{attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),e.payDigital<=e.fixedDigital?a("img",{attrs:{src:"static/image/mall2/switch-off.png"}}):t._e()])]):t._e()]):t._e()}))],2):t._e()],2),a("div",{staticClass:"bottom-btns"},[2==t.deliveryType&&1==t.occurData.needAddress?a("div",{staticClass:"tip theme_bg_yl theme_standard_font theme_light_bg"},[t._v(t._s(t.$store.state.mall2.selectAddress.addressFull)+" ")]):t._e(),"songli"==t.buyType?a("div",{staticClass:"btn theme_standard_bg theme_font_white",on:{click:t.checkProductStock}},[t._v(" 提交礼单 ")]):a("div",{staticClass:"btn theme_standard_bg theme_font_white",on:{click:t.checkProductStock}},[t._v("提交订单")]),a("div",{staticClass:"price"},[Object.keys(t.occurData).length?a("div",{staticClass:"rmb-div"},[a("span",{staticClass:"theme_font_red"},[t._v("￥")]),a("span",{staticClass:"left-no-space price-big theme_font_red"},[t._v(t._s(t.getTotalPriceDuan(0)))]),a("span",{staticClass:"theme_font_red"},[t._v("."+t._s(t.getTotalPriceDuan(1)))]),t._l(t.occurData.digitalList,(function(e,i){return t.$mallCommon.getTotalUsePoints(e)>0?a("div",{staticClass:"digital-div"},[i!=t.$mallCommon.getFirstVartualIndex(t.occurData)||t.$mallCommon.getOccurShowPrice(t.occurData)?a("span",{staticClass:"price-big theme_font_red"},[t._v("+")]):t._e(),a("span",{staticClass:"price-big theme_font_red"},[t._v(t._s(t.$mallCommon.getTotalUsePoints(e)))]),a("span",{staticClass:"theme_font_red"},[t._v(t._s(t.$mallCommon.getTotalUnitStr(e.acctType)))])]):t._e()}))],2):t._e()])])])]):t._e(),t.payWayPopShow?a("pop-view",{on:{closeEvent:t.popClose}},[a("div",{staticClass:"pop-body"},[a("div",{staticClass:"pop-title theme_font_common"},[t._v("请选择支付方式")]),a("div",{staticClass:"items-div pop-scroll-div"},t._l(t.payWays,(function(e){return a("div",{staticClass:"item theme_font_common theme_bg_white_ef",class:{theme_light_bg:t.payWaySelected==e.tag,theme_standard_font_i:t.payWaySelected==e.tag,theme_standard_bdr_i:t.payWaySelected==e.tag},on:{click:function(a){return t.payWayEvent(e)}}},[t._v(t._s(e.text)+" ")])})),0),a("div",{staticClass:"bottom-btn theme_font_white theme_standard_bg bottom-space",on:{click:t.popSureEvent}},[t._v("确定 ")])])]):t._e(),t.showProsDetail?a("pop-view",{on:{closeEvent:function(e){t.showProsDetail=!1}}},[a("div",{staticClass:"pop-body"},[a("div",{staticClass:"pop-title theme_font_common"},[t._v("商品明细")]),a("div",{staticClass:"pop-scroll-div"},[t._l(t.currentStore.storeProData.proArr,(function(e){return a("div",{staticClass:"pro-row"},[a("div",{staticClass:"img-div"},[a("img",{attrs:{src:e.phPictureUrl}})]),a("div",{staticClass:"info-div"},[a("div",{staticClass:"title-min theme_font_black"},[t._v(t._s(e.productName))]),a("div",{staticClass:"title-min theme_font_gray"},[a("span",{staticClass:"font-small"},[t._v(t._s(e.specs))])]),a("div",{staticClass:"price"},[a("PriceOrder",{attrs:{productData:e}}),a("span",{staticStyle:{float:"right"}},[t._v("x "+t._s(e.number))])],1)])])})),a("div",{staticClass:"service"},[a("div",{staticClass:"title"},[t._v("保障服务")]),t._l(t.currentStore.storeProData.serviceArr,(function(e){return a("div",{staticClass:"service-row line_top",on:{click:function(a){return t.toServiceEvent(e)}}},[a("div",{staticClass:"name single-line"},[t._v(t._s(e.productName))]),a("div",{staticClass:"price"},[t._v("¥"+t._s(t.$util.toDecimal2(e.price))+" x "+t._s(e.number)+" "),a("i",{staticClass:"iconfont mall-gengduojiantou"})])])}))],2)],2)])]):t._e(),a("mt-datetime-picker",{ref:"dateDom",attrs:{type:"date",startDate:new Date,endDate:t.getEndDate(),"year-format":"{value} 年","month-format":"{value} 月","date-format":"{value} 日"},model:{value:t.pickupTime,callback:function(e){t.pickupTime=e},expression:"pickupTime"}}),t.showAgreement?a("Agreement",{attrs:{propsValue:9},on:{backEvent:function(e){t.showAgreement=!1}}}):t._e(),t.showPointsRule?a("Agreement",{attrs:{propsValue:11},on:{backEvent:function(e){t.showPointsRule=!1}}}):t._e()],1)},s=[],o=(a("e17f"),a("2241")),r=(a("e7e5"),a("d399")),n=a("5530"),c=(a("a9e3"),a("0d03"),a("e25e"),a("c975"),a("ac1f"),a("1276"),a("4160"),a("159b"),a("b0c0"),a("acd8"),a("b680"),a("99af"),a("5319"),a("662b")),l=a("5edf"),u=a("41ca"),p=a("b695"),h=a("efff"),d=a("590c"),v=a("1868"),m=a("19e7"),f={name:"placeorder",components:{PriceOrder:d["a"],Agreement:v["default"]},data:function(){return{contactFlag:!1,contratWayList:[],paramsData:{},payWays:[{text:"在线支付",tag:"1"},{text:"货到付款",tag:"0"},{text:"提货付款",tag:"0"}],payWays1:[{text:"在线支付",tag:"1"},{text:"货到付款",tag:"0"},{text:"提货付款",tag:"1"}],contratWayText:"选择联系方式",payWaySelected:1,payWayText:"在线支付",payWayPopShow:!1,contratWayPopShow:!1,usePoints:!1,payDigitals:[],useInvoice:!1,lastRes:{},pointsGain:0,occurData:{},usedCoupons:[],invoiceData:null,invoiceInfo:"",currentInvoice:{},proImgArr:[],showProsDetail:!1,pickupPhone:this.$store.state.userInfo.phone,pickupTime:"",currentStore:{},isFirst:!0,referrer:"",canEditReferrer:!0,scanCode:"",showAgreement:!1,showPointsRule:!1,digitalPWD:"",dictByAlias:[],easyCardId:"",cardBalance:"",showYjPayInfo:!1,cardType:"",showYJChange:!1,radio:1,radio1:0,cardList:[],cardDetails:"",userCanUseDigital:"",cardAmount:"",limitType:"",deliveryType:"",complete:!1,backReloadCoupon:!1,pickUpEndTime:"",hasShengxian:!1,selectItem:{},pageType:null,payWayPopShow1:!1,overFlag:!1,wishData:{payNiceName:"",payMsg:""},buyType:"",lbId:"",lsProductName:"",noNavTop:!1}},computed:{recommendDisabled:function(){return!this.$store.state.globalConfig.recommendDisabled||!Number(this.$store.state.globalConfig.recommendDisabled)}},created:function(){var t=this;this.complete=!0,this.lastRes=this.$route.params.res?this.$route.params.res:{},this.occurData=this.lastRes.occur[0],this.easyCardId=this.$route.params.easyCardId,this.cardType=this.$route.params.cardType,this.buyType=this.$route.params.buyType||"",this.lbId=this.$route.params.lbId||"",this.lsProductName=this.$route.params.lsProductName||"",this.paramsData=this.$route.params.paramsData?this.$route.params.paramsData:{},this.deliveryType=this.$route.params.deliveryType?this.$route.params.deliveryType:"2";var e=this.occurData.couNo;if(this.usedCoupons=[],e&&e.length>0)for(var a=0;a<e.length;a++)this.usedCoupons.push({couNo:e[a]});this.$route.params.paramsData?this._reSettleCart(this.$route.params.paramsData.carts):this.$MessageBox.alert("当前状态不支持刷新！","提示").then((function(e){t.$router.go(-1)})),"true"==this.limitType&&this.getCardList(),void 0!=this.$store.state.mall2.pickUpUser&&""!=this.$store.state.mall2.pickUpUser||(this.$store.state.mall2.pickUpUser=this.$store.state.login.nickName);var i=this.$store.state.globalConfig.order_timeout_pickup_cancel||0,s=new Date;s.setHours(s.getHours()+parseInt(i)),this.pickupTime=s,"wish"==this.$route.query.entryType&&this.getWishMsg(1)},mounted:function(){this.pageType=this.$route.query.pageType,2==this.pageType&&(this.payWaySelected=2,this.payWayText="提货付款"),this.noMath()},methods:{auther:function(t){this.$router.push({path:"/authentication/index",query:{}})},changePer:function(t,e){this.contratWayPopShow=!1,this.selectItem=t,this.radio1=e,1==t.type?this.contratWayText="企业":this.contratWayText="个人"},getAuthInfo:function(){var t=this,e={};this.$http.post("/app/json/app_purchase_order/getAuthInfo",e).then((function(e){var a=e.data;0==a.status?(t.contratWayList=e.data.data,t.contratWayPopShow=!0):t.$Toast(a.info)}))["catch"]((function(e){t.$Toast(e)}))},toServiceEvent:function(t){var e=this,a="/app/json/product/getThirdServeDetail",i={id:t.thirdServeId};this.$http.post(a,i).then((function(t){var a=t.data;if(0==a.status){var i=a.data.pageUrl;if(""==i)return void e.$Toast("暂无详情！");-1!=i.indexOf("?")?i+="&":i+="?",i+="token="+token+"&lng="+store.state.currentLocation.posx+"&lat="+store.state.currentLocation.posy+"&pickupId="+store.state.mall2.zitiAddress.id+"&webtype="+store.state.webtype,window.location.href=i}}))},getSelectReceiveTime:function(){var t=this.$store.state.globalConfig.order_fresh_pickup_timeout_startday||0,e=this.$util.nextDate(t),a=this.$store.state.globalConfig.order_fresh_pickup_timeout_starttime||"09:00:00",i=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+a;return i},getReceiveEndTime:function(){var t=this.$store.state.globalConfig.order_fresh_pickup_timeout_endday||1,e=this.$util.nextDate(t),a=this.$store.state.globalConfig.order_fresh_pickup_timeout_endtime||"15:00:00",i=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+a;return i},getShortAddress:function(t){var e=this;this.$request.post("/app/json/short_address/getShortAddress",{code:t}).then((function(t){if(0==t.status){var a=JSON.parse(t.data.addressData);e.deliveryType=a.deliveryType,a.token=e.$store.state.login.token,e.paramsData=a,e._reSettleCart(a.carts)}else e.$toast(t.info)}))},getTotalPriceDuan:function(t){var e=this.$util.toDecimal2(this.occurData.payAmount),a=e.split(".");return a[t]},queryBtn:function(){this.showYJChange=!1,"a"==this.radio?this._reSettleCart(null,""):this._reSettleCart(null,this.cardDetails.cardNo)},getCardList:function(){var t=this,e=[];this.occurData.store.forEach((function(t){t.noActivityCart.forEach((function(t){e.push({skuId:t.skuId,storeOuCode:t.storeOuCode})}))})),this.$request.post("/app/json/app_user_easy_card/getCardList",{proSkus:e}).then((function(e){if(0==e.status){if(t.cardList=e.data||[],t.cardList.length)for(var a in t.cardList)t.cardList[a].cardNo==t.$route.params.cardNo&&(t.radio=parseInt(a))}else t.$Toast(e.info)}))},changeYjCard:function(t){"a"!=this.radio?(this.cardAmount=t.balance,this.cardDetails=t):(this.cardAmount=0,this.cardDetails="")},getCanNotUseStr:function(t){return 1==t||3==t?"余额不足":1==t?"订单金额不够":"未知原因"},getDictByAlias:function(){var t=this,e="/app/json/app_dict/getDictByAlias",a={token:this.$store.state.login.token,alias:"rewards_group"};this.$http.post(e,a).then((function(e){var a=e.data;0==a.status&&0!=a.data.length&&(t.dictByAlias=a.data)}))},getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},pointsRuleEvent:function(){this.showPointsRule=!0},getEndDate:function(){var t=this.$store.state.globalConfig.order_timeout_pickup_cancel||0,e=new Date;return t?e.setHours(e.getHours()+parseInt(t)):e.setDate(e.getDate()+14),e},scanCodeFunc:function(){var t=this;this.$bridgefunc.scanCode((function(e){t.scanCode=e.code,t.referrer=e.code}))},getTotalPrice:function(){return this.$util.toDecimal2(this.occurData.payAmount)},getImgArrs:function(t){for(var e=[],a=0;a<t.activity.length;a++)for(var i=t.activity[a].cart,s=0;s<i.length;s++)e.push(i[s].phPictureUrl);for(var o=t.noActivityCart,r=0;r<o.length;r++)e.push(o[r].phPictureUrl);return e},getNoStockImgArrs:function(t){for(var e=[],a=[],i=0;i<t.activity.length;i++)for(var s=t.activity[i].cart,o=0;o<s.length;o++){var r=s[o];if(r.number>r.stockNumber)""!=r.currentSelfActivity&&r.currentSelfActivity.mktActivityId&&""!=r.currentSelfActivity.mktActivityId&&(r.selfActivityId=r.currentSelfActivity.mktActivityId),e.push(r);else{var n={id:"",skuId:r.skuId,storeOuCode:r.storeOuCode,number:r.number,activityId:r.activityId,proSkuDistributionId:r.proSkuDistributionId||"",checked:r.checked,isGift:r.isGift,spCode:r.spCode};""!=r.currentSelfActivity&&r.currentSelfActivity.mktActivityId&&""!=r.currentSelfActivity.mktActivityId&&(n.selfActivityId=r.currentSelfActivity.mktActivityId),a.push(n)}}for(var c=t.noActivityCart,l=0;l<c.length;l++){var u=c[l];if(u.number>u.stockNumber)""!=u.currentSelfActivity&&u.currentSelfActivity.mktActivityId&&""!=u.currentSelfActivity.mktActivityId&&(u.selfActivityId=u.currentSelfActivity.mktActivityId),e.push(u);else{var p={id:"",skuId:u.skuId,storeOuCode:u.storeOuCode,number:u.number,activityId:u.activityId,proSkuDistributionId:u.proSkuDistributionId||"",checked:u.checked,isGift:u.isGift,spCode:u.spCode};""!=u.currentSelfActivity&&u.currentSelfActivity.mktActivityId&&""!=u.currentSelfActivity.mktActivityId&&(p.selfActivityId=u.currentSelfActivity.mktActivityId),a.push(p)}}return{noStockArr:e,canBuyArr:a}},showFreightDetail:function(){for(var t=[],e=0;e<this.occurData.store.length;e++){var a=this.occurData.store[e],i={};i.storeName=a.storeName,i.freightAmount=a.freightAmount,i.freightDiscountAmount=a.freightDiscountAmount,i.proImgs=this.getImgArrs(a),t.push(i)}u["a"].open({initData:{listData:t},sureEvent:function(){u["a"].close()}})},pickerConfirm:function(t){var e="星期"+"天一二三四五六 ".charAt(new Date(t).getDay()),a=this.$util.getMyDate(t);return a+" 【"+e+"】"},openPicker:function(){this.$refs.dateDom.open()},showProsDetailEvent:function(t){this.currentStore=t,this.showProsDetail=!0},getPeisongString:function(t){return"0"==t?"快递配送":"1"==t?"京东配送":"第三方配送"},toSelectZitiAddress:function(){},toSelectAddress:function(){this.$router.push({path:"/mall2/addresslist"})},useInvoiceEvent:function(){var t=this;if(this.useInvoice=!this.useInvoice,this.useInvoice&&null==this.invoiceData){this.$Loading.open();var e="/app/json/order_invoice/loadTwoTypeDefaultUserInvoiceHead",a={token:this.$store.state.login.token};this.$http.post(e,a).then((function(e){t.$Loading.close();var a=e.data;0==a.status?(t.invoiceData=a.data,"personal"==t.invoiceData.current?(t.currentInvoice=t.invoiceData.personal,t.currentInvoice.name=t.invoiceData.personal.title,t.invoiceInfo=t.invoiceData.personal.title,t.currentInvoice.type=0):(t.currentInvoice.type=1,t.currentInvoice=t.invoiceData.company,t.currentInvoice.invoiceTitle=t.invoiceData.company.title,t.invoiceInfo=t.invoiceData.company.title),t.invoiceData.phone=t.$store.state.login.phone,t.invoiceData.email=t.$store.state.userInfo.email,t.invoiceData.name=t.$store.state.userInfo.nickName):t.$Toast(a.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}},changeInvoice:function(){var t=this;l["a"].open({initData:Object(n["a"])(Object(n["a"])({},this.invoiceData),{},{token:this.$store.state.login.token}),selectedInvoice:function(e){t.currentInvoice=e,0==e.type?(t.invoiceInfo="个人",t.invoiceData.personal.title=e.name,t.invoiceData.personal.userPhone=e.phone,t.invoiceData.personal.userEmail=e.email):(t.invoiceInfo=e.company,t.invoiceData.company.userPhone=e.phone,t.invoiceData.company.userEmail=e.email,t.invoiceData.company.orgTaxNo=e.identifyNumber,t.invoiceData.company.title=e.company),l["a"].close()},invoiceInformation:function(){t.showAgreement=!0}})},reloadSelectedCoupon:function(){if(0!=this.backReloadCoupon){this.backReloadCoupon=!1;var t=this.occurData.couNo;if(this.usedCoupons=[],t.length>0)for(var e=0;e<t.length;e++)this.usedCoupons.push({couNo:t[e]});for(var a=[],i=0;i<this.occurData.userCanUseCoupon.length;i++){var s=this.occurData.userCanUseCoupon[i].couNo;this.occurData.userCanUseCoupon[i].selected=!1;for(var o=0;o<this.usedCoupons.length;o++){var r=this.usedCoupons[o].couNo;if(r==s){this.occurData.userCanUseCoupon[i].selected=!0;break}}a.push(this.occurData.userCanUseCoupon[i])}c["a"].reloadSelectedCoupon(a,[],this.occurData.userCanUseWhenNotSelectCoupon)}},couponEvent:function(){for(var t=this,e=[],a=0;a<this.occurData.userCanUseCoupon.length;a++){var i=this.occurData.userCanUseCoupon[a].couNo;this.occurData.userCanUseCoupon[a].selected=!1;for(var s=0;s<this.usedCoupons.length;s++){var o=this.usedCoupons[s].couNo;if(o==i){this.occurData.userCanUseCoupon[a].selected=!0;break}}e.push(this.occurData.userCanUseCoupon[a])}c["a"].open({initData:{listData:[],userCanNotUseCoupon:this.occurData.userCanNotUseCoupon,userCanUseCoupon:this.occurData.userCanUseCoupon,userCanUseWhenNotSelectCoupon:this.occurData.userCanUseWhenNotSelectCoupon,type:"use",fiveEnter:!0,skuId:"",categoryId:"",storeOuCode:"",token:this.$store.state.login.token,payAmount:this.$util.toDecimal2(parseFloat(this.occurData.payAmount)+parseFloat(this.occurData.couponAmount))},selectedCoupon:function(e){t.usedCoupons=e,t.backReloadCoupon=!0,t.occurData.payAmount=(t.occurData.amount-t.usedCoupons[0].couFaceValue).toFixed(2),t.occurData.couponAmount=t.usedCoupons[0].couFaceValue}})},useDigitalEvent:function(t){if(t.userCanUseDigital<=0){var e=this.getCanNotUseStr(t.deductionState);this.$Toast(e+"，不支持"+this.getDigitalDisplayName(t.acctType)+"支付！")}else{var a=t.acctType;if(t.payDigital<=t.fixedDigital){for(var i=[],s=0;s<this.payDigitals.length;s++)this.payDigitals[s].acctType!=a&&i.push(this.payDigitals[s]);this.payDigitals=i,this.payDigitals.push({acctType:a,payDigital:t.userCanUseDigital+t.fixedDigital})}else{for(var o=[],r=0;r<this.payDigitals.length;r++)this.payDigitals[r].acctType!=a?o.push(this.payDigitals[r]):o.push({acctType:a,payDigital:t.fixedDigital});this.payDigitals=o}this._reSettleCart(null)}},usePointsEvent:function(){0!=this.occurData.userCanUsePoints?(this.usePoints=!this.usePoints,this._reSettleCart(null)):this.$Toast("您没有当前订单可用积分！")},payWayShow:function(){2==this.pageType?this.payWayPopShow1=!0:this.payWayPopShow=!0},contratWayShow:function(){this.getAuthInfo()},payWayEvent:function(t){0!=t.tag?(this.payWaySelected=t.tag,this.payWayText=t.text):this.$Toast("暂不支持！")},payWayEvent1:function(t,e){0!=t.tag?(this.payWaySelected=e,this.payWayText=t.text):this.$Toast("暂不支持！")},popSureEvent:function(){this.payWayPopShow=!1},popSureEvent1:function(){this.contratWayPopShow=!1},popSureEvent2:function(){this.payWayPopShow1=!1},popClose:function(){this.payWayPopShow=!1},popClose2:function(){this.payWayPopShow1=!1},popClose1:function(){this.contratWayPopShow=!1},_reSettleCart:function(t,e){var a=this;this.$Loading.open();var i="/app/json/app_cart/SettleCartByAct",s=this.paramsData;if(s.couNo=[],t)s.carts=t;else if(this.usedCoupons.length>0)for(var o=0;o<this.usedCoupons.length;o++)s.couNo.push(this.usedCoupons[o].couNo);else s.couNo.push("-1");s.limitWalletCardNo=e,2==this.deliveryType?""!=this.$store.state.mall2.selectAddress.id&&(s.userAddressId=this.$store.state.mall2.selectAddress.id):s.pickupId=this.$route.params.paramsData.pickupId?this.$route.params.paramsData.pickupId:this.$store.state.mall2.zitiAddress.id;for(var r=[],n=0;n<this.payDigitals.length;n++){var c=this.payDigitals[n];"LimitWallet"!=c.acctType&&r.push(c)}s.payDigital=r,s=Object.assign(s,{deliveryType:1,specialActivityId:s.specialActivityId,specialActivityType:1,couNo:"-1",pickupId:this.$route.params.paramsData.pickupId}),this.$http.post(i,s).then((function(t){a.$Loading.close();var e=t.data;a.complete=!0,0==e.status?(a.hasShengxian=!1,a.lastRes=e.data,a.paramsData=s,a.initData(),"true"==a.limitType&&a.getCardList(),a.$mallCommon.isExistCanNotAttendActivity(e.data.occur,!0)):(a.$Toast(e.info),a.reloadSelectedCoupon())}),(function(t){a.$Loading.close(),a.$Toast("请求数据失败！"),a.reloadSelectedCoupon()}))},checkProductStock:function(){var t=this;if(2!=this.pageType||this.selectItem.realName)if(this.$store.state.mall2.selectAddress.id>0||2!=this.deliveryType||"1"==this.occurData.needVirtualUserPhone){if(this.occurData&&this.occurData.needReferrer&&(!this.referrer||0==this.referrer.length))return this.$Toast("请填写推荐人"),!1;for(var e=0;e<this.payDigitals.length;e++){var a=this.payDigitals[e];if(a.payDigital>0&&a.payDigital>a.userBalanceDigital){var i="可用";return i+=this.getDigitalDisplayName(a.acctType),i+="余额不足！",void this.$Toast(i)}}for(var s=[],o=[],r=!1,n=0;n<this.occurData.store.length;n++){var c=this.occurData.store[n],l={};l.storeName=c.storeName;var u=this.getNoStockImgArrs(c);o=o.concat(u.canBuyArr),l.noStockArr=u.noStockArr,u.noStockArr.length>0&&(r=!0),s.push(l)}0!=o.length?this.cardBalance.balance-this.number<=0?this.$Toast("当前区域商品库存不足！"):r?p["a"].open({initData:{listData:s},cancelEvent:function(){p["a"].close()},submitEvent:function(){p["a"].close(),t._reSettleCart(o)}}):2==this.pageType?"提货付款"==this.payWayText?(this.overFlag=!0,this._submitOrder(o)):this.checkHighest_recharge(o):this.checkCouponPrice(o):this.$Toast("当前区域商品库存不足！")}else this.$Toast("请维护并选择收货地址！");else this.$Toast("请选择预约单联系方式！")},checkHighest_recharge:function(t){var e=this;this.occurData.amount>1e4?Object(r["a"])("订单金额已超过10000元，请选择提货支付支付方式"):this.occurData.amount>this.$store.state.globalConfig.bulkpurchase_modifyprice?(this.overFlag=!0,o["a"].confirm({title:"标题",confirmButtonText:"申请改价",className:"price-con",getContainer:".placeorder",cancelButtonText:"算了吧~",message:"您的订单金额已到达改价金额".concat(this.$store.state.globalConfig.bulkpurchase_modifyprice,"元，可选择联系管理员进行改价后进行支付")}).then((function(){e.checkCouponPrice(t)}))["catch"]((function(){}))):e.checkCouponPrice(t)},checkCouponPrice:function(t){var e=this;this.occurData.cashCouponFaceValue>this.occurData.cashCouponAmount?this.$MessageBox.confirm("您的优惠券金额比订单金额大，确定使用吗？","提示",{confirmButtonText:"确定"}).then((function(a){e.checkNeedPwd(t)}))["catch"]((function(t){})):this.checkNeedPwd(t)},checkNeedPwd:function(t){var e=this;if(this.digitalPWD="",this.occurData.needPayPwd){var a=!0;if(a){if("1"==this.occurData.payPwdState)return void this.$Toast("支付密码已锁定，请稍后再试！");h["a"].open({initData:{payPwdState:this.occurData.payPwdState},toSettingPwd:function(){e.$router.push({path:"/usercenter/nosetpwd",query:{isSet:0}}),h["a"].close()},inputFinished:function(a){e.digitalPWD=a,e._submitOrder(t),h["a"].close()}})}else this._submitOrder(t)}else this._submitOrder(t)},pustLiveStreamMsg:function(){var t=this,e="/app/json/live_broadcast/comment",a={lbId:this.lbId,content:"【下单】成功下单 "+this.lsProductName+" 🎉🎉🎉"};this.$http.post(e,a).then((function(e){var a=e.data;0==a.status||t.$Toast(a.info)}),(function(t){}))},_submitOrder:function(t){var e=this,a="/app/json/app_shopping_order/submitByAct",i=this.$util.deepClone(this.paramsData);if(1==this.deliveryType&&(i.pickupReceiver=this.$store.state.mall2.pickUpUser,i.pickupMobile=this.pickupPhone,"false"!=this.$store.state.globalConfig.order_pickup_time_selecter_show)){var s=this.$util.getMyDate(this.pickupTime);i.selectReceiveTime=s}if(i.orderScene=this.$util.orderScene(),i.carts=t,i.couNo=[],this.usedCoupons.length>0)for(var o=0;o<this.usedCoupons.length;o++)i.couNo.push(this.usedCoupons[o].couNo);i.userAddress=this.$store.state.mall2.selectAddress,i.userAddressId=this.$store.state.mall2.selectAddress.id,i.token=this.$store.state.login.token,i.payDigital=this.payDigitals,""!=this.digitalPWD&&(i.payPwd=Object(m["a"])(this.digitalPWD)),i.specialActivityId=this.$route.params.paramsData.specialActivityId,i.specialActivityType=this.$route.params.paramsData.specialActivityType,i.pickupId=this.$route.params.paramsData.pickupId,this.$Loading.open(),this.$http.post(a,i).then((function(a){e.$Loading.close();var i=a.data;0==i.status?(""!=e.lbId&&e.pustLiveStreamMsg(),sessionStorage.removeItem("RHY_Pickup_Address"),sessionStorage.removeItem("Place_Order_Params"),sessionStorage.removeItem("Place_Order_Delivery_Type"),e.$router.replace({path:"/mall2/checkstand",query:{payInfo:JSON.stringify(i.data),occurOuCode:e.occurData.ouCode,orderCategory:e.paramsData.orderCategory,vipUnitUserCode:e.paramsData.vipUnitUserCode,buyType:e.buyType,giftCards:JSON.stringify(t),deliveryType:e.deliveryType,name:e.$route.params.name,type:"five_enter"}})):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},returnStoreProducts:function(t){for(var e=0,a=0,i=[],s=[],o=0;o<t.noActivityCart.length;o++){var r=t.noActivityCart[o];a+=r.number,512==r.productType?s.push(r):(e++,i.push(r),6==r.productType&&(this.hasShengxian=!0))}for(var n=0;n<t.activity.length;n++)for(var c=0;c<t.activity[n].cart.length;c++){var l=t.activity[n].cart[c];a+=l.number,512==l.productType?s.push(l):(e++,i.push(l),6==l.productType&&(this.hasShengxian=!0))}var u={num:e,proNum:a,proArr:i,serviceArr:s};t.storeProData=u},initData:function(){if(this.pointsGain=this.lastRes.pointsGain,this.occurData=this.lastRes.occur[0],!this.occurData)return this.occurData={},void(1==this.deliveryType?this.$Toast("当前自提点无库存！"):this.$Toast("当前地址无库存！"));for(var t=0;t<this.occurData.store.length;t++){var e=this.occurData.store[t];this.returnStoreProducts(e)}var a=this.occurData.couNo;if(this.usedCoupons=[],a&&a.length>0)for(var i=0;i<a.length;i++)this.usedCoupons.push({couNo:a[i]});this.payDigitals=[];for(var s=0;s<this.occurData.digitalList.length;s++){var o=this.occurData.digitalList[s];"LimitWallet"==o.acctType&&(this.cardAmount=o.userBalanceDigital,this.userCanUseDigital=o.userCanUseDigital),o.payDigital>o.fixedDigital?this.payDigitals.push({acctType:o.acctType,userBalanceDigital:o.userBalanceDigital,payDigital:o.userCanUseDigital+o.fixedDigital}):this.payDigitals.push({acctType:o.acctType,userBalanceDigital:o.userBalanceDigital,payDigital:o.fixedDigital})}this.reloadSelectedCoupon()},noMath:function(){var t=this,e=!!this.$route.params.noMatch&&this.$route.params.noMatch;e&&this.$MessageBox.confirm("没有相关区域的收货地址，是否要添加？","提示",{confirmButtonText:"确定"}).then((function(e){t.$router.push({path:"addaddress",query:{type:1,isSave:!0,direct:"direct"}})}))["catch"]((function(t){}))},getWishMsg:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$http.post("/app/json/wish_order/getRandomWishOrderConfig",{type:2,isDefault:e}).then((function(e){var a=e.data;0==a.status?t.wishData=a.data:t.$Toast(a.info)}))["catch"]((function(e){t.$Toast(e)}))},getContentTop:function(){return this.noNavTop?"top: 0px;":""}},activated:function(){this.isFirst?this.isFirst=!1:this._reSettleCart(null)},beforeRouteLeave:function(t,e,a){"/mall2/addresslist"==t.path||"/mall2/mypickupaddress"==t.path||"/mall2/addaddress"==t.path||"/usercenter/agreement"==t.path||"/usercenter/nosetpwd"==t.path||this.$keepaliveHelper.deleteCache(this),a()}},g=f,y=(a("20d1"),a("0c7c")),_=Object(y["a"])(g,i,s,!1,null,"5cbe5d6e",null);e["default"]=_.exports}}]);