(window.webpackJsonp=window.webpackJsonp||[]).push([[409],{"0G4o":function(t,e,a){},"2gbm":function(t,e,a){"use strict";var i=a("s2cm");a.n(i).a},Qwwy:function(t,e,a){"use strict";var i=a("0G4o");a.n(i).a},s2cm:function(t,e,a){},xNJ5:function(t,e,a){"use strict";a.r(e);var i=(a("Qwwy"),a("KHd+")),n=Object(i.a)({name:"donate-input",props:["integrations_p","currentIntegrate_p","integralList_p","myintegralList_p","remark_p"],data:function(){return{integrations:[],currentIntegrate:"",integralList:"",myintegralList:"",remark:""}},watch:{integrations_p:{handler:function(t,e){this.integrations=this.integrations_p,this.$forceUpdate()},deep:!0,immediate:!1}},methods:{selectIntegrate:function(t){t.selected=!t.selected,this.integrations.forEach((function(e){e.type!=t.type&&(e.selected=!1)})),this.currentIntegrate=t},agreeToDonate:function(){var t={currentIntegrate:this.currentIntegrate,integralList:this.integralList,myintegralList:this.myintegralList,remark:this.remark};this.$emit("agreeToDonateDo",t)},readAgreement:function(){this.$router.push({path:"/usercenter/agreement",query:{value:18}})},focusEdit:function(){this.currentIntegrate="",this.integrations.forEach((function(t){t.selected=!1}))}},mounted:function(){this.integrations=this.integrations_p,this.currentIntegrate=this.currentIntegrate_p,this.integralList=this.integralList_p,this.myintegralList=this.myintegralList_p,this.remark=this.remark_p}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"donate-input-root"},[a("div",{staticClass:"input-title"},[t._v("我要捐助")]),t._v(" "),a("div",{staticClass:"account-curr"},[t._v("账户剩余积分 "+t._s(""==t.integralList?"0":t.integralList))]),t._v(" "),a("div",{staticClass:"selects"},t._l(t.integrations,(function(e){return a("div",{key:e.value,staticClass:"integrate-area"},[a("div",{staticClass:"integrate-unselect single-line",class:{integrateSelect:e.selected},on:{click:function(a){return t.selectIntegrate(e)}}},[t._v(t._s(e.value))])])})),0),t._v(" "),a("div",{staticClass:"input-line"},[a("van-field",{attrs:{type:"number",placeholder:"自定义捐赠分数"},on:{focus:t.focusEdit},model:{value:t.myintegralList,callback:function(e){t.myintegralList=e},expression:"myintegralList"}})],1),t._v(" "),a("div",{staticClass:"textarea-line"},[a("van-field",{attrs:{type:"textarea",placeholder:"为你的爱心留个言吧~"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),t._v(" "),a("div",{staticClass:"read-agreement"},[t._v("\n    查看\n    "),a("span",{staticClass:"agreenment",on:{click:t.readAgreement}},[t._v("《捐赠协议》")])]),t._v(" "),a("div",{staticClass:"donate-btn",on:{click:t.agreeToDonate}},[t._v("同意协议并捐赠")])])}),[],!1,null,"01f7ae28",null).exports,s=a("7//l"),r=a("Gedb"),o={components:{donateInput:n},data:function(){return{showInputPop:!1,donateItem:"",donatePercent:0,integrations:[{type:0,value:10,selected:!1},{type:1,value:50,selected:!1},{type:2,value:100,selected:!1},{type:3,value:1e3,selected:!1}],currentIntegrate:"0",integralList:"",myintegralList:"",payDigitals:[],isNeedPayPwd:!1,digitalPWD:"",currObjData:"",remark:""}},methods:{toDonate:function(){this.myintegralList="",this.integrations.forEach((function(t){t.selected=!1})),this.showInputPop=!0},getAccountBaseInfo:function(){var t=this;this.$http.post("/app/json/acct/getAccountBaseInfo",{acctType:3}).then((function(e){var a=e.data;0==a.status?t.integralList=a.data.balanceUnit:t.$Toast("获取当前积分失败")})).catch((function(e){t.$Toast(e)}))},agreeToDonateDo:function(t){if(this.currentIntegrate=t.currentIntegrate,this.integralList=t.currentIntegrate,this.myintegralList=t.myintegralList,this.remark=t.remark,""!=this.myintegralList||""!=this.currentIntegrate){if(""!=this.myintegralList){if(parseInt(this.myintegralList)>=parseInt(this.integralList))return void this.$Toast("捐赠的积分不能超过当前剩余积分")}else if(parseInt(this.currentIntegrate.value)>=parseInt(this.integralList))return void this.$Toast("捐赠的积分不能超过当前剩余积分");this.settleAccounts()}else this.$Toast("捐赠积分不能为空")},settleAccounts:function(){var t=this,e={projectId:this.donateItem.id,payDigital:[]};""==this.currentIntegrate||0==this.currentIntegrate?e.donateValue=this.myintegralList:e.donateValue=this.currentIntegrate.value,this.$Loading.open(),this.$http.post("/app/json/shopping_donate/settle",e).then((function(e){if(t.$Loading.close(),0==e.data.status){var a=e.data.data.digitalList;t.currObjData=e.data.data,a&&a.length>0&&(a.forEach((function(e){if(3==e.acctTypeCode){var a=e;t.payDigital=[],a.payDigital,a.fixedDigital,t.payDigitals.push({acctType:a.acctType,userBalanceDigital:a.userBalanceDigital,payDigital:a.userCanUseDigital+a.fixedDigital})}})),t.isNeedPayPwd=e.data.data.needPayPwd,t.toXiaDan(t.isNeedPayPwd))}else t.$Toast(e.data.info)})).catch((function(e){t.$Loading.close()}))},toXiaDan:function(t){t?this.checkNeedPwd(t):this.submitOrder()},submitOrder:function(){var t=this,e={projectId:this.donateItem.id,payDigital:this.payDigitals,remark:this.remark};""==this.currentIntegrate||0==this.currentIntegrate?e.donateValue=this.myintegralList:e.donateValue=this.currentIntegrate.value,this.$Loading.open(),this.digitalPWD&&this.digitalPWD.length>0&&(e.payPwd=Object(r.a)(this.digitalPWD)),this.$http.post("/app/json/shopping_donate/submit",e).then((function(e){t.$Loading.close();var a=e.data,i=a.status,n=a.info;a.data,0==i?(t.$router.replace({path:"/donate-result",query:{donateItem:t.donateItem}}),t.$keepaliveHelper.deleteCache(t)):t.$Toast(n),t.showInputPop=!1})).catch((function(e){t.$Loading.close(),t.showInputPop=!1}))},checkNeedPwd:function(t){var e=this;if(this.digitalPWD="",t){if("1"==this.currObjData.payPwdState)return void this.$Toast("支付密码已锁定，请稍后再试！");s.a.open({initData:{payPwdState:this.currObjData.payPwdState},toSettingPwd:function(){e.$router.push({path:"/usercenter/nosetpwd",query:{isSet:0}}),s.a.close()},inputFinished:function(t){e.digitalPWD=t,e.submitOrder(),s.a.close()}})}else this.submitOrder()}},created:function(){this.getAccountBaseInfo(),this.donateItem=this.$route.query.donateItem,this.donateItem.curDonationUnit=""==this.donateItem.curDonationUnit?"0":this.donateItem.curDonationUnit,this.donateItem.projectDesc=this.$util.replaceH5Img(this.donateItem.projectDesc),this.donatePercent=parseFloat(this.donateItem.curDonationUnit)/parseFloat(this.donateItem.projectExpect)*100,this.donatePercent=this.donatePercent.toFixed(2)},beforeRouteLeave:function(t,e,a){"/donate-home"==t.path&&this.$keepaliveHelper.deleteCache(this),a()}},c=(a("2gbm"),Object(i.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("nav-top",{on:{backEvent:function(e){return t.$router.go(-1)}}}),t._v(" "),a("nav-content",{staticClass:"navclass"},[a("div",{staticClass:"banner"},[a("img",{attrs:{src:t.donateItem.projectPic}})]),t._v(" "),a("div",{staticClass:"curr-root"},[a("van-progress",{staticClass:"progress",attrs:{"track-color":"#DCDDDD",color:"#F02C2D","stroke-width":"5px",percentage:t.donatePercent>100?100:t.donatePercent,"show-pivot":!1}}),t._v(" "),a("div",{staticClass:"donate-current"},[a("div",{staticClass:"intent"},[a("div",{staticClass:"intent-curr"},[t._v(t._s(t.donateItem.curDonationUnit))]),t._v(" "),a("div",{staticClass:"intent-plan"},[t._v("目标 "+t._s(t.donateItem.projectExpect))])]),t._v(" "),a("div",[a("div",{staticClass:"intent-curr"},[t._v(t._s(""==t.donateItem.curDonationCnt?"0":t.donateItem.curDonationCnt))]),t._v(" "),a("div",{staticClass:"intent-plan"},[t._v("爱心 (份)")])]),t._v(" "),a("div",[a("div",{staticClass:"intent-curr"},[t._v(t._s(t.donatePercent)+"%")]),t._v(" "),a("div",{staticClass:"intent-plan"},[t._v("捐赠进度")])])])],1),t._v(" "),a("div",{staticClass:"item-name"},[a("div",{staticClass:"item-title"},[t._v(t._s(t.donateItem.projectName))]),t._v(" "),a("div",{staticClass:"item-des"},[t._v(t._s(t.donateItem.projectIntro))])]),t._v(" "),a("div",{staticClass:"item-read"},[a("div",{staticClass:"item-read-title"},[t._v("项目说明")]),t._v(" "),a("div",{staticClass:"item-detail",domProps:{innerHTML:t._s(t.donateItem.projectDesc)}})]),t._v(" "),a("div",{staticClass:"emtpy"}),t._v(" "),a("div",{staticClass:"donate-btn",on:{click:t.toDonate}},[t._v("我要捐助")]),t._v(" "),a("van-popup",{staticClass:"popup",attrs:{position:"bottom"},model:{value:t.showInputPop,callback:function(e){t.showInputPop=e},expression:"showInputPop"}},[t.showInputPop?a("div",[a("donate-input",{attrs:{integrations_p:t.integrations,currentIntegrate_p:t.currentIntegrate,integralList_p:t.integralList,myintegralList_p:t.myintegralList,remark_p:t.remark},on:{agreeToDonateDo:function(e){return t.agreeToDonateDo(e)}}})],1):t._e()])],1)],1)}),[],!1,null,"4d60b255",null));e.default=c.exports}}]);