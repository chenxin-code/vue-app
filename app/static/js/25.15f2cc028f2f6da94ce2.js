(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{"11I5":function(t,e,a){"use strict";a.r(e);var i=a("ygAv"),s=a("7L8N"),n=a("db0i"),o={components:{repayments:s.a},data:function(){return{currentYear:(new Date).getFullYear(),currentMonth:(new Date).getMonth()+1,minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),currentDate:new Date,dateFrom:"",oilNum:0,showTime:!1,orderList:[],page:0,hasMore:!0,loading:!1,successView:!1,awardActivity:{},tabActive:0,payStyle:{}}},mounted:function(){this.dateFrom=i.a.getDealMonthFrom(this.currentYear,this.currentMonth),this.getPayBill()},computed:{isScan:function(){return"/firmScanOrder"===this.$route.path},isOfflineScan:function(){return"/firmScanOfflineOrder"===this.$route.path}},methods:{changeTab:function(t,e){this.page=0,this.tabActive=t,this.orderList=[],this.getPayBill()},cancelOrderHandler:function(t){var e=this;this.$dialog.confirm({message:"确定取消当前订单吗？"}).then((function(){e.cancelOrder(t)}))},queryOrder:function(){this.page=0,this.orderList=[],this.getPayBill()},cancelOrder:function(t){var e=this,a={token:this.$store.state.login.token,orderType:t.orderType,orderId:t.id},i="/app/json/refuel_center/cancelOrder";100002002==t.orderType&&(i="/app/json/refuel_scan_code/cancelOrder"),this.isOfflineScan&&(i="/app/json/shopping_scan_code/cancelOrder"),this.$http.post(i,a).then((function(t){var a=t.data;0==a.status?(e.$Toast("支付已取消"),e.queryOrder()):e.$Toast(a.info)}))},repayment:function(t){var e=this;console.log(t);var a=[];n.a.getPayWays("200001010",t.ouCode,"1").then((function(t){a=t||[],console.log(a),a.length>0&&(e.payStyle=a[0])})),this.$refs.repay.open(t)},shareView:function(){this.successView=!0},sharePage:function(){this.$router.push({path:"/share-gift/share",query:{awardActivity:JSON.stringify(this.awardActivity)}})},invoiceUse:function(t){var e="";return 0===t?e="未开票":1===t?e="已开票":2===t&&(e="开票中"),e},changeTime:function(){this.showTime=!0},confirmDate:function(t){this.currentYear=new Date(this.currentDate).getFullYear(),this.currentMonth=new Date(this.currentDate).getMonth()+1,this.dateFrom=i.a.getDealMonthFrom(this.currentYear,this.currentMonth),this.showTime=!1,this.orderList=[],this.getPayBill()},formatter:function(t,e){return"year"===t?e+"年":"month"===t?e+"月":e},backEvent:function(){this.$router.go(-1)},getPayBill:function(){var t=this;this.page++,this.loading=!0,this.$Loading.open(),console.log(this.tabActive);var e="/app/json/refuel_center/queryOrder";this.isScan&&(e="/app/json/refuel_scan_code/queryOrder"),this.isOfflineScan&&(e="/app/json/shopping_scan_code/queryOrder");var a={token:this.$store.state.login.token,rows:12,page:this.page};this.isScan?(a.orderTypeList=["100011","100002002","100027002"],a.submitTime=this.dateFrom.start+"TO"+this.dateFrom.end):this.isOfflineScan?(a.orderType="200401002",a.createTime=this.dateFrom.start+"TO"+this.dateFrom.end):(a.payTime=this.dateFrom.start+"TO"+this.dateFrom.end,a.orderType=["100011","100002002","100027002"]),1==this.tabActive?a.state=1:2==this.tabActive?(a.state=3,this.isScan&&(a.payTime=this.dateFrom.start+"TO"+this.dateFrom.end)):3==this.tabActive&&(this.isScan?a.stateList=[7,8,12]:a.state=7),this.$http.post(e,a).then((function(e){var a=e.data;if(0==a.status){console.log(a);var i=a.data.orderList||[];t.orderList=t.orderList.concat(i),t.page<a.data.page.totalPages?t.loading=!1:t.hasMore=!1;var s=0;t.orderList.forEach((function(t){s+=Number(t.payAmount)})),t.oilNum=s}else t.$Toast(a.info);t.$Loading.close()}))},repayDetail:function(t){"1"==this.tabActive&&(this.toDetail(t),console.log(9987))},toDetail:function(t){var e="firmHistoryDetail";this.isScan&&(e="/firmHistoryScanDetail"),this.isOfflineScan&&(e="/firmOfflineScanDetail"),console.log(e),this.$router.push({path:e,query:{orderType:t.orderType,orderId:t.id}})}}},r=(a("qvb+"),a("KHd+")),c=Object(r.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"payorder"},[a("nav-top",{attrs:{title:t.isOfflineScan?"商品支付凭证":"加油支付凭证"},on:{backEvent:t.backEvent}}),t._v(" "),a("nav-content",{staticClass:"firm-order-content"},[a("div",{staticClass:"time-change"},[a("div",{staticClass:"filter-btn",on:{click:function(e){t.showTime=!0}}},[a("div",{staticClass:"time"},[t._v(t._s(t.currentYear)+"年"+t._s(t.currentMonth)+"月")]),t._v(" "),a("i",{staticClass:"icon iconfont mall-arrow-down",class:{active:t.showTime}})]),t._v(" "),0==t.tabActive||2==t.tabActive?a("div",{staticClass:"num"},[t._v("累计加油："),a("span",{staticClass:"info"},[t._v(t._s(t.oilNum.toFixed(2))+"元")])]):t._e()]),t._v(" "),a("van-tabs",{staticClass:"tabs",on:{change:t.changeTab},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[a("van-tab",{attrs:{title:"全部"}}),t._v(" "),a("van-tab",{attrs:{title:"待支付"}}),t._v(" "),a("van-tab",{attrs:{title:"已完成"}}),t._v(" "),a("van-tab",{attrs:{title:"已取消"}})],1),t._v(" "),a("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getPayBill,expression:"getPayBill"}],staticClass:"order-list",attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-immediate-check":!0,"infinite-scroll-distance":"20"}},[t._l(t.orderList,(function(e,i){return a("div",{key:i,staticClass:"order-item",on:{click:function(a){return t.repayDetail(e)}}},[t.isOfflineScan?t._e():a("div",{staticClass:"item"},[a("span",{staticClass:"label"}),t._v(" "),a("span",{staticClass:"con theme_font_red"},[a("van-tag",{attrs:{plain:"",type:"danger"}},[t._v(t._s(t.invoiceUse(e.invoiceUse)))])],1)]),t._v(" "),a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v(t._s(e.storeName))]),t._v(" "),a("span",{staticClass:"con"},[t._v(t._s(e.submitTime))])]),t._v(" "),a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("支付金额")]),t._v(" "),""!==e.payAmount||void 0!==e.payAmount?a("span",{staticClass:"con theme_font_red"},[t._v("￥"+t._s(e.payAmount.toFixed(2)))]):t._e()]),t._v(" "),t._l(e.itemAbstractList,(function(e){return[e.activityTitle&&"null"!=e.activityTitle?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("参与活动")]),t._v(" "),a("span",{staticClass:"con"},[t._v(t._s(e.activityTitle))])]):t._e(),t._v(" "),e.selfActivityTitle&&"null"!=e.selfActivityTitle?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("参与活动")]),t._v(" "),a("span",{staticClass:"con"},[t._v(t._s(e.selfActivityTitle))])]):t._e(),t._v(" "),e.randomDeductionActivityTitle&&"null"!=e.randomDeductionActivityTitle?a("div",{staticClass:"item"},[a("span",{staticClass:"label"},[t._v("参与活动")]),t._v(" "),a("span",{staticClass:"con"},[t._v(t._s(e.randomDeductionActivityTitle))])]):t._e()]})),t._v(" "),a("div",{staticClass:"item pay-btn"},[1==e.state?a("div",[a("div",{staticClass:"con wait-pay",on:{click:function(a){return a.stopPropagation(),t.repayment(e)}}},[t._v("重新支付")]),t._v(" "),a("div",{staticClass:"con wait-pay",staticStyle:{"margin-right":"15px"},on:{click:function(a){return a.stopPropagation(),t.cancelOrderHandler(e)}}},[t._v("取消订单")])]):a("div",{staticClass:"con"},[a("div",{staticClass:"con check-detail",on:{click:function(a){return a.stopPropagation(),t.toDetail(e)}}},[t._v("查看详情")])])])],2)})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasMore,expression:"!hasMore"}],staticClass:"no-data theme_font_tint"},[t._v("没有更多数据了~")])],2)],1),t._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:t.showTime,callback:function(e){t.showTime=e},expression:"showTime"}},[a("van-datetime-picker",{attrs:{type:"year-month","min-date":t.minDate,"max-date":t.maxDate,formatter:t.formatter},on:{confirm:t.confirmDate,cancel:function(e){t.showTime=!1}},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1),t._v(" "),a("repayments",{ref:"repay",attrs:{payStyle:t.payStyle,isScan:t.isScan,isOfflineScan:t.isOfflineScan},on:{queryOrder:t.queryOrder}})],1)}),[],!1,null,"3fae96d8",null);e.default=c.exports},"3Aej":function(t,e,a){},"7L8N":function(t,e,a){"use strict";var i=a("db0i"),s=a("ZGFV"),n=a("VGP3"),o={props:{isScan:{type:Boolean,default:!1},isOfflineScan:{type:Boolean,default:!1},payStyle:{type:Object}},components:{PayMode:n.a},data:function(){return{showModal:!1,payData:{},selectedPayWay:null}},mounted:function(){},methods:{open:function(t){var e=this;this.payData=t,this.showModal=!0,t.payMode||this.isOfflineScan||this.$nextTick((function(){e.$refs.payModeRef.init(t.orderType.slice(0,t.orderType.length-3),t.storeOuCode)}))},setPayWays:function(t){this.selectedPayWay=Object.assign({},t)},payBill:function(t){var e=this;console.log(t);var a=this.selectedPayWay;this.selectedPayWay||(a=this.payStyle);var s="refuelPayEvent";100002002==t.orderType?s="refuelScanPayEvent":200401002==t.orderType&&(s="refuelOfflinePayEvent");var n=Object.assign({},t);t.payMode||(n=Object.assign({},n,a)),i.a[s](n,t.orderType,t.id).then((function(){e.resultHand("1",t)})).catch((function(){e.resultHand("0",t)}))},payTypeStr:function(t){return console.log(t,"payMode"),i.a.getPayWayStr(t)},resultHand:function(t,e){this.$Loading.close(),s.a.addLog("支付结果",t?"成功":"失败");var a="/firmDetail",i="";this.isScan&&(a="/firmScanDetail"),this.isOfflineScan&&(a="/offline_payment/pay_success",i=1),"1"==t?this.$router.replace({path:a,query:{orderType:this.payData.orderType,orderId:this.payData.id,fromPage:1,source:i}}):this.cancelOrder(e)},cancelOrder:function(t){var e=this,a={token:this.$store.state.login.token,orderType:t.orderType,orderId:t.id},i="/app/json/refuel_center/cancelOrder";this.isScan&&(i="/app/json/refuel_scan_code/cancelOrder"),this.isOfflineScan&&(i="/app/json/shopping_scan_code/cancelOrder"),this.$http.post(i,a).then((function(t){var a=t.data;0==a.status?(e.$Toast("支付已取消"),e.$emit("queryOrder")):e.$Toast(a.info)}))}}},r=(a("GKVD"),a("KHd+")),c=Object(r.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.showModal?a("div",{staticClass:"confirm-pay-modal"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-title"},[t._v("确认支付？")]),t._v(" "),a("div",{staticClass:"content"},[t.payData.payMode?a("div",{staticClass:"item"},[a("span",[t._v("支付方式")]),t._v(" "),a("span",[t._v(t._s(t.payTypeStr(t.payData.payMode)))])]):t.isOfflineScan?a("div",{staticClass:"item"},[a("span",[t._v("支付方式")]),t._v(" "),a("span",[t._v(t._s(t.payStyle.text))])]):t.isOfflineScan?t._e():a("div",{staticClass:"item"},[a("pay-mode",{ref:"payModeRef",staticStyle:{width:"100%","margin-top":"0"},on:{setPayWay:t.setPayWays}})],1),t._v(" "),a("div",{staticClass:"item"},[t.isOfflineScan?a("span",[t._v("支付时间")]):a("span",[t._v("加油时间")]),t._v(" "),a("span",[t._v(t._s(t.payData.createTime))])]),t._v(" "),t.isOfflineScan?t._e():a("div",{staticClass:"item"},[a("span",[t._v("加油升数")]),t._v(" "),a("span",[t._v(t._s(t.payData.refuelLiter)+"L")])]),t._v(" "),a("div",{staticClass:"item"},[a("span",[t._v(t._s(t.isOfflineScan?"支付金额":"金额"))]),t._v(" "),a("span",{staticClass:"theme_font_red"},[t._v("￥"+t._s(t.payData.totalAmount.toFixed(2)))])])]),t._v(" "),a("div",{staticClass:"btns"},[a("p",{staticClass:"btn cancel-btn",on:{click:function(e){t.showModal=!1}}},[t._v("否")]),t._v(" "),a("p",{staticClass:"btn",on:{click:function(e){return t.payBill(t.payData)}}},[t._v("是")])])])]):t._e()}),[],!1,null,"104d95a0",null);e.a=c.exports},GKVD:function(t,e,a){"use strict";var i=a("3Aej");a.n(i).a},GZl2:function(t,e,a){},HMz6:function(t,e,a){"use strict";var i=a("GZl2");a.n(i).a},VGP3:function(t,e,a){"use strict";var i=a("db0i"),s={name:"pay-mode",props:{supportCompany:Boolean},data:function(){return{payWay:[],selectedPayWay:{}}},mounted:function(){},methods:{init:function(t,e){var a=this;i.a.getPayWays(t,e).then((function(t){a.payWay=t||[],a.supportCompany?a.selectedPayWay=[]:a.selectedPayWay=a.payWay[0],a.$emit("setPayWay",a.selectedPayWay,"init")}))},payWaySelected:function(t){t.payMode?(this.selectedPayWay=t,this.$emit("setPayWay",this.selectedPayWay)):this.$Toast("暂未开通！")}},components:{}},n=(a("HMz6"),a("KHd+")),o=Object(n.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pay-mode"},[a("div",{staticClass:"title"},[t._v("支付方式")]),t._v(" "),t._l(t.payWay,(function(e){return a("div",{staticClass:"pay-mode-item",on:{click:function(a){return t.payWaySelected(e)}}},["210009"!=e.payModeSub||"210009"==e.payModeSub&&3==t.$store.state.webtype?[a("div",{staticClass:"icon"},[a("img",{attrs:{src:e.icon}})]),t._v(" "),a("div",{staticClass:"text"},[t._v(t._s(e.text))]),t._v(" "),a("div",{staticClass:"selected"},[t.selectedPayWay.payModeSub!=e.payModeSub?a("i",{staticClass:"iconfont mall-weixuanzhong theme_font_tint"}):t._e(),t._v(" "),t.selectedPayWay.payModeSub==e.payModeSub?a("i",{staticClass:"iconfont mall-xuanzhong theme_font_red"}):t._e()])]:t._e()],2)}))],2)}),[],!1,null,"0b904960",null);e.a=o.exports},cv51:function(t,e,a){},"qvb+":function(t,e,a){"use strict";var i=a("cv51");a.n(i).a}}]);