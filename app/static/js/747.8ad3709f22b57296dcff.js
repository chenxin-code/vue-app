(window.webpackJsonp=window.webpackJsonp||[]).push([[747],{NMLE:function(t,e,i){"use strict";var a=i("v52b");i.n(a).a},"hz+t":function(t,e,i){"use strict";i.r(e);var a=i("WQzh"),s=i("Ziuy"),o=i("Xt+m"),n=i("db0i"),c=i("Wbz3"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},l={name:"place-order",components:{PriceOrder:a.a},data:function(){return{useInvoice:!1,historyPros:[],paramsData:{},payDigitals:[],lastRes:null,occurData:{},canEditReferrer:!0,referrer:"",payWayPopShow:!1,payWays:[],selectedPayWay:{},storeOuCode:"",invoiceData:null,invoiceInfo:"",currentInvoice:null,usedCoupons:[],payInfo:{},pickupId:""}},computed:{recommendDisabled:function(){return!this.$store.state.globalConfig.recommendDisabled||!Number(this.$store.state.globalConfig.recommendDisabled)}},methods:{useDigitalEvent:function(t){if(t.userCanUseDigital<=0){var e=this.getCanNotUseStr(t.deductionState);this.$Toast(e+"，不支持"+this.getDigitalDisplayName(t.acctType)+"支付！")}else{var i=t.acctType;if(t.payDigital<=t.fixedDigital){for(var a=[],s=0;s<this.payDigitals.length;s++)this.payDigitals[s].acctType!=i&&a.push(this.payDigitals[s]);this.payDigitals=a,this.payDigitals.push({acctType:i,payDigital:t.userCanUseDigital+t.fixedDigital})}else{for(var o=[],n=0;n<this.payDigitals.length;n++)this.payDigitals[n].acctType!=i&&o.push(this.payDigitals[n]);this.payDigitals=o}this.reSettleCart()}},getCanNotUseStr:function(t){return 1==t||3==t?"余额不足":1==t?"订单金额不够":"未知原因"},payNow:function(){this.submitOrder()},enterSuccess:function(){"2"==this.$store.state.webtype||"3"==this.$store.state.webtype?this.$bridgefunc.setItem("scanbuy_cart_number","0"):c.a.set({key:"scanbuy_cart_number",value:"0",isPublic:!0}),this.$bridgefunc.destroyPreviousController(),window.localStorage.removeItem("historyPros"),this.$router.replace({path:"/mall2/scanbuypaysuccess",query:{orderId:this.payInfo.orderId,payAmount:this.payInfo.payAmount,payWayText:this.selectedPayWay.text,tradeNo:this.payInfo.tradeNo}})},checkPayResult:function(){var t=this;this.$Loading.open();var e={token:this.$store.state.login.token,orderType:this.payInfo.orderType,orderId:this.payInfo.orderId};this.$http.post("/app/json/app_shopping_order/detail",e).then((function(e){t.$Loading.close();var i=e.data;0==i.status&&3==i.data.state&&t.enterSuccess()}),(function(e){t.$Loading.close()}))},payEvent:function(){var t=this;null!=this.selectedPayWay?n.a.payEvent(this.selectedPayWay,this.payInfo.orderType,this.payInfo.orderId).then((function(){t.enterSuccess()})).catch((function(){})):this.$Toast("请选择支付方式！")},submitOrder:function(){var t=this,e=this.paramsData;if(e.isScanBuy=!0,e.couNo=[],this.usedCoupons.length>0)for(var i=0;i<this.usedCoupons.length;i++)e.couNo.push(this.usedCoupons[i].couNo);e.token=this.$store.state.login.token,e.orderScene=this.$util.orderScene(),this.referrer&&this.referrer.length&&(e.rfrCode=this.referrer),this.referrer==this.scanCode?e.rfrCodeType=2:e.rfrCodeType=1,e.userInvoice={},null!=this.currentInvoice&&1==this.useInvoice&&(e.userInvoice.invoiceUse="1",e.userInvoice.invoiceType="1",0==this.currentInvoice.type?(e.userInvoice.invoiceTitleType="4",e.userInvoice.invoiceTitle="个人"):(e.userInvoice.invoiceTitleType="5",e.userInvoice.invoiceTitle=this.currentInvoice.company),e.userInvoice.invoiceUserName=this.currentInvoice.name,e.userInvoice.invoiceUserEmail=this.currentInvoice.email,e.userInvoice.invoiceUserMobile=this.currentInvoice.phone,e.userInvoice.invoiceUserOrgTaxNo=this.currentInvoice.identifyNumber,e.userInvoice.invoiceDetailType=this.currentInvoice.selectedGoodsType),this.$Loading.open(),this.$http.post("/app/json/app_shopping_order/submit",e).then((function(e){t.$Loading.close();var i=e.data;0==i.status?(t.payInfo=i.data,t.payEvent()):t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},backEvent:function(){this.$router.go(-1)},selectPayWay:function(t){this.selectedPayWay=t,this.payWayPopShow=!1},getPayWays:function(){var t,e=this;return(t=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.getPayWays("200001",e.storeOuCode);case 2:e.payWays=t.sent,e.payWays.length>0&&(e.selectedPayWay=e.payWays[0]);case 4:case"end":return t.stop()}}),t,e)})),function(){var e=t.apply(this,arguments);return new Promise((function(t,i){return function a(s,o){try{var n=e[s](o),c=n.value}catch(t){return void i(t)}if(!n.done)return Promise.resolve(c).then((function(t){a("next",t)}),(function(t){a("throw",t)}));t(c)}("next")}))})()},payWayEvent:function(t){},popClose:function(){this.payWayPopShow=!1},buyMoreEvent:function(){this.backEvent()},getTotalPriceDuan:function(t){return this.$util.toDecimal2(this.occurData.payAmount).split(".")[t]},numChange:function(t){this.historyPros=this.getNewPros(t.skuId,t.number),this.reSettleCart()},getNewPros:function(t,e){for(var i=[],a=0;a<this.historyPros.length;a++){var s=this.historyPros[a];t==s.skuId?0!=e&&(s.number=e,i.push(s)):i.push(s)}return i},scanCodeFunc:function(){},payWayShow:function(){this.payWayPopShow=!0},useInvoiceEvent:function(){var t=this;if(this.useInvoice=!this.useInvoice,this.useInvoice&&null==this.invoiceData){this.$Loading.open();var e={token:this.$store.state.login.token};this.$http.post("/app/json/order_invoice/loadTwoTypeDefaultUserInvoiceHead",e).then((function(e){t.$Loading.close();var i=e.data;0==i.status?(t.invoiceData=i.data,"personal"==t.invoiceData.current?(t.currentInvoice=t.invoiceData.personal,t.currentInvoice.name=t.invoiceData.personal.title,t.invoiceInfo=t.invoiceData.personal.title,t.currentInvoice.type=0):(t.currentInvoice.type=1,t.currentInvoice=t.invoiceData.company,t.currentInvoice.invoiceTitle=t.currentInvoice.company.title,t.invoiceInfo=t.invoiceData.company.title),t.invoiceData.phone=t.$store.state.login.phone,t.invoiceData.email=t.$store.state.userInfo.email,t.invoiceData.name=t.$store.state.userInfo.nickName):t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}},changeInvoice:function(){var t=this;o.a.open({initData:r({},this.invoiceData,{token:this.$store.state.login.token}),selectedInvoice:function(e){console.log(e),t.currentInvoice=e,0==e.type?(t.invoiceInfo="个人",t.invoiceData.personal.title=e.name,t.invoiceData.personal.userPhone=e.phone,t.invoiceData.personal.userEmail=e.email):(t.invoiceInfo=e.company,t.invoiceData.company.userPhone=e.phone,t.invoiceData.company.userEmail=e.email,t.invoiceData.company.orgTaxNo=e.identifyNumber,t.invoiceData.company.title=e.company),o.a.close()},invoiceInformation:function(){t.showAgreement=!0}})},couponEvent:function(){for(var t=this,e=0;e<this.occurData.userCanUseCoupon.length;e++){var i=this.occurData.userCanUseCoupon[e].couNo;this.occurData.userCanUseCoupon[e].selected=!1;for(var a=0;a<this.usedCoupons.length;a++)if(this.usedCoupons[a].couNo==i){this.occurData.userCanUseCoupon[e].selected=!0;break}}s.a.open({initData:{listData:[],userCanNotUseCoupon:this.occurData.userCanNotUseCoupon,userCanUseCoupon:this.occurData.userCanUseCoupon,type:"use",skuId:"",categoryId:"",storeOuCode:"",token:this.$store.state.login.token,payAmount:this.$util.toDecimal2(parseFloat(this.occurData.payAmount)+parseFloat(this.occurData.couponAmount))},selectedCoupon:function(e){t.usedCoupons=e,t.reSettleCart(),s.a.close()}})},deleteEvent:function(t){var e=this;return function(i,a){switch(i){case"left":case"cell":case"outside":a.close();break;case"right":if(console.log(t),1==e.historyPros.length){e.$Toast("至少需要购买一个商品！"),a.close();break}e.historyPros=e.getNewPros(t.skuId,0),e.reSettleCart(),a.close()}}},initData:function(){this.pointsGain=this.lastRes.pointsGain,this.occurData=this.lastRes.occur[0],console.log(this.occurData);var t=this.occurData.couNo;if(this.usedCoupons=[],t.length>0)for(var e=0;e<t.length;e++)this.usedCoupons.push({couNo:t[e]});this.payDigitals=[];for(var i=0;i<this.occurData.digitalList.length;i++){var a=this.occurData.digitalList[i];a.payDigital>a.fixedDigital?this.payDigitals.push({acctType:a.acctType,payDigital:a.userCanUseDigital+a.fixedDigital}):this.payDigitals.push({acctType:a.acctType,payDigital:a.fixedDigital})}},getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},reSettleCart:function(){var t=this;this.$Loading.open();var e=this.paramsData;e.isScanBuy=!0,e.couNo=[],e.carts=this.historyPros,e.deliveryType="1",e.pickupId=this.pickupId,e.payDigital=this.payDigitals;for(var i=0,a=0;a<this.historyPros.length;a++)i+=this.historyPros[a].number;"3"==this.$store.state.webtype||"2"==this.$store.state.webtype?this.$bridgefunc.setItem("scanbuy_cart_number",i):c.a.set({key:"scanbuy_cart_number",value:i,isPublic:!0}),this.$http.post("/app/json/app_cart/SettleCart",e).then((function(i){t.$Loading.close();var a=i.data;0==a.status?(window.localStorage.setItem("historyPros",JSON.stringify(t.historyPros)),t.lastRes=a.data,t.paramsData=e,t.initData(),t.$mallCommon.isExistCanNotAttendActivity(a.data.occur,!0)):t.$Toast(a.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}},created:function(){this.storeOuCode=this.$route.query.storeoucode,this.pickupId=this.$route.query.pickupId,this.getPayWays();var t=window.localStorage.getItem("historyPros");this.historyPros=t&&null!=t&&""!=t?JSON.parse(t):[],this.reSettleCart()}},u=(i("NMLE"),i("KHd+")),v=Object(u.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"place-order mall2"},[i("nav-top",{on:{backEvent:t.backEvent}}),t._v(" "),t.lastRes?i("nav-content",[i("div",{staticClass:"scroll-div"},[i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row",on:{click:t.payWayShow}},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("支付方式")]),t._v(" "),i("div",{staticClass:"full"}),t._v(" "),i("div",{staticClass:"theme_font_common right-margin"},[t._v(t._s(t.selectedPayWay.text))]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])])]),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"title full theme_font_common"},[t._v("发票")]),t._v(" "),i("div",{staticClass:"swith",on:{click:t.useInvoiceEvent}},[t.useInvoice?i("img",{attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),t._v(" "),t.useInvoice?t._e():i("img",{attrs:{src:"static/image/mall2/switch-off.png"}})])]),t._v(" "),t.useInvoice?i("div",{staticClass:"flex-row",on:{click:t.changeInvoice}},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("发票信息")]),t._v(" "),i("div",{staticClass:"full"}),t._v(" "),i("div",{staticClass:"theme_font_black right-margin",class:{theme_font_tint:""==t.invoiceInfo}},[t._v(t._s(""!=t.invoiceInfo?t.invoiceInfo:"请编辑发票信息")+"\n          ")]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])]):t._e()]),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row",on:{click:t.couponEvent}},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("优惠券")]),t._v(" "),i("div",{staticClass:"full"}),t._v(" "),i("div",{staticClass:"theme_font_black right-margin"},[t._v("优惠"+t._s(t.$util.toDecimal2(t.occurData.couponAmount))+"元")]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])]),t._v(" "),t._l(t.occurData.digitalList,(function(e){return i("div",[0!=e.deductionState?i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle theme_font_common"},[t._v(t._s(t.getDigitalDisplayName(e.acctType)))]),t._v(" "),i("div",{staticClass:"full"}),t._v(" "),e.userCanUseDigital>0?i("div",{staticClass:"right-margin"},[t._v("\n              共"+t._s(e.userBalanceDigital)+"，可用"+t._s(e.userCanUseDigital)+"，抵￥"+t._s(t.$util.toDecimal2(e.userCanUseDigitalAmount))+"元\n            ")]):t._e(),t._v(" "),e.userCanUseDigital<=0?i("div",{staticClass:"right-margin"},[t._v("\n              共"+t._s(e.userBalanceDigital)+"，"+t._s(t.getCanNotUseStr(e.deductionState))+"，不能使用\n            ")]):t._e(),t._v(" "),i("div",{staticClass:"swith",on:{click:function(i){return t.useDigitalEvent(e)}}},[e.payDigital>e.fixedDigital?i("img",{attrs:{src:"static/image/mall2/switch-on.png"}}):t._e(),t._v(" "),e.payDigital<=e.fixedDigital?i("img",{attrs:{src:"static/image/mall2/switch-off.png"}}):t._e()])]):t._e()])}))],2),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("商品金额")]),t._v(" "),i("div",{staticClass:"theme_font_black"},[t._v("￥"+t._s(t.$util.toDecimal2(t.occurData.amount)))])]),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("立减")]),t._v(" "),i("div",{staticClass:"theme_font_red"},[t._v("-￥"+t._s(t.$util.toDecimal2(t.occurData.discountAmount)))])]),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("优惠券")]),t._v(" "),i("div",{staticClass:"theme_font_red"},[t._v("-￥"+t._s(t.$util.toDecimal2(t.occurData.couponAmount)))])]),t._v(" "),t._l(t.occurData.digitalList,(function(e){return e.payDigital>e.fixedDigital?i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v(t._s(t.getDigitalDisplayName(e.acctType)))]),t._v(" "),i("div",{staticClass:"theme_font_red"},[t._v("-￥"+t._s(t.$util.toDecimal2(e.userCanUseDigitalAmount)))])]):t._e()}))],2),t._v(" "),t.recommendDisabled?i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"passwords-input"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("推荐人")]),t._v(" "),i("div",{staticClass:"passwords"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.referrer,expression:"referrer"}],attrs:{placeholder:"请输入推荐码",disabled:!t.canEditReferrer},domProps:{value:t.referrer},on:{input:function(e){e.target.composing||(t.referrer=e.target.value)}}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.canEditReferrer,expression:"canEditReferrer"}],staticClass:"show-passwords",on:{click:t.scanCodeFunc}},[i("img",{staticClass:"scancode",attrs:{src:"static/image/setting/icon-scan.png"}})])])])]):t._e(),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"name"},[t._v(t._s(t.occurData.store[0].storeName))])]),t._v(" "),t._l(t.occurData.store[0].noActivityCart,(function(e,a){return i("van-swipe-cell",{key:a,attrs:{"right-width":80,"on-close":t.deleteEvent(e)}},[i("div",{staticClass:"pro-row"},[i("div",{staticClass:"img-div"},[i("img",{attrs:{src:e.phPictureUrl}})]),t._v(" "),i("div",{staticClass:"info-div"},[i("div",{staticClass:"title single-line"},[t._v(t._s(e.productName))]),t._v(" "),i("div",{staticClass:"price-number"},[i("PriceOrder",{attrs:{productData:e}}),t._v(" "),i("van-stepper",{attrs:{min:e.saleNumBegin,max:e.saleNumMax,step:e.saleNumStep,integer:""},on:{change:function(i){return t.numChange(e)}},model:{value:e.number,callback:function(i){t.$set(e,"number",i)},expression:"item.number"}})],1)])]),t._v(" "),i("div",{staticClass:"delete-btn",attrs:{slot:"right"},slot:"right"},[t._v("删除")])])})),t._v(" "),i("div",{staticClass:"buy-more theme_font_gray",on:{click:t.buyMoreEvent}},[t._v("继续购买商品")])],2)]),t._v(" "),i("div",{staticClass:"place-bottom-div"},[i("div",{staticClass:"rmb-div"},[i("span",{staticClass:"theme_font_red"},[t._v("￥")]),t._v(" "),i("span",{staticClass:"price-big theme_font_red"},[t._v(t._s(t.getTotalPriceDuan(0)))]),t._v(" "),i("span",{staticClass:"theme_font_red"},[t._v("."+t._s(t.getTotalPriceDuan(1)))])]),t._v(" "),i("div",{staticClass:"pay-now theme_font_white theme_bg_red",on:{click:t.payNow}},[t._v("立即支付")])])]):t._e(),t._v(" "),t.payWayPopShow?i("pop-view",{on:{closeEvent:t.popClose}},[i("div",{staticClass:"pop-body"},[i("div",{staticClass:"pop-title theme_font_common"},[t._v("请选择支付方式")]),t._v(" "),i("div",{staticClass:"items-div pop-scroll-div"},t._l(t.payWays,(function(e,a){return i("div",{staticClass:"pay-way",class:{"line-top":0!=a},on:{click:function(i){return t.selectPayWay(e)}}},[i("div",{staticClass:"icon-div"},[i("img",{attrs:{src:e.icon}})]),t._v(" "),i("div",{staticClass:"full"},[t._v(t._s(e.text))]),t._v(" "),i("div",{staticClass:"selected-mark"},[t.selectedPayWay.payModeSub!=e.payModeSub?i("i",{staticClass:"iconfont mall-weixuanzhong theme_font_tint"}):i("i",{staticClass:"iconfont mall-xuanzhong theme_font_red"})])])})),0)])]):t._e()],1)}),[],!1,null,"de241b08",null);e.default=v.exports},v52b:function(t,e,i){}}]);