(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67b791cc"],{"0bb3":function(t,e,i){},"11a9":function(t,e,i){"use strict";i("fe8c")},"12dd":function(t,e,i){},"1ea4":function(t,e,i){"use strict";i("6e2c")},4059:function(t,e,i){},5627:function(t,e,i){},"5c7a":function(t,e,i){"use strict";i("eac1")},"6b2c":function(t,e,i){"use strict";i("5627")},"6e2c":function(t,e,i){},"72c7":function(t,e,i){"use strict";var s=i("378f"),a=i("653a"),r=i("751a"),c=i("550c"),n=i("99fa"),o=(i("ca00"),{checkIsInitialLoad:function(t){"cnooc"!=a["a"].state.globalConfig.app_home_special_flag?0==a["a"].state.mall2.pickupAddressChecked?(a["a"].state.mall2.pickupAddressChecked=!0,s["a"].vuexStorage(),o.getLocation(t)):t(null):t()},getLocation:function(t){s["a"].getLocation((function(e){e.city&&""!=e.city?(a["a"].state.currentLocation.posx=e.longitude,a["a"].state.currentLocation.posy=e.latitude,o.loadNeerPickupAddress(t)):t(null)}))},loadNeerPickupAddress:function(t){var e="/app/json/user_address/searchSelfliftAddressList",i={posx:a["a"].state.currentLocation.posx,posy:a["a"].state.currentLocation.posy,page:{index:1,pageSize:1}};r["a"].post(e,i).then((function(e){var i=e.data;if(0==i.status)if(i.data&&i.data.length>0){var s=i.data[0];o.checkEqualAndDistance(s,t)}else t(null);else t(null)}),(function(e){t(null)}))},checkEqualAndDistance:function(t,e){t.id!=a["a"].state.mall2.zitiAddress.id&&t.distance<500?c["a"].confirm("距离您最近的自提点是："+t.storeName+",是否切换到最近自提点","提示").then((function(i){o.reSelectPickupAddress(t,e)}))["catch"]((function(t){e(null)})):e(null)},reSelectPickupAddress:function(t,e){a["a"].state.mall2.zitiAddress=t,s["a"].vuexStorage((function(){e(t)})),a["a"].state.login.token&&""!=a["a"].state.login.token&&(n["a"]._addToMyPickupAddress(t.id),n["a"]._setDefaultPickupAddress(t.id))}});e["a"]=o},9916:function(t,e,i){"use strict";i("0bb3")},db55:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart"},[i("nav-top",{attrs:{noTitle:!0},on:{backEvent:t.backEvent}},[i("div",{staticClass:"cart-top"},[i("div",{staticClass:"cart-title",on:{click:function(e){return t.chooseAddress(t.deliverType)}}},[i("span",{staticClass:"title theme_font_black"},[t._v("购物车")]),i("span",{staticClass:"address theme_font_gray"},[t._v(t._s(t.getAddressName()))]),i("i",{staticClass:"iconfont mall-dingwei theme_font_black"})])])]),i("nav-content",[2==t.$store.state.webtype?i("div",{staticClass:"cart-top"},[i("div",{staticClass:"cart-title",on:{click:function(e){return t.chooseAddress(t.deliverType)}}},[i("span",{staticClass:"title theme_font_black"},[t._v("购物车")]),i("span",{staticClass:"address theme_font_gray"},[t._v(t._s(t.getAddressName()))]),i("i",{staticClass:"iconfont mall-dingwei theme_font_black"})])]):t._e(),"1"!=t.$store.state.globalConfig.delivertype_default&&"2"!=t.$store.state.globalConfig.delivertype_default?i("div",{staticClass:"row"},t._l(t.topArr,(function(e,s){return i("div",{staticClass:"type-btn",class:{theme_light_bg:t.deliverType==e.type,theme_standard_bdr_i:t.deliverType==e.type},on:{click:function(i){return t.deliverTypeEvent(e)}}},[i("i",{staticClass:"iconfont  theme_font_common icon-size",class:[e.class,{theme_standard_font_i:t.deliverType==e.type}]}),i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v(t._s(e.name))]),t.peisongNum>0&&2==e.type?i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v("("+t._s(t.peisongNum)+")")]):t._e(),t.zitiNum>0&&1==e.type?i("span",{staticClass:"theme_font_common",class:{theme_standard_font_i:t.deliverType==e.type}},[t._v("("+t._s(t.zitiNum)+")")]):t._e()])})),0):t._e(),i("div",{class:{notop:"1"==t.$store.state.globalConfig.delivertype_default||"2"==t.$store.state.globalConfig.delivertype_default}},[i("p",{staticStyle:{margin:"10px","font-size":"15px"}},[t._v("普通商品")]),t._l(t.topArr,(function(e,s){return e.hasShow?i("CartList",{directives:[{name:"show",rawName:"v-show",value:t.deliverType==e.type,expression:"deliverType == item.type"}],key:s,ref:t.getCartRef(e.type),refInFor:!0,attrs:{deliverType:e.type,isEditing:t.isEditing},on:{updateEdit:t.setEdit}}):t._e()})),i("p",{staticStyle:{margin:"10px","font-size":"15px"}},[t._v("团购商品")]),t._l(t.topArr,(function(e,s){return e.hasShow?i("buyingCartList",{directives:[{name:"show",rawName:"v-show",value:t.deliverType==e.type,expression:"deliverType == item.type"}],key:s+100,ref:t.getCartRef(e.type),refInFor:!0,attrs:{deliverType:e.type,isEditing:t.isEditing},on:{updateEdit:t.setEdit}}):t._e()}))],2)])],1)},a=[],r=(i("4795"),i("ac1f"),i("1276"),i("99af"),i("a026")),c=i("ca00"),n=(i("653a"),{getTopArr:function(){var t=[{name:"配送",type:2,hasShow:!1,class:"mall-peisong",occurArr:[]},{name:"自提",type:1,hasShow:!1,class:"mall-ziti",occurArr:[]}];return t},dealCartList:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.checked=!0;for(var s=0;s<i.store.length;s++){var a=i.store[s];a.checked=this.judgeStoreIsSel(a,!1),a.checked||(i.checked=!1);for(var r=a.activity,c=0;c<r.length;c++){var n=r[c];n.number=this.getActivityNum(n)}}}return t},getActivityNum:function(t){for(var e=0,i=0;i<t.cart.length;i++){var s=t.cart[i];0==s.isGift&&1==s.checked&&(e+=s.number)}return e},judgeStoreIsSel:function(t,e){for(var i=this.getCheckKey(e),s=0;s<t.activity.length;s++)for(var a=t.activity[s],r=0;r<a.cart.length;r++){var c=a.cart[r];if(!c[i])return!1}for(var n=0;n<t.noActivityCart.length;n++){var o=t.noActivityCart[n];if(!o[i])return!1}return!0},getItemAmount:function(t,e){var i=c["a"].toDecimal2(t),s=i.split(".");return s.length>e?s[e]:"00"},getXZClass:function(t,e,i){return t?i?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray":e?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray"},getOccClass:function(t,e,i){return t?i?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray":e?"mall-xuanzhong theme_standard_font":"mall-weixuanzhong theme_font_gray"},setAllUnSel:function(t){for(var e=0;e<t.length;e++){var i=t[e];r["default"].set(i,"dchecked",!1);for(var s=0;s<i.store.length;s++){var a=i.store[s];r["default"].set(a,"dchecked",!1);for(var c=0;c<a.activity.length;c++)for(var n=a.activity[c],o=0;o<n.cart.length;o++){var l=n.cart[o];r["default"].set(l,"dchecked",!1)}for(var u=0;u<a.noActivityCart.length;u++){var d=a.noActivityCart[u];r["default"].set(d,"dchecked",!1)}}}return t},setOccSel:function(t,e){var i=this.getCheckKey(e);t[i]=!t[i];for(var s=0;s<t.store.length;s++){var a=t.store[s];this.setStoreSel(a,e,t[i])}},setStoreSel:function(t,e,i,s){var a=this.getCheckKey(e);void 0==i&&(i=!t[a]),t[a]=i;for(var r=0;r<t.activity.length;r++)for(var c=t.activity[r],n=0;n<c.cart.length;n++){var o=c.cart[n];o[a]=i}for(var l=0;l<t.noActivityCart.length;l++){var u=t.noActivityCart[l];u[a]=i}s&&this.resetOccurItem(s,e,i)},resetOccurItem:function(t,e,i){var s=this.getCheckKey(e),a=!0;if(i)for(var r=0;r<t.store.length;r++){var c=t.store[r],n=c[s];if(!n){a=!1;break}}else a=!1;t[s]=a},setCartSel:function(t,e,i,s){var a=this.getCheckKey(e);t[a]=!t[a];var r=!0;r=!!t[a]&&this.judgeStoreIsSel(i,e),i[a]=r,this.resetOccurItem(s,e,r)},getPayNum:function(t,e){if(e)return 0;for(var i=this.getCheckKey(e),s=0,a=0;a<t.store.length;a++){for(var r=t.store[a],c=0;c<r.activity.length;c++)for(var n=r.activity[c],o=0;o<n.cart.length;o++){var l=n.cart[o];l[i]&&"0"==l.isGift&&(s+=l.number)}for(var u=0;u<r.noActivityCart.length;u++){var d=r.noActivityCart[u];d[i]&&(s+=d.number)}}return s},getCheckKey:function(t){return t?"dchecked":"checked"},getSelOccur:function(t,e,i){this.getCheckKey(e);for(var s=[],a=0;a<t.store.length;a++){var r=t.store[a],c=this.getSelStore(r,e,i);s=s.concat(c)}if("update"==i)for(var n=0;n<s.length;n++){var o=s[n];o.checked=t.checked?0:1}return s},getSelStore:function(t,e,i){for(var s=this.getCheckKey(e),a=[],r=0;r<t.activity.length;r++)for(var c=t.activity[r],n=0;n<c.cart.length;n++){var o=c.cart[n];(o[s]||"update"==i)&&a.push(this.revertCartitemToDic(o,i,t))}for(var l=0;l<t.noActivityCart.length;l++){var u=t.noActivityCart[l];(u[s]||"update"==i)&&a.push(this.revertCartitemToDic(u,i,t))}return a},getInvalidArr:function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];e.push(this.revertCartitemToDic(s,"delete"))}return e},revertCartitemToDic:function(t,e,i){var s={};return"update"==e?(s={skuId:t.skuId,storeOuCode:t.storeOuCode,checked:i.checked?0:1,activityId:t.activityId,isGift:t.isGift},t.currentSelfActivity&&""!=t.currentSelfActivity&&t.currentSelfActivity.mktActivityId&&""!=t.currentSelfActivity.mktActivityId&&(s.selfActivityId=t.currentSelfActivity.mktActivityId)):"pay"==e?(s={id:t.id,skuId:t.skuId,storeOuCode:t.storeOuCode,number:t.number,activityId:t.activityId,checked:t.checked,isGift:t.isGift},t.currentSelfActivity&&""!=t.currentSelfActivity&&t.currentSelfActivity.mktActivityId&&""!=t.currentSelfActivity.mktActivityId&&(s.selfActivityId=t.currentSelfActivity.mktActivityId),null!=t.currentSelfActivity&&""==t.currentSelfActivity&&t.selfActivity&&""!=t.selfActivity&&t.selfActivity.length>0&&(s.selfActivityId="-2")):"delete"==e&&(s={skuId:t.skuId,storeOuCode:t.storeOuCode,isGift:t.isGift,activityId:t.activityId}),s},getActivityRightTitle:function(t){if(1==t.linkType||5==t.linkType||6==t.linkType)return"去凑单";if(2==t.linkType)return"再逛逛";if(3==t.linkType){for(var e=!1,i=0;i<t.cart.length;i++){var s=t.cart[i];if(1==s.isGift){e=!0;break}}return e?"重新领取":"领赠品"}if(4==t.linkType){for(var a=!1,r=0;r<t.cart.length;r++){var c=t.cart[r];if(2==c.isGift){a=!0;break}}return a?"重新领取":"去换购"}return"再逛逛"},getGiftIsOnlyScan:function(t){var e=!0;return 3!=t.linkType&&4!=t.linkType||(e=!1),e},getGiftType:function(t){var e=1;return 4!=t.linkType&&6!=t.linkType||(e=2),e}}),o=n,l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-list"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.occurArr.length||t.invalidCart.length,expression:"occurArr.length || invalidCart.length"}],ref:"scrollwarp",staticClass:"cart-content"},[t._l(t.occurArr,(function(e,s){return i("div",{ref:t.getCartRef(s),refInFor:!0,staticClass:"occur-div theme_bg_white"},[i("div",{staticClass:"occur-title theme_font_white theme_bg_ml_red",on:{click:function(i){return t.setOccSel(e)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getOccClass(t.isEditing,e.checked,e.dchecked)}),i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" "+t._s(e.ouName))])]),t._l(e.store,(function(s,a){return i("div",{staticClass:"store-div"},[i("div",{staticClass:"store-title"},[i("div",{staticClass:"leftcontent"},[i("i",{staticClass:"iconfont font-large-x",class:t.cartJS.getXZClass(t.isEditing,s.checked,s.dchecked),on:{click:function(i){return t.setStoreSel(s,void 0,e)}}}),i("span",{on:{click:function(e){return t.toShop(s)}}},[i("i",{staticClass:"iconfont mall-dianpu font-large-x"}),t._v(" "+t._s(s.storeName))])])]),t._l(s.activity,(function(a,r){return i("div",{staticClass:"store-content"},[i("div",{staticClass:"activity-title"},[i("div",{staticClass:"leftcontent single-line"},[i("span",{staticClass:"ac-tag theme_font_white theme_bg_red"},[t._v(t._s(a.mktActivityType))]),i("span",{staticClass:"ac-title theme_font_gray  marL single-line"},[t._v(t._s(a.activityDiscountDesc))])]),t.cartJS.getActivityRightTitle(a)?i("div",{staticClass:"rightcontent",on:{click:function(e){return t.rightActivityClick(a)}}},[i("span",{staticClass:"theme_font_red"},[t._v(t._s(t.cartJS.getActivityRightTitle(a)))]),i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_red font-large marL"})]):t._e()]),i("div",{staticClass:"activity-content"},t._l(a.cart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])})),i("div",{staticClass:"store-content marT10"},[i("div",{staticClass:"activity-content"},t._l(s.noActivityCart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])],2)})),i("PayDiv",{directives:[{name:"show",rawName:"v-show",value:t.showFirstBt,expression:"showFirstBt"}],attrs:{occuritem:e,isEditing:t.isEditing},on:{setOccSel:t.setOccSel,toPay:t.toPay,toDelete:t.toDelete}})],2)})),i("div",{directives:[{name:"show",rawName:"v-show",value:t.invalidCart&&t.invalidCart.length,expression:"invalidCart && invalidCart.length"}],staticClass:"occur-div  theme_bg_white"},[i("div",{staticClass:"occur-title title-between theme_font_white theme_bg_ml_red"},[t._m(0),i("span",{staticClass:"theme_font_tint flotr",on:{click:function(e){return e.stopPropagation(),t.clearInvalid.apply(null,arguments)}}},[t._v("清除所有")])]),i("div",{staticClass:"invalid-content"},t._l(t.invalidCart,(function(t,e){return i("InvalidCartItem",{key:e,attrs:{cartitem:t}})})),1)])],2),t.occurArr.length||t.invalidCart.length||!t.isHasRequest?t._e():i("div",{staticClass:"nodata-content"},[t._m(1)])])},u=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" 失效的宝贝")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"noCart"},[i("div",{staticClass:"noCartTag"},[i("i",{staticClass:"iconfont mall-gouwuche btn-icon theme_font_tint"}),i("p",{staticClass:"text theme_font_tint"},[t._v("您的购物车是空的,去逛逛吧！")])])])}],d=i("5530"),h=(i("4160"),i("159b"),i("a434"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-swipe-cell",{staticClass:"cell-swipe",attrs:{"right-width":80,"on-close":t.onClose}},[i("div",{staticClass:"cart-item"},[i("div",{staticClass:"cart-item-sel"},[i("i",{directives:[{name:"show",rawName:"v-show",value:0==t.cartitem.isGift||t.isEditing,expression:"cartitem.isGift == 0 || isEditing "}],staticClass:"iconfont font-large",class:t.cartJS.getXZClass(t.isEditing,t.cartitem.checked,t.cartitem.dchecked),on:{click:function(e){return t.setCartSel(t.cartitem,t.storeitem,t.occuritem)}}})]),i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img",class:{"img-samll":0!=t.cartitem.isGift}},[i("div",{staticClass:"click-div",on:{click:function(e){return e.stopPropagation(),t.enterGoodDetail(t.cartitem)}}}),i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}}),1==t.cartitem.state||4==t.cartitem.state?i("div",{staticClass:"cart-item-state theme_font_white"},[t._v(" "+t._s(t.getStateStr())+" ")]):t._e()]),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name line-two",class:t.getFontColorClass()},[1==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("赠品")]):t._e(),2==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("换购")]):t._e(),t._v(" "+t._s(t.cartitem.productName))]),0==t.cartitem.isGift?i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))]):t._e(),i("div",{staticClass:"good-paras"},[i("div",{staticClass:"paras-left"},[i("PriceOrder",{attrs:{productData:t.cartitem}})],1),i("div",{staticClass:"paras-right"},[0==t.cartitem.isGift&&1!=t.cartitem.state&&4!=t.cartitem.state?i("van-stepper",{attrs:{min:t.cartitem.saleNumBegin,step:t.cartitem.saleNumStep,max:t.cartitem.saleNumMax,integer:""},on:{change:t.numChange},model:{value:t.cartitem.number,callback:function(e){t.$set(t.cartitem,"number",e)},expression:"cartitem.number"}}):t._e(),0!=t.cartitem.isGift?i("span",{staticClass:"gift-num theme_font_gray"},[t._v("X"+t._s(t.cartitem.number))]):t._e()],1)])])])]),t.singleActivities_2.length>0&&null!=t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityType))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(t.curSingleActivity.digitalPrice)+t._s(t.getDigitalDisplayName(t.curSingleActivity.acctType))+" + ¥"+t._s(t.$util.toDecimal2(t.curSingleActivity.price)))])]),t.singleActivities_2.length>1?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseSingleActivity()}}},[t._v("修改")]):t._e(),1==t.singleActivities_2.length?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.removeSingleActivity()}}},[t._v("不参加")]):t._e()]):t._e(),t._l(t.singleActivities_2,(function(e){return t.singleActivities_2.length>0&&null==t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(e.currentSelfActivity.mktActivityType))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(e.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(e.digitalPrice)+t._s(t.getDigitalDisplayName(e.acctType))+" + ¥"+t._s(t.$util.toDecimal2(e.price)))])]),i("p",{staticClass:"good-salespro-right",on:{click:function(i){return t.joinSingleActivity(e.currentSelfActivity)}}},[t._v("参加")])]):t._e()})),t.cartitem.activity.length>1&&0==t.cartitem.isGift?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sl-tag theme_border_red_i theme_font_red"},[t._v(t._s(t.getActivityTag()))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.getActivityTitle()))]),i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseActivity()}}},[t._v("修改")])]):t._e()],2)]),i("div",{staticClass:"del-btn",attrs:{slot:"right"},slot:"right"},[t._v("删除")])])],1)}),v=[],m=i("590c"),f=i("76a0"),g={name:"cart-item",components:{CellSwipe:f["CellSwipe"],PriceOrder:m["a"]},props:["cartitem","storeitem","occuritem","isEditing"],data:function(){return{cartJS:o,singleActivities_2:[],curSingleActivity:null}},methods:{getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},onClose:function(t,e){switch(t){case"left":case"cell":case"outside":e.close();break;case"right":this.$emit("deleteCart",[this.cartitem]),e.close();break}},initSingleActivity:function(){if(this.singleActivities_2=[],this.cartitem.currentSelfActivity&&2==this.cartitem.currentSelfActivity.mktActivityPriceLevel?(this.curSingleActivity=this.cartitem,this.singleActivities_2.push(this.cartitem)):this.curSingleActivity=null,this.cartitem.selfActivity)for(var t=0;t<this.cartitem.selfActivity.length;t++){var e=this.cartitem.selfActivity[t],i=e.currentSelfActivity;2==i.mktActivityPriceLevel&&this.singleActivities_2.push(e)}},removeSingleActivity:function(){var t=this,e=this.$store.state.microSho.carts;e.forEach((function(e,i){t.cartitem.skuId!=e.skuId||(t.$store.state.microSho.carts[i].selfActivityId="-2")})),this.$emit("updateCart")},joinSingleActivity:function(t){var e=this,i=this.$store.state.microSho.carts;i.forEach((function(i,s){e.cartitem.skuId!=i.skuId||(e.$store.state.microSho.carts[s].selfActivityId=t.mktActivityId)})),this.$emit("updateCart")},reviseSingleActivity:function(){for(var t=this,e=[],i=0;i<this.singleActivities_2.length;i++){var s=this.singleActivities_2[i];e.push({mktActivityId:s.currentSelfActivity.mktActivityId,title:s.currentSelfActivity.mktActivityTitle+" "+s.digitalPrice+this.getDigitalDisplayName(s.acctType)+"+¥"+this.$util.toDecimal2(s.price),checked:s.currentSelfActivity.mktActivityId==this.curSingleActivity.currentSelfActivity.mktActivityId})}e.push({mktActivityId:"-2",title:"不参加兑换活动",checked:!1}),SalesPro.open({listData:e,sureFunc:function(e){var i=[{skuId:t.cartitem.skuId,storeOuCode:t.cartitem.storeOuCode,selfActivityId:e.mktActivityId}];t.$emit("updateCart",i)}})},deleteCartItem:function(){this.$emit("deleteCart",[this.cartitem])},enterGoodDetail:function(t){},setCartSel:function(t,e,i){this.$emit("setCartSel",t,e,i)},getActivityTitle:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityTitle}return""},getActivityTag:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityType}return""},getItemAmount:function(t,e){return o.getItemAmount(t,e)},reviseActivity:function(){for(var t=[],e=0;e<this.cartitem.activity.length;e++){var i=this.cartitem.activity[e],s=!1;this.cartitem.activityId==i.mktActivityId&&(s=!0),t.push({mktActivityId:i.mktActivityId,title:i.mktActivityTitle,checked:s})}SalesPro.open({listData:t,sureFunc:this.sureFunc})},sureFunc:function(t){var e=[{skuId:this.cartitem.skuId,storeOuCode:this.cartitem.storeOuCode,activityId:t.mktActivityId}];this.$emit("updateCart",e)},numChange:function(){this.$emit("numChange",this.cartitem)},getStateStr:function(){return 1==this.cartitem.state?"下架":4==this.cartitem.state?"无货":""},getFontColorClass:function(){return 1==this.cartitem.state||4==this.cartitem.state?"theme_font_gray_i":""}},created:function(){this.initSingleActivity()},watch:{cartitem:function(){this.initSingleActivity()}}},p=g,y=(i("fec7"),i("0c7c")),C=Object(y["a"])(p,h,v,!1,null,null,null),_=C.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-item-invalid"},[i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img"},[i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}})]),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name double-line theme_font_gray"},[t._v(t._s(t.cartitem.productName))]),i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))])])])])])])},k=[],S={name:"cart-item-invalid",components:{},props:["cartitem"],data:function(){return{}},methods:{},created:function(){}},$=S,I=(i("de48"),Object(y["a"])($,A,k,!1,null,"523f6254",null)),T=I.exports,b=i("1fba"),w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pay-div"},[i("div",{staticClass:"pay-left"},[i("div",{staticClass:"selectAll",on:{click:function(e){return t.setOccSel(t.occuritem)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getXZClass(t.isEditing,t.occuritem.checked,t.occuritem.dchecked)}),i("span",{staticClass:"font-medium marL theme_font_black"},[t._v("全选")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEditing,expression:"!isEditing"}],staticClass:"paymoney"},[i("div",[i("span",{staticClass:"theme_font_black font-large-x"},[t._v("合计:")]),t._l(t.occuritem.digitalList,(function(e){return t.getTotalUsePoints(e)>0?i("div",{staticClass:"digital-div"},[i("span",{staticClass:"font-large-x theme_font_red"},[t._v(t._s(t.getTotalUsePoints(e)))]),i("span",{staticClass:"font-small theme_font_red"},[t._v(t._s(t.getTotalUnitStr(e.acctType)))])]):t._e()})),i("span",{directives:[{name:"show",rawName:"v-show",value:t.getShowPrice(),expression:"getShowPrice()"}],staticClass:"font-large-x theme_font_red"},[t._v(t._s(t.cartJS.getItemAmount(t.occuritem.payAmount,0))+".")]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.getShowPrice(),expression:"getShowPrice()"}],staticClass:"font-small theme_font_red"},[t._v(t._s(t.cartJS.getItemAmount(t.occuritem.payAmount,1)))])],2),i("p",{staticClass:"point theme_font_black font-small"},[t._v("总额: ￥"+t._s(t.$util.toDecimal2(t.getTotalStr()))+"    优惠: ￥"+t._s(t.$util.toDecimal2(t.occuritem.discountAmount)))])])]),t.isEditing?t._e():i("div",{staticClass:"pay-right theme_font_white theme_standard_bg font-large-x",on:{click:function(e){return t.toPay(t.occuritem)}}},[t._v(" 结算 "),i("span",{staticClass:"font-small"},[t._v("("+t._s(t.cartJS.getPayNum(t.occuritem,t.isEditing))+")")])]),t.isEditing?i("div",{staticClass:"pay-right theme_font_white theme_standard_bg font-large-x",on:{click:function(e){return t.toDelete(t.occuritem)}}},[t._v(" 删除 ")]):t._e()])},E=[],D=(i("e25e"),{name:"pay-div",props:["occuritem","isEditing"],components:{},data:function(){return{cartJS:o}},methods:{getTotalUnitStr:function(t){for(var e=this.$store.state.globalConfig.acctList,i=0;i<e.length;i++){var s=e[i];if(s.acctType==t)return s.displayName+"+"}return"积分+"},getTotalUsePoints:function(t){var e=0;return(t.fixedDigital>0||t.payDigital>0)&&(e=parseInt(t.fixedDigital)+parseInt(t.payDigital)),e},setOccSel:function(t){this.$emit("setOccSel",t)},toPay:function(t){this.$emit("toPay",t)},toDelete:function(t){this.$emit("toDelete",t)},getUnitStr:function(){var t=this.occuritem.fixedPoints,e=this.occuritem.amount;return t&&""!=t?0==e||""==e?"积分":"积分+￥":"￥"},getShowPrice:function(t,e){var i=this.occuritem.fixedPoints,s=this.occuritem.amount;return 0!=s&&""!=s||!i||""==i},getTotalStr:function(){var t="";return this.occuritem.fixedPoints&&""!=this.occuritem.fixedPoints&&(t+=this.occuritem.fixedPoints),t+=this.getUnitStr(),this.getShowPrice()&&(t+=this.occuritem.amount),t}},created:function(){}}),x=D,L=(i("1ea4"),Object(y["a"])(x,w,E,!1,null,"2111474e",null)),N=L.exports,P=i("2f62"),O={name:"cart-list",components:{CartItem:_,PayDiv:N,InvalidCartItem:T},computed:Object(d["a"])({},Object(P["c"])(["getPutaggregate"])),props:["deliverType","isEditing"],data:function(){return{occurArr:[],invalidCart:[],cartJS:o,isHasRequest:!1,heightArr:[],fixedIndex:-1,showFirstBt:!0,microStoreCode:""}},methods:{clearInvalid:function(){var t=o.getInvalidArr(this.invalidCart);this.deleteCart(t)},toShop:function(t){},getCartRef:function(t){return"mall2cart"+t},goShopList:function(){var t="/mall2/list/"+this.$util.getDataString();this.$router.push({path:t,query:{lastPath:this.$route.path,delivertype:this.deliverType}})},coupon:function(t){var e=this;Coupon.open({initData:{listData:t.userCanGetCoupon,storeOuCode:t.storeOuCode,skuId:"",type:"receive",categoryId:"",token:this.$store.state.login.token},selectedCoupon:function(t){Coupon.close()},getedCoupon:function(t){},couponProducts:function(t){var i="/mall2/list/"+e.$util.getDataString();e.$router.push({path:i,query:{pageType:"coupon",coupon:t.couTypeCode,fromCart:"1",delivertype:e.deliverType,lastPath:e.$route.path,couFaceValue:t.couFaceValue,couThresholdAmount:t.couThresholdAmount,endTime:e.$util.getDateFromString(t.validEndDate)}}),Coupon.close()}})},rightActivityClick:function(t){var e="/mall2/list/"+this.$util.getDataString();this.$router.push({path:e,query:{pageType:"activity",activity:t.mktActivityId,fromCart:"1",delivertype:this.deliverType,skuId:t.cart[0].skuId,storeOuCode:t.cart[0].storeOuCode,lastPath:this.$route.path}})},sureFunc:function(t){var e=this;this.$Loading.open();var i="/app/json/app_cart/addCart",s={token:this.$store.state.login.token,carts:t,deliveryType:this.deliverType};this.$http.post(i,s).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.$store.state.mall2.cartNum=i.data,e.$Toast("添加购物车成功！")):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},setCartSel:function(t,e,i){var s=this;if(this.isEditing)o.setCartSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.carts;a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.carts[i].checked=s.$store.state.microSho.carts[i].checked?0:1)})),this.getDataList()}},setStoreSel:function(t,e,i){var s=this;if(this.isEditing)o.setStoreSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.carts,r=t.noActivityCart||[];r.forEach((function(t,e){a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.carts[i].checked=s.$store.state.microSho.carts[i].checked?0:1)}))})),this.getDataList()}},setOccSel:function(t){var e=this;if(this.isEditing)o.setOccSel(t,this.isEditing);else{for(var i=[],s=0;s<t.store.length;s++){var a=t.store[s],r=this.getSelStore(a,!1);i=i.concat(r)}var c=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){c.forEach((function(s,a){s.skuId==i.skuId&&s.deliverType==e.deliverType&&(e.$store.state.microSho.groupbuyingCarts[a].checked=t.checked?0:1)}))})),this.getDataList()}},getSelStore:function(t,e){for(var i=[],s=0;s<t.noActivityCart.length;s++){var a=t.noActivityCart[s];i.push({checked:e?a.checked:a.checked?0:1,deliverType:a.deliverType,number:a.number,proSkuDistributionId:a.proSkuDistributionId,selfActivityId:a.selfActivityId,skuId:a.skuId,storeOuCode:a.storeOuCode})}return i},toPay:function(t){for(var e=this,i=this.$store.state.microSho.carts,s=[],a=0;a<t.store.length;a++){var r=t.store[a],c=this.getSelStore(r,!0);s=s.concat(c)}var n=[];if(s.forEach((function(t){t.checked&&(i.forEach((function(e){e.skuId==t.skuId&&(t.proSkuDistributionId=e.proSkuDistributionId,t.selfActivityId=e.selfActivityId)})),n.push(t))})),0!=n.length){var l="/app/json/app_cart/SettleCart",u={token:this.$store.state.login.token,deliveryType:this.deliverType,carts:n,microStoreCode:this.microStoreCode};if(2==this.deliverType){if(""==this.$store.state.mall2.selectAddress.id||"undefined"==this.$store.state.mall2.selectAddress.id)return void this.$Toast("请先选择配送区域！");"-1"!=this.$store.state.mall2.selectAddress.id?u.userAddressId=this.$store.state.mall2.selectAddress.id:(u.userAddress={},u.userAddress.provinceId=this.$store.state.mall2.selectAddress.provinceId,u.userAddress.provinceName=this.$store.state.mall2.selectAddress.provinceName,u.userAddress.cityId=this.$store.state.mall2.selectAddress.cityId,u.userAddress.cityName=this.$store.state.mall2.selectAddress.cityName,u.userAddress.countryId=this.$store.state.mall2.selectAddress.countryId,u.userAddress.countryName=this.$store.state.mall2.selectAddress.countryName,u.userAddress.townId=this.$store.state.mall2.selectAddress.townId,u.userAddress.townName=this.$store.state.mall2.selectAddress.townName)}this.setCommonPara(u),this.$Loading.open(),this.$http.post(l,u).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.occurArr=o.dealCartList(i.data.occur),e.isEditing&&o.setAllUnSel(e.occurArr),1==e.$mallCommon.isExistCanNotAttendActivity(i.data.occur)?e.$MessageBox.confirm("部分商品不能参加活动</br>将按原价购买，是否继续？","提示",{confirmButtonText:"确定"}).then((function(t){e.$router.push({name:"填写订单",params:{res:i.data,paramsData:u,deliveryType:e.deliverType}})}))["catch"]((function(t){})):e.$router.push({name:"填写订单",params:{res:i.data,paramsData:u,deliveryType:e.deliverType}})):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))}else this.$Toast("请选择要结算的商品")},toDelete:function(t){var e=this,i=JSON.parse(JSON.stringify(this.$store.state.microSho.carts)),s=t.store||[];s.forEach((function(t){t.noActivityCart.forEach((function(t){i.forEach((function(i,s){i.deliverType==e.deliverType&&t.skuId==i.skuId&&e.$store.state.microSho.carts.splice(s,1)}))}))})),this.getDataList()},setCommonPara:function(t){return 2==this.deliverType?(t.provinceId=this.$store.state.mall2.selectAddress.provinceId,t.cityId=this.$store.state.mall2.selectAddress.cityId,t.countryId=this.$store.state.mall2.selectAddress.countryId):1==this.deliverType&&(t.pickupId=this.$store.state.mall2.zitiAddress.id),!0},_initScroll:function(){var t=this;this.cityListScroll?(this.cityListScroll.refresh(),this.cityListScroll.off("scroll")):this.cityListScroll=new b["a"](this.$refs.scrollwarp,{click:!0,probeType:3,bounce:!1});var e=this.$refs.scrollwarp,i=e.offsetHeight;if(1!=this.occurArr.length||""!=this.invalidCart){this.showFirstBt=!0;for(var s=0;s<this.occurArr.length;s++){var a=this.$refs[this.getCartRef(s)][0],r={top:a.offsetTop,height:a.offsetHeight,isFixed:!1};a.offsetHeight>i&&(r.isFixed=!0),this.heightArr.push(r)}this.cityListScroll.on("scroll",(function(e){if(e.y>5)t.fixedIndex=-1;else{var s=Math.abs(e.y);t.calculateFixedIndex(s,i)}})),this.calculateFixedIndex(0,i)}else{this.fixedIndex=0;var c=this.$refs[this.getCartRef(0)][0],n=c.offsetHeight;n<i&&(this.showFirstBt=!1)}},calculateFixedIndex:function(t,e){for(var i=!1,s=0;s<this.heightArr.length;s++){var a=this.heightArr[s],r=a.top,c=a.height,n=a.isFixed;if(t>=r&&t<=r+c){n&&t<=r+c-e&&(i=!0,this.fixedIndex=s);break}}i||(this.fixedIndex=-1)},_getCartCount:function(){var t=this,e="/app/json/app_cart/getCartCount",i={token:this.$store.state.login.token,deliveryType:this.deliverType};this.$http.post(e,i).then((function(e){var i=e.data;0==i.status?t.$store.state.mall2.cartNum=i.data:t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},numChange:function(t){var e=this,i=this.$store.state.microSho.carts;i.forEach((function(i,s){t.skuId!=i.skuId||(e.$store.state.microSho.carts[s].number=t.number)})),this.getDataList()},updateCart:function(){this.getDataList()},deleteCart:function(t){var e=this;if(t.length){var i=this.$store.state.microSho.carts;i.forEach((function(i,s){t[0].skuId!=i.skuId||e.$store.state.microSho.carts.splice(s,1)})),this.$Toast("删除成功"),this.getDataList()}else this.$Toast("请选择要删除的商品")},getDataList:function(){var t=this,e=this.$store.state.microSho.carts,i=[];if(e.forEach((function(e){e.deliverType==t.deliverType&&i.push(e)})),i.length){this.$Loading.open();var s="/app/json/app_cart/getCart",a={token:this.$store.state.login.token,microStoreCode:this.microStoreCode,carts:i,deliveryType:this.deliverType};this.setCommonPara(a),this.$http.post(s,a).then((function(e){t.$Loading.close();var i=e.data;if(0==i.status){t.isHasRequest=!0,t.occurArr=o.dealCartList(i.data.occur),t.invalidCart=i.data.invalidCart?i.data.invalidCart:[];var s=t.$store.state.microSho.carts;t.invalidCart.forEach((function(e){s.forEach((function(i,s){e.skuId==i.skuId&&t.$store.state.microSho.carts.splice(s,1)}))})),t.isEditing&&o.setAllUnSel(t.occurArr),t.$nextTick((function(){}))}else t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}else this.isHasRequest=!0,this.occurArr=o.dealCartList([]),this.invalidCart=[]}},watch:{isEditing:function(t,e){t&&this.occurArr&&(this.occurArr=o.setAllUnSel(this.occurArr))}},mounted:function(){},created:function(){this.microStoreCode=this.$route.query.microStoreCode?this.$route.query.microStoreCode:"",this.getDataList()},beforeDestroy:function(){}},F=O,G=(i("9916"),Object(y["a"])(F,l,u,!1,null,"3e7d2e22",null)),j=G.exports,z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cart-list"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.occurArr.length||t.invalidCart.length,expression:"occurArr.length || invalidCart.length"}],ref:"scrollwarp",staticClass:"cart-content"},[i("div",[t._l(t.occurArr,(function(e,s){return i("div",{ref:t.getCartRef(s),refInFor:!0,staticClass:"occur-div theme_bg_white"},[i("div",{staticClass:"occur-title theme_font_white theme_bg_ml_red",on:{click:function(i){return t.setOccSel(e)}}},[i("i",{staticClass:"iconfont   font-large-x",class:t.cartJS.getOccClass(t.isEditing,e.checked,e.dchecked)}),i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" "+t._s(e.ouName))])]),t._l(e.store,(function(s,a){return i("div",{staticClass:"store-div"},[i("div",{staticClass:"store-title"},[i("div",{staticClass:"leftcontent"},[i("i",{staticClass:"iconfont font-large-x",class:t.cartJS.getXZClass(t.isEditing,s.checked,s.dchecked),on:{click:function(i){return t.setStoreSel(s,void 0,e)}}}),i("span",{on:{click:function(e){return t.toShop(s)}}},[i("i",{staticClass:"iconfont mall-dianpu font-large-x"}),t._v(" "+t._s(s.storeName))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:s.userCanGetCoupon&&s.userCanGetCoupon.length,expression:"storeitem.userCanGetCoupon && storeitem.userCanGetCoupon.length"}],staticClass:"rightcontent",on:{click:function(e){return t.coupon(s)}}},[i("span",[t._v("优惠券")]),i("i",{staticClass:"iconfont mall-gengduo theme_font_gray font-large marL"})])]),t._l(s.activity,(function(a,r){return i("div",{staticClass:"store-content"},[i("div",{staticClass:"activity-title"},[i("div",{staticClass:"leftcontent single-line"},[i("span",{staticClass:"ac-tag theme_font_white theme_bg_red"},[t._v(t._s(a.mktActivityType))]),i("span",{staticClass:"ac-title theme_font_gray  marL single-line"},[t._v(t._s(a.activityDiscountDesc))])]),t.cartJS.getActivityRightTitle(a)?i("div",{staticClass:"rightcontent",on:{click:function(e){return t.rightActivityClick(a)}}},[i("span",{staticClass:"theme_font_red"},[t._v(t._s(t.cartJS.getActivityRightTitle(a)))]),i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_red font-large marL"})]):t._e()]),i("div",{staticClass:"activity-content"},t._l(a.cart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])})),i("div",{staticClass:"store-content marT10"},[i("div",{staticClass:"activity-content"},t._l(s.noActivityCart,(function(a,r){return i("CartItem",{key:r,attrs:{isEditing:t.isEditing,cartitem:a,occuritem:e,storeitem:s},on:{setCartSel:t.setCartSel,numChange:t.numChange,updateCart:t.updateCart,deleteCart:t.deleteCart}})})),1)])],2)})),i("PayDiv",{directives:[{name:"show",rawName:"v-show",value:t.showFirstBt,expression:"showFirstBt"}],attrs:{occuritem:e,isEditing:t.isEditing},on:{setOccSel:t.setOccSel,toPay:t.toPay,toDelete:t.toDelete}})],2)})),i("div",{directives:[{name:"show",rawName:"v-show",value:t.invalidCart&&t.invalidCart.length,expression:"invalidCart && invalidCart.length"}],staticClass:"occur-div  theme_bg_white"},[i("div",{staticClass:"occur-title title-between theme_font_white theme_bg_ml_red"},[t._m(0),i("span",{staticClass:"theme_font_tint flotr",on:{click:function(e){return e.stopPropagation(),t.clearInvalid.apply(null,arguments)}}},[t._v("清除所有")])]),i("div",{staticClass:"invalid-content"},t._l(t.invalidCart,(function(t,e){return i("InvalidCartItem",{key:e,attrs:{cartitem:t}})})),1)])],2)]),t.occurArr.length||t.invalidCart.length||!t.isHasRequest?t._e():i("div",{staticClass:"nodata-content"},[t._m(1)])])},R=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"theme_font_black"},[i("i",{staticClass:"iconfont mall-shoukuanfang"}),t._v(" 失效的宝贝")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"noCart"},[i("div",{staticClass:"noCartTag"},[i("i",{staticClass:"iconfont mall-gouwuche btn-icon theme_font_tint"}),i("p",{staticClass:"text theme_font_tint"},[t._v("您的购物车是空的,去逛逛吧！")])])])}],J=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-swipe-cell",{staticClass:"cell-swipe",attrs:{"right-width":80,"on-close":t.onClose}},[i("div",{staticClass:"cart-item"},[i("div",{staticClass:"cart-item-sel"},[i("i",{directives:[{name:"show",rawName:"v-show",value:0==t.cartitem.isGift||t.isEditing,expression:"cartitem.isGift == 0 || isEditing "}],staticClass:"iconfont font-large",class:t.cartJS.getXZClass(t.isEditing,t.cartitem.checked,t.cartitem.dchecked),on:{click:function(e){return t.setCartSel(t.cartitem,t.storeitem,t.occuritem)}}})]),i("div",{staticClass:"cell-content"},[i("div",{staticClass:"good-content"},[i("div",{staticClass:"good-img",class:{"img-samll":0!=t.cartitem.isGift}},[i("div",{staticClass:"click-div",on:{click:function(e){return e.stopPropagation(),t.enterGoodDetail(t.cartitem)}}}),i("img",{attrs:{src:t.cartitem.phPictureUrl,alt:""}}),1==t.cartitem.state||4==t.cartitem.state?i("div",{staticClass:"cart-item-state theme_font_white"},[t._v(" "+t._s(t.getStateStr())+" ")]):t._e()]),i("div",{staticClass:"good-detail"},[i("div",{staticClass:"good-info"},[i("p",{staticClass:"good-name line-two",class:t.getFontColorClass()},[1==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("赠品")]):t._e(),2==t.cartitem.isGift?i("span",{staticClass:"good-tag theme_border_red  theme_font_red"},[t._v("换购")]):t._e(),t._v(" "+t._s(t.cartitem.productName))]),0==t.cartitem.isGift?i("p",{staticClass:"size theme_font_gray  single-line"},[t._v(t._s(t.cartitem.specs))]):t._e(),i("div",{staticClass:"good-paras"},[i("div",{staticClass:"paras-left"},[i("PriceOrder",{attrs:{productData:t.cartitem}})],1),i("div",{staticClass:"paras-right"},[0==t.cartitem.isGift&&1!=t.cartitem.state&&4!=t.cartitem.state?i("van-stepper",{attrs:{min:t.cartitem.saleNumBegin,step:t.cartitem.saleNumStep,max:t.cartitem.saleNumMax,integer:""},on:{change:t.numChange},model:{value:t.cartitem.number,callback:function(e){t.$set(t.cartitem,"number",e)},expression:"cartitem.number"}}):t._e(),0!=t.cartitem.isGift?i("span",{staticClass:"gift-num theme_font_gray"},[t._v("X"+t._s(t.cartitem.number))]):t._e()],1)])])])]),t.singleActivities_2.length>0&&null!=t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityType))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.curSingleActivity.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(t.curSingleActivity.digitalPrice)+t._s(t.getDigitalDisplayName(t.curSingleActivity.acctType))+" + ¥"+t._s(t.$util.toDecimal2(t.curSingleActivity.price)))])]),t.singleActivities_2.length>1?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseSingleActivity()}}},[t._v("修改")]):t._e(),1==t.singleActivities_2.length?i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.removeSingleActivity()}}},[t._v("不参加")]):t._e()]):t._e(),t._l(t.singleActivities_2,(function(e){return t.singleActivities_2.length>0&&null==t.curSingleActivity?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sa-type"},[t._v(t._s(e.currentSelfActivity.mktActivityType))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(e.currentSelfActivity.mktActivityTitle)+" "),i("span",{staticClass:"theme_standard_font"},[t._v(t._s(e.digitalPrice)+t._s(t.getDigitalDisplayName(e.acctType))+" + ¥"+t._s(t.$util.toDecimal2(e.price)))])]),i("p",{staticClass:"good-salespro-right",on:{click:function(i){return t.joinSingleActivity(e.currentSelfActivity)}}},[t._v("参加")])]):t._e()})),t.cartitem.activity.length>1&&0==t.cartitem.isGift?i("div",{staticClass:"good-salespro"},[i("p",{staticClass:"sl-tag theme_border_red_i theme_font_red"},[t._v(t._s(t.getActivityTag()))]),i("p",{staticClass:"sl-title single-line"},[t._v(t._s(t.getActivityTitle()))]),i("p",{staticClass:"good-salespro-right",on:{click:function(e){return t.reviseActivity()}}},[t._v("修改")])]):t._e()],2)]),i("div",{staticClass:"del-btn",attrs:{slot:"right"},slot:"right"},[t._v("删除")])])],1)},B=[],q={name:"cart-item",components:{CellSwipe:f["CellSwipe"],PriceOrder:m["a"]},props:["cartitem","storeitem","occuritem","isEditing"],data:function(){return{cartJS:o,singleActivities_2:[],curSingleActivity:null}},methods:{getDigitalDisplayName:function(t){return this.$mallCommon.accTypeToName(t,"200001")},onClose:function(t,e){switch(t){case"left":case"cell":case"outside":e.close();break;case"right":this.$emit("deleteCart",[this.cartitem]),e.close();break}},initSingleActivity:function(){if(this.singleActivities_2=[],this.cartitem.currentSelfActivity&&2==this.cartitem.currentSelfActivity.mktActivityPriceLevel?(this.curSingleActivity=this.cartitem,this.singleActivities_2.push(this.cartitem)):this.curSingleActivity=null,this.cartitem.selfActivity)for(var t=0;t<this.cartitem.selfActivity.length;t++){var e=this.cartitem.selfActivity[t],i=e.currentSelfActivity;2==i.mktActivityPriceLevel&&this.singleActivities_2.push(e)}},removeSingleActivity:function(){var t=this,e=this.$store.state.microSho.groupbuyingCarts;e.forEach((function(e,i){t.cartitem.skuId!=e.skuId||(t.$store.state.microSho.groupbuyingCarts[i].selfActivityId="-2")})),this.$emit("updateCart")},joinSingleActivity:function(t){var e=this,i=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){e.cartitem.skuId!=i.skuId||(e.$store.state.microSho.groupbuyingCarts[s].selfActivityId=t.mktActivityId)})),this.$emit("updateCart")},reviseSingleActivity:function(){for(var t=this,e=[],i=0;i<this.singleActivities_2.length;i++){var s=this.singleActivities_2[i];e.push({mktActivityId:s.currentSelfActivity.mktActivityId,title:s.currentSelfActivity.mktActivityTitle+" "+s.digitalPrice+this.getDigitalDisplayName(s.acctType)+"+¥"+this.$util.toDecimal2(s.price),checked:s.currentSelfActivity.mktActivityId==this.curSingleActivity.currentSelfActivity.mktActivityId})}e.push({mktActivityId:"-2",title:"不参加兑换活动",checked:!1}),SalesPro.open({listData:e,sureFunc:function(e){var i=[{skuId:t.cartitem.skuId,storeOuCode:t.cartitem.storeOuCode,selfActivityId:e.mktActivityId}];t.$emit("updateCart",i)}})},deleteCartItem:function(){this.$emit("deleteCart",[this.cartitem])},enterGoodDetail:function(t){},setCartSel:function(t,e,i){this.$emit("setCartSel",t,e,i)},getActivityTitle:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityTitle}return""},getActivityTag:function(){for(var t=0;t<this.cartitem.activity.length;t++){var e=this.cartitem.activity[t];if(e.mktActivityId==this.cartitem.activityId)return e.mktActivityType}return""},getItemAmount:function(t,e){return o.getItemAmount(t,e)},reviseActivity:function(){for(var t=[],e=0;e<this.cartitem.activity.length;e++){var i=this.cartitem.activity[e],s=!1;this.cartitem.activityId==i.mktActivityId&&(s=!0),t.push({mktActivityId:i.mktActivityId,title:i.mktActivityTitle,checked:s})}SalesPro.open({listData:t,sureFunc:this.sureFunc})},sureFunc:function(t){var e=[{skuId:this.cartitem.skuId,storeOuCode:this.cartitem.storeOuCode,activityId:t.mktActivityId}];this.$emit("updateCart",e)},numChange:function(){this.$emit("numChange",this.cartitem)},getStateStr:function(){return 1==this.cartitem.state?"下架":4==this.cartitem.state?"无货":""},getFontColorClass:function(){return 1==this.cartitem.state||4==this.cartitem.state?"theme_font_gray_i":""}},created:function(){this.initSingleActivity()},watch:{cartitem:function(){this.initSingleActivity()}}},H=q,U=(i("11a9"),Object(y["a"])(H,J,B,!1,null,null,null)),K=U.exports,Z={name:"cart-list",components:{CartItem:K,PayDiv:N,InvalidCartItem:T},computed:Object(d["a"])({},Object(P["c"])(["getPutaggregate"])),props:["deliverType","isEditing"],data:function(){return{occurArr:[],invalidCart:[],cartJS:o,isHasRequest:!1,heightArr:[],fixedIndex:-1,showFirstBt:!0,microStoreCode:""}},methods:{clearInvalid:function(){var t=o.getInvalidArr(this.invalidCart);this.deleteCart(t)},toShop:function(t){},getCartRef:function(t){return"mall2cart"+t},goShopList:function(){var t="/mall2/list/"+this.$util.getDataString();this.$router.push({path:t,query:{lastPath:this.$route.path,delivertype:this.deliverType}})},coupon:function(t){var e=this;Coupon.open({initData:{listData:t.userCanGetCoupon,storeOuCode:t.storeOuCode,skuId:"",type:"receive",categoryId:"",token:this.$store.state.login.token},selectedCoupon:function(t){Coupon.close()},getedCoupon:function(t){},couponProducts:function(t){var i="/mall2/list/"+e.$util.getDataString();e.$router.push({path:i,query:{pageType:"coupon",coupon:t.couTypeCode,fromCart:"1",delivertype:e.deliverType,lastPath:e.$route.path,couFaceValue:t.couFaceValue,couThresholdAmount:t.couThresholdAmount,endTime:e.$util.getDateFromString(t.validEndDate)}}),Coupon.close()}})},rightActivityClick:function(t){var e="/mall2/list/"+this.$util.getDataString();this.$router.push({path:e,query:{pageType:"activity",activity:t.mktActivityId,fromCart:"1",delivertype:this.deliverType,skuId:t.cart[0].skuId,storeOuCode:t.cart[0].storeOuCode,lastPath:this.$route.path}})},sureFunc:function(t){var e=this;this.$Loading.open();var i="/app/json/app_cart/addCart",s={token:this.$store.state.login.token,carts:t,deliveryType:this.deliverType};this.$http.post(i,s).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.$store.state.mall2.cartNum=i.data,e.$Toast("添加购物车成功！")):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},setCartSel:function(t,e,i){var s=this;if(this.isEditing)o.setCartSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.groupbuyingCarts;a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.groupbuyingCarts[i].checked=s.$store.state.microSho.groupbuyingCarts[i].checked?0:1)})),this.getDataList()}},setStoreSel:function(t,e,i){var s=this;if(this.isEditing)o.setStoreSel(t,this.isEditing,e,i);else{var a=this.$store.state.microSho.groupbuyingCarts,r=t.noActivityCart||[];r.forEach((function(t,e){a.forEach((function(e,i){e.deliverType!=s.deliverType||e.skuId!=t.skuId||(s.$store.state.microSho.groupbuyingCarts[i].checked=s.$store.state.microSho.groupbuyingCarts[i].checked?0:1)}))})),this.getDataList()}},setOccSel:function(t){var e=this;if(this.isEditing)o.setOccSel(t,this.isEditing);else{for(var i=[],s=0;s<t.store.length;s++){var a=t.store[s],r=this.getSelStore(a,!1);i=i.concat(r)}var c=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){c.forEach((function(s,a){s.skuId==i.skuId&&s.deliverType==e.deliverType&&(e.$store.state.microSho.groupbuyingCarts[a].checked=t.checked?0:1)}))})),this.getDataList()}},getSelStore:function(t,e){for(var i=[],s=0;s<t.noActivityCart.length;s++){var a=t.noActivityCart[s];i.push({checked:e?a.checked:a.checked?0:1,deliverType:a.deliverType,number:a.number,proSkuDistributionId:a.proSkuDistributionId,selfActivityId:a.selfActivityId,skuId:a.skuId,storeOuCode:a.storeOuCode})}return i},toPay:function(t){for(var e=this,i=this.$store.state.microSho.groupbuyingCarts,s=[],a=0;a<t.store.length;a++){var r=t.store[a],c=this.getSelStore(r,!0);s=s.concat(c)}var n=[];if(s.forEach((function(t){t.checked&&(i.forEach((function(e){e.skuId==t.skuId&&(t.proSkuDistributionId=e.proSkuDistributionId,t.selfActivityId=e.selfActivityId)})),n.push(t))})),0!=n.length){var l="/app/json/app_purchase_order/settleCart",u={token:this.$store.state.login.token,deliveryType:this.deliverType,carts:n,microStoreCode:this.microStoreCode};if(2==this.deliverType){if(""==this.$store.state.mall2.selectAddress.id||"undefined"==this.$store.state.mall2.selectAddress.id)return void this.$Toast("请先选择配送区域！");"-1"!=this.$store.state.mall2.selectAddress.id?u.userAddressId=this.$store.state.mall2.selectAddress.id:(u.userAddress={},u.userAddress.provinceId=this.$store.state.mall2.selectAddress.provinceId,u.userAddress.provinceName=this.$store.state.mall2.selectAddress.provinceName,u.userAddress.cityId=this.$store.state.mall2.selectAddress.cityId,u.userAddress.cityName=this.$store.state.mall2.selectAddress.cityName,u.userAddress.countryId=this.$store.state.mall2.selectAddress.countryId,u.userAddress.countryName=this.$store.state.mall2.selectAddress.countryName,u.userAddress.townId=this.$store.state.mall2.selectAddress.townId,u.userAddress.townName=this.$store.state.mall2.selectAddress.townName)}this.setCommonPara(u),this.$Loading.open(),this.$http.post(l,u).then((function(t){e.$Loading.close();var i=t.data;0==i.status?(e.occurArr=o.dealCartList(i.data.occur),e.isEditing&&o.setAllUnSel(e.occurArr),1==e.$mallCommon.isExistCanNotAttendActivity(i.data.occur)?e.$MessageBox.confirm("部分商品不能参加活动</br>将按原价购买，是否继续？","提示",{confirmButtonText:"确定"}).then((function(t){e.$router.push({name:"企业团购下订单",params:{res:i.data,paramsData:u,deliveryType:e.deliverType}})}))["catch"]((function(t){})):e.$router.push({name:"企业团购下订单",params:{res:i.data,paramsData:u,deliveryType:e.deliverType}})):e.$Toast(i.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))}else this.$Toast("请选择要结算的商品")},toDelete:function(t){var e=this,i=JSON.parse(JSON.stringify(this.$store.state.microSho.groupbuyingCarts)),s=t.store||[];s.forEach((function(t){t.noActivityCart.forEach((function(t){i.forEach((function(i,s){i.deliverType==e.deliverType&&t.skuId==i.skuId&&e.$store.state.microSho.groupbuyingCarts.splice(s,1)}))}))})),this.getDataList()},setCommonPara:function(t){return 2==this.deliverType?(t.provinceId=this.$store.state.mall2.selectAddress.provinceId,t.cityId=this.$store.state.mall2.selectAddress.cityId,t.countryId=this.$store.state.mall2.selectAddress.countryId):1==this.deliverType&&(t.pickupId=this.$store.state.mall2.zitiAddress.id),!0},_initScroll:function(){var t=this;this.cityListScroll?(this.cityListScroll.refresh(),this.cityListScroll.off("scroll")):this.cityListScroll=new b["a"](this.$refs.scrollwarp,{click:!0,probeType:3,bounce:!1});var e=this.$refs.scrollwarp,i=e.offsetHeight;if(1!=this.occurArr.length||""!=this.invalidCart){this.showFirstBt=!0;for(var s=0;s<this.occurArr.length;s++){var a=this.$refs[this.getCartRef(s)][0],r={top:a.offsetTop,height:a.offsetHeight,isFixed:!1};a.offsetHeight>i&&(r.isFixed=!0),this.heightArr.push(r)}this.cityListScroll.on("scroll",(function(e){if(e.y>5)t.fixedIndex=-1;else{var s=Math.abs(e.y);t.calculateFixedIndex(s,i)}})),this.calculateFixedIndex(0,i)}else{this.fixedIndex=0;var c=this.$refs[this.getCartRef(0)][0],n=c.offsetHeight;n<i&&(this.showFirstBt=!1)}},calculateFixedIndex:function(t,e){for(var i=!1,s=0;s<this.heightArr.length;s++){var a=this.heightArr[s],r=a.top,c=a.height,n=a.isFixed;if(t>=r&&t<=r+c){n&&t<=r+c-e&&(i=!0,this.fixedIndex=s);break}}i||(this.fixedIndex=-1)},_getCartCount:function(){var t=this,e="/app/json/app_cart/getCartCount",i={token:this.$store.state.login.token,deliveryType:this.deliverType};this.$http.post(e,i).then((function(e){var i=e.data;0==i.status?t.$store.state.mall2.cartNum=i.data:t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},numChange:function(t){var e=this,i=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){t.skuId!=i.skuId||(e.$store.state.microSho.groupbuyingCarts[s].number=t.number)})),this.getDataList()},updateCart:function(){this.getDataList()},deleteCart:function(t){var e=this;if(t.length){var i=this.$store.state.microSho.groupbuyingCarts;i.forEach((function(i,s){t[0].skuId!=i.skuId||e.$store.state.microSho.groupbuyingCarts.splice(s,1)})),this.$Toast("删除成功"),this.getDataList()}else this.$Toast("请选择要删除的商品")},getDataList:function(){var t=this,e=this.$store.state.microSho.groupbuyingCarts,i=[];if(e.forEach((function(e){e.deliverType==t.deliverType&&i.push(e)})),i.length){this.$Loading.open();var s="/app/json/app_purchase_order/getCart",a={token:this.$store.state.login.token,microStoreCode:this.microStoreCode,carts:i,deliveryType:this.deliverType};this.setCommonPara(a),this.$http.post(s,a).then((function(e){t.$Loading.close();var i=e.data;if(0==i.status){t.isHasRequest=!0,t.occurArr=o.dealCartList(i.data.occur),t.invalidCart=i.data.invalidCart?i.data.invalidCart:[];var s=t.$store.state.microSho.groupbuyingCarts;t.invalidCart.forEach((function(e){s.forEach((function(i,s){e.skuId==i.skuId&&t.$store.state.microSho.groupbuyingCarts.splice(s,1)}))})),t.isEditing&&o.setAllUnSel(t.occurArr),t.$nextTick((function(){}))}else t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}else this.isHasRequest=!0,this.occurArr=o.dealCartList([]),this.invalidCart=[]}},watch:{isEditing:function(t,e){t&&this.occurArr&&(this.occurArr=o.setAllUnSel(this.occurArr))}},mounted:function(){},created:function(){this.microStoreCode=this.$route.query.microStoreCode?this.$route.query.microStoreCode:"",this.getDataList()},beforeDestroy:function(){}},X=Z,M=(i("6b2c"),Object(y["a"])(X,z,R,!1,null,"2037a9d1",null)),V=M.exports,Q=i("72c7"),W={name:"cart",components:{CartList:j,buyingCartList:V},props:{hasBack:{type:Boolean,default:!1},commonShow:{type:Boolean,default:!1}},data:function(){return{topArr:[],deliverType:null,isEditing:!1,peisongNum:0,zitiNum:0,dataIsLoad:!1,firstZiti:!0}},methods:{backEvent:function(){this.$router.go(-1),this.$keepaliveHelper.deleteCache(this)},setEdit:function(){this.isEditing=!this.isEditing},getAddressName:function(){var t=null;return(2==this.deliverType||1==this.deliverType)&&(t=""),t},chooseAddress:function(t){2==t?this.$router.push({path:"/mall2/addresslist"}):this.$router.push({path:"/mall2/mypickupaddress"})},deliverTypeEvent:function(t){2==t.type?(this.saveItemSel(t),this.getData()):1==t.type&&(1!=this.firstZiti||void 0!=this.$store.state.mall2.zitiAddress.id&&""!=this.$store.state.mall2.zitiAddress.id?(this.saveItemSel(t),this.getData()):this.chooseAddress(t.type),this.firstZiti=!1)},saveItemSel:function(t){t.hasShow=!0,this.deliverType=t.type,this.$store.state.mall2.staticDeliverType=this.deliverType,this.$bridgefunc.vuexStorage()},pageShow:function(){this.getData()},getData:function(){var t=this;if(1==this.deliverType)Q["a"].checkIsInitialLoad((function(e){if(e)t.getData();else{var i=t.getCartRef(t.deliverType);t.$nextTick((function(){if(t.$refs[i]){var e=t.$refs[i];e[0].getDataList()}}))}}));else{var e=this.getCartRef(this.deliverType);this.$nextTick((function(){if(t.$refs[e]){var i=t.$refs[e];i[0].getDataList()}}))}},getCartRef:function(t){return"cart"+t},getItemByType:function(t){for(var e=0;e<this.topArr.length;e++){var i=this.topArr[e];if(i.type==t)return i}return null},_getCartCount:function(t){var e=this,i="/app/json/app_cart/getCartCount",s={token:this.$store.state.login.token,deliveryType:t};this.$http.post(i,s).then((function(i){var s=i.data;0==s.status&&(e.$store.state.mall2.cartNum=s.data,1==t?e.zitiNum=s.data:e.peisongNum=s.data)}),(function(t){}))}},activated:function(){if(("/common"!=this.$route.path||this.commonShow)&&1==this.dataIsLoad){var t=this.getItemByType(this.deliverType);this.deliverTypeEvent(t)}},mounted:function(){var t=this;this.deliverType=this.$store.state.mall2.staticDeliverType;var e=this.getItemByType(this.deliverType);this.deliverTypeEvent(e),setTimeout((function(){t.dataIsLoad=!0}),500)},created:function(){this.topArr=o.getTopArr()}},Y=W,tt=(i("5c7a"),Object(y["a"])(Y,s,a,!1,null,"a09238ec",null));e["default"]=tt.exports},de48:function(t,e,i){"use strict";i("4059")},eac1:function(t,e,i){},fe8c:function(t,e,i){},fec7:function(t,e,i){"use strict";i("12dd")}}]);