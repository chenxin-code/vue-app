(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{"3Xci":function(t,e,i){},"5Pdl":function(t,e,i){"use strict";var a=i("3Xci");i.n(a).a},IYJV:function(t,e,i){"use strict";var a=i("ZI3E");i.n(a).a},NQxh:function(t,e,i){"use strict";i.r(e),i("TC2U");var a=i("eqsK"),s=i("L2JU"),o=i("mG4U"),r=i("2nGb"),l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},n={name:"scenicdetail",components:{Share:a.a},computed:l({},Object(s.c)(["getPutaggregate"])),data:function(){return{status:!1,isShow:!1,chooseIndex:0,score:"5.0",remark_cou:"12345",detail:{},swiperOption:{autoHeight:!1,spaceBetween:0,speed:500,autoplay:{delay:3e3},loop:!0,pagination:{el:".swiper-pagination",clickable:!1},paginationShow:!0},childList:[],scrollValue:0,objStype:{},listData:{},popupShow:!1,shareObj:{popupShow:!1},storeOuCode:"",deliveryType:"",proSkuDistributionId:""}},methods:{dataProcessing:function(t){var e={integer:"0",decimals:"00",linePrice:"0.00"},i=t.marketPrice+"";e.linePrice=i;var a=(t.salePrice+"").split(".");a&&(1==a.length?(e.integer=a[0],""==e.integer&&(e.integer="0"),e.decimals="00"):2==a.length&&(e.integer=a[0],e.decimals=a[1],e.decimals.length<2&&(e.decimals=e.decimals+"0"))),t.dpedData=e},chooseDate:function(t,e){console.log("testFunc"),this.chooseIndex=e,this.childList=t.childList},bookClick:function(t){var e=this,i=""!=this.detail.saleNumBegin?this.detail.saleNumBegin:1,a=""!=this.detail.saleNumStep?this.detail.saleNumStep:1,s=""!=this.detail.saleNumMax?this.detail.saleNumMax:20,o=""!=t.stockNum?t.stockNum:9999;this.$Loading.open();var r={token:this.$store.state.login.token,carts:[{skuId:t.skuId,storeOuCode:this.detail.storeOuCode,number:i,checked:"1"}],deliveryType:this.detail.deliveryType};this.$http.post("/app/json/app_cart/SettleCart",r).then((function(t){e.$Loading.close();var r=t.data;0==r.status?1==e.$mallCommon.isExistCanNotAttendActivity(r.data.occur)?e.$MessageBox.confirm("部分商品不能参加活动</br>将按原价购买，是否继续？","提示",{confirmButtonText:"确定"}).then((function(t){e.$router.push({name:"立即下单",params:{occur:r.data.occur,proName:e.detail.showTitle,saleNumBegin:i,saleNumStep:a,saleNumMax:s,stockNum:o}})})).catch((function(t){})):e.$router.push({name:"立即下单",params:{occur:r.data.occur,proName:e.detail.showTitle,saleNumBegin:i,saleNumStep:a,saleNumMax:s,stockNum:o}}):e.$Toast(r.info)}),(function(t){e.$Loading.close(),e.$Toast("请求数据失败！")}))},_getDateSkuSaleDetail:function(t){var e=this;this.$Loading.open();var i={token:this.$store.state.login.token,skuId:t,deliverType:this.deliveryType,storeOuCode:this.storeOuCode};console.log(i),this.$http.post("/app/json/product/getAppProDetail",i).then((function(t){e.$Loading.close();var i=t.data;if(0==i.status){if(e.status=!0,e.detail=i.data,e.detail.featureList.length){var a=e.detail.featureList[0];a.childList.length&&(e.childList=a.childList)}e.isShow=!0}else e.isShow=!1,e.$Toast(i.info)}),(function(t){e.isShow=!1,e.$Loading.close(),console.log("获取门票详情",t),e.$Toast("获取数据失败")}))},backEvent:function(){this.$router.go(-1),this.$keepaliveHelper.deleteCache(this)},addMethod:function(){var t=this;this.$messagebox.confirm("确定要添加该商品到店铺吗!","提示").then((function(e){t.$Loading.open(),t.$http.post("/app/json/app_distribution_order/addProToMicroStore",{skuId:t.skuId,storeId:t.getPutaggregate.id}).then((function(e){t.$Loading.close(),0==e.data.status?(t.$Toast("添加成功!"),t.listData.hidden=1,o.a.$emit("setlistData",t.skuId)):t.$Toast(e.data.info)}))})).catch((function(){}))},shareMethod:function(){var t=this,e={};e.showTitle=this.detail.showTitle,e.sharetext=this.detail.skuName,e.picUrls=[this.detail.phMainUrl],e.id=this.detail.id,e.skuId=this.detail.skuId,e.productType=this.detail.productType,e.deliveryType=this.detail.deliveryType,this.detail.featureList.length&&(e.dpedData={},e.dpedData.linePrice=this.detail.featureList[0].childList[0].marketPrice,e.dpedData.featureName=this.detail.featureList[0].childList[0].featureName),e.detailurl=this.$store.state.globalConfig.wxBaseUrl+r.a.shareUrl+this.$route.fullPath,1==this.detailData.deliveryType&&(e.detailurl=e.detailurl+"&storeID="+this.$store.state.mall2.zitiAddress.id),this.$store.state.login.token&&""!=this.$store.state.login.token&&(e.detailurl=e.detailurl+"&recommend="+this.$store.state.userInfo.userId,e.detailurl=e.detailurl+"&recommendPhone="+this.$store.state.login.phone),"1"!=this.listData.hidden?(this.$Loading.open(),this.$http.post("/app/json/app_distribution_order/addProToMicroStore",{skuId:this.skuId,storeId:this.getPutaggregate.id}).then((function(i){t.$Loading.close(),0==i.data.status?(t.$Toast("添加成功!"),t.listData.hidden=1,o.a.$emit("setlistData",t.skuId),t.shareObj=Object.assign({},t.shareObj,e),t.popupShow=!0,t.shareObj.popupShow=!0):t.$Toast(i.data.info)}))):(this.shareObj=Object.assign({},this.shareObj,e),this.popupShow=!0,this.shareObj.popupShow=!0)},upDownMethod:function(){var t=this;this.$messagebox.confirm("确定要"+(1==this.objStype.queryType?"下架":"上架")+"该商品吗!","提示").then((function(e){var i=1==t.objStype.queryType?"0":"1";t.$Loading.open(),t.$http.post("/app/json/app_distribution_order/updateProFromMicroStore",{skuId:t.skuId,storeId:t.getPutaggregate.id,status:i}).then((function(e){t.$Loading.close(),0==e.data.status?(t.$Toast((1==t.objStype.queryType?"下架":"上架")+"成功!"),t.objStype.queryType=1==t.objStype.queryType?"0":"1"):t.$Toast(e.data.info)}))})).catch((function(){}))},upDownShareMethod:function(){var t={};t.showTitle=this.detail.showTitle,t.sharetext=this.detail.skuName,t.picUrls=[this.detail.phMainUrl],t.id=this.detail.id,t.skuId=this.detail.skuId,t.productType=this.detail.productType,t.deliveryType=this.detail.deliveryType,this.detail.featureList.length&&(t.dpedData={},t.dpedData.linePrice=this.detail.featureList[0].childList[0].marketPrice,t.dpedData.featureName=this.detail.featureList[0].childList[0].featureName),t.detailurl=this.$store.state.globalConfig.wxBaseUrl+r.a.shareUrl+this.$route.fullPath,1==this.detailData.deliveryType&&(t.detailurl=t.detailurl+"&storeID="+this.$store.state.mall2.zitiAddress.id),this.$store.state.login.token&&""!=this.$store.state.login.token&&(t.detailurl=t.detailurl+"&recommend="+this.$store.state.userInfo.userId,t.detailurl=t.detailurl+"&recommendPhone="+this.$store.state.login.phone),this.shareObj=Object.assign({},{proSkuDistributionId:this.proSkuDistributionId},this.shareObj,this.detailData),this.popupShow=!0,this.shareObj.popupShow=!0},setshareData:function(t){this.popupShow=!1,this.shareObj=Object.assign({},t)}},created:function(){this.proSkuDistributionId=this.$route.query.proSkuDistributionId||"",console.log(111,this.proSkuDistributionId),this.$route.query.obj?"[object String]"==Object.prototype.toString.call(this.$route.query.obj)?this.objStype=JSON.parse(sessionStorage.getItem("microShoStype")):(this.objStype=this.$route.query.obj,sessionStorage.setItem("microShoStype",JSON.stringify(this.objStype))):this.objStype={},this.$route.query.listData?"[object String]"==Object.prototype.toString.call(this.$route.query.listData)?this.listData=JSON.parse(sessionStorage.getItem("microShoListData")):(this.listData=this.$route.query.listData,sessionStorage.setItem("microShoListData",JSON.stringify(this.listData))):this.listData={},this.storeOuCode=this.$route.query.storeOuCode?this.$route.query.storeOuCode:"",this.skuId=this.$route.query.skuId?this.$route.query.skuId:"",this.deliveryType=this.$route.query.deliveryType;var t=this.$route.query.id;null!=t&&null!=t&&""!=t&&this._getDateSkuSaleDetail(t)},activated:function(){},beforeRouteLeave:function(t,e,i){this.$keepaliveHelper.deleteCache(this),i()}},d=(i("5Pdl"),i("KHd+")),c=Object(d.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"scenicdetail"},[i("div",{ref:"detailTop2",staticClass:"detail-top",style:{height:this.$store.state.barHeight+this.$market.getNavHeight()+"px"}},[i("div",{staticClass:"navcontent",style:{top:this.$store.state.barHeight+"px",height:this.$market.getNavHeight()+"px","line-height":this.$market.getNavHeight()+"px"}},[i("div",{staticClass:"nav-back-btn",staticStyle:{left:"10px",top:"5px",width:"34px",height:"34px"},on:{click:t.backEvent}},[i("img",{staticStyle:{display:"block",width:"100%",height:"100%"},attrs:{src:"static/image/mall2/back.png"}})])])]),t._v(" "),t.isShow?i("nav-content",{staticStyle:{top:"0px"}},[i("div",{ref:"ticketdetailscrl",staticClass:"scroll-con"},[i("van-swipe",{staticClass:"top-image",attrs:{autoplay:2e3,"indicator-color":"white"}},t._l(t.detail.picUrls,(function(t,e){return i("van-swipe-item",{key:e},[i("img",{attrs:{src:t}})])})),1),t._v(" "),i("div",{staticClass:"top-title shadow-cell theme_bg_white"},[i("div",{staticClass:"left-title "},[i("p",{staticClass:"bigtitlefont"},[t._v(t._s(t.detail.showTitle))]),t._v(" "),i("p",{staticClass:"describe theme_font_gray"},[t._v(t._s(t.detail.storeOuName))])])]),t._v(" "),i("div",{staticClass:"detail-con"},[i("div",{staticClass:"date-list"},t._l(t.detail.featureList,(function(e,a){return i("div",{staticClass:"choosedate",class:{theme_bg_red:t.chooseIndex==a},on:{click:function(i){return t.chooseDate(e,a)}}},[i("p",{staticClass:"week-con theme_font_gray",class:{theme_font_white:t.chooseIndex==a}},[t._v("\n              "+t._s(e.featureName))]),t._v(" "),i("P",{staticClass:"day-con theme_font_common",class:{theme_font_white:t.chooseIndex==a}},[t._v(t._s(e.curDate))])],1)})),0),t._v(" "),t._l(t.childList,(function(e){return i("div",{staticClass:"shadow-cell flex-con padding-con"},[t._v("\n          "+t._s(t.dataProcessing(e))+"\n          "),i("div",{staticClass:"left-ticket"},[i("P",{staticClass:"bigtitlefont"},[t._v(t._s(e.featureName))]),t._v(" "),i("p",{staticClass:"price"},[i("span",{staticClass:"price-x theme_font_red"},[t._v("￥")]),i("span",{staticClass:"price-z theme_font_red"},[t._v(t._s(e.dpedData.integer))]),i("span",{staticClass:"price-x theme_font_red"},[t._v("."+t._s(e.dpedData.decimals))]),t._v("  \n              "),i("span",{staticClass:"price-x theme_font_tint",class:{"line-through":2==t.$store.state.globalConfig.priceShowType}},[1==t.$store.state.globalConfig.priceShowType?i("span",[t._v("原价:")]):t._e(),t._v("￥"+t._s(t.$util.toDecimal2(e.dpedData.linePrice)))]),t._v(" "),e.stockNum&&""!=e.stockNum?i("span",{staticClass:"theme_font_tint"},[t._v("  (仅剩"+t._s(e.stockNum)+"张)")]):t._e()])],1),t._v(" "),i("div",{staticClass:"right-ticket theme_bg_red theme_font_white",on:{click:function(i){return t.bookClick(e)}}},[t._v("立即预定")])])})),t._v(" "),i("div",{staticClass:"shadow-cell padding-con"},[i("p",{staticClass:"html-title"},[t._v("购票须知")]),t._v(" "),i("div",{domProps:{innerHTML:t._s(t.detail.proSkuMediaModel.mobileParam)}})]),t._v(" "),i("div",{staticClass:"shadow-cell padding-con"},[i("p",{staticClass:"html-title"},[t._v("游玩攻略")]),t._v(" "),i("div",{staticStyle:{overflow:"hidden"},domProps:{innerHTML:t._s(t.detail.proSkuMediaModel.mobileDetail)}})])],2)],1)]):t._e(),t._v(" "),t.status?i("div",{staticClass:"bottom-btns"},[Object.keys(t.objStype).length?i("div",{staticClass:"bottom-box upDown"},[i("div",{staticClass:"btn",class:1==t.objStype.queryType?"theme_standard_font_i":"theme_standard_bg theme_font_white",on:{click:t.upDownMethod}},[i("span",{staticClass:"iconfont"},[t._v(t._s(1==t.objStype.queryType?"下架":"上架"))])]),t._v(" "),1==t.objStype.queryType?i("div",{staticClass:"btn theme_font_white theme_standard_bg",on:{click:t.upDownShareMethod}},[i("p",{staticClass:"title"},[t._v("分享推广")])]):t._e()]):i("div",{staticClass:"bottom-box add"},[0==t.listData.hidden?i("div",{staticClass:"addIco theme_standard_font_i",on:{click:t.addMethod}},[t._v("\n          添加\n        ")]):t._e(),t._v(" "),i("div",{staticClass:"addText theme_font_white theme_standard_bg",on:{click:t.shareMethod}},[i("p",{staticClass:"title"},[t._v("分享推广")])])])]):t._e(),t._v(" "),t.popupShow?i("Share",{attrs:{shareObj:t.shareObj},on:{setshareData:t.setshareData}}):t._e()],1)}),[],!1,null,"5ddd553f",null);e.default=c.exports},TC2U:function(t,e,i){},ZI3E:function(t,e,i){},eqsK:function(t,e,i){"use strict";var a=i("lR8Q"),s=i.n(a),o=i("2nGb"),r=i("0FX9"),l=i.n(r),n=i("L2JU"),d=i("rlxw"),c={name:"share",props:["shareObj"],computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t})({},Object(n.c)(["getPutaggregate"])),data:function(){return{imgUrl:"",timeOutEvent:0,popupShow:!0,codeShow:this.shareObj.codeShow,detailData:this.$util.deepClone(this.shareObj)}},mounted:function(){this.setOssImg(this.detailData.phMainUrl||this.detailData.picMainUrl||this.detailData.picUrls[0])},methods:{getPrices:function(){return d.a.getPriceShow(this.detailData.purPriceRules)},setOssImg:function(t){var e=this;this.imgUrl="",this.$request.post("/app/json/home/getFileBase64",{filePath:t}).then((function(t){0==t.status?t.data?e.imgUrl="data:image/png;base64,"+(t.data||""):e.$Toast("getFileBase64 返回为空"):e.$Toast(t.info)}))},getInteger:function(t){return this.$util.toDecimal2(t).split(".")[0]},getDecimals:function(t){return this.$util.toDecimal2(t).split(".")[1]},clickOverlay:function(){this.detailData.popupShow=!1,this.$emit("setshareData",this.detailData.storeCode)},sharewx:function(){var t="/micro_sho/shareDetail/";this.detailData.groupFlag&&(t="/micro_sho/sharebuyingDetail/");var e={};(e={}).title=this.detailData.showTitle||this.detailData.skuName,e.sharetext=this.detailData.skuName,e.imageurl=this.detailData.phMainUrl,e.detailurl=this.$store.state.globalConfig.wxBaseUrl+o.a.shareUrl+""+t+this.$util.getDataString(),e.detailurl=e.detailurl+"?id="+(this.detailData.id||this.detailData.skuId)+"&skuId="+(this.detailData.skuId||this.detailData.id)+"&microStoreCode="+this.getPutaggregate.storeCode+"&storeName="+this.getPutaggregate.storeName+"&productType="+this.detailData.productType+"&deliveryType="+this.$store.state.mall2.staticDeliverType+"&storeOuCodeNew="+this.$store.state.mall2.zitiAddress.id+"&proSkuDistributionId="+this.detailData.proSkuDistributionId,this.$store.state.login.token&&""!=this.$store.state.login.token&&(e.detailurl=e.detailurl+"&recommend="+this.$store.state.userInfo.userId,e.detailurl=e.detailurl+"&recommendPhone="+this.$store.state.login.phone),console.log("shareData",e),this.$bridgefunc.wechatShare(e)},QRcode:function(){var t=this,e="/micro_sho/shareDetail";this.detailData.groupFlag&&(e="/micro_sho/sharebuyingDetail"),this.codeShow=!0,this.$emit("qRcodeStstus",this.codeShow),this.$nextTick((function(i){var a=""+t.$store.state.globalConfig.wxBaseUrl+o.a.shareUrl+e+"/"+t.$util.getDataString()+"?id="+(t.detailData.id||t.detailData.skuId)+"&skuId="+(t.detailData.skuId||t.detailData.id)+"&microStoreCode="+t.getPutaggregate.storeCode+"&storeName="+t.getPutaggregate.storeName+"&productType="+t.detailData.productType+"&deliveryType="+t.$store.state.mall2.staticDeliverType+"&storeOuCodeNew="+t.$store.state.mall2.zitiAddress.id+"&proSkuDistributionId="+t.detailData.proSkuDistributionId;l.a.toCanvas(document.getElementById("qrcode"),a,{width:140})}))},btnbox:function(){this.codeShow=!1,this.$emit("qRcodeStstus",this.codeShow)},preservation:function(){var t=this,e=document.querySelector(".code-content"),i=parseInt(window.getComputedStyle(e).width),a=parseInt(window.getComputedStyle(e).height),o=document.createElement("canvas");o.width=2*i,o.height=2*a,o.getContext("2d").scale(2,2);var r={useCORS:!0,scale:2,canvas:o,backgroundColor:"#000"};s()(this.$refs.imageWrapper,r).then((function(e){var i=e.toDataURL("image/png");t.codeShow=!1;var a=i.split("base64,");console.log(i),t.$bridgefunc.savePhoto(a[1],(function(e){"1"==e?(t.detailData.popupShow=!1,t.$emit("setshareData",t.detailData),t.$Toast("保存成功！")):t.$Toast("保存失败！")}))}))}}},h=(i("IYJV"),i("KHd+")),u=Object(h.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box"},[i("van-popup",{attrs:{position:"bottom"},on:{"click-overlay":t.clickOverlay},model:{value:t.detailData.popupShow,callback:function(e){t.$set(t.detailData,"popupShow",e)},expression:"detailData.popupShow"}},[i("div",{staticClass:"popup"},[i("div",{staticClass:"popup-content",on:{click:t.sharewx}},[i("img",{attrs:{src:"static/image/mall2/weixin.png",alt:""}}),t._v(" "),i("span",[t._v("微信")])]),t._v(" "),i("div",{staticClass:"popup-content",on:{click:t.QRcode}},[i("img",{attrs:{src:"static/image/microShop/code@2x.png",alt:""}}),t._v(" "),i("span",[t._v("二维码")])])])]),t._v(" "),t.codeShow?i("div",{staticClass:"code-div",on:{click:function(e){return e.target!==e.currentTarget?null:t.btnbox(e)}}},[i("div",{ref:"imageWrapper",staticClass:"code-content"},[i("div",{staticClass:"code-content-img"},[i("div",{staticClass:"code-content-img-top"},[i("img",{attrs:{src:t.imgUrl,alt:"",crossOrigin:"anonymous"}})]),t._v(" "),t.detailData.groupFlag?i("div",{staticClass:"code-content-img-buttom"},[i("div",{staticClass:"price theme_font_red"},t._l(t.getPrices(),(function(e,a){return i("div",{staticClass:"price-item"},[0!=a?i("p",{staticClass:"xian"},[t._v(" ~ ")]):t._e(),t._v(" "),i("p",[t._v("¥")]),t._v(" "),i("p",{staticClass:"big"},[t._v(t._s(e.iNum)+".")]),t._v(" "),i("p",[t._v(t._s(e.dNum))])])})),0),t._v(" "),i("div",{staticClass:"text theme_font_black"},[t._v(t._s(t.detailData.showTitle))])]):i("div",{staticClass:"code-content-img-buttom"},[i("div",{staticClass:"text theme_font_red"},[i("span",{staticClass:"font-small price-z theme_font_red",staticStyle:{"font-weight":"700"}},[t._v("￥")]),t._v(" "),i("span",{staticClass:"price-z theme_font_red",staticStyle:{"margin-left":"-4px"}},[t._v(t._s(t.getInteger(t.detailData.salePrice)))]),t._v(" "),i("span",{staticClass:"font-small price-z theme_font_red",staticStyle:{"margin-left":"-4px","font-weight":"700"}},[t._v("."+t._s(t.getDecimals(t.detailData.salePrice)))])]),t._v(" "),i("div",{staticClass:"text theme_font_black"},[t._v(t._s(t.detailData.dpedData.featureName||t.detailData.skuName))])])]),t._v(" "),i("div",{staticClass:"code-content-line"}),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"code-content-zanwei"})]),t._v(" "),i("div",{staticClass:"code-btn"},[i("div",{staticClass:"btn theme_bg_red",on:{click:function(e){return e.stopPropagation(),t.preservation(e)}}},[t._v("保存图片到本地")]),t._v(" "),i("div",{staticClass:"text"},[t._v("记得发送给朋友或发布到朋友圈呦！")])])]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"code-content-code"},[e("canvas",{staticClass:"qrcode",attrs:{id:"qrcode"}}),this._v(" "),e("p",[this._v("微信扫码或长按识别二维码")])])}],!1,null,"1e8a9c88",null);e.a=u.exports},mG4U:function(t,e,i){"use strict";var a=i("oCYn");e.a=new a.default},rlxw:function(t,e,i){"use strict";var a=i("ygAv"),s={getPriceShow:function(t){if(0==t.length)return"";for(var e=t[0].price,i=t[0].price,a=1;a<t.length;a++){var s=t[a].price;e>s&&(e=s),i<s&&(i=s)}return e==i?[this.getINumDNum(e)]:[this.getINumDNum(e),this.getINumDNum(i)]},getINumDNum:function(t){var e=a.a.toDecimal2(t).split(".");return{iNum:e[0],dNum:e[1]}}};e.a=s}}]);