(window.webpackJsonp=window.webpackJsonp||[]).push([[713],{"15TJ":function(t,e,s){},"28rc":function(t,e,s){"use strict";s.r(e);var i=s("xZc2"),r=s("Vqiz"),a=s("csf6"),o=s("mbR2"),n=s("mCA+"),l={name:"cart",components:{CartList:r.a,AdPage:o.a},props:{hasBack:{type:Boolean,default:!0},commonShow:{type:Boolean,default:!1}},data:function(){return{topArr:[],deliverType:null,listZitiId:null,cartAddress:null,isEditing:!1,peisongNum:0,zitiNum:0,dataIsLoad:!1,firstZiti:!0,orderCategory:"",vipUnitUserCode:void 0,lastPath:"",cartNum:0,showBackBtn:!0}},methods:{toPresaleCart:function(){this.$router.push({path:"/mall2/presalecart"})},backEvent:function(){this.$router.go(-1),this.$keepaliveHelper.deleteCache(this)},setEdit:function(){this.isEditing=!this.isEditing},getAddressName:function(){var t=null;return 2==this.deliverType?t="":1==this.deliverType&&(t=""),t},chooseAddress:function(t){if(2==t)this.$router.push({path:"/mall2/addresslist"});else{if("cnooc"==this.$store.state.globalConfig.app_home_special_flag)return;this.$router.push({path:"/mall2/mypickupaddress"})}},deliverTypeEvent:function(t){2==t.type?(this.saveItemSel(t),this.getData()):1==t.type&&(1!=this.firstZiti||null!=this.$store.state.mall2.zitiAddress.id&&""!=this.$store.state.mall2.zitiAddress.id?(this.saveItemSel(t),this.getData()):this.chooseAddress(t.type),this.firstZiti=!1)},saveItemSel:function(t){t.hasShow=!0,this.deliverType=t.type,this.$store.state.mall2.staticDeliverType=this.deliverType,this.$bridgefunc.vuexStorage()},pageShow:function(){this.deliverType=this.$store.state.mall2.staticDeliverType,this.getData()},getData:function(){var t=this;if(1==this.deliverType)a.a.checkIsInitialLoad((function(e){if(e)t.getData();else{var s=t.getCartRef(t.deliverType);t.$nextTick((function(){if(t.$refs[s]){var e=t.$refs[s];console.log("this.$store.state.mall2.zitiAddress",t.$store.state.mall2.zitiAddress),console.log("this.$route.query.pickupAddress",t.$route.query.pickupAddress),e[0].getDataList(),sessionStorage.removeItem("RHY_Pickup_Address")}}))}}));else{var e=this.getCartRef(this.deliverType);this.$nextTick((function(){t.$refs[e]&&(t.$refs[e][0].getDataList(),sessionStorage.removeItem("RHY_Pickup_Address"))}))}},getCartRef:function(t){return"cart"+t},getItemByType:function(t){for(var e=0;e<this.topArr.length;e++){var s=this.topArr[e];if(s.type==t)return s}return null},_getCartCount:function(t){var e=this,s={token:this.$store.state.login.token,deliveryType:t,orderCategory:this.orderCategory,vipUnitUserCode:this.vipUnitUserCode};this.$http.post("/app/json/app_cart/getCartCount",s).then((function(s){var i=s.data;0==i.status&&(e.goodsCount=i.data,1==t?e.zitiNum=i.data:e.peisongNum=i.data)}),(function(t){}))}},activated:function(){if(2==this.$store.state.globalConfig.presaleType&&(this.cartNum=n.a.getCartNum()),("/common"!=this.$route.path||this.commonShow)&&1==this.dataIsLoad){this.deliverType=this.$store.state.mall2.staticDeliverType;var t=this.getItemByType(this.deliverType);this.deliverTypeEvent(t)}},beforeRouteLeave:function(t,e,s){t.path!=this.lastPath&&"/"!=this.lastPath&&""!=this.lastPath||this.$keepaliveHelper.deleteCache(this),s()},mounted:function(){var t=this;this.deliverType=this.$store.state.mall2.staticDeliverType;var e=this.getItemByType(this.deliverType);this.deliverTypeEvent(e),setTimeout((function(){t.dataIsLoad=!0}),500),1==this.deliverType?(this.zitiNum=this.$store.state.mall2.cartNum,"cnooc"==this.$store.state.globalConfig.app_home_special_flag?""!=this.$store.state.mall2.zitiAddress.mchOuCode&&this._getCartCount(2):this._getCartCount(2)):(this.peisongNum=this.$store.state.mall2.cartNum,"cnooc"==this.$store.state.globalConfig.app_home_special_flag?""!=this.$store.state.mall2.zitiAddress.id&&this._getCartCount(2):this._getCartCount(1))},created:function(){var t=this;if(this.lastPath=this.$route.query.lastPath?this.$route.query.lastPath:"",this.topArr=i.a.getTopArr(),this.$route.query.pickupId)this.$mallCommon.getSysStoreById(this.$route.query.pickupId,(function(e){t.$store.state.mall2.zitiAddress=e,sessionStorage.setItem("RHY_Pickup_Address",t.$route.query.pickupId),t.$userCenter._setDefaultPickupAddress(e.id)}));else if(this.$route.query.pickupAddress){var e=JSON.parse(this.$route.query.pickupAddress);this.$store.state.mall2.zitiAddress=e,sessionStorage.setItem("RHY_Pickup_Address",this.$route.query.pickupAddress),this.$userCenter._setDefaultPickupAddress(e.id)}this.listZitiId=this.$route.query.pickupId,this.cartAddress=this.$store.state.mall2.selectAddress,this.orderCategory=this.$route.query.orderCategory,this.vipUnitUserCode=this.$route.query.vipUnitUserCode,console.log("this.$store.state.webtype",this.$store.state.webtype),2!=this.$store.state.webtype&&3!=this.$store.state.webtype||"/common"!=this.$route.path?this.showBackBtn=!0:this.showBackBtn=!1},watch:{"$store.state.mall2.cartNum":function(t,e){0==t&&(this.isEditing=!1),1==this.deliverType?this.zitiNum=t:this.peisongNum=t}},computed:{goodsCount:{get:function(){return this.$store.state.mall2.cartNum},set:function(){}}}},d=(s("qfH3"),s("KHd+")),h=Object(d.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"cart"},[s("nav-top",{attrs:{noTitle:!0,noBack:!t.hasBack,showBackBtn:t.showBackBtn},on:{backEvent:t.backEvent}},[s("div",{staticClass:"cart-top"},[s("div",{staticClass:"cart-title"},[s("span",{staticClass:"title theme_font_black"},[t._v("购物车("+t._s(t.goodsCount)+")")])]),t._v(" "),t.goodsCount>0?s("p",{staticClass:"cart-edit theme_font_gray",on:{click:t.setEdit}},[t._v("\n        "+t._s(t.isEditing?"完成":"编辑")+"\n      ")]):t._e()])]),t._v(" "),s("nav-content",[s("div",{staticClass:"list-content",class:{notop:"1"==t.$store.state.globalConfig.delivertype_default||"2"==t.$store.state.globalConfig.delivertype_default}},t._l(t.topArr,(function(e,i){return e.hasShow?s("CartList",{directives:[{name:"show",rawName:"v-show",value:t.deliverType==e.type,expression:"deliverType == item.type"}],key:i,ref:t.getCartRef(e.type),refInFor:!0,attrs:{deliverType:e.type,isEditing:t.isEditing,orderCategory:t.orderCategory,vipUnitUserCode:t.vipUnitUserCode},on:{updateEdit:t.setEdit}}):t._e()})),1)]),t._v(" "),s("AdPage",{attrs:{pageAdKeywords:"AD_Key_Cart"}})],1)}),[],!1,null,"f8c7ec4c",null);e.default=h.exports},qfH3:function(t,e,s){"use strict";var i=s("15TJ");s.n(i).a}}]);