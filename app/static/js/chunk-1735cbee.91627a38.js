(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1735cbee"],{"14bc":function(t,e,s){},"29ea":function(t,e,s){},"2c42":function(t,e,s){"use strict";s("14bc")},ad50:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"coupon-list"},[o("nav-top",{attrs:{title:"优惠券"},on:{backEvent:t.backEvent}}),t.menuList.length?o("nav-content",{staticClass:"coupon-center"},[1==t.$store.state.globalConfig.app_crm_coupon_enable&&7!=t.$store.state.webtype?o("ul",{staticClass:"coupon-menu"},t._l(t.couponMenuList,(function(e,s){return o("li",{key:s,class:t.couponMenuListIndex==s?"active":"",on:{click:function(o){return t.couponHandle(e,s)}}},[t._v(t._s(e.title)),"app"==e.type?o("span",[t._v("("+t._s(t.appcouponTotal)+")")]):t._e()])})),0):t._e(),0==t.couponMenuListIndex?o("div",{staticClass:"coupon-content"},[o("ul",{staticClass:"menu-list"},t._l(t.menuList,(function(e,s){return o("li",{key:s,staticClass:"menu-item",class:{active:t.curType===e.url},on:{click:function(s){return t.chooseHandler(e.url)}}},[o("span",{staticClass:"text theme_standard_bdr_i",class:{theme_standard_font_i:t.curType===e.url}},[t._v(t._s(e.name)+"（"+t._s(e.num)+"）")])])})),0),o("ul",{directives:[{name:"show",rawName:"v-show",value:t.curType===t.unusedValue,expression:"curType === unusedValue"}],staticClass:"sub-menu-list"},[o("horizontal-scroll",{attrs:{dataList:t.couponTypeList}},[t._l(t.couponTypeList,(function(e,s){return o("li",{staticClass:"sub-menu-item",class:{active:t.curCateAlias===e.cateAlias},on:{click:function(s){return t.subMenuHandler(e.cateAlias)}}},[o("span",{staticClass:"text",class:{"theme_standard_bdr_i theme_standard_font_i theme_light_bg_i":t.curCateAlias===e.cateAlias}},[t._v(t._s(e.cateName)+"("+t._s(e.cateCnt)+")")])])})),o("li",{staticClass:"sub-menu-item",class:{active:"gouwuquan"===t.curCateAlias},on:{click:function(e){return t.subMenuHandler("gouwuquan")}}},[o("span",{staticClass:"text",class:{"theme_standard_bdr_i theme_standard_font_i theme_light_bg_i":"gouwuquan"===t.curCateAlias}},[t._v(" 购物券 ("+t._s(t.couponPackageLength)+") ")])])],2)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:t.hasGetData,expression:"hasGetData"}],staticClass:"coupon-list-wrapper",class:{"no-padding":!t.hasBtmBtn}},[o("scroll",{ref:"scroll",staticClass:"coupon-list-scroll",attrs:{listenScroll:!0,"probe-type":3,hasMore:t.hasMore,pullUpLoad:!0,data:t.couponList,pullDownRefresh:!0},on:{scroll:t.scroll,pullingUp:t.loadMore,pullingDown:t.reset}},[["gouwuquan"===t.curCateAlias&&"getUnusedCouponsWithCols"==t.curType?t._l(t.couponList,(function(t,e){return o("couponPackage",{key:e,staticClass:"coupon-item",attrs:{item:t}})})):t._l(t.couponList,(function(e,s){return o("coupon",{key:s,staticClass:"coupon-item",attrs:{couponLayoutType:t.isGroupCoupon?2:1,disabled:t.disabled,used:"getUsedCoupons"===t.curType,curType:t.curType,item:e,index:s},on:{load:t.reset}})}))]],2),t.couponList.length?t._e():o("div",{staticClass:"no-coupon-wrapper"},[o("img",{staticClass:"img",attrs:{src:s("223a"),alt:""}}),o("p",{staticClass:"title theme_font_tint"},[t._v("没有券？")]),o("p",{staticClass:"sub-title theme_font_tint"},[t._v("去领券中心看看吧")])]),t.disabled?o("div",{staticClass:"tip"},[t._v("以上是近期"+t._s("getExpiredCoupons"==t.curType?"已过期":"已使用")+"的优惠券")]):t._e()],1),t.hasBtmBtn?o("div",{staticClass:"footer-btn"},[""==t.noGetCoupon?o("router-link",{staticClass:"btn",attrs:{to:"/get_coupon"}},[t._v("领更多好券")]):t._e(),o("a",{staticClass:"btn",on:{click:t.viewQrcode}},[t._v("查看会员二维码")])],1):t._e()]):o("div",{staticClass:"coupon-content"})]):t._e(),o("van-popup",{model:{value:t.showActivateModel,callback:function(e){t.showActivateModel=e},expression:"showActivateModel"}},[o("div",{staticClass:"activate-model"},[o("div",{staticClass:"title"},[t._v("激活码")]),o("div",{staticClass:"content"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.dynamicCode,expression:"dynamicCode"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入激活码"},domProps:{value:t.dynamicCode},on:{input:function(e){e.target.composing||(t.dynamicCode=e.target.value)}}}),o("span",{staticStyle:{"margin-left":"10px"},on:{click:t.scanCodeFunc}},[o("img",{staticClass:"see-icon",attrs:{src:"static/image/setting/icon-scan.png"}})])]),o("div",{staticClass:"btn theme_standard_bg theme_standard_font",staticStyle:{"margin-left":"0","margin-top":"15px"},on:{click:t.activateHandler}},[t._v("激活 ")])])]),o("van-dialog",{attrs:{title:"会员二维码",confirmButtonText:"关闭"},model:{value:t.showQrcode,callback:function(e){t.showQrcode=e},expression:"showQrcode"}},[o("div",{staticClass:"qr-warp",staticStyle:{"text-align":"center"}},[o("canvas",{staticClass:"qr-code",attrs:{id:"qrcode"}})])]),t.couponsView?o("div",{ref:"moved",staticClass:"xuanfu",attrs:{id:"moveDiv"},on:{mousedown:t.down,touchstart:t.down,mousemove:function(e){return e.preventDefault(),t.move.apply(null,arguments)},touchmove:function(e){return e.preventDefault(),t.move.apply(null,arguments)},mouseup:t.end,touchend:t.end}},[o("img",{staticClass:"imgt1",attrs:{src:s("e2d0"),alt:""},on:{click:t.tocoupons}}),o("img",{staticClass:"imgt2",attrs:{src:s("7401"),alt:""},on:{click:t.closeBtn}})]):t._e()],1)},n=[],a=s("1da1"),i=s("5530"),c=(s("96cf"),s("277d"),s("4160"),s("159b"),s("5377"),s("d81d"),s("99af"),s("7db0"),s("d3b7"),s("4e82"),s("00d6")),u=s("d055"),r=s.n(u),l=s("c81b"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.item.couPackage?s("div",{staticClass:"package"},[s("div",{staticClass:"coupon-left"},[s("h3",[t._v(t._s(t.item.couPackageName))]),s("p",[t._v("共"+t._s(t.item.couCount)+"张")])]),s("div",{staticClass:"coupon-right",on:{click:function(e){return t.use(t.item.couPackage)}}},[s("span",[t._v("立即使用")])])]):t._e()},d=[],h={props:{item:{type:Object,default:function(){}}},methods:{use:function(t){var e={path:"/coupon_package_detail",query:{couPackage:t}};this.$router.push(e)}}},m=h,f=(s("e5e8"),s("0c7c")),v=Object(f["a"])(m,p,d,!1,null,"3ffbf2e2",null),g=v.exports,C=s("bba4"),y=s("2f62"),_={name:"",data:function(){return{appcouponTotal:0,couponMenuListIndex:0,couponMenuList:[{title:"APP优惠券",type:"app"},{title:this.$store.state.globalConfig.crmcoupons_title||"便利店优惠券",type:"crm"}],noGetCoupon:"",showActivateModel:!1,dynamicCode:"",hasGetData:!1,couponTypeList:[],couponList:[],menuList:[],page:0,rows:10,hasMore:!0,loading:!1,scrollY:0,_scrollY:0,showQrcode:!1,couponPackageLength:0,isFirstEnter:!0,curType:"",curCateAlias:"quanbu",isGroupCoupon:!1,unusedValue:"",flags:!1,position:{x:0,y:0},nx:"",ny:"",dx:"",dy:"",xPum:"",yPum:"",couponsView:!1,crmUrl:"",hasBtmBtn:!0}},mounted:function(){this.loadIndex(),this.getCouponPackage(),this.getCouTypeCateCnt()},created:function(){this.noGetCoupon=this.$store.state.globalConfig.coupon_list_no_get_coupon||"",1==this.$store.state.globalConfig.hideCouponListBtmBtn?this.hasBtmBtn=!1:this.hasBtmBtn=!0},activated:function(){this.isFirstEnter||this.backScroll()},beforeRouteLeave:function(t,e,s){this._scrollY=this.scrollY,s()},computed:Object(i["a"])({disabled:function(){return"getUsedCoupons"===this.curType||"getExpiredCoupons"===this.curType}},Object(y["c"])(["vipUnitUser"])),methods:{couponHandle:function(t,e){var s=this;this.couponMenuListIndex=e,"crm"==t.type&&this.$request.post("/app/json/home/getExoLoginUrl",{token:this.$store.state.login.token,sysTag:"crm",vipUnitUserCode:this.vipUnitUser.vipUnitUserId}).then((function(t){0===t.status?(s.crmUrl=t.data||"",s.$bridgefunc.customPush({path:s.crmUrl,isnativetop:"1"})):s.$Toast(t.info)}))},viewQrcode:function(){var t=this;this.showQrcode=!0,this.$nextTick((function(){r.a.toCanvas(document.getElementById("qrcode"),t.$store.state.userInfo.userId||"",{width:180})}))},getCouponPackage:function(){var t=this;this.$http.post("/app/json/coupon/getUnusedCouponsGroupByPackage",{token:this.$store.state.login.token}).then((function(e){var s=e.data;0==s.status?(t.couponPackageLength=s.totalRecords||0,Array.isArray(s.data)&&s.data.length&&s.data.forEach((function(e){e.couponPackage||(t.couponPackageLength=s.totalRecords-1)}))):t.$toast(e.info)}))},scanCodeFunc:function(){var t=this;this.$bridgefunc.scanCode((function(e){t.dynamicCode=e.code,t.activateHandler()}))},backEvent:function(){"subject"==this.$route.query.type?this.$router.push({path:"/questionlist"}):"serviceSubject"==this.$route.query.type?this.$router.push({path:"/service/questionlist"}):"equity_car"==this.$route.query.type?this.$router.push({path:"/equity_card/equityList"}):this.$router.go(-1)},tocoupons:function(){this.$router.push({path:"/user_center/shareList"})},closeBtn:function(){this.couponsView=!1},down:function(){var t;this.flags=!0,t=event.touches?event.touches[0]:event,this.position.x=t.clientX,this.position.y=t.clientY,this.dx=moveDiv.offsetLeft,this.dy=moveDiv.offsetTop},move:function(){if(this.flags){var t;t=event.touches?event.touches[0]:event,this.nx=t.clientX-this.position.x,this.ny=t.clientY-this.position.y,this.xPum=this.dx+this.nx,this.yPum=this.dy+this.ny;var e=document.body.clientWidth-this.$refs.moved.offsetWidth,s=document.body.clientHeight-this.$refs.moved.offsetHeight;this.xPum<0&&(this.xPum=0),this.yPum<0&&(this.yPum=0),this.xPum>e&&(this.xPum=e),this.yPum>s&&(this.yPum=s),moveDiv.style.left=this.xPum+"px",moveDiv.style.top=this.yPum+"px",document.addEventListener("touchmove",(function(t){t.stopPropagation()}),!1)}},end:function(){this.flags=!1},loadIndex:function(){var t=this,e=this;this.$http.post("/app/json/fission_activity/getShareUsedCoupons",{}).then((function(t){if("success"===t.data.result){var s=t.data.data||[];s.length>0&&(e.couponsView=!0)}}),(function(e){t.$Toast(res.data.info)}))},pageInit:function(){var t=this;this.getMyCouponCnt().then((function(e){t.getCouTypeCateCnt(),t.isFirstEnter=!1}))},backScroll:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t.page,t.rows=s*t.rows,t.page=0,t.couponList=[],e.next=6,t.getMyCouponCnt();case 6:return e.next=8,t.loadMore(!0);case 8:t.getCouTypeCateCnt(),t.$nextTick((function(){t.$refs.scroll.scrollTo(0,t._scrollY)})),t.rows=10,t.page=s;case 12:case"end":return e.stop()}}),e)})))()},scroll:function(t){this.scrollY=t.y},chooseHandler:function(t){t!==this.curType&&(this.$refs.scroll&&this.$refs.scroll.scrollTo(0,0),this.curType=t,this.reset())},subMenuHandler:function(t){t!==this.curCateAlias&&(this.$refs.scroll&&this.$refs.scroll.scrollTo(0,0),this.curCateAlias=t,this.reset())},reset:function(){this.$refs.scroll.closePullUp(),this.hasMore=!0,this.hasGetData=!1,this.page=0,this.couponList=[],this.loadMore(!0)},loadMore:function(t){var e=this;if(!this.loading){this.$Loading.open(),this.page++,this.loading=!0;var s={page:this.page,rows:this.rows};this.curType===this.unusedValue&&this.curCateAlias&&"quanbu"!=this.curCateAlias&&"gouwuquan"!==this.curCateAlias&&(s.couTypeCategoryAlias=this.curCateAlias);var o="/app/json/coupon/".concat(this.curType);return"gouwuquan"===this.curCateAlias&&"getUnusedCouponsWithCols"==this.curType&&(o="/app/json/coupon/getUnusedCouponsGroupByPackage"),this.$http.post(o,s).then((function(s){var o=s.data;if(0==o.status){if(!Array.isArray(o.data)||!o.data.length)return e.$Loading.close(),e.loading=!1,void(e.hasGetData=!0);var n=o.data||[];if(n.map((function(t){return t.dpedData=e.$mallCommon.priceFromItem(t),t.linePrice=e.$util.toDecimal2(t.dpedData.linePrice),t})),e.couponList=e.couponList.concat(n),"gouwuquan"!==e.curCateAlias){var a=null;e.curType===e.unusedValue&&e.curCateAlias&&"quanbu"!=e.curCateAlias?(a=e.couponTypeList.find((function(t){return t.cateAlias===e.curCateAlias})),a.cateCnt):(a=e.menuList.find((function(t){return t.url===e.curType})),a.num)}e.couponList.length>=o.totalRecords&&(e.hasMore=!1)}e.loading=!1,e.hasGetData=!0,t&&e.$refs.scroll.openPullUp(),e.$Loading.close()}))}},getMyCouponCnt:function(){var t=this;return new Promise((function(e,s){t.$Loading.open(),t.$http.post("/app/json/coupon/getMyCouponCnt",{}).then((function(s){var o=s.data;if(0==o.status){var n=o.data||{},a=[];for(var i in n){var c={};switch(i){case"unusednum":c={name:"未使用",num:n[i],url:t.unusedValue,sort:0},a.push(c);break;case"usednum":c={name:"已使用",num:n[i],url:"getUsedCoupons",sort:1},a.push(c);break;case"expnum":c={name:"已过期",num:n[i],url:"getExpiredCoupons",sort:2},a.push(c);break}}a=a.sort((function(t,e){return t.sort-e.sort})),t.menuList=a,e()}t.$Loading.close()}))}))},getCouTypeCateCnt:function(){var t=this;this.$Loading.open();var e={state:20};this.$http.post("/app/json/coupon/getCouTypeCateCnt",e).then((function(e){var s=e.data;if(0==s.status){for(var o=s.data.cateCntModels||[],n=0,a=0;a<o.length;a++)n+=o[a].cateCnt||0;t.couponTypeList=o,t.curCateAlias=o[0].cateAlias,t.appcouponTotal=n,t.loadMore()}t.$Loading.close()}))},deleteCoupon:function(t){var e=this;this.$Loading.open();var s={couNo:t.couNo};this.$http.post("/app/json/coupon/delCoupons",s).then((function(t){var s=t.data;0==s.status?(e.$toast("删除成功！"),e.getMyCouponCnt(),e.reset()):e.$toast(s.info||"删除失败！"),e.$Loading.close()}))["catch"]((function(t){e.$toast(t||"删除异常！"),e.$Loading.close()}))},activateHandler:function(){var t=this;this.dynamicCode?this.$http.post("/app/json/coupon/corpUserActivateCou",{dynamicCode:this.dynamicCode}).then((function(e){var s=e.data;0==s.status?(t.$toast("激活成功！"),t.getMyCouponCnt(),t.reset()):t.$toast(s.info||"激活失败！"),t.dynamicCode="",t.showActivateModel=!1})):this.$toast("请输入激活码！")}},watch:{$route:{handler:function(t,e){!this.isFirstEnter||"/coupon_list2"!==t.path&&"/coupon_list"!==t.path||(this.isGroupCoupon="/coupon_list2"===t.path,this.unusedValue=this.isGroupCoupon?"getUnusedCouponsGroup":"getUnusedCouponsWithCols",this.curType=this.unusedValue,this.pageInit())},immediate:!0}},components:{Coupon:l["a"],HorizontalScroll:c["a"],Scroll:C["default"],couponPackage:g}},b=_,$=(s("2c42"),Object(f["a"])(b,o,n,!1,null,"cf84d192",null));e["default"]=$.exports},e5e8:function(t,e,s){"use strict";s("29ea")}}]);