(window.webpackJsonp=window.webpackJsonp||[]).push([[170,348],{"02kl":function(t,e,i){"use strict";var s=i("C3sG");i.n(s).a},"2Unv":function(t,e,i){"use strict";i.r(e);var s=i("Xt+m"),a=i("Qcq2"),o=i("WQzh"),n=i("GGi1"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},l={name:"placeorder",components:{PriceOrder:o.a,Agreement:n.default},data:function(){return{deliveryType:this.$store.state.mall2.staticDeliverType,paramsData:{},settleData:{},pickupPhone:this.$store.state.login.phone,pickupTime:new Date,payWayText:"在线支付",payWayPopShow:!1,payWays:[{text:"在线支付",tag:"1"},{text:"货到付款",tag:"0"},{text:"提货付款",tag:"0"}],payWaySelected:1,remark:"",useInvoice:!1,invoiceData:null,invoiceInfo:"",currentInvoice:{},showAgreement:!1,referrer:"",canEditReferrer:!0,scanCode:"",type:"1"}},computed:{recommendDisabled:function(){return!this.$store.state.globalConfig.recommendDisabled||!Number(this.$store.state.globalConfig.recommendDisabled)}},methods:{scanCodeFunc:function(){var t=this;this.$bridgefunc.scanCode((function(e){t.scanCode=e.code,t.referrer=e.code}))},checkProductStock:function(){if(1==this.deliveryType){if(null==this.$store.state.mall2.pickUpUser||""==this.$store.state.mall2.pickUpUser)return void this.$Toast("请完善自提人信息");if(""==this.pickupPhone)return void this.$Toast("请完善自提人信息");this.$bridgefunc.vuexStorage()}if(this.$store.state.mall2.selectAddress.id>0||2!=this.deliveryType){for(var t=0;t<this.settleData.carts.length;t++){var e=this.settleData.carts[t];if(e.stockNumber<e.number)return void this.$Toast("当前区域商品库存不足！")}this._submitOrder()}else this.$Toast("请维护并选择收货地址！")},_submitOrder:function(){var t=this,e="/app/json/app_fight_group_order/start";"2"==this.type&&(e="/app/json/app_fight_group_order/join");var i=this.paramsData;if(1==this.deliveryType){i.pickupReceiver=this.$store.state.mall2.pickUpUser,i.pickupMobile=this.pickupPhone;var s=this.$util.getMyDate(this.pickupTime);i.selectReceiveTime=s}i.remark=this.remark,i.userAddress=this.$store.state.mall2.selectAddress,i.userAddressId=this.$store.state.mall2.selectAddress.id,i.token=this.$store.state.login.token,this.referrer&&this.referrer.length&&(i.rfrCode=this.referrer),this.referrer==this.scanCode?i.rfrCodeType=2:i.rfrCodeType=1,i.userInvoice={},null!=this.currentInvoice&&1==this.useInvoice&&(i.userInvoice.invoiceUse="1",i.userInvoice.invoiceType="1",0==this.currentInvoice.type?(i.userInvoice.invoiceTitleType="4",i.userInvoice.invoiceTitle="个人"):(i.userInvoice.invoiceTitleType="5",i.userInvoice.invoiceTitle=this.currentInvoice.company),i.userInvoice.invoiceUserName=this.currentInvoice.name,i.userInvoice.invoiceUserEmail=this.currentInvoice.email,i.userInvoice.invoiceUserMobile=this.currentInvoice.phone,i.userInvoice.invoiceUserOrgTaxNo=this.currentInvoice.identifyNumber,i.userInvoice.invoiceDetailType=this.currentInvoice.selectedGoodsType),this.$Loading.open(),this.$http.post(e,i).then((function(e){t.$Loading.close();var i=e.data;0==i.status?0==i.data.responseSubmit.payAmount?t.$router.replace({path:"/group_detail",query:{orderId:i.data.orderId,mktGroupBuyId:t.mktGroupBuyId,formPaySuccess:"1"}}):(console.log("-----------------------------------",t.$route),t.$router.replace({path:"/mall2/checkstand",query:{payInfo:JSON.stringify(i.data.responseSubmit),occurOuCode:t.settleData.ouCode,isGroup:"1",orderId:i.data.orderId,mktGroupBuyId:t.mktGroupBuyId,skuId:t.$route.params.skuId,productType:t.$route.params.productType,groupId:t.$route.params.groupId}})):t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},getTotalPriceDuan:function(t){return this.$util.toDecimal2(this.settleData.payAmount).split(".")[t]},getImgArrs:function(t){for(var e=[],i=t.carts,s=0;s<i.length;s++)e.push(i[s].phPictureUrl);return e},showFreightDetail:function(){var t=[],e={};e.storeName=this.settleData.ouName,e.freightAmount=this.settleData.freightAmount,e.freightDiscountAmount=this.settleData.freightDiscountAmount,e.proImgs=this.getImgArrs(this.settleData),t.push(e),a.a.open({initData:{listData:t},sureEvent:function(){a.a.close()}})},useInvoiceEvent:function(){var t=this;if(this.useInvoice=!this.useInvoice,this.useInvoice&&null==this.invoiceData){this.$Loading.open();var e={token:this.$store.state.login.token};this.$http.post("/app/json/order_invoice/loadTwoTypeDefaultUserInvoiceHead",e).then((function(e){t.$Loading.close();var i=e.data;0==i.status?(t.invoiceData=i.data,"personal"==t.invoiceData.current?(t.currentInvoice=t.invoiceData.personal,t.currentInvoice.name=t.invoiceData.personal.title,t.invoiceInfo=t.invoiceData.personal.title,t.currentInvoice.type=0):(t.currentInvoice.type=1,t.currentInvoice=t.invoiceData.company,t.currentInvoice.invoiceTitle=t.invoiceData.company.title,t.invoiceInfo=t.invoiceData.company.title),t.invoiceData.phone=t.$store.state.login.phone,t.invoiceData.email=t.$store.state.userInfo.email,t.invoiceData.name=t.$store.state.userInfo.nickName):t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))}},changeInvoice:function(){var t=this;s.a.open({initData:r({},this.invoiceData,{token:this.$store.state.login.token}),selectedInvoice:function(e){console.log(e),t.currentInvoice=e,0==e.type?(t.invoiceInfo="个人",t.invoiceData.personal.title=e.name,t.invoiceData.personal.userPhone=e.phone,t.invoiceData.personal.userEmail=e.email):(t.invoiceInfo=e.company,t.invoiceData.company.userPhone=e.phone,t.invoiceData.company.userEmail=e.email,t.invoiceData.company.orgTaxNo=e.identifyNumber,t.invoiceData.company.title=e.company),s.a.close()},invoiceInformation:function(){t.showAgreement=!0}})},returnStoreProducts:function(t){for(var e=t.noActivityCart.length,i=0,s=[],a=0;a<t.noActivityCart.length;a++)s.push(t.noActivityCart[a].phPictureUrl),i+=t.noActivityCart[a].number;for(var o=0;o<t.activity.length;o++){e+=t.activity[o].cart.length;for(var n=0;n<t.activity[o].cart.length;n++)s.push(t.activity[o].cart[n].phPictureUrl),i+=t.activity[o].cart[n].number}var r={num:e,proNum:i,proImgArr:s};t.storeProData=r},_settle:function(){var t=this;this.$Loading.open();var e=this.paramsData;2==this.deliveryType?this.$store.state.mall2.selectAddress.id>0&&(e.userAddressId=this.$store.state.mall2.selectAddress.id):e.pickupId=this.$store.state.mall2.zitiAddress.id,this.$http.post("/app/json/app_fight_group_order/settle",e).then((function(e){t.$Loading.close();var i=e.data;0==i.status?t.settleData=i.data:t.$Toast(i.info)}),(function(e){t.$Loading.close(),t.$Toast("请求数据失败！")}))},payWayShow:function(){this.payWayPopShow=!0},payWayEvent:function(t){0!=t.tag?(this.payWaySelected=t.tag,this.payWayText=t.text):this.$Toast("暂不支持！")},popSureEvent:function(){this.payWayPopShow=!1},popClose:function(){this.payWayPopShow=!1},toSelectAddress:function(){this.$router.push({path:"/mall2/addresslist"})},toSelectZitiAddress:function(){console.log(this.paramsData);for(var t=this.paramsData.carts,e=[],i=0;i<t.length;i++)e.push(t[i].skuId);this.$router.push({path:"/mall2/mypickupaddress",query:{skuIds:JSON.stringify(e)}})},openPicker:function(){this.$refs.dateDom.open()},pickerConfirm:function(t){var e="星期"+"天一二三四五六 ".charAt(new Date(t).getDay());return this.$util.getMyDate(t)+" 【"+e+"】"},getEndDate:function(){var t=new Date;return t.setDate(t.getDate()+14),t}},created:function(){this.type=this.$route.params.type?this.$route.params.type:"1",this.orderId=this.$route.params.orderId?this.$route.params.orderId:"",this.mktGroupBuyId=this.$route.params.mktGroupBuyId?this.$route.params.mktGroupBuyId:"",this.paramsData=JSON.parse(this.$route.params.paramsData),this.lastPath=this.$route.query.lastPath},activated:function(){this._settle()},beforeRouteLeave:function(t,e,i){t.path!=this.lastPath&&"/group_detail"!=t.path&&"/mall2/checkstand"!=t.path||this.$keepaliveHelper.deleteCache(this),i()}},c=(i("q5E6"),i("KHd+")),d=Object(c.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"placeorder mall2"},[i("nav-top",{on:{backEvent:function(e){return t.$router.go(-1)}}}),t._v(" "),i("nav-content",[i("div",{staticClass:"flex-div"},[i("div",{staticClass:"scroll-div"},[2==t.deliveryType?i("div",{staticClass:"block-div no-padding-bottom"},[t.$store.state.mall2.selectAddress.id>0&&2==t.deliveryType?i("div",{on:{click:t.toSelectAddress}},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"name theme_font_black"},[t._v(t._s(t.$store.state.mall2.selectAddress.receiverName))]),t._v(" "),i("div",{staticClass:"name theme_font_black"},[t._v(t._s(t.$store.state.mall2.selectAddress.mobile))]),t._v(" "),1==t.$store.state.mall2.selectAddress.isDefault?i("div",{staticClass:"act-item-full theme_standard_bg theme_font_white"},[t._v("默认\n              ")]):t._e()]),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"full theme_font_tint font-small"},[t._v(t._s(t.$store.state.mall2.selectAddress.addressFull))]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_tint icon-font"})])])]):t._e(),t._v(" "),t.$store.state.mall2.selectAddress.id>0||2!=t.deliveryType?t._e():i("div",{on:{click:t.toSelectAddress}},[i("div",{staticClass:"flex-row"},[t._v("\n              请选择地址信息\n            ")])]),t._v(" "),t.$store.state.mall2.zitiAddress.id>0&&1==t.deliveryType?i("div",{on:{click:t.toSelectZitiAddress}},[i("div",{staticClass:"pickup-shop"},[i("div",{staticStyle:{flex:"1"}},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"name theme_font_black"},[t._v("自提店铺："+t._s(t.$store.state.mall2.zitiAddress.storeName))])]),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"full theme_font_tint font-small",staticStyle:{"line-height":"1.4"}},[t._v("\n                    "+t._s(t.$store.state.mall2.zitiAddress.addressFull)+" "+t._s(t.$store.state.mall2.zitiAddress.phone&&""!=t.$store.state.mall2.zitiAddress.phone?"("+t.$store.state.mall2.zitiAddress.phone+")":"")+"\n                  ")])])]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduojiantou theme_font_tint icon-font"})])])]):t._e(),t._v(" "),i("div",{staticClass:"colorfulline"},[i("img",{attrs:{src:"static/image/mall2/colorfulline.png"}})])]):t._e(),t._v(" "),1==t.deliveryType?i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"title theme_font_black"},[t._v("提货人信息")])]),t._v(" "),i("div",{staticClass:"flex-row flex-row-smallbottom"},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("姓名")]),t._v(" "),i("div",{staticClass:"full"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.$store.state.mall2.pickUpUser,expression:"$store.state.mall2.pickUpUser"}],staticClass:"row-input",attrs:{placeholder:"请输入提货人姓名"},domProps:{value:t.$store.state.mall2.pickUpUser},on:{input:function(e){e.target.composing||t.$set(t.$store.state.mall2,"pickUpUser",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("联系方式")]),t._v(" "),i("div",{staticClass:"full"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.pickupPhone,expression:"pickupPhone"}],staticClass:"row-input",attrs:{placeholder:"请输入提货人联系方式"},domProps:{value:t.pickupPhone},on:{input:function(e){e.target.composing||(t.pickupPhone=e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"flex-row",on:{click:t.openPicker}},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("自提时间")]),t._v(" "),i("div",{staticClass:"full theme_font_common",class:{theme_font_tint_i:""==t.pickupTime},staticStyle:{"text-align":"right"}},[t._v(t._s(t.pickerConfirm(t.pickupTime))+"\n            ")]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])])]):t._e(),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row",on:{click:t.payWayShow}},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("支付方式")]),t._v(" "),i("div",{staticClass:"full"}),t._v(" "),i("div",{staticClass:"theme_font_common right-margin"},[t._v(t._s(t.payWayText))]),t._v(" "),i("div",[i("i",{staticClass:"iconfont mall-gengduo more-icon theme_font_tint"})])])]),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"name"},[t._v(t._s(t.settleData.ouName))])]),t._v(" "),i("div",t._l(t.settleData.carts,(function(e){return i("div",{staticClass:"pro-row"},[i("div",{staticClass:"img-div"},[i("img",{attrs:{src:e.phPictureUrl}})]),t._v(" "),i("div",{staticClass:"info-div"},[i("div",{staticClass:"title theme_font_black"},[t._v(t._s(e.productName))]),t._v(" "),i("div",{staticClass:"title theme_font_black"},[i("span",[t._v(t._s(e.specs))])]),t._v(" "),i("div",{staticClass:"price"},[i("PriceOrder",{attrs:{productData:e}}),t._v(" "),i("span",{staticStyle:{float:"right"}},[t._v("x "+t._s(e.number))])],1)])])})),0),t._v(" "),i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle theme_font_common"},[t._v("备注")]),t._v(" "),i("div",{staticClass:"full"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],staticClass:"row-input theme_font_common",attrs:{placeholder:"请留下您想说的话"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}})])])]),t._v(" "),i("div",{staticClass:"block-div"},[i("div",{staticClass:"flex-row"},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("商品金额")]),t._v(" "),i("div",{staticClass:"theme_font_black"},[t._v("￥"+t._s(t.$util.toDecimal2(t.settleData.amount)))])]),t._v(" "),i("div",{staticClass:"flex-row",on:{click:t.showFreightDetail}},[i("div",{staticClass:"label-middle full theme_font_common"},[t._v("运费"),i("i",{staticClass:"iconfont mall-info theme_font_gray",staticStyle:{"margin-left":"3px"}})]),t._v(" "),i("div",{staticClass:"theme_font_red"},[t._v("+￥"+t._s(t.$util.toDecimal2(parseFloat(t.settleData.freightAmount)-parseFloat(t.settleData.freightDiscountAmount)))+"\n            ")])])])]),t._v(" "),i("div",{staticClass:"bottom-btns"},[2==t.deliveryType?i("div",{staticClass:"tip theme_bg_yl theme_standard_font theme_light_bg"},[t._v("\n          "+t._s(t.$store.state.mall2.selectAddress.addressFull)+"\n        ")]):t._e(),t._v(" "),i("div",{staticClass:"btn theme_standard_bg theme_font_white",on:{click:t.checkProductStock}},[t._v("提交订单")]),t._v(" "),i("div",{staticClass:"price"},[i("div",{staticClass:"rmb-div"},[i("span",{staticClass:"theme_font_red"},[t._v("￥")]),t._v(" "),i("span",{staticClass:"left-no-space price-big theme_font_red"},[t._v(t._s(t.getTotalPriceDuan(0)))]),t._v(" "),i("span",{staticClass:"theme_font_red"},[t._v("."+t._s(t.getTotalPriceDuan(1)))])])])])])]),t._v(" "),i("mt-datetime-picker",{ref:"dateDom",attrs:{type:"date",startDate:new Date,endDate:t.getEndDate(),"year-format":"{value} 年","month-format":"{value} 月","date-format":"{value} 日"},model:{value:t.pickupTime,callback:function(e){t.pickupTime=e},expression:"pickupTime"}}),t._v(" "),t.payWayPopShow?i("pop-view",{on:{closeEvent:t.popClose}},[i("div",{staticClass:"pop-body"},[i("div",{staticClass:"pop-title theme_font_common"},[t._v("请选择支付方式")]),t._v(" "),i("div",{staticClass:"items-div pop-scroll-div"},t._l(t.payWays,(function(e){return i("div",{staticClass:"item theme_font_common theme_bg_white_ef",class:{theme_light_bg:t.payWaySelected==e.tag,theme_standard_font_i:t.payWaySelected==e.tag,theme_standard_bdr_i:t.payWaySelected==e.tag},on:{click:function(i){return t.payWayEvent(e)}}},[t._v(t._s(e.text)+"\n        ")])})),0),t._v(" "),i("div",{staticClass:"bottom-btn theme_font_white theme_standard_bg bottom-space",on:{click:t.popSureEvent}},[t._v("确定")])])]):t._e(),t._v(" "),t.showAgreement?i("Agreement",{attrs:{propsValue:9},on:{backEvent:function(e){t.showAgreement=!1}}}):t._e()],1)}),[],!1,null,"589e7664",null);e.default=d.exports},C3sG:function(t,e,i){},Fybm:function(t,e,i){"use strict";var s={name:"agreement-content",components:{},props:["value","noloading"],data:function(){return{agreementContent:""}},methods:{getAgreement:function(){var t=this;"true"!=this.noloading&&this.$Loading.open();var e=void 0,i=void 0;18==this.value?(e="/app/json/news/getNewsList",i={values:52}):(e="/app/json/news/getList",i={token:this.$store.state.login.token,value:this.value}),this.$http.post(e,i).then((function(e){"true"!=t.noloading&&t.$Loading.close();var i=e.data.data;if(i&&""!=i){var s=i[0];t.agreementContent=s.content}else console.log("协议内容为空")}),(function(e){"true"!=t.noloading&&t.$Loading.close(),t.$Toast("请求数据失败！")}))}},mounted:function(){this.getAgreement()},created:function(){}},a=(i("02kl"),i("KHd+")),o=Object(a.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"agreement-content"},[e("div",{staticClass:"content",domProps:{innerHTML:this._s(this.agreementContent)}})])}),[],!1,null,"5e72c5d8",null);e.a=o.exports},GGi1:function(t,e,i){"use strict";i.r(e);var s={name:"agreement",components:{AgreementContent:i("Fybm").a},props:["propsValue"],data:function(){return{value:"",topTitle:"协议"}},methods:{backEvent:function(){this.propsValue?this.$emit("backEvent"):this.$router.go(-1)}},created:function(){this.value=this.$route.query.value?this.$route.query.value:3,this.topTitle="协议",this.propsValue&&(this.value=this.propsValue),3!=this.$store.state.webtype&&(9==this.value?(this.topTitle="发票须知",document.title="发票须知"):10==this.value?(this.topTitle="积分规则",document.title="积分规则"):11==this.value?(this.topTitle="积分使用规则",document.title="积分使用规则"):17==this.value?(this.topTitle="用户协议",document.title="用户协议"):18==this.value?(this.topTitle="捐赠协议",document.title="捐赠协议"):63==this.value?(this.topTitle="隐私协议",document.title="隐私协议"):65==this.value?(this.topTitle="使用规则",document.title="使用规则"):80==this.value&&(this.topTitle="使用规则",document.title="使用规则"))}},a=(i("XXIG"),i("KHd+")),o=Object(a.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"agreement theme_bg_white"},[e("nav-top",{attrs:{title:this.topTitle},on:{backEvent:this.backEvent}}),this._v(" "),e("nav-content",[e("div",{staticClass:"content"},[e("AgreementContent",{attrs:{value:this.value}})],1)])],1)}),[],!1,null,"281a2789",null);e.default=o.exports},Ii5f:function(t,e,i){},XXIG:function(t,e,i){"use strict";var s=i("XkAZ");i.n(s).a},XkAZ:function(t,e,i){},q5E6:function(t,e,i){"use strict";var s=i("Ii5f");i.n(s).a}}]);