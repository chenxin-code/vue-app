(window.webpackJsonp=window.webpackJsonp||[]).push([[760],{"B8C/":function(t,e,s){"use strict";s.r(e);var o=s("dqDD"),a={name:"refuel-order",components:{Toast:o.Toast},data:function(){return{orderNo:"",pageShow:0,selectedIndex:"0",cardInfo:null,elticket:{couNo:"",userId:"",couPic:"",couTypeTitle:"不适用优惠券",couTypeSubTitle:"",validDate:"",state:"",couCanGift:""},refuelInfo:{stationCode:"",stationName:"",gunNo:"",tradeNo:"",oilName:"",oilCode:"",oilType:"",oilPrice:"",totalOilQty:"",totalOilAmount:"",tradeTime:""},paytype_normal:[{type:"01",name:"微信",img:"static/image/refuel/pay_wechat.png"},{type:"02",name:"支付宝",img:"static/image/refuel/pay_zhifubao.png"}],pageType:"",yunCardInfo:null}},computed:{money:function(){var t=this.elticket.limit?this.elticket.limit:0,e=this.refuelInfo.totalOilAmount;return e-t<0?0:e-t},isYunCardIndoor:function(){return"yunPay-indoor"===this.pageType}},mounted:function(){var t=this,e=this;this.$bridgefunc.registePageShow((function(){e.$bridgefunc.vuexRead((function(){switch(e.pageShow){case 1:var s=e.$util.cloneDeep(e.$store.state.card);for(var o in""!=s.cardNo&&(e.cardInfo=s),t.$store.state.card)e.$store.state.card[o]="";break;case 2:var a=e.$util.cloneDeep(e.$store.state.elticket);for(var i in""!=a.coucode&&(e.elticket=a),t.$store.state.elticket)e.$store.state.elticket[i]="";break;case 3:console.log("orderNo",e.orderNo),e.orderNo&&e.orderNo.length>0&&e.queryOrder()}e.$bridgefunc.vuexStorage(),e.pageShow=0}))}))},methods:{getUserCardList:function(){this.$Loading.open();var t={token:this.$store.state.login.token},e=this;this.$http.post("/app/json/card/getUserCardList",t).then((function(t){e.$Loading.close();var s=t.data;if(0==s.status){var a=s.data;a&&a.length?e.cardInfo=a[0]:e.$store.state.login.bindCardState="0"}else Object(o.Toast)({message:s.info?s.info:"获取加油卡列表失败",position:"bottom",duration:2e3})}),(function(t){e.$Loading.close(),Object(o.Toast)({message:"获取加油卡列表失败",position:"bottom",duration:2e3})}))},cancelOrder:function(){this.$Loading.open();var t=this,e={token:this.$store.state.login.token,orderNo:t.orderNo};this.$http.post("/app/json/refuel/cancelOrder",e).then((function(e){t.$Loading.close(),0==e.data.status&&(t.orderNo="")}),(function(e){t.$Loading.close()}))},payPage:function(){this.payWay=!this.payWay,this.selectedIndex="0"},selectticket:function(){this.pageShow=2,this.$bridgefunc.customPush({path:"/selectelticket",isnativetop:1,query:{}})},paytypeselect:function(t){this.selectedIndex=t?t.type:"0"},pushSelectCard:function(){this.pageShow=1,this.$bridgefunc.customPush({path:"/refuelcardselect",isnativetop:"1"})},repickOilGun:function(){this.$bridgefunc.customGo(-2)},payClick:function(){if(this.isYunCardIndoor){var t={orgId:this.yunCardInfo.stationCode,orderId:this.yunCardInfo.orderNo,amount:100*this.yunCardInfo.totalAmount},e={payStr:encodeURIComponent(JSON.stringify(t)),pan:this.yunCardInfo.cardNo};return console.log("yunParams",e),void this.$bridgefunc.yunConfirmPayCode(e,(function(t){alert(t)}))}if(0!=this.selectedIndex){this.$Loading.open();var s=this;this.$http.post("/app/json/refuel/refuel",{stationCode:s.refuelInfo.stationCode,gunNo:s.refuelInfo.gunNo,payMode:s.selectedIndex,token:s.$store.state.login.token,stationName:s.refuelInfo.stationName,oilCode:s.refuelInfo.oilCode,oilName:s.refuelInfo.oilName,oilPrice:s.refuelInfo.oilPrice,totalOilQty:s.refuelInfo.totalOilQty,totalOilAmount:s.refuelInfo.totalOilAmount,tradeNo:s.refuelInfo.tradeNo,respData:this.$route.query.respData?decodeURIComponent(this.$route.query.respData):""}).then((function(t){s.$Loading.close();var e=t.data;0==e.status?(s.orderNo=e.data.orderNo,console.log("index",s.selectedIndex),s.pageShow=3,"01"==s.selectedIndex?s.payForWX(e.data):"02"==s.selectedIndex&&s.payForAli(e.data.aliPrepay)):s.$MessageBox.alert(e.info?e.info:"获取订单失败","提示")}),(function(t){s.$Loading.close(),Object(o.Toast)({message:"获取订单失败",position:"bottom",duration:2e3})}))}else{var a=this.refuelInfo.yunCardInfo||{},i={epsSn:0,nozzle:this.refuelInfo.gunNo||"",orgCode:this.refuelInfo.oilCode||"",paidAmount:0,rposNo:a.workstationID||"",rposSn:a.saleItem.transactionNumber||"",rposTime:a.tender.authorization.timeStamp||"",saleItems:[{categoryCode:a.saleItem.productCode||"",goodCode:a.saleItem.additionalProductCode||"",isOil:!0,itemName:this.refuelInfo.oilName||"",payAmount:100*this.refuelInfo.totalOilAmount||"",price:100*a.unitPrice||"",quantity:100*a.quantity||"",rposSn:0,sendAmount:100*this.refuelInfo.totalOilAmount||"",sourceAmount:100*this.refuelInfo.totalOilAmount||"",totalAmount:100*this.refuelInfo.totalOilAmount||""}],srcTransactionAmount:100*this.refuelInfo.totalOilAmount||"",totalAmount:100*this.refuelInfo.totalOilAmount||"",transactionAmount:100*this.refuelInfo.totalOilAmount||"",transactionBalance:100*this.refuelInfo.totalOilAmount||"",voucher:"",voucherAmount:0};console.log("lastInfo",i)}},payForAli:function(t){var e=this;this.$bridgefunc.aliPay(t,(function(t){console.log(t),t?e.queryOrder():Object(o.Toast)({message:"支付失败",position:"bottom",duration:2e3})}))},payForWX:function(t){var e=this;this.$bridgefunc.wxPay(t,(function(t){console.log(t),t?e.queryOrder():Object(o.Toast)({message:"支付失败",position:"bottom",duration:2e3})}))},pushOrderDetail:function(){"01"==this.selectedIndex?this.refuelInfo.payMode="微信支付":"02"==this.selectedIndex&&(this.refuelInfo.payMode="支付宝支付"),this.refuelInfo.payTime=this.$util.getPayTime(),this.$bridgefunc.customPush({path:"/refuelorderdetail",isnativetop:1,query:{oilRecord:encodeURIComponent(JSON.stringify(this.refuelInfo))}})},queryOrder:function(){this.$Loading.open();var t={token:this.$store.state.login.token,orderNo:this.orderNo,stationCode:this.refuelInfo.stationCode},e=this;this.$http.post("/app/json/refuel/queryOrderState",t).then((function(t){e.$Loading.close();var s=t.data;"316"==s.data.bizCode||"318"==s.data.bizCode?e.pushOrderDetail():"313"==s.data.bizCode?e.$bridgefunc.customPush({path:"/oilrecord",isnativetop:"1",query:{selected:"00"}}):e.$MessageBox.alert(s.info?s.info:"查询失败","提示")}),(function(t){e.$Loading.close(),Object(o.Toast)({message:"查询失败",position:"bottom",duration:2e3})}))}},created:function(){if(this.pageType=this.$route.query.pageType,"yunPay-indoor"===this.pageType)return this.yunCardInfo=JSON.parse(decodeURIComponent(this.$route.query.payData)),console.log("this.pageType",this.pageType),void console.log("this.yunCardInfo",this.yunCardInfo);this.refuelInfo=JSON.parse(decodeURIComponent(this.$route.query.refuelInfo)),this.getUserCardList()}},i=(s("qYwc"),s("KHd+")),n=Object(i.a)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bottom"},[t.isYunCardIndoor?s("div",{staticClass:"moudleUp-style"},[s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("订单号")]),t._v(" "),s("span",{staticClass:"right-span"},[t._v(t._s(t.yunCardInfo.orderNo))])]),t._v(" "),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("加油站")]),t._v(" "),s("span",{staticClass:"right-span"},[t._v(t._s(t.yunCardInfo.stationName))])]),t._v(" "),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("金额")]),t._v(" "),s("span",{staticClass:"right-span"},[s("span",[s("span",{staticClass:"money"},[t._v("￥"+t._s(t.yunCardInfo.totalAmount))]),t._v("元\n        ")])])])]):s("div",{staticClass:"moudleUp-style"},[s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("枪号")]),t._v(" "),s("span",{staticClass:"right-span"},[t._v(t._s(t.refuelInfo.gunNo)+"号")])]),t._v(" "),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("油品")]),t._v(" "),s("span",{staticClass:"right-span"},[t._v(t._s(t.refuelInfo.oilName))])]),t._v(" "),s("div",{staticClass:"item"},[s("span",{staticClass:"left-span"},[t._v("金额")]),t._v(" "),s("span",{staticClass:"right-span"},[s("span",[s("span",{staticClass:"money"},[t._v("￥"+t._s(t.refuelInfo.totalOilAmount))]),t._v("元\n        ")])])])]),t._v(" "),s("div",{staticClass:"moudle2_style"},[s("div",{staticClass:"line_style text_style money_style"},[t._v("选择支付方式")]),t._v(" "),t.cardInfo?s("div",{staticClass:"paytype_style moudle_style",on:{click:function(e){return t.paytypeselect()}}},["0"==t.selectedIndex?s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/checked.png"}}):s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/unchecked.png"}}),t._v(" "),s("div",{staticClass:"hint_style"},[s("div",[t._v("加油卡支付（"+t._s(t.cardInfo.cityName)+"）")]),t._v(" "),s("div",{staticClass:"hint_text"},[t._v(t._s(t.cardInfo.cardNo)+"  余额¥ "+t._s(t.cardInfo.totalBalance))])]),t._v(" "),s("div",{staticClass:"btn_change_card",on:{click:t.pushSelectCard}},[t._v("更换")])]):t._e(),t._v(" "),t._l(t.paytype_normal,(function(e){return s("div",{staticClass:"paytype_style moudle_style",on:{click:function(s){return t.paytypeselect(e)}}},[e.type==t.selectedIndex?s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/checked.png"}}):s("img",{staticClass:"img-full",attrs:{src:"static/image/refuel/unchecked.png"}}),t._v(" "),s("img",{staticClass:"img_style",attrs:{src:e.img}}),t._v(" "),s("div",{staticStyle:{flex:"1"}},[t._v(t._s(e.name))])])}))],2),t._v(" "),"0"==t.selectedIndex?s("div",{staticClass:"moudle_style",on:{click:t.selectticket}},[s("div",{staticClass:"text_style hint_style "},[t._v("优惠券")]),t._v(" "),s("div",{staticClass:"text_style hint_text",class:{mtop:t.elticket.limit}},[t._v(t._s(t.elticket.limit?t.elticket.limit:"不适用优惠券"))]),t._v(" "),s("img",{staticClass:"moreimg_style",attrs:{src:"static/images/icon-more.png"}})]):t._e(),t._v(" "),s("div",{staticClass:"moudle_style"},[s("div",{staticClass:"text_style hint_style"},[t._v("需付金额")]),t._v(" "),s("div",{staticClass:"text_style orange"},[t._v("¥ ")]),t._v(" "),s("div",{staticClass:"text_style orange money_style"},[t._v(t._s(t.money))]),t._v(" "),s("div",{staticClass:"text_style"},[t._v("元")])]),t._v(" "),s("div",{staticClass:"sure-div",on:{click:function(e){return t.payClick()}}},[t._v("付款")])])}),[],!1,null,"72dce4f3",null);e.default=n.exports},"N+Y2":function(t,e,s){},qYwc:function(t,e,s){"use strict";var o=s("N+Y2");s.n(o).a}}]);