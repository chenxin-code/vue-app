(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{"28u4":function(t,e,i){"use strict";var s=i("W0oH");i.n(s).a},"2SzD":function(t,e,i){"use strict";i.r(e),i("X1+7");var s=i("8lM+"),n=(i("ilju"),i("5B+z")),o=(i("28u4"),i("KHd+")),a=Object(o.a)({name:"",components:{},props:[],data:function(){return{text:"",placeholder:"",title:"",item:{},showMark:!1}},methods:{textInputChange:function(t){if("nickName"==this.item.key){var e=t.target.value;e.length>10&&(e=e.slice(0,10),this.$Toast("最大输入10个字")),this.text=e}},showMarkFun:function(t,e,i){this.item=t,this.title=e,this.placeholder=i,this.showMark=!0},closeMark:function(){this.showMark=!1,this.text=""},submit:function(){""!=this.text?"email"!=this.item.key||this.$util.checkMail(this.text)?this.$emit("submitData",this.item,this.text):this.$Toast("请输入正确的邮箱"):this.$Toast(this.placeholder)},stopP:function(t){}},created:function(){}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.showMark?i("div",{staticClass:"mark",on:{click:function(e){return e.stopPropagation(),t.closeMark(e)}}},[i("div",{staticClass:"mark-center"},[i("p",{staticClass:"mark-title"},[t._v(t._s(t.title))]),t._v(" "),i("div",{staticClass:"input-text"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],attrs:{placeholder:t.placeholder},domProps:{value:t.text},on:{click:function(e){return e.stopPropagation(),t.stopP(e)},input:[function(e){e.target.composing||(t.text=e.target.value)},t.textInputChange]}})]),t._v(" "),i("div",{staticClass:"btn"},[i("span",{staticClass:"btn-c",on:{click:t.closeMark}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"btn-s",on:{click:t.submit}},[t._v("提交")])])])]):t._e()}),[],!1,null,"6dc0e11d",null).exports,r=i("8LpY"),c=i("dqDD"),h=i("L2JU"),u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},f={name:"setting",components:{UpdateMark:a,DatetimePicker:c.DatetimePicker,Popup:n.a,Picker:s.a},computed:u({},Object(h.c)(["userInfo"])),data:function(){return{settingList:[{name:"头像",id:"0",key:"headImg",type:0},{name:"姓名",id:"1",key:"nickName",type:1},{name:"邮箱",id:"3",key:"email",type:1},{name:"生日",id:"4",key:"birthday",type:1},{name:"性别",id:"9",key:"gender",type:1},{name:"手机号",id:"8",key:"phone",type:1,disabled:1==this.$store.state.globalConfig.appUserInfoPhoneDisabled}],userInfoCP:{},currentDate:new Date,selectIndex:-1,showRightBtn:!1,columns:[{text:"男",value:1},{text:"女",value:2}],sexShow:!1}},methods:{onConfirm:function(t,e){this.sexShow=!1,this.userInfoCP.gender=t.value,this.checkModify()&&(this.showRightBtn=!0)},checkModify:function(){return this.userInfoCP.headImg!=this.userInfo.headImg||this.userInfoCP.nickName!=this.userInfo.nickName||this.userInfoCP.email!=this.userInfo.email||this.userInfoCP.birthday!=this.userInfo.birthday||this.userInfoCP.gender!=this.userInfo.gender},infoChanged:function(t,e){this.userInfoCP[t.key]=e,this.$refs.updateMark.closeMark(),this.checkModify()&&(this.showRightBtn=!0)},saveInfo:function(){this.submitData(!1)},backEvent:function(){var t=this;this.checkModify()?this.$MessageBox.confirm("您还有已修改的信息未保存，是否保存信息!","提示",{cancelButtonText:"直接返回",confirmButtonText:"保存并返回"}).then((function(e){t.submitData(!0)})).catch((function(e){t.$router.go(-1)})):this.$router.go(-1)},getItemLb:function(t){var e=t.key;return 0==t.type?this.userInfoCP[e]?this.userInfoCP.headImg:"2"==this.userInfoCP.gender?"static/image/setting/setting-img.png":"static/image/setting/setting-img-man.png":"gender"!=t.key?this.userInfoCP[e]:"1"==this.userInfoCP[e]?"男":"2"==this.userInfoCP[e]?"女":""},jumpUrl:function(t,e){if(!t.disabled)if(this.selectIndex=e,"0"==t.id)r.a.open({linkFunc:this.linkFunc,token:this.$store.state.login.token});else if("1"==t.id)this.$refs.updateMark.showMarkFun(t,"修改姓名","请输入姓名");else if("2"==t.id);else if("3"==t.id)this.$refs.updateMark.showMarkFun(t,"修改邮箱","请输入邮箱");else if("4"==t.id){if(""!=this.userInfoCP.birthday&&"1"==this.$store.state.globalConfig.can_not_modify_birthday)return void this.$Toast("不支持生日修改！");this.$refs.picker.open()}else"5"==t.id?this.$router.push({path:"/aqgl"}):"6"==t.id||"7"==t.id||("8"==t.id?this.$router.push({path:"/usercenter/choseway"}):"9"==t.id&&(this.sexShow=!0))},changetime:function(t){var e=t.getFullYear(),i=t.getMonth()+1,s=t.getDate(),n=e+"-"+this.bl(i)+"-"+this.bl(s);this.userInfoCP.birthday=n,this.$refs.updateMark.closeMark(),this.checkModify()&&(this.showRightBtn=!0)},bl:function(t){return t<10&&(t="0"+t),t},submitData:function(t){var e=this;this.$Loading.open();var i={token:this.$store.state.login.token};i.avtUrl=this.userInfoCP.headImg,i.nickName=this.userInfoCP.nickName,i.email=this.userInfoCP.email,i.birthday=this.userInfoCP.birthday,i.gender=this.userInfoCP.gender,this.$http.post("/app/json/user/modifyUserInfo",i).then((function(i){e.$Loading.close();var s=i.data;0==s.status?(e.$store.state.userInfo=e.userInfoCP,e.$bridgefunc.vuexStorage(),e.$Toast("修改成功"),t&&e.$router.go(-1)):e.$Toast(s.info?s.info:"修改失败")}),(function(t){e.$Loading.close(),e.$Toast("系统运行过程中遇到问题，请稍候再试")}))},linkFunc:function(t,e){this.$set(this.userInfoCP,"headImg",t),this.checkModify()&&(this.showRightBtn=!0)},modifyHeadImg:function(t){var e=this;this.$Loading.open();var i={token:this.$store.state.login.token,headImg:t};this.$http.post("/app/json/user/modifyHeadImg",i).then((function(i){e.$Loading.close();var s=i.data;if(0==s.status){var n=e.settingList[e.selectIndex];e.$store.state.userInfo[n.key]=t,e.$bridgefunc.vuexStorage(),e.$Toast("修改头像成功")}else e.$Toast(s.info?s.info:"修改失败")}),(function(t){e.$Loading.close(),e.$Toast("系统运行过程中遇到问题，请稍候再试")}))},getMyInfo:function(){var t=this;this.$Loading.open(),this.$http.post("/app/json/user/getUserInfo",{}).then((function(e){t.$Loading.close();var i=e.data;0==i.status?(t.$store.state.userInfo=i.data,t.currentDate=new Date(i.data.birthday),t.$bridgefunc.vuexStorage()):t.$Toast(i.info?i.info:"获取个人信息失败")}),(function(e){t.$Loading.close(),t.$Toast("系统运行过程中遇到问题，请稍候再试")}))}},created:function(){console.log("this.userInfo",this.userInfo),this.userInfoCP=JSON.parse(JSON.stringify(this.userInfo)),this.getMyInfo()}},l=(i("xgTk"),i("2oyh"),Object(o.a)(f,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-info"},[i("nav-top",{on:{backEvent:t.backEvent}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showRightBtn,expression:"showRightBtn"}],staticClass:"right-btn",staticStyle:{right:"0px",height:"44px",top:"0px","padding-right":"10px","font-size":"12px"},on:{click:t.saveInfo}},[t._v("保存")])]),t._v(" "),i("nav-content",[i("div",{staticClass:"center"},[i("ul",{staticClass:"setting-list mine-box-shodow"},t._l(t.settingList,(function(e,s){return i("li",{staticClass:"setting-item public-bar border-bottom info-cellpad",class:{"icon-more":!e.disabled},on:{click:function(i){return t.jumpUrl(e,s)}}},[i("span",{staticClass:"left-text"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"right-text"},[0==e.type?i("img",{attrs:{src:t.getItemLb(e)}}):t._e(),t._v(" "),1==e.type?i("div",{staticClass:"right-title"},[t._v("\n              "+t._s(t.getItemLb(e))+"\n            ")]):t._e()])])})),0)])]),t._v(" "),i("UpdateMark",{ref:"updateMark",on:{submitData:t.infoChanged}}),t._v(" "),i("mt-datetime-picker",{ref:"picker",attrs:{type:"date",startDate:new Date(1930,0,1),endDate:new Date,"year-format":"{value}","month-format":"{value}","date-format":"{value}"},on:{confirm:t.changetime},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}}),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.sexShow,callback:function(e){t.sexShow=e},expression:"sexShow"}},[i("van-picker",{attrs:{"show-toolbar":"",title:"请选择性别",columns:t.columns},on:{cancel:function(e){t.sexShow=!1},confirm:t.onConfirm}})],1)],1)}),[],!1,null,"3652f2b6",null));e.default=l.exports},"2oyh":function(t,e,i){"use strict";var s=i("iWkX");i.n(s).a},RNwn:function(t,e,i){},W0oH:function(t,e,i){},iWkX:function(t,e,i){},xgTk:function(t,e,i){"use strict";var s=i("RNwn");i.n(s).a}}]);